"use strict";(self.webpackChunkbusiness_builder_master_frontend=self.webpackChunkbusiness_builder_master_frontend||[]).push([[5494],{33715:(e,t,n)=>{n.d(t,{l:()=>P});var i,s,a=n(57528),l=n(65043),r=n(33171),o=n(62468),d=n(68655),c=n(23913),h=n(59218),m=n(88787),u=n(85871),x=n(87139),g=n(22107),p=n(98662),j=n(34946),v=n(82459),E=n(35699),C=n(45973),S=n(29244),T=n(76659),b=n(96148),I=n(10202),f=n(48239),A=n(30502),y=n(39081),D=n(58861),k=n(12733),z=n(10585),N=n(70459),w=n(39985),R=n(70579);const O=(0,N.J1)(i||(i=(0,a.A)(["\n  query SearchClients($search: String, $tags: [String!]) {\n    searchClients(search: $search, tags: $tags) {\n      id\n      fName\n      lName\n      email\n      phoneNumber\n      tags\n    }\n  }\n"]))),M=(0,N.J1)(s||(s=(0,a.A)(["\n  query GetAllClientTags {\n    allClientTags\n  }\n"]))),P=e=>{var t;let{selectedClients:n,onSelectionChange:i,allowMultiple:s=!0,placeholder:a="Search clients by name, email, or phone..."}=e;const[N,P]=(0,l.useState)(""),[B,L]=(0,l.useState)([]),[$,F]=(0,l.useState)([0,1]),{data:U}=((0,A.d)(),(0,z.IT)(M)),{loading:J,data:X,error:_}=(0,z.IT)(O,{variables:{search:N||void 0,tags:B.length>0?B:void 0},skip:!N&&0===B.length}),W=(0,w.oU)("text.secondary"),H=(0,w.oU)("text.muted"),G=(0,w.oU)("border.light"),K=e=>{s?n.includes(e)?i(n.filter(t=>t!==e)):i([...n,e]):i([e])},q=()=>{i([])},Y=n.length,Q=(null===X||void 0===X||null===(t=X.searchClients)||void 0===t?void 0:t.length)||0;return(0,R.jsxs)(I.T,{spacing:4,align:"stretch",children:[(0,R.jsxs)(r.n,{allowMultiple:!0,index:$,onChange:e=>F(e),children:[(0,R.jsxs)(c.A,{border:"none",children:[(0,R.jsxs)(o.J,{px:0,children:[(0,R.jsx)(g.a,{flex:"1",textAlign:"left",children:(0,R.jsx)(y.E,{fontWeight:"medium",children:"Search Clients"})}),(0,R.jsx)(d.Q,{})]}),(0,R.jsx)(h.v,{px:0,children:(0,R.jsxs)(I.T,{spacing:3,align:"stretch",children:[(0,R.jsxs)(C.M,{children:[(0,R.jsx)(S.W,{pointerEvents:"none",children:(0,R.jsx)(k.W,{color:H})}),(0,R.jsx)(E.p,{placeholder:a,value:N,onChange:e=>P(e.target.value),bg:(0,w.QQ)("form","fieldBg"),border:"1px",borderColor:(0,w.QQ)("form","fieldBorder"),_focus:{borderColor:(0,w.QQ)("form","fieldBorderFocus"),boxShadow:(0,w.QQ)("form","fieldShadowFocus")}})]}),J&&(0,R.jsxs)(b.z,{justify:"center",py:4,children:[(0,R.jsx)(T.y,{size:"sm"}),(0,R.jsx)(y.E,{fontSize:"sm",color:W,children:"Searching..."})]}),_&&(0,R.jsxs)(m.F,{status:"error",borderRadius:"md",children:[(0,R.jsx)(u._,{}),"Error searching clients: ",_.message]}),(null===X||void 0===X?void 0:X.searchClients)&&X.searchClients.length>0&&(0,R.jsxs)(g.a,{children:[(0,R.jsxs)(b.z,{justify:"space-between",mb:2,children:[(0,R.jsxs)(y.E,{fontSize:"sm",color:W,children:["Found ",Q," client",1!==Q?"s":""]}),s&&(0,R.jsxs)(b.z,{spacing:2,children:[(0,R.jsx)(p.$,{size:"xs",variant:"link",onClick:()=>{if(null!==X&&void 0!==X&&X.searchClients){const e=X.searchClients.map(e=>e.id);i(e)}},children:"Select All"}),Y>0&&(0,R.jsx)(p.$,{size:"xs",variant:"link",onClick:q,children:"Clear"})]})]}),(0,R.jsx)(I.T,{align:"stretch",spacing:1,maxH:"200px",overflowY:"auto",border:"1px",borderColor:G,borderRadius:"md",p:2,children:X.searchClients.map(e=>(0,R.jsx)(g.a,{p:2,borderRadius:"md",_hover:{bg:(0,w.oU)("background.overlay")},children:(0,R.jsxs)(b.z,{justify:"space-between",children:[(0,R.jsxs)(b.z,{spacing:3,flex:1,cursor:"pointer",onClick:()=>K(e.id),children:[(0,R.jsx)(g.a,{onClick:e=>e.stopPropagation(),children:(0,R.jsx)(j.S,{isChecked:n.includes(e.id),onChange:()=>K(e.id)})}),(0,R.jsxs)(I.T,{align:"start",spacing:0,children:[(0,R.jsxs)(y.E,{fontSize:"sm",fontWeight:"medium",children:[e.fName," ",e.lName]}),(0,R.jsx)(y.E,{fontSize:"xs",color:H,children:e.email||e.phoneNumber||"No contact info"})]})]}),e.tags&&e.tags.length>0&&(0,R.jsxs)(D.B,{spacing:1,children:[e.tags.slice(0,2).map(e=>(0,R.jsx)(D.Q,{children:(0,R.jsx)(f.vw,{size:"sm",variant:"subtle",colorScheme:"blue",children:(0,R.jsx)(f.d1,{children:e})})},e)),e.tags.length>2&&(0,R.jsx)(D.Q,{children:(0,R.jsxs)(x.E,{fontSize:"xs",colorScheme:"gray",children:["+",e.tags.length-2]})})]})]})},e.id))})]}),(null===X||void 0===X?void 0:X.searchClients)&&0===X.searchClients.length&&(0,R.jsx)(y.E,{fontSize:"sm",color:H,textAlign:"center",py:4,children:"No clients found matching your search"})]})})]}),(0,R.jsxs)(c.A,{border:"none",children:[(0,R.jsxs)(o.J,{px:0,children:[(0,R.jsx)(g.a,{flex:"1",textAlign:"left",children:(0,R.jsxs)(b.z,{children:[(0,R.jsx)(y.E,{fontWeight:"medium",children:"Filter by Tags"}),B.length>0&&(0,R.jsxs)(x.E,{colorScheme:"blue",fontSize:"xs",children:[B.length," selected"]})]})}),(0,R.jsx)(d.Q,{})]}),(0,R.jsx)(h.v,{px:0,children:null!==U&&void 0!==U&&U.allClientTags&&U.allClientTags.length>0?(0,R.jsxs)(I.T,{align:"stretch",spacing:3,children:[(0,R.jsx)(y.E,{fontSize:"sm",color:W,children:"Select tags to filter clients:"}),(0,R.jsx)(D.B,{spacing:2,children:U.allClientTags.map(e=>(0,R.jsx)(D.Q,{children:(0,R.jsx)(f.vw,{size:"md",variant:B.includes(e)?"solid":"outline",colorScheme:B.includes(e)?"blue":"gray",cursor:"pointer",onClick:()=>(e=>{L(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),_hover:{transform:"scale(1.05)"},children:(0,R.jsx)(f.d1,{children:e})})},e))}),B.length>0&&(0,R.jsx)(p.$,{size:"sm",variant:"ghost",onClick:()=>L([]),children:"Clear Tag Filters"})]}):(0,R.jsx)(y.E,{fontSize:"sm",color:H,textAlign:"center",py:4,children:"No tags available"})})]})]}),Y>0&&(0,R.jsxs)(g.a,{children:[(0,R.jsx)(v.c,{my:2}),(0,R.jsxs)(b.z,{justify:"space-between",children:[(0,R.jsxs)(y.E,{fontSize:"sm",color:W,children:[Y," client",1!==Y?"s":""," selected"]}),(0,R.jsx)(p.$,{size:"xs",variant:"ghost",onClick:q,colorScheme:"red",children:"Clear Selection"})]})]})]})}},94877:(e,t,n)=>{n.d(t,{C:()=>B});var i,s,a,l=n(57528),r=n(65043),o=n(22107),d=n(98662),c=n(44093),h=n(43533),m=n(35699),u=n(45973),x=n(29244),g=n(82846),p=n(15983),j=n(33192),v=n(91933),E=n(91765),C=n(68707),S=n(75780),T=n(96148),b=n(10202),I=n(48239),f=n(30502),A=n(47726),y=n(39081),D=n(58861),k=n(85369),z=n(31881),N=n(10585),w=n(70459),R=n(70579);const O=(0,w.J1)(i||(i=(0,l.A)(["\n  query GetCalendarTags($calendarId: String!) {\n    calendarTags(calendarId: $calendarId) {\n      id\n      name\n      color\n      description\n      usageCount\n    }\n  }\n"]))),M=(0,w.J1)(s||(s=(0,l.A)(["\n  mutation UpsertCalendarTag($calendarId: String!, $input: CalendarTagInput!) {\n    upsertCalendarTag(calendarId: $calendarId, input: $input) {\n      id\n      name\n      color\n      description\n    }\n  }\n"]))),P=(0,w.J1)(a||(a=(0,l.A)(["\n  query SuggestTagColors {\n    suggestTagColors\n  }\n"]))),B=e=>{let{calendarId:t,selectedTags:n,onTagsChange:i,placeholder:s="Add tags..."}=e;const{colorMode:a}=(0,c.G6)(),l=(0,f.d)(),[w,B]=(0,r.useState)(""),[L,$]=(0,r.useState)("#BAE1FF"),[F,U]=(0,r.useState)(!1),[J,X]=(0,r.useState)({}),{data:_,refetch:W}=(0,N.IT)(O,{variables:{calendarId:t},context:{headers:{"x-tenant-id":localStorage.getItem("tenantId")||""}}}),{data:H}=(0,N.IT)(P),[G]=(0,z.n)(M);(0,r.useEffect)(()=>{if(null!==_&&void 0!==_&&_.calendarTags){const e={};_.calendarTags.forEach(t=>{e[t.name]=t.color}),X(e)}},[_]);const K=async()=>{if(w.trim())try{await G({variables:{calendarId:t,input:{name:w.trim(),color:L}},context:{headers:{"x-tenant-id":localStorage.getItem("tenantId")||""}}}),n.includes(w.trim())||i([...n,w.trim()]),B(""),U(!1),W(),l({title:"Tag created",status:"success",duration:2e3})}catch(e){console.error("Error creating tag:",e),l({title:"Error creating tag",description:"Failed to create the tag",status:"error",duration:3e3})}},q=(null===H||void 0===H?void 0:H.suggestTagColors)||["#FFB3BA","#FFDFBA","#FFFFBA","#BAFFC9","#BAE1FF","#E0BBE4","#C7CEEA","#FFDAC1","#B5EAD7","#FFE5B4"],Y=((null===_||void 0===_?void 0:_.calendarTags)||[]).filter(e=>!n.includes(e.name));return(0,R.jsxs)(b.T,{align:"stretch",spacing:3,children:[n.length>0&&(0,R.jsx)(D.B,{spacing:2,children:n.map(e=>(0,R.jsx)(D.Q,{children:(0,R.jsxs)(I.vw,{size:"md",borderRadius:"full",variant:"solid",backgroundColor:J[e]||"#E2E8F0",color:J[e]?"gray.800":"white",children:[(0,R.jsx)(I.d1,{children:e}),(0,R.jsx)(I.TV,{onClick:()=>{return t=e,void i(n.filter(e=>e!==t));var t}})]})},e))}),(0,R.jsx)(T.z,{children:(0,R.jsxs)(g.A,{isOpen:F,onClose:()=>{U(!1),B("")},closeOnBlur:!1,placement:"bottom-start",returnFocusOnClose:!1,children:[(0,R.jsx)(S.W,{children:(0,R.jsxs)(u.M,{size:"sm",children:[(0,R.jsx)(x.W,{children:(0,R.jsx)(k.wJQ,{color:"gray.300"})}),(0,R.jsx)(m.p,{placeholder:s,value:w,onChange:e=>B(e.target.value),onClick:()=>U(!0),onKeyDown:e=>{"Enter"===e.key&&w.trim()?K():"Escape"===e.key&&(U(!1),B(""))}})]})}),(0,R.jsxs)(E.h,{width:"300px",children:[(0,R.jsx)(p.R,{}),(0,R.jsx)(v.q,{}),(0,R.jsx)(C.D,{children:w?"Create New Tag":"Select or Create Tag"}),(0,R.jsx)(j.e,{children:(0,R.jsxs)(b.T,{align:"stretch",spacing:3,children:[Y.length>0&&!w&&(0,R.jsxs)(o.a,{children:[(0,R.jsx)(y.E,{fontSize:"xs",color:"gray.500",mb:2,children:"Existing Tags"}),(0,R.jsx)(D.B,{spacing:2,children:Y.map(e=>(0,R.jsx)(D.Q,{children:(0,R.jsxs)(I.vw,{size:"sm",borderRadius:"full",variant:"solid",backgroundColor:e.color,color:"gray.800",cursor:"pointer",onClick:()=>{var t;t=e.name,n.includes(t)||i([...n,t]),U(!1)},_hover:{opacity:.8},children:[(0,R.jsx)(I.d1,{children:e.name}),e.usageCount>0&&(0,R.jsxs)(y.E,{fontSize:"xs",ml:1,opacity:.7,children:["(",e.usageCount,")"]})]})},e.id))})]}),w&&(0,R.jsxs)(o.a,{children:[(0,R.jsx)(y.E,{fontSize:"xs",color:"gray.500",mb:2,children:"Choose Color"}),(0,R.jsx)(h.x,{templateColumns:"repeat(5, 1fr)",gap:2,children:q.slice(0,10).map(e=>(0,R.jsx)(A.m,{label:e,children:(0,R.jsx)(o.a,{w:"32px",h:"32px",borderRadius:"md",backgroundColor:e,cursor:"pointer",border:L===e?"2px solid":"1px solid",borderColor:L===e?"blue.500":"gray.300",onClick:()=>$(e),display:"flex",alignItems:"center",justifyContent:"center",children:L===e&&(0,R.jsx)(k.CMH,{size:12,color:"gray.700"})})},e))}),(0,R.jsx)(d.$,{size:"sm",colorScheme:"blue",width:"full",mt:3,onClick:K,leftIcon:(0,R.jsx)(k.OiG,{}),children:"Create Tag"})]})]})})]})]})})]})}},95494:(e,t,n)=>{n.d(t,{A:()=>Ge});var i,s,a,l,r,o,d,c,h,m=n(89379),u=n(57528),x=n(65043),g=n(70459),p=n(31881),j=n(30502),v=n(44093),E=n(78460),C=n(11054),S=n(25722),T=n(35929),b=n(15071),I=n(10202),f=n(96148),A=n(39081),y=n(47726),D=n(7189),k=n(67516),z=n(22107),N=n(87139),w=n(3109),R=n(31411),O=n(14566),M=n(25011),P=n(51794),B=n(10227),L=n(29904),$=n(73225),F=n(76668),U=n(35699),J=n(19077),X=n(66686),_=n(72431),W=n(98481),H=n(82459),G=n(61724),K=n(42703),q=n(45973),Y=n(80006),Q=n(98662),V=n(56529),Z=n(98971),ee=n(82497),te=n(58584),ne=n(12730),ie=n(48070),se=n(1009),ae=n(33715),le=n(94877),re=n(39985),oe=n(10585),de=n(34946),ce=n(57371),he=n(53407),me=n(84937),ue=n(5874);const xe=(0,g.J1)(i||(i=(0,u.A)(["\n  query GetEventTasks($calendarEventId: String!) {\n    calendarEventTasks(calendarEventId: $calendarEventId) {\n      id\n      title\n      description\n      status\n      completed\n      completedAt\n      completedBy\n      dueDate\n      order\n      assignedTo\n      notes\n      totalChecklistItems\n      completedChecklistItems\n      progressPercentage\n      checklistItems {\n        id\n        title\n        completed\n        completedAt\n        completedBy\n        order\n      }\n      createdAt\n      updatedAt\n    }\n  }\n"]))),ge=(0,g.J1)(s||(s=(0,u.A)(["\n  mutation CreateEventTask($input: CalendarEventTaskInput!) {\n    createCalendarEventTask(input: $input) {\n      id\n      title\n      description\n      status\n      completed\n      completedAt\n      dueDate\n      order\n      assignedTo\n      notes\n      totalChecklistItems\n      completedChecklistItems\n      progressPercentage\n      checklistItems {\n        id\n        title\n        completed\n        completedAt\n        order\n      }\n    }\n  }\n"]))),pe=(0,g.J1)(a||(a=(0,u.A)(["\n  mutation UpdateEventTask($id: String!, $input: CalendarEventTaskInput!) {\n    updateCalendarEventTask(id: $id, input: $input) {\n      id\n      title\n      description\n      status\n      completed\n      completedAt\n      dueDate\n      order\n      assignedTo\n      notes\n      totalChecklistItems\n      completedChecklistItems\n      progressPercentage\n      checklistItems {\n        id\n        title\n        completed\n        completedAt\n        order\n      }\n    }\n  }\n"]))),je=(0,g.J1)(l||(l=(0,u.A)(["\n  mutation ToggleTaskCompletion($id: String!) {\n    toggleCalendarEventTaskCompletion(id: $id) {\n      id\n      completed\n      completedAt\n      status\n      progressPercentage\n    }\n  }\n"]))),ve=(0,g.J1)(r||(r=(0,u.A)(["\n  mutation DeleteEventTask($id: String!) {\n    deleteCalendarEventTask(id: $id)\n  }\n"]))),Ee=(0,g.J1)(o||(o=(0,u.A)(["\n  mutation AddChecklistItem($taskId: String!, $item: CalendarEventTaskChecklistItemInput!) {\n    addCalendarEventTaskChecklistItem(taskId: $taskId, item: $item) {\n      id\n      checklistItems {\n        id\n        title\n        completed\n        completedAt\n        order\n      }\n      totalChecklistItems\n      completedChecklistItems\n      progressPercentage\n    }\n  }\n"]))),Ce=(0,g.J1)(d||(d=(0,u.A)(["\n  mutation UpdateChecklistItem($input: UpdateCalendarEventTaskChecklistInput!) {\n    updateCalendarEventTaskChecklistItem(input: $input) {\n      id\n      checklistItems {\n        id\n        title\n        completed\n        completedAt\n        order\n      }\n      totalChecklistItems\n      completedChecklistItems\n      progressPercentage\n      completed\n      status\n    }\n  }\n"]))),Se=(0,g.J1)(c||(c=(0,u.A)(["\n  mutation RemoveChecklistItem($taskId: String!, $checklistItemId: String!) {\n    removeCalendarEventTaskChecklistItem(taskId: $taskId, checklistItemId: $checklistItemId) {\n      id\n      checklistItems {\n        id\n        title\n        completed\n        order\n      }\n      totalChecklistItems\n      completedChecklistItems\n      progressPercentage\n    }\n  }\n"])));(0,g.J1)(h||(h=(0,u.A)(["\n  query GetIncompleteTasks($calendarId: String) {\n    incompleteTasks(calendarId: $calendarId) {\n      id\n      title\n      description\n      status\n      completed\n      dueDate\n      calendarEventId\n      totalChecklistItems\n      completedChecklistItems\n      progressPercentage\n      checklistItems {\n        id\n        title\n        completed\n        order\n      }\n    }\n  }\n"])));var Te=n(45852),be=n(70579);const Ie=e=>{let{eventId:t}=e;const n=(0,j.d)(),[i,s]=(0,x.useState)(""),[a,l]=(0,x.useState)(new Set),[r,o]=(0,x.useState)({}),{data:d,loading:c,refetch:h}=(0,oe.IT)(xe,{variables:{calendarEventId:t},skip:!t}),[u]=(0,p.n)(ge,{onCompleted:()=>{n({title:"Task created",status:"success",duration:2e3}),s(""),h()},onError:e=>{n({title:"Error creating task",description:e.message,status:"error",duration:3e3})}}),[g]=(0,p.n)(pe,{onCompleted:()=>{n({title:"Task updated",status:"success",duration:2e3}),h()}}),[v]=(0,p.n)(ve,{onCompleted:()=>{n({title:"Task deleted",status:"success",duration:2e3}),h()}}),[E]=(0,p.n)(je,{onCompleted:()=>{h()}}),[C]=(0,p.n)(Ee,{onCompleted:()=>{h()}}),[S]=(0,p.n)(Ce,{onCompleted:()=>{h()}}),[T]=(0,p.n)(Se,{onCompleted:()=>{h()}}),b=async()=>{i.trim()&&await u({variables:{input:{calendarEventId:t,title:i,checklistItems:[]}}})},y=e=>{const t=r[e];null!==t&&void 0!==t&&t.trim()&&(C({variables:{taskId:e,item:{id:(0,Te.A)(),title:t,completed:!1,order:0}}}),o((0,m.A)((0,m.A)({},r),{},{[e]:""})))},D=(null===d||void 0===d?void 0:d.calendarEventTasks)||[];return c?(0,be.jsx)(A.E,{children:"Loading tasks..."}):(0,be.jsxs)(I.T,{align:"stretch",spacing:4,children:[(0,be.jsx)(A.E,{fontSize:"lg",fontWeight:"bold",children:"Event Tasks"}),(0,be.jsxs)(f.z,{children:[(0,be.jsx)(U.p,{placeholder:"Add a new task...",value:i,onChange:e=>s(e.target.value),onKeyPress:e=>"Enter"===e.key&&b()}),(0,be.jsx)(K.K,{"aria-label":"Add task",icon:(0,be.jsx)(ne.R,{}),onClick:b,colorScheme:"blue",isDisabled:!i.trim()})]}),(0,be.jsx)(I.T,{align:"stretch",spacing:3,children:D.map(e=>{var t;return(0,be.jsxs)(z.a,{borderWidth:1,borderRadius:"md",p:3,children:[(0,be.jsxs)(f.z,{justify:"space-between",mb:2,children:[(0,be.jsxs)(f.z,{flex:1,spacing:3,children:[(0,be.jsx)(de.S,{isChecked:e.completed,onChange:()=>{return t=e.id,void E({variables:{id:t}});var t},size:"lg"}),(0,be.jsxs)(I.T,{align:"start",spacing:0,flex:1,children:[(0,be.jsx)(A.E,{fontWeight:"medium",textDecoration:e.completed?"line-through":"none",opacity:e.completed?.6:1,children:e.title}),e.checklistItems.length>0&&(0,be.jsxs)(f.z,{spacing:2,fontSize:"sm",children:[(0,be.jsxs)(A.E,{color:"gray.600",children:[e.completedChecklistItems,"/",e.totalChecklistItems," completed"]}),(0,be.jsx)(ce.k,{value:e.progressPercentage,size:"sm",width:"100px",colorScheme:"green",borderRadius:"full"})]})]})]}),(0,be.jsxs)(f.z,{children:[(0,be.jsx)(K.K,{"aria-label":"Toggle checklist",icon:a.has(e.id)?(0,be.jsx)(me.M,{}):(0,be.jsx)(ue.D,{}),size:"sm",variant:"ghost",onClick:()=>(e=>{const t=new Set(a);t.has(e)?t.delete(e):t.add(e),l(t)})(e.id)}),(0,be.jsx)(K.K,{"aria-label":"Delete task",icon:(0,be.jsx)(te.d,{}),size:"sm",colorScheme:"red",variant:"ghost",onClick:()=>{return t=e.id,void v({variables:{id:t}});var t}})]})]}),(0,be.jsx)(he.S,{in:a.has(e.id),animateOpacity:!0,children:(0,be.jsxs)(I.T,{align:"stretch",spacing:2,mt:3,pl:8,children:[(0,be.jsx)(H.c,{}),e.checklistItems.map(t=>(0,be.jsxs)(f.z,{spacing:2,children:[(0,be.jsx)(de.S,{isChecked:t.completed,onChange:()=>{return n=e.id,i=t.id,s=t.completed,void S({variables:{input:{taskId:n,checklistItemId:i,completed:!s}}});var n,i,s},size:"sm"}),(0,be.jsx)(A.E,{flex:1,fontSize:"sm",textDecoration:t.completed?"line-through":"none",opacity:t.completed?.6:1,children:t.title}),(0,be.jsx)(K.K,{"aria-label":"Remove item",icon:(0,be.jsx)(te.d,{}),size:"xs",variant:"ghost",onClick:()=>{return n=e.id,i=t.id,void T({variables:{taskId:n,checklistItemId:i}});var n,i}})]},t.id)),(0,be.jsxs)(f.z,{mt:2,children:[(0,be.jsx)(U.p,{placeholder:"Add checklist item...",value:r[e.id]||"",onChange:t=>o((0,m.A)((0,m.A)({},r),{},{[e.id]:t.target.value})),onKeyPress:t=>"Enter"===t.key&&y(e.id),size:"sm"}),(0,be.jsx)(K.K,{"aria-label":"Add item",icon:(0,be.jsx)(ne.R,{}),size:"sm",onClick:()=>y(e.id),isDisabled:!(null!==(t=r[e.id])&&void 0!==t&&t.trim())})]})]})})]},e.id)})}),0===D.length&&(0,be.jsx)(z.a,{textAlign:"center",py:8,color:"gray.500",children:(0,be.jsx)(A.E,{children:"No tasks yet. Add your first task above!"})})]})},fe=e=>{let{eventNotes:t="",onSave:n}=e;const[i,s]=(0,x.useState)(t),[a,l]=(0,x.useState)(!1),r=(0,j.d)();(0,x.useEffect)(()=>{s(t||""),l(!1)},[t]);return(0,be.jsxs)(I.T,{align:"stretch",spacing:4,height:"100%",children:[(0,be.jsx)(A.E,{fontSize:"lg",fontWeight:"bold",children:"Event Notes"}),(0,be.jsx)(J.T,{placeholder:"Add notes for this event... You can use this space to document preparation steps, important details, follow-up actions, or any other information related to this event.",value:i,onChange:e=>{return n=e.target.value,s(n),void l(n!==t);var n},minHeight:"300px",resize:"vertical"}),(0,be.jsx)(Q.$,{colorScheme:"blue",onClick:()=>{n(i),l(!1),r({title:"Notes saved",status:"success",duration:2e3})},isDisabled:!a,alignSelf:"flex-end",children:"Save Notes"}),(0,be.jsxs)(z.a,{fontSize:"sm",color:"gray.600",mt:2,children:[(0,be.jsx)(A.E,{children:"\ud83d\udca1 Tip: Use notes to:"}),(0,be.jsx)(A.E,{ml:4,children:"\u2022 Document meeting agendas and outcomes"}),(0,be.jsx)(A.E,{ml:4,children:"\u2022 Track preparation steps for the event"}),(0,be.jsx)(A.E,{ml:4,children:"\u2022 Record important decisions or action items"}),(0,be.jsx)(A.E,{ml:4,children:"\u2022 Store reference links or resources"})]})]})};var Ae,ye,De,ke,ze=n(96870),Ne=n(28846),we=n(83169),Re=n(24330),Oe=n(73212),Me=n(80454);const Pe=(0,g.J1)(Ae||(Ae=(0,u.A)(["\n  mutation UpdateEvent($id: String!, $input: CalendarEventInput!) {\n    updateEvent(id: $id, input: $input) {\n      id\n      metadata\n    }\n  }\n"]))),Be=(0,g.J1)(ye||(ye=(0,u.A)(["\n  query GetClientByEmail($email: String!) {\n    clientByEmail(email: $email) {\n      id\n      fName\n      lName\n      email\n      phoneNumber\n    }\n  }\n"]))),Le=(0,g.J1)(De||(De=(0,u.A)(["\n  mutation CreateProject($input: ProjectInput!) {\n    createProject(input: $input) {\n      id\n      projectName\n      projectGoal\n      projectDescription\n      billingClient {\n        id\n        fName\n        lName\n      }\n    }\n  }\n"]))),$e=(0,g.J1)(ke||(ke=(0,u.A)(["\n  query GetProject($id: ID!) {\n    project(id: $id) {\n      id\n      projectName\n    }\n  }\n"]))),Fe=e=>{var t,n,i,s,a;let{event:l,calendarId:r,onCancel:o,onReschedule:d,onSendReminder:c,onPaymentStatusUpdate:h}=e;const{colorMode:u}=(0,v.G6)(),g=(0,j.d)(),y=(null===(t=l.extendedProps)||void 0===t?void 0:t.metadata)||l.metadata||{},{isOpen:D,onOpen:w,onClose:R}=(0,ze.j)(),O=y["X-BOOKER-NAME"]||"Unknown",P=y["X-BOOKER-EMAIL"]||"",B=y["X-BOOKER-PHONE"]||"",L=y["X-BOOKER-TIMEZONE"]||"UTC",X=y["X-BOOKING-STATUS"]||"CONFIRMED",_=y["X-PAYMENT-STATUS"]||"NOT_REQUIRED",W=y["X-PAYMENT-AMOUNT"],K=y["X-PAYMENT-CURRENCY"]||"USD",q=y["X-MEETING-LINK"],Y=y["X-BOOKING-TOKEN"],Z=y["X-PROJECT-ID"],[ee,te]=(0,x.useState)(_),ne=(null===(n=l.title)||void 0===n?void 0:n.split(" - ")[0])||"Booking Session",[ie,ae]=(0,x.useState)({projectName:ne,projectGoal:"Complete ".concat(ne," session and deliver outcomes"),projectDescription:"Project for ".concat(O,"'s ").concat(ne," booked on ").concat((0,Me.GP)(new Date,"MMMM d, yyyy"))}),{data:le,loading:de}=(0,oe.IT)(Be,{variables:{email:P},skip:!P,context:{headers:{"x-tenant-id":localStorage.getItem("tenantId")||""}}}),ce=!(null===le||void 0===le||!le.clientByEmail),he=null===le||void 0===le?void 0:le.clientByEmail,{data:me,loading:ue,refetch:xe}=(0,oe.IT)($e,{variables:{id:Z||""},skip:!Z,context:{headers:{"x-tenant-id":localStorage.getItem("tenantId")||""}}}),ge=!(null===me||void 0===me||!me.project),pe=null===me||void 0===me?void 0:me.project,[je,{loading:ve}]=(0,p.n)(Le,{onCompleted:async e=>{const t=e.createProject.id,n=e.createProject.projectName;g({title:"Project Created",description:'"'.concat(n,'" has been created successfully'),status:"success",duration:3e3,isClosable:!0});try{await Ee({variables:{id:l.id,input:{calendarId:r,title:l.title,startTime:l.start||l.startTime,endTime:l.end||l.endTime,metadata:(0,m.A)((0,m.A)({},y),{},{"X-PROJECT-ID":t,"X-PROJECT-NAME":n})}},context:{headers:{"x-tenant-id":localStorage.getItem("tenantId")||""}}}),await xe(),R(),g({title:"Booking Updated",description:"Project has been linked to this booking",status:"success",duration:2e3,isClosable:!0})}catch(i){console.error("Error linking project to booking:",i),g({title:"Warning",description:"Project created but failed to link to booking",status:"warning",duration:5e3,isClosable:!0})}},onError:e=>{g({title:"Error creating project",description:e.message,status:"error",duration:5e3,isClosable:!0})}}),[Ee,{loading:Ce}]=(0,p.n)(Pe,{onCompleted:()=>{g({title:"Payment status updated",status:"success",duration:3e3,isClosable:!0}),h&&h()},onError:e=>{g({title:"Error updating payment status",description:e.message,status:"error",duration:5e3,isClosable:!0})}}),Se=(0,re.oU)("light"===u?"text.primary":"text.primaryDark",u),Te=(0,re.oU)("light"===u?"text.secondary":"text.secondaryDark",u),Ie="light"===u?"white":"gray.800",fe="light"===u?"gray.200":"gray.600",Ae=l.start?new Date(l.start):l.startTime?new Date(l.startTime):null,ye=l.end?new Date(l.end):l.endTime?new Date(l.endTime):null;console.log("\ud83d\udcc5 BookingDetailsView - Event data:",{event:l,metadata:y,startDate:Ae,endDate:ye,startRaw:l.start,startTime:l.startTime,endRaw:l.end,endTime:l.endTime});const De=[];Object.keys(y).forEach(e=>{if(e.startsWith("X-BOOKING-QUESTION-")){const t=e.replace("X-BOOKING-QUESTION-",""),n="X-BOOKING-ANSWER-".concat(t);y[n]&&De.push({question:y[e],answer:y[n]})}});const ke=()=>{switch(ee){case"COMPLETED":return"green";case"PENDING":return"yellow";case"FAILED":return"red";case"REFUNDED":return"orange";default:return"gray"}};return(0,be.jsxs)(I.T,{spacing:6,align:"stretch",width:"100%",children:[(0,be.jsxs)(z.a,{children:[(0,be.jsxs)(f.z,{spacing:2,mb:2,children:[(0,be.jsx)(M.I,{as:se.wIk,color:"blue.500",boxSize:5}),(0,be.jsx)(Ne.D,{size:"md",color:Se,children:"Public Booking Details"})]}),(0,be.jsxs)(f.z,{spacing:2,children:[(0,be.jsx)(N.E,{colorScheme:(()=>{switch(X){case"CONFIRMED":return"green";case"PENDING":return"yellow";case"CANCELLED":return"red";default:return"gray"}})(),fontSize:"sm",children:X}),"NOT_REQUIRED"!==_&&(0,be.jsxs)(N.E,{colorScheme:ke(),fontSize:"sm",children:["Payment: ",_]})]})]}),(0,be.jsx)(H.c,{}),(0,be.jsx)(we.Z,{bg:Ie,borderColor:fe,borderWidth:"1px",children:(0,be.jsxs)(Re.b,{children:[(0,be.jsx)(Ne.D,{size:"sm",color:Se,mb:4,children:"Booker Information"}),(0,be.jsxs)(I.T,{align:"stretch",spacing:3,children:[(0,be.jsxs)(f.z,{children:[(0,be.jsx)(M.I,{as:se.JXP,color:Te}),(0,be.jsx)(A.E,{color:Te,fontSize:"sm",width:"100px",children:"Name:"}),(0,be.jsx)(A.E,{color:Se,fontWeight:"medium",children:O})]}),P&&(0,be.jsxs)(f.z,{children:[(0,be.jsx)(M.I,{as:se.pHD,color:Te}),(0,be.jsx)(A.E,{color:Te,fontSize:"sm",width:"100px",children:"Email:"}),(0,be.jsx)(A.E,{color:Se,fontWeight:"medium",children:P})]}),B&&(0,be.jsxs)(f.z,{children:[(0,be.jsx)(M.I,{as:se.QFc,color:Te}),(0,be.jsx)(A.E,{color:Te,fontSize:"sm",width:"100px",children:"Phone:"}),(0,be.jsx)(A.E,{color:Se,fontWeight:"medium",children:B})]}),(0,be.jsxs)(f.z,{children:[(0,be.jsx)(M.I,{as:se.Ohp,color:Te}),(0,be.jsx)(A.E,{color:Te,fontSize:"sm",width:"100px",children:"Timezone:"}),(0,be.jsx)(A.E,{color:Se,fontWeight:"medium",children:L})]}),(0,be.jsx)(H.c,{}),(0,be.jsx)(z.a,{children:de?(0,be.jsx)(A.E,{fontSize:"sm",color:Te,children:"Checking client status..."}):ce?(0,be.jsxs)(I.T,{align:"stretch",spacing:2,children:[(0,be.jsxs)(f.z,{spacing:2,children:[(0,be.jsx)(M.I,{as:se.YrT,color:"green.500"}),(0,be.jsx)(A.E,{fontSize:"sm",color:"green.600",fontWeight:"medium",children:"Client exists in database"}),(0,be.jsxs)(N.E,{colorScheme:"green",fontSize:"xs",children:[null===he||void 0===he?void 0:he.fName," ",null===he||void 0===he?void 0:he.lName]})]}),(0,be.jsx)(Q.$,{leftIcon:(0,be.jsx)(M.I,{as:se.HaR}),colorScheme:"green",variant:"outline",size:"sm",onClick:()=>window.open("/client/".concat(null===he||void 0===he?void 0:he.id),"_blank"),width:"full",children:"View Client Details"})]}):(0,be.jsxs)(I.T,{align:"stretch",spacing:2,children:[(0,be.jsxs)(f.z,{spacing:2,children:[(0,be.jsx)(M.I,{as:se.JXP,color:"orange.500"}),(0,be.jsx)(A.E,{fontSize:"sm",color:"orange.600",fontWeight:"medium",children:"Client not found in database"})]}),(0,be.jsx)(Q.$,{leftIcon:(0,be.jsx)(M.I,{as:se.JXP}),colorScheme:"orange",variant:"outline",size:"sm",onClick:()=>{const e=O.split(" "),t=e[0]||"",n=e.slice(1).join(" ")||"",i=new URLSearchParams({fName:t,lName:n,email:P,phoneNumber:B,source:"booking",bookingToken:Y||""});window.open("/clients/new?".concat(i.toString()),"_blank")},width:"full",children:"Create Client Record"}),(0,be.jsx)(A.E,{fontSize:"xs",color:Te,children:"Opens pre-filled client form in new tab"})]})})]})]})}),(0,be.jsx)(we.Z,{bg:Ie,borderColor:fe,borderWidth:"1px",children:(0,be.jsxs)(Re.b,{children:[(0,be.jsx)(Ne.D,{size:"sm",color:Se,mb:4,children:"Appointment Details"}),(0,be.jsxs)(I.T,{align:"stretch",spacing:3,children:[Ae&&(0,be.jsxs)(f.z,{children:[(0,be.jsx)(M.I,{as:se.wIk,color:Te}),(0,be.jsx)(A.E,{color:Te,fontSize:"sm",width:"100px",children:"Date:"}),(0,be.jsx)(A.E,{color:Se,fontWeight:"medium",children:(0,Me.GP)(Ae,"EEEE, MMMM d, yyyy")})]}),Ae&&ye&&(0,be.jsxs)(f.z,{children:[(0,be.jsx)(M.I,{as:se.Ohp,color:Te}),(0,be.jsx)(A.E,{color:Te,fontSize:"sm",width:"100px",children:"Time:"}),(0,be.jsxs)(A.E,{color:Se,fontWeight:"medium",children:[(0,Me.GP)(Ae,"h:mm a")," - ",(0,Me.GP)(ye,"h:mm a")]})]}),(null===(i=l.extendedProps)||void 0===i?void 0:i.location)&&(0,be.jsxs)(f.z,{align:"start",children:[(0,be.jsx)(M.I,{as:se.HzC,color:Te,mt:1}),(0,be.jsx)(A.E,{color:Te,fontSize:"sm",width:"100px",children:"Location:"}),(0,be.jsx)(A.E,{color:Se,fontWeight:"medium",children:"string"===typeof l.extendedProps.location?l.extendedProps.location:(null===(s=l.extendedProps.location)||void 0===s?void 0:s.name)||(null===(a=l.extendedProps.location)||void 0===a?void 0:a.details)||"N/A"})]}),q&&(0,be.jsxs)(f.z,{children:[(0,be.jsx)(M.I,{as:se.HaR,color:Te}),(0,be.jsx)(A.E,{color:Te,fontSize:"sm",width:"100px",children:"Meeting Link:"}),(0,be.jsx)(Q.$,{as:"a",href:q,target:"_blank",size:"sm",colorScheme:"blue",variant:"link",rightIcon:(0,be.jsx)(se.HaR,{}),children:"Join Meeting"})]})]})]})}),"NOT_REQUIRED"!==_&&(0,be.jsx)(we.Z,{bg:Ie,borderColor:fe,borderWidth:"1px",children:(0,be.jsxs)(Re.b,{children:[(0,be.jsx)(Ne.D,{size:"sm",color:Se,mb:4,children:"Payment Information"}),(0,be.jsxs)(I.T,{align:"stretch",spacing:3,children:[(0,be.jsxs)(f.z,{children:[(0,be.jsx)(M.I,{as:se.z8N,color:Te}),(0,be.jsx)(A.E,{color:Te,fontSize:"sm",width:"100px",children:"Amount:"}),(0,be.jsx)(A.E,{color:Se,fontWeight:"medium",children:W?"".concat(K," $").concat((W/100).toFixed(2)):"N/A"})]}),(0,be.jsxs)(I.T,{align:"stretch",spacing:2,children:[(0,be.jsxs)(f.z,{children:[(0,be.jsx)(A.E,{color:Te,fontSize:"sm",width:"100px",children:"Status:"}),(0,be.jsx)(N.E,{colorScheme:ke(),children:ee})]}),(0,be.jsxs)(z.a,{children:[(0,be.jsx)(A.E,{color:Te,fontSize:"xs",mb:1,children:"Update Payment Status:"}),(0,be.jsxs)(G.l,{value:ee,onChange:e=>(async e=>{te(e);try{await Ee({variables:{id:l.id,input:{calendarId:r,title:l.title,startTime:l.start||l.startTime,endTime:l.end||l.endTime,metadata:(0,m.A)((0,m.A)({},y),{},{"X-PAYMENT-STATUS":e})}},context:{headers:{"x-tenant-id":localStorage.getItem("tenantId")||""}}}),g({title:"Payment status updated",description:"Status changed to ".concat(e),status:"success",duration:3e3,isClosable:!0}),h&&h()}catch(t){console.error("Error updating payment status:",t),te(_),g({title:"Error updating payment status",description:t instanceof Error?t.message:"Failed to update payment status",status:"error",duration:5e3,isClosable:!0})}})(e.target.value),size:"sm",isDisabled:Ce,children:[(0,be.jsx)("option",{value:"NOT_REQUIRED",children:"Not Required"}),(0,be.jsx)("option",{value:"PENDING",children:"Pending"}),(0,be.jsx)("option",{value:"COMPLETED",children:"Completed"}),(0,be.jsx)("option",{value:"FAILED",children:"Failed"}),(0,be.jsx)("option",{value:"REFUNDED",children:"Refunded"})]})]})]}),(0,be.jsx)(H.c,{}),(0,be.jsx)(z.a,{children:ue?(0,be.jsx)(A.E,{fontSize:"sm",color:Te,children:"Checking project status..."}):ge?(0,be.jsxs)(I.T,{align:"stretch",spacing:2,children:[(0,be.jsxs)(f.z,{spacing:2,children:[(0,be.jsx)(M.I,{as:se.YrT,color:"green.500"}),(0,be.jsx)(A.E,{fontSize:"sm",color:"green.600",fontWeight:"medium",children:"Project linked to booking"}),(0,be.jsx)(N.E,{colorScheme:"green",fontSize:"xs",children:null===pe||void 0===pe?void 0:pe.projectName})]}),(0,be.jsx)(Q.$,{leftIcon:(0,be.jsx)(M.I,{as:se.HaR}),colorScheme:"green",variant:"outline",size:"sm",onClick:()=>window.open("/project/".concat(Z),"_blank"),width:"full",children:"View Project"})]}):(0,be.jsxs)(I.T,{align:"stretch",spacing:2,children:[(0,be.jsxs)(f.z,{spacing:2,children:[(0,be.jsx)(M.I,{as:se.UDU,color:"blue.500"}),(0,be.jsx)(A.E,{fontSize:"sm",color:"blue.600",fontWeight:"medium",children:"No project linked yet"})]}),(0,be.jsx)(Q.$,{leftIcon:(0,be.jsx)(M.I,{as:se.UDU}),colorScheme:"blue",variant:"solid",size:"sm",onClick:w,width:"full",isDisabled:!ce,children:"Create Project"}),!ce&&(0,be.jsx)(A.E,{fontSize:"xs",color:Te,children:"Create a client record first before creating a project"})]})}),(0,be.jsx)(H.c,{}),(0,be.jsxs)(z.a,{children:[(0,be.jsx)(Q.$,{leftIcon:(0,be.jsx)(M.I,{as:se.jH2}),colorScheme:ge?"purple":"gray",variant:"outline",size:"sm",onClick:()=>{var e;if(!ce)return void g({title:"Client not found",description:'Please create a client record first using the "Create Client" button',status:"warning",duration:5e3,isClosable:!0});if(!ge)return void g({title:"Project required",description:'Please create a project first using the "Create Project" button',status:"warning",duration:5e3,isClosable:!0});const t=(null===(e=l.title)||void 0===e?void 0:e.split(" - ")[0])||"Booking Session",n=W?(W/100).toFixed(2):"0.00",i=new URLSearchParams({itemName:t,itemPrice:n,itemQuantity:"1",clientEmail:P,clientName:O,clientPhone:B,currency:K,projectId:Z||"",notes:"Bill for booking on ".concat(Ae?(0,Me.GP)(Ae,"MMMM d, yyyy"):""," at ").concat(Ae?(0,Me.GP)(Ae,"h:mm a"):"",". Booking Token: ").concat(Y,". Project: ").concat((null===pe||void 0===pe?void 0:pe.projectName)||"N/A")});window.open("/bills/new?".concat(i.toString()),"_blank")},width:"full",isDisabled:!ge,children:"Issue Bill"}),(0,be.jsx)(A.E,{fontSize:"xs",color:Te,mt:2,children:ge?"Create a formal invoice for this booking":"Create a project first before issuing a bill"})]})]})]})}),De.length>0&&(0,be.jsx)(we.Z,{bg:Ie,borderColor:fe,borderWidth:"1px",children:(0,be.jsxs)(Re.b,{children:[(0,be.jsx)(Ne.D,{size:"sm",color:Se,mb:4,children:"Additional Information"}),(0,be.jsx)(I.T,{align:"stretch",spacing:3,children:De.map((e,t)=>(0,be.jsxs)(z.a,{children:[(0,be.jsx)(A.E,{color:Te,fontSize:"sm",mb:1,children:e.question}),(0,be.jsx)(A.E,{color:Se,fontWeight:"medium",pl:4,children:e.answer})]},t))})]})}),(0,be.jsx)(H.c,{}),(0,be.jsxs)(Oe.r,{columns:{base:1,md:3},spacing:3,children:[c&&(0,be.jsx)(Q.$,{colorScheme:"blue",variant:"outline",onClick:c,children:"Send Reminder"}),d&&(0,be.jsx)(Q.$,{colorScheme:"orange",variant:"outline",onClick:d,children:"Reschedule"}),o&&(0,be.jsx)(Q.$,{colorScheme:"red",variant:"outline",onClick:o,children:"Cancel Booking"})]}),Y&&(0,be.jsx)(z.a,{pt:2,children:(0,be.jsxs)(A.E,{color:Te,fontSize:"xs",children:["Booking Token: ",Y]})}),(0,be.jsxs)(E.aF,{isOpen:D,onClose:R,size:"lg",children:[(0,be.jsx)(C.m,{backdropFilter:"blur(4px)"}),(0,be.jsxs)(S.$,{bg:Ie,borderColor:fe,borderWidth:"1px",children:[(0,be.jsx)(b.r,{color:Se,children:(0,be.jsxs)(f.z,{spacing:2,children:[(0,be.jsx)(M.I,{as:se.UDU,color:"blue.500"}),(0,be.jsx)(A.E,{children:"Create Project for Booking"})]})}),(0,be.jsx)(T.s,{color:Te}),(0,be.jsx)(k.c,{pb:6,children:(0,be.jsxs)(I.T,{spacing:4,align:"stretch",children:[(0,be.jsxs)(z.a,{bg:"light"===u?"blue.50":"blue.900",p:3,borderRadius:"md",children:[(0,be.jsxs)(A.E,{fontSize:"sm",color:Se,children:[(0,be.jsx)("strong",{children:"Client:"})," ",O," (",P,")"]}),(0,be.jsxs)(A.E,{fontSize:"sm",color:Se,children:[(0,be.jsx)("strong",{children:"Session:"})," ",ne]})]}),(0,be.jsxs)($.MJ,{isRequired:!0,children:[(0,be.jsx)(F.l,{color:Se,fontSize:"sm",children:"Project Name"}),(0,be.jsx)(U.p,{value:ie.projectName,onChange:e=>ae((0,m.A)((0,m.A)({},ie),{},{projectName:e.target.value})),placeholder:"Enter project name",bg:"light"===u?"white":"gray.700",borderColor:fe,color:Se})]}),(0,be.jsxs)($.MJ,{isRequired:!0,children:[(0,be.jsx)(F.l,{color:Se,fontSize:"sm",children:"Project Goal (max 17 words)"}),(0,be.jsx)(J.T,{value:ie.projectGoal,onChange:e=>ae((0,m.A)((0,m.A)({},ie),{},{projectGoal:e.target.value})),placeholder:"Enter project goal",rows:2,bg:"light"===u?"white":"gray.700",borderColor:fe,color:Se})]}),(0,be.jsxs)($.MJ,{children:[(0,be.jsx)(F.l,{color:Se,fontSize:"sm",children:"Project Description (max 70 words)"}),(0,be.jsx)(J.T,{value:ie.projectDescription,onChange:e=>ae((0,m.A)((0,m.A)({},ie),{},{projectDescription:e.target.value})),placeholder:"Enter project description",rows:3,bg:"light"===u?"white":"gray.700",borderColor:fe,color:Se})]})]})}),(0,be.jsxs)(V.j,{children:[(0,be.jsx)(Q.$,{variant:"ghost",mr:3,onClick:R,children:"Cancel"}),(0,be.jsx)(Q.$,{colorScheme:"blue",onClick:async()=>{if(ce)try{await je({variables:{input:{projectName:ie.projectName,projectGoal:ie.projectGoal,projectDescription:ie.projectDescription,billingClient:he.id}},context:{headers:{"x-tenant-id":localStorage.getItem("tenantId")||""}}})}catch(e){console.error("Error creating project:",e)}else g({title:"Client required",description:"Please create a client record first",status:"warning",duration:5e3,isClosable:!0})},isLoading:ve,leftIcon:(0,be.jsx)(M.I,{as:se.UDU}),children:"Create Project"})]})]})]})]})};var Ue,Je,Xe;const _e=(0,g.J1)(Ue||(Ue=(0,u.A)(["\n  mutation CreateEvent($input: CalendarEventInput!) {\n    createEvent(input: $input) {\n      id\n      title\n      startTime\n      endTime\n    }\n  }\n"]))),We=(0,g.J1)(Je||(Je=(0,u.A)(["\n  mutation UpdateEvent($id: String!, $input: CalendarEventInput!) {\n    updateEvent(id: $id, input: $input) {\n      id\n      title\n      startTime\n      endTime\n    }\n  }\n"]))),He=(0,g.J1)(Xe||(Xe=(0,u.A)(["\n  mutation CancelEvent($id: String!, $reason: String) {\n    cancelEvent(id: $id, reason: $reason)\n  }\n"]))),Ge=e=>{var t,n,i;let{isOpen:s,onClose:a,calendarId:l,event:r,initialDate:o,initialTimeRange:d,onSuccess:c}=e;const h=(0,j.d)(),{colorMode:u}=(0,v.G6)(),g=!!r&&!!r.id,oe="PUBLIC_BOOKING"===(null===r||void 0===r||null===(t=r.extendedProps)||void 0===t||null===(n=t.metadata)||void 0===n?void 0:n["X-EVENT-TYPE"])||"PUBLIC_BOOKING"===(null===r||void 0===r||null===(i=r.metadata)||void 0===i?void 0:i["X-EVENT-TYPE"]),de=((0,re.oU)("light"===u?"background.card":"background.darkSurface",u),(0,re.oU)("light"===u?"background.light":"background.taskCard",u)),ce=((0,re.oU)("light"===u?"text.primary":"text.primaryDark",u),(0,re.oU)("light"===u?"text.secondary":"text.secondaryDark",u)),he=((0,re.oU)("light"===u?"text.muted":"text.mutedDark",u),(0,re.oU)("border.darkCard",u)),[me,ue]=(0,x.useState)({title:"",description:"",startTime:"",endTime:"",allDay:!1,location:"",status:"CONFIRMED",visibility:"PUBLIC",eventType:"STANDARD",broadcastData:{smsContent:"",emailSubject:"",emailContent:"",recipientListId:"",selectedClientIds:[],recipientCount:0,scheduledSendTime:"",useAlphaId:!1},attendees:[],recurrence:{enabled:!1,frequency:"DAILY",interval:1,endDate:""},reminders:[{minutes:15,type:"NOTIFICATION"}],attachments:[],metadata:{},categories:[],eventNotes:""}),[xe,ge]=(0,x.useState)(""),[pe,je]=(0,x.useState)("");(0,x.useEffect)(()=>{if(console.log("\ud83c\udfac EventModal opened"),console.log("\ud83d\udcdd Initial event prop:",r),console.log("\ud83d\udcc5 Calendar ID:",l),console.log("\ud83d\udcc6 Initial Date:",o),console.log("\u23f0 Initial Time Range:",d),console.log("\u270f\ufe0f Edit Mode:",g),r&&r.id){var e,t,n,i,s,a,c,h,u,x,p,j,v,E,C,S,T,b,I,f,A,y,D,k,z,N,w,R,O,M,P,B,L,$,F,U;console.log("\ud83d\udd27 Setting up edit mode with event:",r);const l=new Date(r.startTime),o=new Date(r.endTime),d=e=>{const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0");return"".concat(t,"-").concat(n,"-").concat(i,"T").concat(s,":").concat(a)};console.log("\ud83d\udd0d Event data loaded:"),console.log("  Event ID:",r.id),console.log("  Full metadata:",r.metadata),console.log("  Metadata type:",typeof r.metadata),console.log("  X-EVENT-TYPE:",null===(e=r.metadata)||void 0===e?void 0:e["X-EVENT-TYPE"]),console.log("  Event type resolved:",(null===(t=r.metadata)||void 0===t?void 0:t["X-EVENT-TYPE"])||(null===(n=r.metadata)||void 0===n?void 0:n.eventType)||"STANDARD");let m=r.metadata;if("string"===typeof r.metadata)try{m=JSON.parse(r.metadata),console.log("  Parsed metadata:",m)}catch(J){console.error("  Failed to parse metadata:",J)}ue({title:r.title||"",description:r.description||"",startTime:d(l),endTime:d(o),allDay:r.isAllDay||r.allDay||!1,location:(null===(i=r.location)||void 0===i?void 0:i.address)||r.location||"",status:r.status||"CONFIRMED",visibility:r.visibility||"PUBLIC",eventType:(null===(s=r.metadata)||void 0===s?void 0:s["X-EVENT-TYPE"])||(null===(a=r.metadata)||void 0===a?void 0:a.eventType)||"STANDARD",broadcastData:{smsContent:(null===(c=r.metadata)||void 0===c?void 0:c["X-SMS-CONTENT"])||(null===(h=r.metadata)||void 0===h||null===(u=h.broadcastData)||void 0===u?void 0:u.smsContent)||"",emailSubject:(null===(x=r.metadata)||void 0===x?void 0:x["X-EMAIL-SUBJECT"])||(null===(p=r.metadata)||void 0===p||null===(j=p.broadcastData)||void 0===j?void 0:j.emailSubject)||"",emailContent:(null===(v=r.metadata)||void 0===v?void 0:v["X-EMAIL-CONTENT"])||(null===(E=r.metadata)||void 0===E||null===(C=E.broadcastData)||void 0===C?void 0:C.emailContent)||"",recipientListId:(null===(S=r.metadata)||void 0===S?void 0:S["X-SMS-RECIPIENT-LIST"])||(null===(T=r.metadata)||void 0===T?void 0:T["X-EMAIL-RECIPIENT-LIST"])||(null===(b=r.metadata)||void 0===b||null===(I=b.broadcastData)||void 0===I?void 0:I.recipientListId)||"",selectedClientIds:(null===(f=r.metadata)||void 0===f?void 0:f["X-SELECTED-CLIENT-IDS"])||(null===(A=r.metadata)||void 0===A||null===(y=A.broadcastData)||void 0===y?void 0:y.selectedClientIds)||[],recipientCount:(null===(D=r.metadata)||void 0===D||null===(k=D.broadcastData)||void 0===k?void 0:k.recipientCount)||0,scheduledSendTime:(null===(z=r.metadata)||void 0===z?void 0:z["X-BROADCAST-SCHEDULED"])||(null===(N=r.metadata)||void 0===N||null===(w=N.broadcastData)||void 0===w?void 0:w.scheduledSendTime)||"",useAlphaId:(null===(R=r.metadata)||void 0===R?void 0:R["X-USE-ALPHA-ID"])||(null===(O=r.metadata)||void 0===O||null===(M=O.broadcastData)||void 0===M?void 0:M.useAlphaId)||!1},attendees:(null===(P=r.attendees)||void 0===P?void 0:P.map(e=>({clientId:e.clientId,email:e.email,name:e.name,status:e.status,role:e.role,isOrganizer:e.isOrganizer,rsvpRequired:e.rsvpRequired})))||[],recurrence:{enabled:!!r.recurrence,frequency:(null===(B=r.recurrence)||void 0===B?void 0:B.frequency)||"DAILY",interval:(null===(L=r.recurrence)||void 0===L?void 0:L.interval)||1,endDate:(null===($=r.recurrence)||void 0===$?void 0:$.endDate)||""},reminders:(null===(F=r.reminders)||void 0===F?void 0:F.map(e=>({minutes:e.minutesBefore||e.minutes||15,type:"PUSH"===e.method?"NOTIFICATION":e.method||"EMAIL"})))||[{minutes:15,type:"NOTIFICATION"}],attachments:(null===(U=r.attachments)||void 0===U?void 0:U.map(e=>({name:e.name,url:e.url})))||[],metadata:r.metadata||{},categories:r.categories||[],eventNotes:r.eventNotes||""})}else if(d)console.log("\u23f0 Setting up create mode with time range:",d),ue(e=>(0,m.A)((0,m.A)({},e),{},{title:"",description:"",startTime:d.start,endTime:d.end,allDay:d.isAllDay||!1,status:"CONFIRMED",visibility:"PUBLIC",eventType:"STANDARD",broadcastData:{smsContent:"",emailSubject:"",emailContent:"",recipientListId:"",selectedClientIds:[],recipientCount:0,scheduledSendTime:"",useAlphaId:!1},attendees:[],reminders:[{minutes:15,type:"NOTIFICATION"}],attachments:[],metadata:{},categories:[]}));else if(o){console.log("\ud83d\udcc5 Setting up create mode with date:",o);const[e,t,n]=o.split("-").map(Number),i=new Date(e,t-1,n,9,0,0),s=new Date(e,t-1,n,9,10,0),a=e=>{const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0");return"".concat(t,"-").concat(n,"-").concat(i,"T").concat(s,":").concat(a)},l=a(i),r=a(s);console.log("\ud83d\udcc5 Clicked date:",o),console.log("\u23f0 Start time:",i),console.log("\u23f0 End time:",s),console.log("\ud83d\udcdd Start formatted:",l),console.log("\ud83d\udcdd End formatted:",r),ue(e=>(0,m.A)((0,m.A)({},e),{},{title:"",description:"",startTime:l,endTime:r,allDay:!0,status:"CONFIRMED",visibility:"PUBLIC",eventType:"STANDARD",broadcastData:{smsContent:"",emailSubject:"",emailContent:"",recipientListId:"",selectedClientIds:[],recipientCount:0,scheduledSendTime:"",useAlphaId:!1},attendees:[],reminders:[{minutes:15,type:"NOTIFICATION"}],attachments:[],metadata:{},categories:[]}))}else{const e=new Date,t=new Date(e);t.setHours(t.getHours()+1,0,0,0);const n=new Date(t);n.setMinutes(n.getMinutes()+10),ue(e=>(0,m.A)((0,m.A)({},e),{},{startTime:t.toISOString().slice(0,16),endTime:n.toISOString().slice(0,16)}))}},[r,o,d,g]);const[ve,{loading:Ee}]=(0,p.n)(_e,{onCompleted:e=>{console.log("\u2705 Event created successfully:",e);const t="ICAL_INVITE"===me.eventType,n=me.attendees&&me.attendees.length>0,i=me.broadcastData.selectedClientIds&&me.broadcastData.selectedClientIds.length>0,s=(n?me.attendees.length:0)+(i?me.broadcastData.selectedClientIds.length:0);h(t&&s>0?{title:"Event created and invitations sent",description:"Calendar invitations have been sent to ".concat(s," recipient").concat(s>1?"s":""),status:"success",duration:5e3,isClosable:!0}:{title:"Event created",status:"success",duration:3e3}),c()},onError:e=>{console.error("\u274c Error creating event:",e),console.error("Error details:",e.graphQLErrors),console.error("Network error:",e.networkError),h({title:"Error creating event",description:e.message,status:"error",duration:5e3})}}),[Ce,{loading:Se}]=(0,p.n)(We,{onCompleted:e=>{console.log("\u2705 Event updated successfully:",e),h({title:"Event updated",description:"Your changes have been saved",status:"success",duration:3e3,isClosable:!0}),c()},onError:e=>{console.error("\u274c Error updating event:",e),console.error("Error details:",e.graphQLErrors),console.error("Network error:",e.networkError),h({title:"Error updating event",description:e.message,status:"error",duration:5e3})}}),[Te,{loading:Ae}]=(0,p.n)(He,{onCompleted:()=>{h({title:"Event cancelled successfully",status:"success",duration:3e3}),c()},onError:e=>{h({title:"Error cancelling event",description:e.message,status:"error",duration:5e3})}}),ye=e=>{const{name:t,value:n}=e.target;ue(e=>(0,m.A)((0,m.A)({},e),{},{[t]:n}))},De=(e,t)=>{ue(n=>(0,m.A)((0,m.A)({},n),{},{recurrence:(0,m.A)((0,m.A)({},n.recurrence),{},{[e]:t})}))},ke=(e,t,n)=>{ue(i=>(0,m.A)((0,m.A)({},i),{},{reminders:i.reminders.map((i,s)=>s===e?(0,m.A)((0,m.A)({},i),{},{[t]:n}):i)}))},[ze,Ne]=(0,x.useState)({x:100,y:50}),[we,Re]=(0,x.useState)(!1),[Oe,Me]=(0,x.useState)({x:0,y:0}),Pe=(0,x.useRef)(null),Be=(0,x.useRef)(null);return(0,x.useEffect)(()=>{const e=e=>{we&&Ne({x:e.clientX-Oe.x,y:e.clientY-Oe.y})},t=()=>{Re(!1)};return we&&(document.addEventListener("mousemove",e),document.addEventListener("mouseup",t)),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[we,Oe]),(0,be.jsxs)(E.aF,{isOpen:s,onClose:a,size:"4xl",closeOnOverlayClick:!1,initialFocusRef:Be,children:[(0,be.jsx)(C.m,{bg:"blackAlpha.300"}),(0,be.jsxs)(S.$,{ref:Pe,position:"fixed",left:"".concat(ze.x,"px"),top:"".concat(ze.y,"px"),margin:0,maxW:"900px",maxH:"90vh",containerProps:{justifyContent:"flex-start",alignItems:"flex-start"},onMouseDown:e=>{e.target.closest(".modal-drag-handle")&&(Re(!0),Me({x:e.clientX-ze.x,y:e.clientY-ze.y}))},cursor:we?"grabbing":"default",children:[(0,be.jsx)(T.s,{zIndex:2}),(0,be.jsx)(b.r,{borderBottomWidth:"1px",className:"modal-drag-handle",cursor:"grab",_active:{cursor:"grabbing"},userSelect:"none",children:(0,be.jsxs)(I.T,{align:"stretch",spacing:2,children:[(0,be.jsx)(f.z,{justify:"space-between",pr:8,children:(0,be.jsxs)(f.z,{children:[(0,be.jsx)(Z.C,{}),(0,be.jsx)(A.E,{children:g?"Edit Event":"Create New Event"}),g&&(null===r||void 0===r?void 0:r.id)&&(0,be.jsxs)(A.E,{fontSize:"xs",color:"gray.500",fontFamily:"mono",children:["ID: ",r.id]})]})}),(0,be.jsxs)(f.z,{spacing:2,children:[(0,be.jsx)(y.m,{label:"This calendar follows the iCalendar (RFC 5545) standard for maximum compatibility",children:(0,be.jsxs)(f.z,{spacing:1,children:[(0,be.jsx)(ee.m,{boxSize:3,color:"gray.500"}),(0,be.jsx)(A.E,{fontSize:"xs",color:"gray.500",children:"iCalendar Standard"})]})}),(0,be.jsx)(D.N,{href:"https://datatracker.ietf.org/doc/html/rfc5545",isExternal:!0,fontSize:"xs",color:"blue.500",textDecoration:"underline",children:"RFC 5545"})]})]})}),(0,be.jsxs)(k.c,{overflowY:"auto",children:[(0,be.jsxs)(z.a,{mb:4,children:[(0,be.jsx)(A.E,{fontSize:"xl",fontWeight:"bold",mb:2,children:me.title||"New Event"}),g&&(0,be.jsxs)(f.z,{spacing:3,wrap:"wrap",children:[(0,be.jsx)(N.E,{colorScheme:"blue",fontSize:"sm",children:me.eventType.replace("_"," ")}),(0,be.jsx)(N.E,{colorScheme:"green",fontSize:"sm",children:me.status}),(null===r||void 0===r?void 0:r.totalTasks)>0&&(0,be.jsxs)(f.z,{spacing:1,children:[(0,be.jsx)(se.NLe,{}),(0,be.jsxs)(A.E,{fontSize:"sm",children:[r.completedTasks,"/",r.totalTasks," tasks completed"]}),r.taskProgressPercentage>0&&(0,be.jsxs)(A.E,{fontSize:"xs",color:"gray.600",children:["(",r.taskProgressPercentage,"%)"]})]})]})]}),(0,be.jsxs)(w.t,{children:[(0,be.jsxs)(R.w,{children:[oe&&(0,be.jsx)(O.o,{children:(0,be.jsxs)(f.z,{spacing:2,children:[(0,be.jsx)(M.I,{as:se.cfS}),(0,be.jsx)(A.E,{children:"Booking Details"})]})}),(0,be.jsx)(O.o,{children:(0,be.jsxs)(f.z,{spacing:2,children:[(0,be.jsx)(se.wIk,{}),(0,be.jsx)(A.E,{children:"Details"})]})}),(0,be.jsx)(O.o,{children:(0,be.jsxs)(f.z,{spacing:2,children:[(0,be.jsx)(se.NLe,{}),(0,be.jsx)(A.E,{children:"Tasks"})]})}),(0,be.jsx)(O.o,{children:(0,be.jsxs)(f.z,{spacing:2,children:[(0,be.jsx)(se.jH2,{}),(0,be.jsx)(A.E,{children:"Notes"})]})})]}),(0,be.jsxs)(P.T,{children:[oe&&(0,be.jsx)(B.K,{children:(0,be.jsx)(Fe,{event:r,calendarId:l,onCancel:()=>{h({title:"Cancel Booking",description:"Cancel booking functionality coming soon",status:"info",duration:3e3})},onReschedule:()=>{h({title:"Reschedule Booking",description:"Reschedule functionality coming soon",status:"info",duration:3e3})},onSendReminder:()=>{h({title:"Send Reminder",description:"Send reminder functionality coming soon",status:"info",duration:3e3})}})}),(0,be.jsx)(B.K,{children:(0,be.jsxs)(L.B,{spacing:4,children:[oe&&(0,be.jsx)(z.a,{p:3,bg:"blue.50",borderRadius:"md",borderWidth:"1px",borderColor:"blue.200",children:(0,be.jsxs)(f.z,{spacing:2,children:[(0,be.jsx)(M.I,{as:se.cfS,color:"blue.500"}),(0,be.jsx)(A.E,{fontSize:"sm",color:"blue.700",fontWeight:"medium",children:'This is a public booking event. Visit the "Booking Details" tab to see full booking information.'})]})}),(0,be.jsxs)($.MJ,{isRequired:!0,children:[(0,be.jsx)(F.l,{children:"Event Title"}),(0,be.jsx)(U.p,{ref:Be,name:"title",value:me.title,onChange:ye,placeholder:"e.g., Team Meeting, Client Call",isReadOnly:oe,bg:oe?de:void 0}),oe&&(0,be.jsx)($.eK,{fontSize:"xs",color:ce,children:"Title is set by the booking system and cannot be edited"})]}),(0,be.jsxs)($.MJ,{children:[(0,be.jsx)(F.l,{children:"Description"}),(0,be.jsx)(J.T,{name:"description",value:me.description,onChange:ye,placeholder:"Event details and agenda",rows:3,isReadOnly:oe,bg:oe?de:void 0}),oe&&(0,be.jsx)($.eK,{fontSize:"xs",color:ce,children:"Description is set by the booking system and cannot be edited"})]}),!oe&&(0,be.jsx)(f.z,{spacing:4,children:(0,be.jsxs)($.MJ,{children:[(0,be.jsx)(F.l,{children:(0,be.jsxs)(f.z,{children:[(0,be.jsx)(se.wIk,{}),(0,be.jsx)(A.E,{children:"Event Type"})]})}),(0,be.jsx)(X.z,{value:me.eventType,onChange:e=>{ue(t=>(0,m.A)((0,m.A)({},t),{},{eventType:e}))},children:(0,be.jsxs)(L.B,{direction:"column",spacing:2,children:[(0,be.jsx)(_.s,{value:"STANDARD",children:(0,be.jsxs)(f.z,{children:[(0,be.jsx)(A.E,{fontSize:"sm",children:"\ud83d\udcc5"}),(0,be.jsx)(A.E,{fontSize:"sm",children:"Standard Event"})]})}),(0,be.jsx)(_.s,{value:"ICAL_INVITE",children:(0,be.jsxs)(f.z,{children:[(0,be.jsx)(A.E,{fontSize:"sm",children:"\ud83d\udce4"}),(0,be.jsx)(A.E,{fontSize:"sm",children:"iCal Email Invite"})]})}),(0,be.jsx)(_.s,{value:"SMS_BROADCAST",children:(0,be.jsxs)(f.z,{children:[(0,be.jsx)(A.E,{fontSize:"sm",children:"\ud83d\udcac"}),(0,be.jsx)(A.E,{fontSize:"sm",children:"SMS Broadcast"})]})}),(0,be.jsx)(_.s,{value:"EMAIL_BROADCAST",children:(0,be.jsxs)(f.z,{children:[(0,be.jsx)(A.E,{fontSize:"sm",children:"\u2709\ufe0f"}),(0,be.jsx)(A.E,{fontSize:"sm",children:"Email Broadcast"})]})}),(0,be.jsx)(_.s,{value:"BOTH_BROADCAST",children:(0,be.jsxs)(f.z,{children:[(0,be.jsx)(A.E,{fontSize:"sm",children:"\ud83d\udce2"}),(0,be.jsx)(A.E,{fontSize:"sm",children:"SMS + Email Broadcast"})]})})]})}),(0,be.jsx)($.eK,{fontSize:"xs",children:"ICAL_INVITE"===me.eventType?"iCal invites will be sent to all attendees when event is created":"Broadcast events will trigger automated messages at the scheduled time"})]})}),!oe&&"STANDARD"!==me.eventType&&"ICAL_INVITE"!==me.eventType&&(0,be.jsx)(z.a,{p:4,bg:de,borderRadius:"md",border:"1px solid",borderColor:he,children:(0,be.jsxs)(I.T,{align:"stretch",spacing:3,children:[(0,be.jsxs)(A.E,{fontWeight:"bold",fontSize:"sm",children:["Broadcast Configuration","BOTH_BROADCAST"===me.eventType&&(0,be.jsx)(N.E,{ml:2,colorScheme:"purple",children:"SMS + Email"})]}),("SMS_BROADCAST"===me.eventType||"BOTH_BROADCAST"===me.eventType)&&(0,be.jsxs)(z.a,{children:["BOTH_BROADCAST"===me.eventType&&(0,be.jsx)(A.E,{fontSize:"sm",fontWeight:"medium",mb:2,color:"blue.600",children:"\ud83d\udcf1 SMS Configuration"}),(0,be.jsxs)($.MJ,{children:[(0,be.jsx)(F.l,{fontSize:"sm",children:"SMS Message"}),(0,be.jsx)(J.T,{value:me.broadcastData.smsContent,onChange:e=>ue(t=>(0,m.A)((0,m.A)({},t),{},{broadcastData:(0,m.A)((0,m.A)({},t.broadcastData),{},{smsContent:e.target.value})})),placeholder:"Enter SMS message content (160 characters recommended)",rows:3}),(0,be.jsxs)($.eK,{fontSize:"xs",children:[me.broadcastData.smsContent.length,"/160 characters"]})]}),(0,be.jsxs)($.MJ,{children:[(0,be.jsxs)(f.z,{justify:"space-between",children:[(0,be.jsx)(F.l,{htmlFor:"use-alpha-id",mb:"0",fontSize:"sm",children:"Use AlphaId for SMS"}),(0,be.jsx)(W.d,{id:"use-alpha-id",isChecked:me.broadcastData.useAlphaId,onChange:e=>ue(t=>(0,m.A)((0,m.A)({},t),{},{broadcastData:(0,m.A)((0,m.A)({},t.broadcastData),{},{useAlphaId:e.target.checked})}))})]}),(0,be.jsx)($.eK,{fontSize:"xs",children:me.broadcastData.useAlphaId?"SMS will be sent from your business name (AlphaId)":"SMS will be sent from a dedicated phone number"})]})]}),("EMAIL_BROADCAST"===me.eventType||"BOTH_BROADCAST"===me.eventType)&&(0,be.jsxs)(z.a,{children:["BOTH_BROADCAST"===me.eventType&&(0,be.jsxs)(be.Fragment,{children:[(0,be.jsx)(H.c,{my:3}),(0,be.jsx)(A.E,{fontSize:"sm",fontWeight:"medium",mb:2,color:"green.600",children:"\u2709\ufe0f Email Configuration"})]}),(0,be.jsxs)($.MJ,{children:[(0,be.jsx)(F.l,{fontSize:"sm",children:"Email Subject"}),(0,be.jsx)(U.p,{value:me.broadcastData.emailSubject,onChange:e=>ue(t=>(0,m.A)((0,m.A)({},t),{},{broadcastData:(0,m.A)((0,m.A)({},t.broadcastData),{},{emailSubject:e.target.value})})),placeholder:"Enter email subject line"})]}),(0,be.jsxs)($.MJ,{children:[(0,be.jsx)(F.l,{fontSize:"sm",children:"Email Content"}),(0,be.jsx)(J.T,{value:me.broadcastData.emailContent,onChange:e=>ue(t=>(0,m.A)((0,m.A)({},t),{},{broadcastData:(0,m.A)((0,m.A)({},t.broadcastData),{},{emailContent:e.target.value})})),placeholder:"Enter email message content",rows:5})]})]}),"BOTH_BROADCAST"===me.eventType&&(0,be.jsx)(H.c,{my:3}),(0,be.jsxs)($.MJ,{children:[(0,be.jsxs)(F.l,{fontSize:"sm",children:["Recipients","BOTH_BROADCAST"===me.eventType&&(0,be.jsx)(A.E,{as:"span",fontSize:"xs",color:"gray.600",ml:2,children:"(will receive both SMS and Email)"}),"SMS_BROADCAST"===me.eventType&&(0,be.jsx)(A.E,{as:"span",fontSize:"xs",color:"gray.600",ml:2,children:"(will receive SMS only)"}),"EMAIL_BROADCAST"===me.eventType&&(0,be.jsx)(A.E,{as:"span",fontSize:"xs",color:"gray.600",ml:2,children:"(will receive Email only)"})]}),(0,be.jsx)(ae.l,{selectedClients:me.broadcastData.selectedClientIds,onSelectionChange:e=>ue(t=>(0,m.A)((0,m.A)({},t),{},{broadcastData:(0,m.A)((0,m.A)({},t.broadcastData),{},{selectedClientIds:e,recipientCount:e.length})})),allowMultiple:!0,placeholder:"Search for recipients by name, email, phone, or tags..."}),(0,be.jsxs)($.eK,{fontSize:"xs",children:["Selected recipients: ",me.broadcastData.selectedClientIds.length]})]})]})}),!oe&&(0,be.jsx)($.MJ,{children:(0,be.jsxs)(f.z,{justify:"space-between",children:[(0,be.jsx)(F.l,{mb:0,children:"All Day Event"}),(0,be.jsx)(W.d,{isChecked:me.allDay,onChange:e=>{return(t="allDay",e=>{ue("allDay"===t?e?n=>{const i=n.startTime?n.startTime.split("T")[0]:"",s=n.endTime?n.endTime.split("T")[0]:"",a=!s||s<i?n.startTime:n.endTime;return(0,m.A)((0,m.A)({},n),{},{[t]:e,endTime:a})}:n=>(0,m.A)((0,m.A)({},n),{},{[t]:e}):n=>(0,m.A)((0,m.A)({},n),{},{[t]:e}))})(e.target.checked);var t}})]})}),(0,be.jsxs)(I.T,{align:"stretch",spacing:2,children:[(0,be.jsxs)(f.z,{children:[(0,be.jsxs)($.MJ,{isRequired:!0,children:[(0,be.jsxs)(F.l,{children:["Start ",me.allDay?"Date":"Date & Time"]}),(0,be.jsx)(U.p,{type:me.allDay?"date":"datetime-local",isReadOnly:oe,bg:oe?de:void 0,name:"startTime",value:me.allDay?me.startTime.split("T")[0]:me.startTime,onChange:e=>{if(ye(e),me.allDay){const t=e.target.value.split("T")[0],n=me.endTime?me.endTime.split("T")[0]:"";(!n||n<t)&&ue(t=>(0,m.A)((0,m.A)({},t),{},{endTime:e.target.value}))}}})]}),(0,be.jsxs)($.MJ,{isRequired:!0,children:[(0,be.jsx)(F.l,{children:me.allDay?"End Date":"End Date & Time"}),(0,be.jsx)(U.p,{type:me.allDay?"date":"datetime-local",name:"endTime",value:me.allDay?me.endTime?me.endTime.split("T")[0]:"":me.endTime,onChange:ye,isReadOnly:oe,bg:oe?de:void 0})]})]}),oe&&(0,be.jsx)(A.E,{fontSize:"xs",color:ce,children:'Date and time are set by the booking and cannot be edited. Use the "Reschedule" action in Booking Details to change.'})]}),(0,be.jsxs)($.MJ,{children:[(0,be.jsx)(F.l,{children:(0,be.jsxs)(f.z,{children:[(0,be.jsx)(se.HzC,{}),(0,be.jsx)(A.E,{children:"Location"})]})}),(0,be.jsx)(U.p,{name:"location",value:me.location,onChange:ye,placeholder:"e.g., Conference Room, Zoom Link"})]}),(0,be.jsxs)($.MJ,{children:[(0,be.jsx)(F.l,{children:"Tags"}),(0,be.jsx)(le.C,{calendarId:l,selectedTags:me.categories,onTagsChange:e=>ue((0,m.A)((0,m.A)({},me),{},{categories:e})),placeholder:"Add tags to categorize this event"})]}),(0,be.jsxs)(f.z,{children:[(0,be.jsxs)($.MJ,{children:[(0,be.jsx)(F.l,{children:"Status"}),(0,be.jsxs)(G.l,{name:"status",value:me.status,onChange:ye,children:[(0,be.jsx)("option",{value:"CONFIRMED",children:"Confirmed"}),(0,be.jsx)("option",{value:"TENTATIVE",children:"Tentative"}),(0,be.jsx)("option",{value:"CANCELLED",children:"Cancelled"})]})]}),(0,be.jsxs)($.MJ,{children:[(0,be.jsx)(F.l,{children:"Visibility"}),(0,be.jsxs)(G.l,{name:"visibility",value:me.visibility,onChange:ye,children:[(0,be.jsx)("option",{value:"PUBLIC",children:"Public"}),(0,be.jsx)("option",{value:"PRIVATE",children:"Private"}),(0,be.jsx)("option",{value:"CONFIDENTIAL",children:"Confidential"})]})]})]}),(0,be.jsx)(H.c,{}),(0,be.jsxs)(z.a,{children:[(0,be.jsx)(F.l,{children:(0,be.jsxs)(f.z,{children:[(0,be.jsx)(se.cfS,{}),(0,be.jsx)(A.E,{children:"Attendees"})]})}),(0,be.jsxs)(L.B,{spacing:2,children:[me.attendees.map((e,t)=>(0,be.jsxs)(f.z,{children:[(0,be.jsx)(N.E,{colorScheme:"blue",px:2,py:1,children:e.name||e.email}),(0,be.jsx)(K.K,{"aria-label":"Remove attendee",icon:(0,be.jsx)(te.d,{}),size:"sm",variant:"ghost",colorScheme:"red",onClick:()=>(e=>{ue(t=>(0,m.A)((0,m.A)({},t),{},{attendees:t.attendees.filter((t,n)=>n!==e)}))})(t)})]},t)),(0,be.jsxs)(f.z,{children:[(0,be.jsx)(U.p,{placeholder:"Email",value:xe,onChange:e=>ge(e.target.value),size:"sm"}),(0,be.jsx)(U.p,{placeholder:"Name (optional)",value:pe,onChange:e=>je(e.target.value),size:"sm"}),(0,be.jsx)(K.K,{"aria-label":"Add attendee",icon:(0,be.jsx)(ne.R,{}),size:"sm",onClick:()=>{xe&&(ue(e=>(0,m.A)((0,m.A)({},e),{},{attendees:[...e.attendees,{email:xe,name:pe}]})),ge(""),je(""))},isDisabled:!xe})]})]})]}),(0,be.jsx)(H.c,{}),(0,be.jsxs)(z.a,{children:[(0,be.jsx)($.MJ,{children:(0,be.jsxs)(f.z,{justify:"space-between",children:[(0,be.jsx)(F.l,{mb:0,children:(0,be.jsxs)(f.z,{children:[(0,be.jsx)(se.jEl,{}),(0,be.jsx)(A.E,{children:"Recurring Event"})]})}),(0,be.jsx)(W.d,{isChecked:me.recurrence.enabled,onChange:e=>De("enabled",e.target.checked)})]})}),me.recurrence.enabled&&(0,be.jsxs)(L.B,{spacing:2,mt:2,children:[(0,be.jsxs)(f.z,{children:[(0,be.jsxs)($.MJ,{children:[(0,be.jsx)(F.l,{children:"Frequency"}),(0,be.jsxs)(G.l,{value:me.recurrence.frequency,onChange:e=>De("frequency",e.target.value),children:[(0,be.jsx)("option",{value:"DAILY",children:"Daily"}),(0,be.jsx)("option",{value:"WEEKLY",children:"Weekly"}),(0,be.jsx)("option",{value:"MONTHLY",children:"Monthly"}),(0,be.jsx)("option",{value:"YEARLY",children:"Yearly"})]})]}),(0,be.jsxs)($.MJ,{children:[(0,be.jsx)(F.l,{children:"Interval"}),(0,be.jsxs)(q.M,{children:[(0,be.jsx)(U.p,{type:"number",value:me.recurrence.interval,onChange:e=>De("interval",parseInt(e.target.value)),min:1}),(0,be.jsx)(Y.G6,{children:me.recurrence.frequency.toLowerCase().replace("ly","(s)")})]})]})]}),(0,be.jsxs)($.MJ,{children:[(0,be.jsx)(F.l,{children:"End Date (optional)"}),(0,be.jsx)(U.p,{type:"date",value:me.recurrence.endDate,onChange:e=>De("endDate",e.target.value)})]})]})]}),(0,be.jsx)(H.c,{}),(0,be.jsxs)(z.a,{children:[(0,be.jsx)(F.l,{children:(0,be.jsxs)(f.z,{children:[(0,be.jsx)(ie.X,{}),(0,be.jsx)(A.E,{children:"Reminders"})]})}),(0,be.jsxs)(L.B,{spacing:2,children:[me.reminders.map((e,t)=>(0,be.jsxs)(f.z,{children:[(0,be.jsx)(U.p,{type:"number",value:e.minutes,onChange:e=>ke(t,"minutes",parseInt(e.target.value)),min:0,width:"100px"}),(0,be.jsxs)(G.l,{value:e.type,onChange:e=>ke(t,"type",e.target.value),children:[(0,be.jsx)("option",{value:"NOTIFICATION",children:"Notification"}),(0,be.jsx)("option",{value:"EMAIL",children:"Email"}),(0,be.jsx)("option",{value:"SMS",children:"SMS"})]}),(0,be.jsx)(A.E,{children:"minutes before"}),(0,be.jsx)(K.K,{"aria-label":"Remove reminder",icon:(0,be.jsx)(te.d,{}),size:"sm",variant:"ghost",colorScheme:"red",onClick:()=>(e=>{ue(t=>(0,m.A)((0,m.A)({},t),{},{reminders:t.reminders.filter((t,n)=>n!==e)}))})(t)})]},t)),(0,be.jsx)(Q.$,{leftIcon:(0,be.jsx)(ne.R,{}),size:"sm",variant:"outline",onClick:()=>{ue(e=>(0,m.A)((0,m.A)({},e),{},{reminders:[...e.reminders,{minutes:15,type:"NOTIFICATION"}]}))},children:"Add Reminder"})]})]})]})}),(0,be.jsx)(B.K,{children:g&&null!==r&&void 0!==r&&r.id?(0,be.jsx)(Ie,{eventId:r.id}):(0,be.jsx)(z.a,{textAlign:"center",py:8,color:"gray.500",children:(0,be.jsx)(A.E,{children:"Save the event first to add tasks"})})}),(0,be.jsx)(B.K,{children:(0,be.jsx)(fe,{eventNotes:me.eventNotes,onSave:e=>{ue(t=>(0,m.A)((0,m.A)({},t),{},{eventNotes:e}))}})})]})]})]}),(0,be.jsxs)(V.j,{borderTopWidth:"1px",justifyContent:g?"space-between":"flex-end",children:[g&&(0,be.jsx)(Q.$,{leftIcon:(0,be.jsx)(te.d,{}),colorScheme:"red",variant:"outline",onClick:()=>{window.confirm("Are you sure you want to cancel this event? This action cannot be undone.")&&Te({variables:{id:r.id,reason:"Event cancelled by user"},context:{headers:{"x-tenant-id":localStorage.getItem("tenantId")||""}}})},isLoading:Ae,size:"sm",children:"Cancel Event"}),(0,be.jsxs)(f.z,{spacing:3,children:[(0,be.jsx)(Q.$,{variant:"outline",onClick:a,size:"sm",children:"Cancel"}),(0,be.jsx)(Q.$,{colorScheme:"blue",onClick:()=>{console.log("\ud83d\ude80 EventModal - Starting event submission"),console.log("\ud83d\udcdd Form Data:",me),console.log("\ud83d\udcc5 Calendar ID:",l),console.log("\u270f\ufe0f Is Edit Mode:",g),console.log("\ud83c\udd94 Event ID (if editing):",null===r||void 0===r?void 0:r.id);const e={calendarId:l,title:me.title,description:me.description||void 0,startTime:me.allDay?new Date(new Date(me.startTime).setHours(0,0,0,0)).toISOString():new Date(me.startTime).toISOString(),endTime:me.allDay?new Date(new Date(me.endTime).setHours(23,59,59,999)).toISOString():new Date(me.endTime).toISOString(),isAllDay:me.allDay,status:me.status,visibility:me.visibility,categories:me.categories};if(("STANDARD"!==me.eventType||me.broadcastData.smsContent||me.broadcastData.emailSubject)&&(e.metadata=(0,m.A)((0,m.A)((0,m.A)((0,m.A)((0,m.A)({"X-EVENT-TYPE":me.eventType},"ICAL_INVITE"===me.eventType&&{"X-SEND-ICAL-INVITES":"true","X-ICAL-METHOD":"REQUEST"}),me.broadcastData.smsContent&&{"X-SMS-CONTENT":me.broadcastData.smsContent,"X-SMS-RECIPIENT-LIST":me.broadcastData.recipientListId||"","X-SELECTED-CLIENT-IDS":me.broadcastData.selectedClientIds,"X-USE-ALPHA-ID":me.broadcastData.useAlphaId}),me.broadcastData.emailSubject&&{"X-EMAIL-SUBJECT":me.broadcastData.emailSubject,"X-EMAIL-CONTENT":me.broadcastData.emailContent,"X-EMAIL-RECIPIENT-LIST":me.broadcastData.recipientListId||"","X-SELECTED-CLIENT-IDS":me.broadcastData.selectedClientIds}),me.broadcastData.scheduledSendTime&&{"X-BROADCAST-SCHEDULED":me.broadcastData.scheduledSendTime}),{},{"X-CREATED-BY":"business-builder-calendar","X-ICAL-VERSION":"RFC5545"})),console.log("\ud83d\udcca Base Input Object:",e),me.attendees.length>0&&(e.attendees=me.attendees.map(e=>({clientId:e.clientId,email:e.email,name:e.name,role:e.role||"REQ_PARTICIPANT",status:e.status||"NEEDS_ACTION",isOrganizer:e.isOrganizer||!1,rsvpRequired:void 0===e.rsvpRequired||e.rsvpRequired})),console.log("\ud83d\udc65 Attendees:",e.attendees)),me.attachments&&me.attachments.length>0&&(e.attachments=me.attachments.map(e=>({name:e.name,url:e.url,mimeType:e.mimeType,size:e.size})),console.log("\ud83d\udcce Attachments:",e.attachments)),me.location&&(e.location={address:me.location},console.log("\ud83d\udccd Location:",e.location)),me.reminders&&me.reminders.length>0&&(e.reminders=me.reminders.map(e=>({minutesBefore:e.minutesBefore||e.minutes||15,method:e.method||("NOTIFICATION"===e.type?"PUSH":e.type)||"EMAIL",enabled:void 0===e.enabled||e.enabled})),console.log("\ud83d\udd14 Reminders:",e.reminders)),me.recurrence.enabled&&(e.isRecurring=!0,e.recurrence={frequency:me.recurrence.frequency,interval:me.recurrence.interval,until:me.recurrence.endDate?new Date(me.recurrence.endDate).toISOString():null},console.log("\ud83d\udd04 Recurrence:",e.recurrence)),console.log("\ud83c\udfaf Final Input Object to send:",JSON.stringify(e,null,2)),g){if(null===r||void 0===r||!r.id)return console.error("\u274c ERROR: Trying to update event but no event ID provided!"),void h({title:"Error",description:"Cannot update event: Event ID is missing",status:"error",duration:5e3});console.log("\ud83d\udce4 Calling updateEvent with ID:",r.id),console.log("\ud83d\udce4 Variables:",{id:r.id,input:e}),Ce({variables:{id:r.id,input:e},context:{headers:{"x-tenant-id":localStorage.getItem("tenantId")||""}}})}else console.log("\ud83d\udce4 Calling createEvent"),console.log("\ud83d\udce4 Variables:",{input:e}),ve({variables:{input:e},context:{headers:{"x-tenant-id":localStorage.getItem("tenantId")||""}}})},isLoading:Ee||Se,isDisabled:!me.title||!me.startTime||!me.endTime,size:"sm",children:g?"Update Event":"Create Event"})]})]})]})]})}}}]);
//# sourceMappingURL=5494.2f62ce36.chunk.js.map