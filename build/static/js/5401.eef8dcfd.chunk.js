"use strict";(self.webpackChunkbusiness_builder_master_frontend=self.webpackChunkbusiness_builder_master_frontend||[]).push([[5401],{5401:(e,o,n)=>{n.r(o),n.d(o,{default:()=>Be});var r,i,t,s=n(57528),a=n(65043),l=n(30502),c=n(96870),d=n(22107),m=n(98939),u=n(68659),h=n(76659),x=n(83169),g=n(24330),p=n(10202),b=n(25011),j=n(39081),f=n(98662),y=n(96148),v=n(47726),E=n(42703),C=n(28846),k=n(87139),S=n(58861),T=n(48239),w=n(82459),A=n(7189),D=n(78460),I=n(11054),z=n(25722),P=n(15071),U=n(35929),B=n(67516),N=n(35699),O=n(56529),$=n(73216),_=n(70459),M=n(10585),L=n(31881),F=n(1009),R=n(80454),H=n(65239),J=n.n(H),G=n(46865),W=n(52003),q=n(63295),Q=n(39985),K=n(66037),X=n(95214),Y=n(95393),Z=n(88019),V=n(34946),ee=n(59883),oe=n(86236),ne=n(91872),re=n(53560),ie=n(89379),te=n(73225),se=n(76668),ae=n(19077),le=n(61724),ce=n(70579);const de=(0,_.J1)(r||(r=(0,s.A)(["\n    mutation CreateCommunicationTask($input: CommunicationTaskInput!) {\n        createCommunicationTask(input: $input) {\n            id\n            title\n            description\n            status\n            priority\n            dueDate\n            assignedTo {\n                id\n                fName\n                lName\n                email\n            }\n            notes\n            communicationId\n            communicationType\n            createdAt\n        }\n    }\n"]))),me=(0,_.J1)(i||(i=(0,s.A)(["\n    mutation UpdateCommunicationTask($id: ID!, $input: UpdateCommunicationTaskInput!) {\n        updateCommunicationTask(id: $id, input: $input) {\n            id\n            title\n            description\n            status\n            priority\n            dueDate\n            assignedTo {\n                id\n                fName\n                lName\n                email\n            }\n            notes\n            completedAt\n        }\n    }\n"]))),ue=(0,_.J1)(t||(t=(0,s.A)(["\n    query GetClients {\n        clients {\n            id\n            fName\n            lName\n            email\n            businessName\n        }\n    }\n"]))),he=e=>{var o;let{isOpen:n,onClose:r,communicationId:i,communicationType:t,onTaskCreated:s,existingTask:c}=e;const m=(0,l.d)(),[u,h]=(0,a.useState)(""),[x,g]=(0,a.useState)(""),[v,E]=(0,a.useState)("TODO"),[C,S]=(0,a.useState)("MEDIUM"),[T,w]=(0,a.useState)(""),[A,O]=(0,a.useState)([]),[$,_]=(0,a.useState)(""),R=((0,Q.oU)("background.cardGradient"),(0,Q.oU)("border.darkCard")),H=(0,Q.oU)("text.primaryDark"),J=(0,Q.oU)("text.mutedDark"),G=(0,Q.oU)("background.main"),W=(0,Q.oU)("background.main"),{data:q}=(0,M.IT)(ue),[K,{loading:X}]=(0,L.n)(de,{onCompleted:()=>{m({title:"Task created",description:"The task has been created successfully",status:"success",duration:3e3,isClosable:!0}),null===s||void 0===s||s(),V()},onError:e=>{m({title:"Error creating task",description:e.message,status:"error",duration:5e3,isClosable:!0})}}),[Y,{loading:Z}]=(0,L.n)(me,{onCompleted:()=>{m({title:"Task updated",description:"The task has been updated successfully",status:"success",duration:3e3,isClosable:!0}),null===s||void 0===s||s(),V()},onError:e=>{m({title:"Error updating task",description:e.message,status:"error",duration:5e3,isClosable:!0})}});(0,a.useEffect)(()=>{if(c){var e;if(h(c.title),g(c.description||""),E(c.status),S(c.priority),c.dueDate){const e=new Date(c.dueDate),o=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),t=String(e.getMinutes()).padStart(2,"0");w("".concat(o,"-").concat(n,"-").concat(r,"T").concat(i,":").concat(t))}else w("");O((null===(e=c.assignedTo)||void 0===e?void 0:e.map(e=>e.id))||[]),_(c.notes||"")}},[c]);const V=()=>{h(""),g(""),E("TODO"),S("MEDIUM"),w(""),O([]),_(""),r()},ee=e=>{switch(e){case"TODO":default:return F.Ohp;case"IN_PROGRESS":return F.y3G;case"COMPLETED":return F.A3x;case"CANCELLED":return F.q_G}};return(0,ce.jsxs)(D.aF,{isOpen:n,onClose:V,size:"xl",children:[(0,ce.jsx)(I.m,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(4px)"}),(0,ce.jsxs)(z.$,{bg:G,border:"1px solid",borderColor:R,color:H,children:[(0,ce.jsx)(P.r,{color:H,borderBottom:"1px solid",borderColor:R,children:c?"Edit Task":"Create Task"}),(0,ce.jsx)(U.s,{color:H}),(0,ce.jsx)(B.c,{pb:6,children:(0,ce.jsxs)(p.T,{spacing:4,align:"stretch",children:[(0,ce.jsxs)(te.MJ,{isRequired:!0,children:[(0,ce.jsx)(se.l,{color:H,children:"Title"}),(0,ce.jsx)(N.p,{value:u,onChange:e=>h(e.target.value),placeholder:"Enter task title",bg:W,borderColor:R,color:H,_placeholder:{color:J},_hover:{borderColor:(0,Q.oU)("primaryBlue")},_focus:{borderColor:(0,Q.oU)("primaryBlue"),boxShadow:"none"}}),(0,ce.jsx)(te.eK,{color:J,children:"Brief title describing the task"})]}),(0,ce.jsxs)(te.MJ,{children:[(0,ce.jsx)(se.l,{color:H,children:"Description"}),(0,ce.jsx)(ae.T,{value:x,onChange:e=>g(e.target.value),placeholder:"Detailed description of the task",rows:3,bg:W,borderColor:R,color:H,_placeholder:{color:J},_hover:{borderColor:(0,Q.oU)("primaryBlue")},_focus:{borderColor:(0,Q.oU)("primaryBlue"),boxShadow:"none"}})]}),(0,ce.jsxs)(y.z,{spacing:4,children:[(0,ce.jsxs)(te.MJ,{flex:1,children:[(0,ce.jsx)(se.l,{color:H,children:(0,ce.jsxs)(y.z,{spacing:2,children:[(0,ce.jsx)(b.I,{as:ee(v),color:H}),(0,ce.jsx)(j.E,{children:"Status"})]})}),(0,ce.jsxs)(le.l,{value:v,onChange:e=>E(e.target.value),bg:W,borderColor:R,color:H,_hover:{borderColor:(0,Q.oU)("primaryBlue")},_focus:{borderColor:(0,Q.oU)("primaryBlue"),boxShadow:"none"},children:[(0,ce.jsx)("option",{value:"TODO",children:"To Do"}),(0,ce.jsx)("option",{value:"IN_PROGRESS",children:"In Progress"}),(0,ce.jsx)("option",{value:"COMPLETED",children:"Completed"}),(0,ce.jsx)("option",{value:"CANCELLED",children:"Cancelled"})]})]}),(0,ce.jsxs)(te.MJ,{flex:1,children:[(0,ce.jsx)(se.l,{color:H,children:(0,ce.jsxs)(y.z,{spacing:2,children:[(0,ce.jsx)(b.I,{as:F.QsL,color:H}),(0,ce.jsx)(j.E,{children:"Priority"})]})}),(0,ce.jsxs)(le.l,{value:C,onChange:e=>S(e.target.value),bg:W,borderColor:R,color:H,_hover:{borderColor:(0,Q.oU)("primaryBlue")},_focus:{borderColor:(0,Q.oU)("primaryBlue"),boxShadow:"none"},children:[(0,ce.jsx)("option",{value:"LOW",children:"Low"}),(0,ce.jsx)("option",{value:"MEDIUM",children:"Medium"}),(0,ce.jsx)("option",{value:"HIGH",children:"High"}),(0,ce.jsx)("option",{value:"URGENT",children:"Urgent"})]})]})]}),(0,ce.jsxs)(y.z,{spacing:4,children:[(0,ce.jsxs)(te.MJ,{flex:1,children:[(0,ce.jsx)(se.l,{color:H,children:(0,ce.jsxs)(y.z,{spacing:2,children:[(0,ce.jsx)(b.I,{as:F.wIk,color:H}),(0,ce.jsx)(j.E,{children:"Due Date"})]})}),(0,ce.jsx)(N.p,{type:"datetime-local",value:T,onChange:e=>w(e.target.value),bg:W,borderColor:R,color:H,_hover:{borderColor:(0,Q.oU)("primaryBlue")},_focus:{borderColor:(0,Q.oU)("primaryBlue"),boxShadow:"none"}})]}),(0,ce.jsxs)(te.MJ,{flex:1,children:[(0,ce.jsx)(se.l,{color:H,children:(0,ce.jsxs)(y.z,{spacing:2,children:[(0,ce.jsx)(b.I,{as:F.JXP,color:H}),(0,ce.jsx)(j.E,{children:"Assign To"})]})}),(0,ce.jsx)(le.l,{value:A[0]||"",onChange:e=>O(e.target.value?[e.target.value]:[]),placeholder:"Select assignee",bg:W,borderColor:R,color:H,_placeholder:{color:J},_hover:{borderColor:(0,Q.oU)("primaryBlue")},_focus:{borderColor:(0,Q.oU)("primaryBlue"),boxShadow:"none"},children:null===q||void 0===q||null===(o=q.clients)||void 0===o?void 0:o.map(e=>(0,ce.jsxs)("option",{value:e.id,children:[e.fName," ",e.lName," - ",e.email]},e.id))})]})]}),(0,ce.jsxs)(te.MJ,{children:[(0,ce.jsx)(se.l,{color:H,children:"Notes"}),(0,ce.jsx)(ae.T,{value:$,onChange:e=>_(e.target.value),placeholder:"Additional notes or context",rows:2,bg:W,borderColor:R,color:H,_placeholder:{color:J},_hover:{borderColor:(0,Q.oU)("primaryBlue")},_focus:{borderColor:(0,Q.oU)("primaryBlue"),boxShadow:"none"}})]}),(0,ce.jsx)(d.a,{p:3,borderWidth:1,borderRadius:"md",borderColor:R,children:(0,ce.jsxs)(y.z,{spacing:4,children:[(0,ce.jsx)(k.E,{colorScheme:(e=>{switch(e){case"TODO":default:return"gray";case"IN_PROGRESS":return"blue";case"COMPLETED":return"green";case"CANCELLED":return"red"}})(v),px:2,py:1,children:(0,ce.jsxs)(y.z,{spacing:1,children:[(0,ce.jsx)(b.I,{as:ee(v)}),(0,ce.jsx)(j.E,{children:v.replace("_"," ")})]})}),(0,ce.jsx)(k.E,{colorScheme:(e=>{switch(e){case"LOW":default:return"gray";case"MEDIUM":return"yellow";case"HIGH":return"orange";case"URGENT":return"red"}})(C),px:2,py:1,children:(0,ce.jsxs)(y.z,{spacing:1,children:[(0,ce.jsx)(b.I,{as:F.QsL}),(0,ce.jsx)(j.E,{children:C})]})}),T&&(0,ce.jsx)(k.E,{colorScheme:"purple",px:2,py:1,children:(0,ce.jsxs)(y.z,{spacing:1,children:[(0,ce.jsx)(b.I,{as:F.wIk}),(0,ce.jsxs)(j.E,{children:["Due: ",new Date(T).toLocaleDateString()]})]})})]})}),(0,ce.jsxs)(y.z,{justify:"flex-end",spacing:3,children:[(0,ce.jsx)(f.$,{variant:"ghost",onClick:V,color:H,_hover:{bg:(0,Q.oU)("background.cardGradient")},children:"Cancel"}),(0,ce.jsx)(f.$,{colorScheme:"blue",onClick:async()=>{if(!u.trim())return void m({title:"Title required",description:"Please enter a task title",status:"warning",duration:3e3,isClosable:!0});let e;T&&(e=16===T.length?new Date(T+":00").toISOString():new Date(T).toISOString());const o={title:u.trim(),description:x.trim()||void 0,status:v,priority:C,dueDate:e||void 0,assignedTo:A.length>0?A:void 0,notes:$.trim()||void 0};c?await Y({variables:{id:c.id,input:o}}):await K({variables:{input:(0,ie.A)((0,ie.A)({},o),{},{communicationId:i,communicationType:t})}})},isLoading:X||Z,loadingText:c?"Updating...":"Creating...",children:c?"Update Task":"Create Task"})]})]})})]})]})};var xe,ge;const pe=(0,_.J1)(xe||(xe=(0,s.A)(["\n    mutation ToggleCommunicationTaskStatus($id: ID!) {\n        toggleCommunicationTaskStatus(id: $id) {\n            id\n            status\n            completedAt\n        }\n    }\n"]))),be=(0,_.J1)(ge||(ge=(0,s.A)(["\n    mutation DeleteCommunicationTask($id: ID!) {\n        deleteCommunicationTask(id: $id)\n    }\n"]))),je=e=>{var o;let{tasks:n,communicationId:r,communicationType:i,onTasksUpdated:t,allowEdit:s=!0}=e;const[c,m]=(0,a.useState)(!1),[u,h]=(0,a.useState)(null),v=(0,l.d)(),C=(0,Q.oU)("background.cardGradient"),S=(0,Q.oU)("border.darkCard"),T=(0,Q.oU)("text.primaryDark"),A=(0,Q.oU)("text.secondaryDark"),D=(0,Q.oU)("text.mutedDark"),I=(0,Q.oU)("taskCardBg"),[z]=(0,L.n)(pe,{onCompleted:()=>{t()},onError:e=>{v({title:"Error updating task",description:e.message,status:"error",duration:3e3,isClosable:!0})}}),[P]=(0,L.n)(be,{onCompleted:()=>{v({title:"Task deleted",status:"success",duration:2e3,isClosable:!0}),t()},onError:e=>{v({title:"Error deleting task",description:e.message,status:"error",duration:3e3,isClosable:!0})}}),U=e=>{switch(e){case"TODO":default:return F.Ohp;case"IN_PROGRESS":return F.y3G;case"COMPLETED":return F.A3x;case"CANCELLED":return F.q_G}},B=e=>{switch(e){case"TODO":default:return"gray";case"IN_PROGRESS":return"blue";case"COMPLETED":return"green";case"CANCELLED":return"red"}},N=e=>{switch(e){case"LOW":default:return"gray";case"MEDIUM":return"yellow";case"HIGH":return"orange";case"URGENT":return"red"}},O=()=>{h(null),m(!0)},$=n.filter(e=>"COMPLETED"===e.status).length,_=n.length>0?$/n.length*100:0;console.log("\ud83d\udccb [CommunicationTaskList] Tasks prop:",n),console.log("\ud83d\udccb [CommunicationTaskList] Tasks length:",n.length),console.log("\ud83d\udccb [CommunicationTaskList] Completed tasks:",$);const M=e=>{const o=new Date(e),n=new Date,r=Math.ceil((o.getTime()-n.getTime())/864e5);return 0===r?"Today":1===r?"Tomorrow":-1===r?"Yesterday":r>0&&r<=7?"In ".concat(r," days"):r<0?"".concat(Math.abs(r)," days overdue"):o.toLocaleDateString()};return(0,ce.jsxs)(x.Z,{bg:C,borderColor:S,variant:"outline",children:[(0,ce.jsx)(g.b,{children:(0,ce.jsxs)(p.T,{align:"stretch",spacing:4,children:[(0,ce.jsxs)(y.z,{justify:"space-between",children:[(0,ce.jsxs)(p.T,{align:"start",spacing:1,children:[(0,ce.jsx)(j.E,{fontSize:"lg",fontWeight:"semibold",color:T,children:"Tasks"}),(0,ce.jsxs)(y.z,{spacing:2,children:[(0,ce.jsxs)(j.E,{fontSize:"sm",color:D,children:[$," of ",n.length," completed"]}),n.length>0&&(0,ce.jsxs)(k.E,{colorScheme:100===_?"green":"blue",children:[Math.round(_),"%"]})]})]}),s&&(0,ce.jsx)(f.$,{leftIcon:(0,ce.jsx)(F.GGD,{}),colorScheme:"blue",size:"sm",onClick:O,children:"Add Task"})]}),n.length>0&&(0,ce.jsx)(Z.k,{value:_,size:"sm",colorScheme:100===_?"green":"blue",borderRadius:"full"}),(0,ce.jsx)(w.c,{}),0===n.length?(0,ce.jsxs)(d.a,{py:8,textAlign:"center",children:[(0,ce.jsx)(b.I,{as:F.A3x,boxSize:12,color:D,mb:3}),(0,ce.jsx)(j.E,{color:D,children:"No tasks yet"}),s&&(0,ce.jsx)(f.$,{mt:3,size:"sm",variant:"ghost",colorScheme:"blue",onClick:O,children:"Create your first task"})]}):(0,ce.jsx)(p.T,{align:"stretch",spacing:2,children:n.map(e=>{return(0,ce.jsx)(d.a,{p:3,bg:I,borderRadius:"md",borderWidth:1,borderColor:S,opacity:"COMPLETED"===e.status?.7:1,_hover:{shadow:"sm"},children:(0,ce.jsxs)(y.z,{justify:"space-between",align:"start",children:[(0,ce.jsxs)(y.z,{align:"start",spacing:3,flex:1,children:[s&&(0,ce.jsx)(V.S,{isChecked:"COMPLETED"===e.status,onChange:()=>(async e=>{await z({variables:{id:e}})})(e.id),colorScheme:"green",mt:1}),(0,ce.jsxs)(p.T,{align:"start",spacing:1,flex:1,children:[(0,ce.jsx)(j.E,{fontWeight:"medium",color:T,textDecoration:"COMPLETED"===e.status?"line-through":"none",children:e.title}),e.description&&(0,ce.jsx)(j.E,{fontSize:"sm",color:A,children:e.description}),(0,ce.jsxs)(y.z,{spacing:3,flexWrap:"wrap",children:[(0,ce.jsx)(k.E,{colorScheme:B(e.status),size:"sm",children:(0,ce.jsxs)(y.z,{spacing:1,children:[(0,ce.jsx)(b.I,{as:U(e.status),boxSize:3}),(0,ce.jsx)(j.E,{fontSize:"xs",children:e.status.replace("_"," ")})]})}),(0,ce.jsx)(k.E,{colorScheme:N(e.priority),size:"sm",children:(0,ce.jsxs)(y.z,{spacing:1,children:[(0,ce.jsx)(b.I,{as:F.QsL,boxSize:3}),(0,ce.jsx)(j.E,{fontSize:"xs",children:e.priority})]})}),e.dueDate&&(0,ce.jsx)(k.E,{colorScheme:(o=e.dueDate,new Date(o)<new Date&&"COMPLETED"!==e.status?"red":"purple"),size:"sm",children:(0,ce.jsxs)(y.z,{spacing:1,children:[(0,ce.jsx)(b.I,{as:F.wIk,boxSize:3}),(0,ce.jsx)(j.E,{fontSize:"xs",children:M(e.dueDate)})]})}),e.assignedTo&&e.assignedTo.length>0&&(0,ce.jsxs)(y.z,{spacing:1,children:[(0,ce.jsx)(b.I,{as:F.JXP,boxSize:3,color:D}),(0,ce.jsxs)(j.E,{fontSize:"xs",color:D,children:[e.assignedTo[0].fName," ",e.assignedTo[0].lName]})]})]})]})]}),s&&(0,ce.jsxs)(ee.W,{children:[(0,ce.jsx)(oe.I,{as:E.K,icon:(0,ce.jsx)(F.ZZB,{}),variant:"ghost",size:"sm"}),(0,ce.jsxs)(ne.c,{children:[(0,ce.jsx)(re.D,{icon:(0,ce.jsx)(F.WXf,{}),onClick:()=>(e=>{h(e),m(!0)})(e),children:"Edit"}),(0,ce.jsx)(re.D,{icon:(0,ce.jsx)(F.IXo,{}),onClick:()=>(async e=>{window.confirm("Are you sure you want to delete this task?")&&await P({variables:{id:e}})})(e.id),color:"red.500",children:"Delete"})]})]})]})},e.id);var o})})]})}),(0,ce.jsx)(he,{isOpen:c,onClose:()=>{m(!1),h(null)},communicationId:r,communicationType:i,onTaskCreated:t,existingTask:u?{id:u.id,title:u.title,description:u.description||void 0,status:u.status,priority:u.priority,dueDate:u.dueDate||void 0,assignedTo:(null===(o=u.assignedTo)||void 0===o?void 0:o.map(e=>({id:e.id})))||void 0,notes:u.notes||void 0}:void 0})]})};var fe,ye,ve,Ee,Ce,ke,Se,Te=n(10744);const we=(0,_.J1)(fe||(fe=(0,s.A)(["\n    query GetInboundEmail($id: ID!) {\n        inboundEmail(id: $id) {\n            id\n            messageId\n            subject\n            from\n            fromName\n            fromFull\n            to\n            toFull\n            cc\n            ccFull\n            bcc\n            replyTo\n            date\n            textBody\n            htmlBody\n            isRead\n            isStarred\n            folder\n            labels\n            attachments {\n                name\n                contentType\n                contentLength\n                ipfsUrl\n                ipfsHash\n            }\n            tasks {\n                id\n                title\n                description\n                status\n                priority\n                dueDate\n                assignedTo {\n                    id\n                    fName\n                    lName\n                    email\n                }\n                notes\n                completedAt\n                createdAt\n            }\n        }\n    }\n"]))),Ae=(0,_.J1)(ye||(ye=(0,s.A)(["\n    mutation StarEmail($id: ID!, $isStarred: Boolean!) {\n        starInboundEmail(id: $id, isStarred: $isStarred) {\n            id\n            isStarred\n        }\n    }\n"]))),De=(0,_.J1)(ve||(ve=(0,s.A)(["\n    mutation AddInboundEmailLabel($emailId: String!, $label: String!) {\n        addInboundEmailLabel(emailId: $emailId, label: $label) {\n            id\n            labels\n        }\n    }\n"]))),Ie=(0,_.J1)(Ee||(Ee=(0,s.A)(["\n    mutation RemoveInboundEmailLabel($emailId: String!, $label: String!) {\n        removeInboundEmailLabel(emailId: $emailId, label: $label) {\n            id\n            labels\n        }\n    }\n"]))),ze=(0,_.J1)(Ce||(Ce=(0,s.A)(["\n    query AvailableInboundEmailLabels {\n        availableInboundEmailLabels\n    }\n"]))),Pe=(0,_.J1)(ke||(ke=(0,s.A)(["\n    mutation MoveToFolder($id: ID!, $folder: String!) {\n        moveInboundEmailToFolder(id: $id, folder: $folder) {\n            id\n            folder\n        }\n    }\n"]))),Ue=(0,_.J1)(Se||(Se=(0,s.A)(["\n    mutation DeleteInboundEmail($id: ID!) {\n        deleteInboundEmail(id: $id)\n    }\n"]))),Be=()=>{var e,o,n,r,i,t,s;(0,K.H)("Inbound Email");const{id:_}=(0,$.g)(),H=(0,$.Zp)(),Z=(0,l.d)(),V=(0,Q.oU)("background.main"),ee=(0,Q.oU)("background.cardGradient"),oe=(0,Q.oU)("border.darkCard"),ne=(0,Q.oU)("text.primaryDark"),re=(0,Q.oU)("text.secondaryDark"),ie=(0,Q.oU)("text.mutedDark"),{isOpen:te,onOpen:se,onClose:ae}=(0,c.j)(),{isOpen:le,onOpen:de,onClose:me}=(0,c.j)(),[ue,he]=(0,a.useState)(""),{data:xe,loading:ge,error:pe,refetch:be}=(0,M.IT)(we,{variables:{id:_},skip:!_,fetchPolicy:"cache-and-network",onError:e=>{console.error("Failed to fetch email:",e),console.error("GraphQL Errors:",e.graphQLErrors),console.error("Network Error:",e.networkError),Z({title:"Error loading email",description:e.message||"Unable to fetch email details",status:"error",duration:5e3,isClosable:!0})}});a.useEffect(()=>{var e,o;null!==xe&&void 0!==xe&&xe.inboundEmail&&(console.log("\n\ud83d\udce7 ========== FRONTEND EMAIL DATA RECEIVED =========="),console.log("\ud83d\udce7 Email ID:",xe.inboundEmail.id),console.log("\ud83d\udce7 Email Subject:",xe.inboundEmail.subject),console.log("\ud83d\udce7 Attachments exists:",!!xe.inboundEmail.attachments),console.log("\ud83d\udce7 Attachments is array:",Array.isArray(xe.inboundEmail.attachments)),console.log("\ud83d\udce7 Attachments length:",(null===(e=xe.inboundEmail.attachments)||void 0===e?void 0:e.length)||0),console.log("\ud83d\udce7 Attachments data:",JSON.stringify(xe.inboundEmail.attachments,null,2)),console.log("\ud83d\udce7 Tasks exists:",!!xe.inboundEmail.tasks),console.log("\ud83d\udce7 Tasks is array:",Array.isArray(xe.inboundEmail.tasks)),console.log("\ud83d\udce7 Tasks length:",(null===(o=xe.inboundEmail.tasks)||void 0===o?void 0:o.length)||0),console.log("\ud83d\udce7 Tasks data:",JSON.stringify(xe.inboundEmail.tasks,null,2)),console.log("\ud83d\udce7 ========== END FRONTEND EMAIL DATA ==========\n"))},[xe]);const{data:fe}=(0,M.IT)(ze),[ye]=(0,L.n)(Ae),[ve]=(0,L.n)(Pe),[Ee]=(0,L.n)(De,{onCompleted:()=>{Z({title:"Tag added",status:"success",duration:2e3}),be()}}),[Ce]=(0,L.n)(Ie,{onCompleted:()=>{Z({title:"Tag removed",status:"success",duration:2e3}),be()}}),[ke]=(0,L.n)(Ue,{onCompleted:()=>{Z({title:"Email deleted",status:"success",duration:3e3,isClosable:!0}),H("/emails")}}),Se=async()=>{ue&&null!==xe&&void 0!==xe&&xe.inboundEmail&&(await Ee({variables:{emailId:xe.inboundEmail.id,label:ue}}),he(""))};if(ge)return(0,ce.jsxs)(d.a,{minH:"100vh",bg:V,display:"flex",flexDirection:"column",children:[(0,ce.jsx)(W.m,{}),(0,ce.jsx)(X.y,{moduleConfig:Y.default}),(0,ce.jsx)(X.y,{moduleConfig:Y.default}),(0,ce.jsx)(m.m,{maxW:{base:"container.sm",md:"container.md",lg:"container.xl"},px:{base:4,md:8},py:{base:4,md:8},flex:"1",children:(0,ce.jsx)(u.o,{py:20,children:(0,ce.jsx)(h.y,{size:"xl",color:(0,Q.oU)("primaryBlue")})})}),(0,ce.jsx)(q.n,{})]});if(pe||null===xe||void 0===xe||!xe.inboundEmail)return(0,ce.jsxs)(d.a,{minH:"100vh",bg:V,display:"flex",flexDirection:"column",children:[(0,ce.jsx)(W.m,{}),(0,ce.jsx)(X.y,{moduleConfig:Y.default}),(0,ce.jsx)(X.y,{moduleConfig:Y.default}),(0,ce.jsx)(m.m,{maxW:{base:"container.sm",md:"container.md",lg:"container.xl"},px:{base:4,md:8},py:{base:4,md:8},flex:"1",children:(0,ce.jsx)(x.Z,{bg:ee,border:"1px solid",borderColor:oe,children:(0,ce.jsx)(g.b,{children:(0,ce.jsx)(u.o,{py:10,children:(0,ce.jsxs)(p.T,{spacing:4,children:[(0,ce.jsx)(b.I,{as:F.pHD,boxSize:12,color:ie}),(0,ce.jsx)(j.E,{color:ie,fontSize:"lg",children:pe?"Error loading email":"Email not found"}),pe&&(0,ce.jsxs)(p.T,{spacing:2,children:[(0,ce.jsx)(j.E,{color:ie,fontSize:"sm",textAlign:"center",children:pe.message}),_&&(0,ce.jsxs)(j.E,{color:ie,fontSize:"xs",fontFamily:"mono",children:["ID: ",_]})]}),(0,ce.jsx)(f.$,{leftIcon:(0,ce.jsx)(F.kRp,{}),onClick:()=>H("/emails"),variant:"ghost",children:"Back to Emails"})]})})})})}),(0,ce.jsx)(q.n,{})]});const Be=xe.inboundEmail;return(0,ce.jsxs)(d.a,{minH:"100vh",bg:V,display:"flex",flexDirection:"column",children:[(0,ce.jsx)(W.m,{}),(0,ce.jsx)(X.y,{moduleConfig:Y.default}),(0,ce.jsx)(m.m,{maxW:{base:"container.sm",md:"container.md",lg:"container.xl"},px:{base:4,md:8},py:{base:4,md:8},flex:"1",children:(0,ce.jsxs)(p.T,{spacing:{base:4,md:6},align:"stretch",children:[(0,ce.jsxs)(p.T,{align:"stretch",spacing:{base:3,md:0},children:[(0,ce.jsxs)(y.z,{spacing:{base:2,md:3},flexWrap:{base:"wrap",md:"nowrap"},justify:{base:"stretch",md:"flex-start"},children:[(0,ce.jsx)(f.$,{leftIcon:(0,ce.jsx)(F.kRp,{}),onClick:()=>H("/emails"),variant:"outline",borderColor:oe,color:ne,_hover:{bg:ee},size:{base:"sm",md:"md"},width:{base:"100%",md:"auto"},children:"Back to Inbox"}),(0,ce.jsx)(f.$,{leftIcon:(0,ce.jsx)(F.tSU,{}),onClick:()=>{if(null!==xe&&void 0!==xe&&xe.inboundEmail){const e=xe.inboundEmail,o={to:e.from,subject:e.subject.startsWith("Re:")?e.subject:"Re: ".concat(e.subject),fromName:e.fromName||e.from||"",date:e.date,textBody:e.textBody||"",htmlBody:e.htmlBody||"",originalTo:e.to&&e.to.length>0?e.to[0]:e.toFull&&e.toFull.length>0?e.toFull[0]:null};sessionStorage.setItem("replyEmail",JSON.stringify(o)),H("/emails/new?action=reply")}},variant:"solid",bg:(0,Q.oU)("primaryBlue"),color:"white",_hover:{bg:(0,Q.oU)("primaryBlueHover"),transform:"scale(1.02)"},_active:{bg:(0,Q.oU)("primaryBlue")},px:{base:4,md:6},fontWeight:"medium",size:{base:"sm",md:"md"},width:{base:"100%",md:"auto"},children:"Reply"}),(0,ce.jsx)(f.$,{leftIcon:(0,ce.jsx)(F.cfS,{}),onClick:()=>{if(null!==xe&&void 0!==xe&&xe.inboundEmail){const e=xe.inboundEmail,o=[e.from],n=[];e.to&&Array.isArray(e.to)&&e.to.forEach(o=>{o&&o!==e.from&&n.push(o)}),e.cc&&Array.isArray(e.cc)&&e.cc.forEach(e=>{e&&!n.includes(e)&&n.push(e)});const r={to:o.join(","),cc:n.join(","),subject:e.subject.startsWith("Re:")?e.subject:"Re: ".concat(e.subject),fromName:e.fromName||e.from||"",date:e.date,textBody:e.textBody||"",htmlBody:e.htmlBody||"",originalTo:e.to&&e.to.length>0?e.to[0]:e.toFull&&e.toFull.length>0?e.toFull[0]:null};sessionStorage.setItem("replyEmail",JSON.stringify(r)),H("/emails/new?action=replyAll")}},variant:"outline",borderColor:(0,Q.oU)("primaryBlue"),color:(0,Q.oU)("primaryBlue"),_hover:{bg:(0,Q.oU)("primaryBlue"),color:"white",transform:"scale(1.02)"},_active:{bg:(0,Q.oU)("primaryBlueHover")},px:{base:4,md:6},fontWeight:"medium",size:{base:"sm",md:"md"},width:{base:"100%",md:"auto"},children:"Reply to All"}),(0,ce.jsx)(f.$,{leftIcon:(0,ce.jsx)(F.YQ2,{}),onClick:()=>{if(null!==xe&&void 0!==xe&&xe.inboundEmail){const e=xe.inboundEmail,o={subject:e.subject.startsWith("Fwd:")?e.subject:"Fwd: ".concat(e.subject),fromName:e.fromName||e.from||"",fromEmail:e.from||"",date:e.date,textBody:e.textBody||"",htmlBody:e.htmlBody||"",originalSubject:e.subject.replace("Fwd: ",""),attachments:e.attachments||[]};sessionStorage.setItem("forwardEmail",JSON.stringify(o)),H("/emails/new?action=forward")}},variant:"outline",borderColor:(0,Q.oU)("primaryBlue"),color:(0,Q.oU)("primaryBlue"),_hover:{bg:(0,Q.oU)("primaryBlue"),color:"white",transform:"scale(1.02)"},_active:{bg:(0,Q.oU)("primaryBlueHover")},px:{base:4,md:6},fontWeight:"medium",size:{base:"sm",md:"md"},width:{base:"100%",md:"auto"},children:"Forward"}),(0,ce.jsx)(f.$,{leftIcon:(0,ce.jsx)(F.est,{}),size:{base:"sm",md:"lg"},variant:"solid",bg:"green.500",color:"white",_hover:{bg:"green.600",transform:"scale(1.05)"},_active:{bg:"green.700"},onClick:se,px:{base:4,md:8},fontSize:{base:"sm",md:"lg"},fontWeight:"bold",boxShadow:"lg",width:{base:"100%",md:"auto"},children:"Convert to Project"})]}),(0,ce.jsxs)(y.z,{spacing:{base:2,md:3},justify:{base:"center",md:"flex-end"},children:[(0,ce.jsx)(v.m,{label:"Export as PDF",placement:"bottom",bg:(0,Q.oU)("primaryBlue"),color:"white",fontSize:"sm",px:3,py:2,borderRadius:"md",hasArrow:!0,children:(0,ce.jsx)(E.K,{"aria-label":"Export as PDF",icon:(0,ce.jsx)(F.jH2,{}),onClick:async()=>{if(null!==xe&&void 0!==xe&&xe.inboundEmail)try{var e;let o=document.getElementById("email-content-container");if(!o){const e=document.querySelectorAll(".chakra-card__body");Array.from(e).forEach(e=>{!o&&e.querySelector(".chakra-heading")&&e.querySelector(".chakra-divider")&&(o=e)})}if(!o)throw new Error("Email content element not found");Z({title:"Generating PDF",description:"Please wait while we prepare your PDF...",status:"info",duration:2e3});const n=o.cloneNode(!0);n.querySelectorAll('button, .chakra-button, [aria-label*="Manage"]').forEach(e=>e.remove()),n.style.cssText='\n                position: absolute !important;\n                left: -9999px !important;\n                top: 0 !important;\n                background-color: white !important;\n                width: 800px !important;\n                padding: 20px !important;\n                color: black !important;\n                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif !important;\n                height: auto !important;\n                max-height: none !important;\n                overflow: visible !important;\n            ';n.querySelectorAll("*").forEach(e=>{const o=e;o.style.maxHeight&&(o.style.maxHeight="none"),o.style.height&&"auto"!==o.style.height&&(o.style.height="auto"),o.style.overflow="visible",o.classList.contains("chakra-badge")||o.style.backgroundColor||o.style.background||(o.style.color="black"),o.tagName.match(/^(P|H[1-6]|SPAN|DIV|TD|TH|LI)$/i)&&(o.style.color="black !important")}),document.body.appendChild(n),await new Promise(e=>setTimeout(e,500));const r=await J()(n,{scale:2,useCORS:!0,allowTaint:!0,logging:!1,backgroundColor:"#ffffff",width:800,height:n.scrollHeight,windowWidth:800,windowHeight:n.scrollHeight,onclone:(e,o)=>{o.style.color="black",o.style.backgroundColor="white";o.querySelectorAll("p, h1, h2, h3, h4, h5, h6, span, div, td, th, li").forEach(e=>{const o=e;o.style.backgroundColor||o.classList.contains("chakra-badge")||(o.style.color="black")})}});document.body.removeChild(n);r.toDataURL("image/png");const i=new G.Ay({orientation:"portrait",unit:"mm",format:"a4"}),t=i.internal.pageSize.getWidth(),s=i.internal.pageSize.getHeight(),a=t-20,l=r.height*a/r.width,c=s-20,d=Math.ceil(l/c);for(let e=0;e<d;e++){e>0&&i.addPage();const o=e*(c*r.width/a),n=Math.min(r.height-o,c*r.width/a),t=document.createElement("canvas");t.width=r.width,t.height=n;const s=t.getContext("2d");if(s){s.drawImage(r,0,o,r.width,n,0,0,r.width,n);const e=t.toDataURL("image/png"),l=n*a/r.width;i.addImage(e,"PNG",10,10,a,l,void 0,"FAST")}}const m=xe.inboundEmail;i.setProperties({title:m.subject,subject:"Email from ".concat(m.from),author:Q.Kk.siteName||"Email Archive",keywords:(null===(e=m.labels)||void 0===e?void 0:e.join(", "))||"",creator:Q.Kk.siteName||"Email Archive"});const u="".concat(m.subject.replace(/[^a-z0-9]/gi,"_").substring(0,50),"_").concat((0,R.GP)(new Date(m.date),"yyyy-MM-dd"),".pdf");i.save(u),Z({title:"PDF Downloaded",description:"Email has been exported as PDF",status:"success",duration:3e3})}catch(pe){console.error("Error generating PDF:",pe),Z({title:"Error",description:"Failed to generate PDF. Please try again.",status:"error",duration:3e3})}},variant:"ghost",color:ie,_hover:{transform:"scale(1.1)",color:(0,Q.oU)("primaryBlue")}})}),(0,ce.jsx)(v.m,{label:Be.isStarred?"Unstar email":"Star email",placement:"bottom",bg:(0,Q.oU)("primaryBlue"),color:"white",fontSize:"sm",px:3,py:2,borderRadius:"md",hasArrow:!0,children:(0,ce.jsx)(E.K,{"aria-label":"Star email",icon:(0,ce.jsx)(F.usP,{}),onClick:async()=>{null!==xe&&void 0!==xe&&xe.inboundEmail&&await ye({variables:{id:xe.inboundEmail.id,isStarred:!xe.inboundEmail.isStarred}})},variant:"ghost",color:Be.isStarred?(0,Q.oU)("starYellow"):ie,_hover:{transform:"scale(1.1)",color:Be.isStarred?(0,Q.oU)("starYellowHover"):(0,Q.oU)("primaryBlue")}})}),(0,ce.jsx)(v.m,{label:"Archived"===Be.folder?"Move back to Inbox if tasks are not completed":"Archive email when all tasks are done",placement:"bottom",bg:(0,Q.oU)("primaryBlue"),color:"white",fontSize:"sm",px:3,py:2,borderRadius:"md",hasArrow:!0,children:(0,ce.jsx)(E.K,{"aria-label":"Archived"===Be.folder?"Unarchive email":"Archive email",icon:(0,ce.jsx)(F.OZ2,{}),onClick:async()=>{if(null!==xe&&void 0!==xe&&xe.inboundEmail){const e="Archived"===xe.inboundEmail.folder,o=e?"Inbox":"Archived";await ve({variables:{id:xe.inboundEmail.id,folder:o}}),Z({title:e?"Email moved back to inbox":"Email archived",description:e?"Email has been restored to your inbox":"Email has been moved to archive",status:"success",duration:3e3,isClosable:!0}),setTimeout(()=>{H("/emails")},1e3)}},variant:"ghost",color:"Archived"===Be.folder?(0,Q.oU)("primaryBlue"):ie,_hover:{transform:"scale(1.1)",color:(0,Q.oU)("primaryBlue")}})}),(0,ce.jsx)(v.m,{label:"Delete email",placement:"bottom",bg:(0,Q.oU)("status.error"),color:"white",fontSize:"sm",px:3,py:2,borderRadius:"md",hasArrow:!0,children:(0,ce.jsx)(E.K,{"aria-label":"Delete email",icon:(0,ce.jsx)(F.IXo,{}),onClick:async()=>{window.confirm("Are you sure you want to delete this email?")&&await ke({variables:{id:_}})},variant:"ghost",color:"red.500",_hover:{transform:"scale(1.1)",color:"red.600",bg:"red.50"}})})]})]}),(0,ce.jsx)(x.Z,{bg:ee,border:"1px solid",borderColor:oe,children:(0,ce.jsx)(g.b,{p:{base:3,md:6},id:"email-content-container",children:(0,ce.jsxs)(p.T,{align:"stretch",spacing:{base:4,md:6},children:[(0,ce.jsxs)(p.T,{align:"stretch",spacing:3,children:[(0,ce.jsxs)(p.T,{align:"start",spacing:{base:2,md:3},children:[(0,ce.jsx)(C.D,{size:{base:"md",md:"lg",lg:"xl"},color:ne,children:Be.subject}),Be.folder&&(0,ce.jsx)(k.E,{colorScheme:"blue",fontSize:{base:"xs",md:"sm"},children:Be.folder})]}),(0,ce.jsxs)(y.z,{spacing:2,align:"center",children:[(null===(e=Be.labels)||void 0===e?void 0:e.length)>0&&(0,ce.jsx)(S.B,{spacing:2,children:Be.labels.map(e=>(0,ce.jsx)(S.Q,{children:(0,ce.jsx)(T.vw,{size:"md",bg:"rgba(168, 85, 247, 0.2)",color:"#A855F7",border:"1px solid",borderColor:"rgba(168, 85, 247, 0.3)",children:(0,ce.jsx)(T.d1,{children:e})})},e))}),(0,ce.jsx)(v.m,{label:"Manage tags",placement:"top",bg:(0,Q.oU)("primaryBlue"),color:"white",fontSize:"sm",px:3,py:2,borderRadius:"md",hasArrow:!0,children:(0,ce.jsx)(E.K,{"aria-label":"Manage tags",icon:(0,ce.jsx)(F.cnX,{}),size:"sm",variant:"ghost",color:ie,_hover:{bg:ee,color:(0,Q.oU)("primaryBlue"),transform:"scale(1.1)"},onClick:de})})]})]}),(0,ce.jsx)(w.c,{borderColor:oe}),(0,ce.jsxs)(p.T,{align:"stretch",spacing:{base:2,md:3},children:[(0,ce.jsxs)(p.T,{align:"start",spacing:1,children:[(0,ce.jsx)(j.E,{fontWeight:"bold",color:ie,fontSize:{base:"sm",md:"md"},children:"From:"}),(0,ce.jsx)(j.E,{color:ne,fontSize:{base:"sm",md:"md"},pl:{base:0,md:4},children:Be.fromFull||Be.from})]}),(0,ce.jsxs)(p.T,{align:"start",spacing:1,children:[(0,ce.jsx)(j.E,{fontWeight:"bold",color:ie,fontSize:{base:"sm",md:"md"},children:"To:"}),(0,ce.jsx)(p.T,{align:"start",spacing:1,pl:{base:0,md:4},children:(null===(o=Be.toFull)||void 0===o?void 0:o.map((e,o)=>(0,ce.jsx)(j.E,{color:ne,fontSize:{base:"sm",md:"md"},children:e},o)))||(null===(n=Be.to)||void 0===n?void 0:n.map((e,o)=>(0,ce.jsx)(j.E,{color:ne,fontSize:{base:"sm",md:"md"},children:e},o)))})]}),(null===(r=Be.cc)||void 0===r?void 0:r.length)>0&&(0,ce.jsxs)(y.z,{align:"start",children:[(0,ce.jsx)(j.E,{fontWeight:"bold",color:ie,minW:"80px",children:"CC:"}),(0,ce.jsx)(p.T,{align:"start",spacing:1,children:(null===(i=Be.ccFull)||void 0===i?void 0:i.map((e,o)=>(0,ce.jsx)(j.E,{color:ne,children:e},o)))||(null===(t=Be.cc)||void 0===t?void 0:t.map((e,o)=>(0,ce.jsx)(j.E,{color:ne,children:e},o)))})]}),(0,ce.jsxs)(p.T,{align:"start",spacing:1,children:[(0,ce.jsx)(j.E,{fontWeight:"bold",color:ie,fontSize:{base:"sm",md:"md"},children:"Date:"}),(0,ce.jsx)(j.E,{color:ne,fontSize:{base:"sm",md:"md"},pl:{base:0,md:4},children:(0,R.GP)(new Date(Be.date),"PPpp")})]})]}),(0,ce.jsx)(w.c,{borderColor:oe}),(0,ce.jsx)(d.a,{children:Be.htmlBody?(0,ce.jsx)(d.a,{dangerouslySetInnerHTML:{__html:Be.htmlBody},color:re,sx:{"& a":{color:(0,Q.oU)("primaryBlue"),textDecoration:"underline"},"& p":{marginBottom:"1em"},"& ul, & ol":{paddingLeft:"2em",marginBottom:"1em"},"& blockquote":{borderLeft:"3px solid",borderColor:oe,paddingLeft:"1em",marginLeft:"0",color:ie}}}):(0,ce.jsx)(j.E,{whiteSpace:"pre-wrap",color:re,children:Be.textBody||"No content available"})}),(null===(s=Be.attachments)||void 0===s?void 0:s.length)>0&&(0,ce.jsxs)(ce.Fragment,{children:[(0,ce.jsx)(w.c,{borderColor:oe}),(0,ce.jsxs)(p.T,{align:"stretch",spacing:3,children:[(0,ce.jsxs)(y.z,{children:[(0,ce.jsx)(b.I,{as:F._mV,color:ie}),(0,ce.jsxs)(j.E,{fontWeight:"bold",color:ie,children:["Attachments (",Be.attachments.length,")"]})]}),(0,ce.jsx)(p.T,{align:"stretch",spacing:2,children:Be.attachments.map((e,o)=>(0,ce.jsx)(d.a,{children:e.ipfsUrl?(0,ce.jsx)(A.N,{href:e.ipfsUrl,isExternal:!0,_hover:{textDecoration:"none"},children:(0,ce.jsxs)(y.z,{p:3,bg:V,borderRadius:"md",border:"1px solid",borderColor:oe,cursor:"pointer",_hover:{bg:"whiteAlpha.50",borderColor:(0,Q.oU)("primaryBlue")},transition:"all 0.2s",children:[(0,ce.jsx)(b.I,{as:F.a4x,color:(0,Q.oU)("primaryBlue")}),(0,ce.jsxs)(p.T,{align:"start",spacing:0,flex:1,children:[(0,ce.jsx)(j.E,{color:ne,fontWeight:"medium",children:e.name}),(0,ce.jsxs)(y.z,{spacing:2,children:[(0,ce.jsx)(j.E,{fontSize:"sm",color:ie,children:e.contentType}),(0,ce.jsxs)(j.E,{fontSize:"sm",color:ie,children:["\u2022 ",Math.round(e.contentLength/1024)," KB"]}),e.ipfsHash&&(0,ce.jsxs)(j.E,{fontSize:"xs",color:ie,fontFamily:"mono",children:["\u2022 IPFS: ",e.ipfsHash.substring(0,8),"..."]})]})]}),(0,ce.jsx)(b.I,{as:F.HaR,color:ie})]})}):(0,ce.jsxs)(y.z,{p:3,bg:V,borderRadius:"md",border:"1px solid",borderColor:oe,opacity:.7,children:[(0,ce.jsx)(b.I,{as:F._mV,color:ie}),(0,ce.jsxs)(p.T,{align:"start",spacing:0,flex:1,children:[(0,ce.jsx)(j.E,{color:ne,children:e.name}),(0,ce.jsxs)(j.E,{fontSize:"sm",color:ie,children:[e.contentType," \u2022 ",Math.round(e.contentLength/1024)," KB"]})]}),(0,ce.jsx)(k.E,{colorScheme:"gray",fontSize:"xs",children:"Not uploaded"})]})},o))})]})]})]})})}),(0,ce.jsx)(d.a,{mt:6,children:(0,ce.jsx)(je,{tasks:Be.tasks||[],communicationId:_,communicationType:"INBOUND_EMAIL",onTasksUpdated:()=>{be()},allowEdit:!0})})]})}),(0,ce.jsx)(q.n,{}),(null===xe||void 0===xe?void 0:xe.inboundEmail)&&(0,ce.jsx)(Te.R,{isOpen:te,onClose:ae,email:{id:xe.inboundEmail.id,subject:xe.inboundEmail.subject||"",bodyMarkdown:xe.inboundEmail.textBody||"",from:xe.inboundEmail.from||""}}),(null===xe||void 0===xe?void 0:xe.inboundEmail)&&(0,ce.jsxs)(D.aF,{isOpen:le,onClose:me,size:"md",children:[(0,ce.jsx)(I.m,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),(0,ce.jsxs)(z.$,{bg:ee,border:"1px solid",borderColor:oe,children:[(0,ce.jsx)(P.r,{color:ne,children:"Manage Tags"}),(0,ce.jsx)(U.s,{color:ie}),(0,ce.jsx)(B.c,{children:(0,ce.jsxs)(p.T,{spacing:4,align:"stretch",children:[(0,ce.jsxs)(j.E,{fontSize:"sm",color:re,noOfLines:2,children:[(0,ce.jsx)("strong",{children:"Subject:"})," ",xe.inboundEmail.subject]}),xe.inboundEmail.labels&&xe.inboundEmail.labels.length>0&&(0,ce.jsxs)(d.a,{children:[(0,ce.jsx)(j.E,{fontSize:"sm",color:ie,mb:2,children:"Current tags:"}),(0,ce.jsx)(S.B,{spacing:2,children:xe.inboundEmail.labels.map(e=>(0,ce.jsx)(S.Q,{children:(0,ce.jsxs)(T.vw,{size:"md",bg:"rgba(168, 85, 247, 0.2)",color:"#A855F7",border:"1px solid",borderColor:"rgba(168, 85, 247, 0.3)",children:[(0,ce.jsx)(T.d1,{children:e}),(0,ce.jsx)(T.TV,{onClick:()=>(async e=>{null!==xe&&void 0!==xe&&xe.inboundEmail&&await Ce({variables:{emailId:xe.inboundEmail.id,label:e}})})(e)})]})},e))})]}),(0,ce.jsxs)(d.a,{children:[(0,ce.jsx)(j.E,{fontSize:"sm",color:ie,mb:2,children:"Add new tag:"}),(0,ce.jsxs)(y.z,{children:[(0,ce.jsx)(N.p,{value:ue,onChange:e=>he(e.target.value),placeholder:"Enter tag name",size:"sm",bg:V,color:ne,borderColor:oe,_placeholder:{color:ie},onKeyPress:e=>{"Enter"===e.key&&Se()}}),(0,ce.jsx)(f.$,{size:"sm",onClick:Se,bg:(0,Q.oU)("primaryBlue"),color:"white",_hover:{bg:(0,Q.oU)("primaryBlueHover")},isDisabled:!ue.trim(),children:"Add"})]})]}),(null===fe||void 0===fe?void 0:fe.availableInboundEmailLabels)&&fe.availableInboundEmailLabels.length>0&&(0,ce.jsxs)(d.a,{children:[(0,ce.jsx)(j.E,{fontSize:"sm",color:ie,mb:2,children:"Quick add from existing tags:"}),(0,ce.jsx)(S.B,{spacing:2,children:fe.availableInboundEmailLabels.filter(e=>{var o;return!(null!==(o=xe.inboundEmail.labels)&&void 0!==o&&o.includes(e))}).map(e=>(0,ce.jsx)(S.Q,{children:(0,ce.jsx)(T.vw,{size:"sm",cursor:"pointer",bg:oe,color:re,_hover:{bg:"rgba(168, 85, 247, 0.2)",color:"#A855F7"},onClick:()=>{he(e),Se()},children:(0,ce.jsx)(T.d1,{children:e})})},e))})]})]})}),(0,ce.jsx)(O.j,{children:(0,ce.jsx)(f.$,{variant:"ghost",onClick:me,color:ie,children:"Done"})})]})]})]})}},10744:(e,o,n)=>{n.d(o,{R:()=>oe});var r,i,t,s,a=n(89379),l=n(57528),c=n(65043),d=n(88787),m=n(85871),u=n(87139),h=n(22107),x=n(98662),g=n(42703),p=n(82459),b=n(73225),j=n(76668),f=n(35699),y=n(67516),v=n(35929),E=n(56529),C=n(15071),k=n(11054),S=n(78460),T=n(25722),w=n(44860),A=n(76659),D=n(96148),I=n(10202),z=n(98481),P=n(80511),U=n(82595),B=n(67813),N=n(83201),O=n(3313),$=n(55395),_=n(14566),M=n(31411),L=n(10227),F=n(51794),R=n(3109),H=n(19077),J=n(30502),G=n(39081),W=n(31881),q=n(70459),Q=n(1009),K=n(39985),X=n(70579);const Y=(0,q.J1)(r||(r=(0,l.A)(["\n    mutation ScanEmailAndGenerateProjectProposal(\n        $emailContent: String!\n        $emailSubject: String\n        $senderName: String\n        $senderEmail: String\n    ) {\n        scanEmailAndGenerateProjectProposal(\n            emailContent: $emailContent\n            emailSubject: $emailSubject\n            senderName: $senderName\n            senderEmail: $senderEmail\n        ) {\n            projectName\n            projectSummary\n            clientName\n            clientEmail\n            clientPhone\n            tasks {\n                title\n                description\n                estimatedHours\n                order\n                category\n            }\n            suggestedPrice\n            upfrontPayment\n            finalPayment\n            deliveryTimeline\n            deliverables\n            specialRequirements\n        }\n    }\n"]))),Z=(0,q.J1)(i||(i=(0,l.A)(["\n    mutation CreateProject($input: ProjectInput!) {\n        createProject(input: $input) {\n            id\n            projectName\n            projectGoal\n            suggestedPrice\n            upfrontPayment\n        }\n    }\n"]))),V=(0,q.J1)(t||(t=(0,l.A)(["\n    mutation CreateTask($input: TaskInput!) {\n        createTask(input: $input) {\n            id\n            name\n            description\n            status\n        }\n    }\n"]))),ee=(0,q.J1)(s||(s=(0,l.A)(["\n    mutation CreateBill($input: BillInput!) {\n        createBill(input: $input) {\n            id\n            status\n            totalAmount\n        }\n    }\n"]))),oe=e=>{let{isOpen:o,onClose:n,email:r}=e;const i=(0,J.d)(),[t,s]=(0,c.useState)(null),[l,q]=(0,c.useState)(!1),[oe,ne]=(0,c.useState)(!1),[re,ie]=(0,c.useState)(!0),[te,se]=(0,c.useState)(0),[ae]=(0,W.n)(Y),[le]=(0,W.n)(Z),[ce]=(0,W.n)(V),[de]=(0,W.n)(ee),me=(0,K.oU)("textPrimary"),ue=(0,K.oU)("textSecondary"),he=(0,K.oU)("background"),xe=(0,K.oU)("cardBorder");(0,c.useEffect)(()=>{!o||t||l||ge()},[o]);const ge=async()=>{q(!0);try{var e,o,n,t;const a=await ae({variables:{emailContent:r.bodyMarkdown||"",emailSubject:r.subject||"",senderName:(null===(e=r.from)||void 0===e?void 0:e.split("<")[0].trim())||"",senderEmail:(null===(o=r.from)||void 0===o||null===(n=o.match(/<(.+)>/))||void 0===n?void 0:n[1])||r.from||""}});null!==(t=a.data)&&void 0!==t&&t.scanEmailAndGenerateProjectProposal&&(s(a.data.scanEmailAndGenerateProjectProposal),i({title:"Analysis Complete",description:"AI has extracted project details from the email",status:"success",duration:3e3}))}catch(a){console.error("Failed to analyze email:",a),i({title:"Analysis failed",description:"Could not analyze email. Please fill in details manually.",status:"error",duration:5e3}),s({projectName:r.subject||"New Project",projectSummary:"",clientName:"",clientEmail:"",clientPhone:"",tasks:[],suggestedPrice:0,upfrontPayment:0,finalPayment:0,deliveryTimeline:"2 weeks",deliverables:[],specialRequirements:""})}finally{q(!1)}},pe=(e,o,n)=>{if(!t)return;const r=[...t.tasks];r[e]=(0,a.A)((0,a.A)({},r[e]),{},{[o]:n}),s((0,a.A)((0,a.A)({},t),{},{tasks:r}))},be=(null===t||void 0===t?void 0:t.tasks.reduce((e,o)=>e+o.estimatedHours,0))||0;return(0,X.jsxs)(S.aF,{isOpen:o,onClose:n,size:"6xl",children:[(0,X.jsx)(k.m,{}),(0,X.jsxs)(T.$,{bg:he,borderColor:xe,children:[(0,X.jsx)(C.r,{color:me,children:(0,X.jsxs)(D.z,{children:[(0,X.jsx)(Q.est,{}),(0,X.jsx)(G.E,{children:"Convert Email to Project"})]})}),(0,X.jsx)(v.s,{color:ue}),(0,X.jsx)(y.c,{children:l?(0,X.jsxs)(I.T,{spacing:4,py:8,children:[(0,X.jsx)(A.y,{size:"xl",color:(0,K.oU)("primaryBlue")}),(0,X.jsx)(G.E,{color:ue,children:"AI is analyzing email content..."}),(0,X.jsx)(G.E,{fontSize:"sm",color:ue,children:"Extracting project details and tasks"})]}):t?(0,X.jsxs)(R.t,{index:te,onChange:se,children:[(0,X.jsxs)(M.w,{children:[(0,X.jsx)(_.o,{color:ue,children:"Project Details"}),(0,X.jsxs)(_.o,{color:ue,children:["Tasks (",t.tasks.length,")"]}),(0,X.jsx)(_.o,{color:ue,children:"Pricing"})]}),(0,X.jsxs)(F.T,{children:[(0,X.jsx)(L.K,{children:(0,X.jsxs)(I.T,{spacing:4,align:"stretch",children:[(0,X.jsxs)(b.MJ,{children:[(0,X.jsx)(j.l,{color:ue,children:"Project Name"}),(0,X.jsx)(f.p,{value:t.projectName,onChange:e=>s((0,a.A)((0,a.A)({},t),{},{projectName:e.target.value})),bg:he,borderColor:xe,color:me})]}),(0,X.jsxs)(b.MJ,{children:[(0,X.jsx)(j.l,{color:ue,children:"Project Summary"}),(0,X.jsx)(H.T,{value:t.projectSummary,onChange:e=>s((0,a.A)((0,a.A)({},t),{},{projectSummary:e.target.value})),bg:he,borderColor:xe,color:me,rows:3})]}),(0,X.jsxs)(D.z,{spacing:4,children:[(0,X.jsxs)(b.MJ,{children:[(0,X.jsx)(j.l,{color:ue,children:"Client Name"}),(0,X.jsx)(f.p,{value:t.clientName,onChange:e=>s((0,a.A)((0,a.A)({},t),{},{clientName:e.target.value})),bg:he,borderColor:xe,color:me})]}),(0,X.jsxs)(b.MJ,{children:[(0,X.jsx)(j.l,{color:ue,children:"Client Email"}),(0,X.jsx)(f.p,{value:t.clientEmail||"",onChange:e=>s((0,a.A)((0,a.A)({},t),{},{clientEmail:e.target.value})),bg:he,borderColor:xe,color:me})]})]}),(0,X.jsxs)(b.MJ,{children:[(0,X.jsxs)(j.l,{color:ue,children:[(0,X.jsx)(Q.Ohp,{style:{display:"inline",marginRight:"8px"}}),"Delivery Timeline"]}),(0,X.jsx)(f.p,{value:t.deliveryTimeline,onChange:e=>s((0,a.A)((0,a.A)({},t),{},{deliveryTimeline:e.target.value})),bg:he,borderColor:xe,color:me})]})]})}),(0,X.jsx)(L.K,{children:(0,X.jsxs)(I.T,{spacing:4,align:"stretch",children:[(0,X.jsxs)(D.z,{justify:"space-between",children:[(0,X.jsxs)(G.E,{color:ue,children:["Total Hours: ",(0,X.jsxs)(u.E,{colorScheme:"blue",children:[be,"h"]})]}),(0,X.jsx)(x.$,{size:"sm",leftIcon:(0,X.jsx)(Q.GGD,{}),variant:"outline",onClick:()=>{if(!t)return;const e={title:"New Task",description:"",estimatedHours:1,order:t.tasks.length+1,category:"Development"};s((0,a.A)((0,a.A)({},t),{},{tasks:[...t.tasks,e]}))},children:"Add Task"})]}),(0,X.jsx)(h.a,{maxH:"300px",overflowY:"auto",children:(0,X.jsxs)(P.X,{size:"sm",children:[(0,X.jsx)(O.d,{children:(0,X.jsxs)($.Tr,{children:[(0,X.jsx)(N.Th,{color:ue,children:"Task"}),(0,X.jsx)(N.Th,{color:ue,children:"Description"}),(0,X.jsx)(N.Th,{color:ue,isNumeric:!0,children:"Hours"}),(0,X.jsx)(N.Th,{})]})}),(0,X.jsx)(U.N,{children:t.tasks.map((e,o)=>(0,X.jsxs)($.Tr,{children:[(0,X.jsx)(B.Td,{children:(0,X.jsx)(f.p,{value:e.title,onChange:e=>pe(o,"title",e.target.value),size:"sm",bg:he,borderColor:xe,color:me})}),(0,X.jsx)(B.Td,{children:(0,X.jsx)(f.p,{value:e.description,onChange:e=>pe(o,"description",e.target.value),size:"sm",bg:he,borderColor:xe,color:me})}),(0,X.jsx)(B.Td,{children:(0,X.jsxs)(w.Q7,{value:e.estimatedHours,onChange:(e,n)=>pe(o,"estimatedHours",n),min:.5,step:.5,size:"sm",width:"80px",children:[(0,X.jsx)(w.OO,{bg:he,borderColor:xe,color:me}),(0,X.jsxs)(w.lw,{children:[(0,X.jsx)(w.Q0,{}),(0,X.jsx)(w.Sh,{})]})]})}),(0,X.jsx)(B.Td,{children:(0,X.jsx)(g.K,{"aria-label":"Remove task",icon:(0,X.jsx)(Q.IXo,{}),size:"sm",variant:"ghost",colorScheme:"red",onClick:()=>(e=>{t&&s((0,a.A)((0,a.A)({},t),{},{tasks:t.tasks.filter((o,n)=>n!==e)}))})(o)})})]},o))})]})})]})}),(0,X.jsx)(L.K,{children:(0,X.jsxs)(I.T,{spacing:4,align:"stretch",children:[(0,X.jsxs)(d.F,{status:"info",variant:"subtle",children:[(0,X.jsx)(m._,{}),(0,X.jsxs)(h.a,{children:[(0,X.jsx)(G.E,{fontWeight:"bold",children:"AI Pricing Recommendation"}),(0,X.jsxs)(G.E,{fontSize:"sm",children:["Based on ",be," hours of work"]})]})]}),(0,X.jsxs)(D.z,{spacing:4,children:[(0,X.jsxs)(b.MJ,{children:[(0,X.jsxs)(j.l,{color:ue,children:[(0,X.jsx)(Q.z8N,{style:{display:"inline"}})," Total Price"]}),(0,X.jsxs)(w.Q7,{value:t.suggestedPrice,onChange:(e,o)=>s((0,a.A)((0,a.A)({},t),{},{suggestedPrice:o,upfrontPayment:Math.round(.5*o),finalPayment:Math.round(.5*o)})),min:0,step:100,children:[(0,X.jsx)(w.OO,{bg:he,borderColor:xe,color:me}),(0,X.jsxs)(w.lw,{children:[(0,X.jsx)(w.Q0,{}),(0,X.jsx)(w.Sh,{})]})]})]}),(0,X.jsxs)(b.MJ,{children:[(0,X.jsx)(j.l,{color:ue,children:"50% Upfront"}),(0,X.jsxs)(w.Q7,{value:t.upfrontPayment,onChange:(e,o)=>s((0,a.A)((0,a.A)({},t),{},{upfrontPayment:o})),min:0,step:100,children:[(0,X.jsx)(w.OO,{bg:he,borderColor:xe,color:me}),(0,X.jsxs)(w.lw,{children:[(0,X.jsx)(w.Q0,{}),(0,X.jsx)(w.Sh,{})]})]})]}),(0,X.jsxs)(b.MJ,{children:[(0,X.jsx)(j.l,{color:ue,children:"50% Final"}),(0,X.jsxs)(w.Q7,{value:t.finalPayment,onChange:(e,o)=>s((0,a.A)((0,a.A)({},t),{},{finalPayment:o})),min:0,step:100,children:[(0,X.jsx)(w.OO,{bg:he,borderColor:xe,color:me}),(0,X.jsxs)(w.lw,{children:[(0,X.jsx)(w.Q0,{}),(0,X.jsx)(w.Sh,{})]})]})]})]}),(0,X.jsx)(p.c,{}),(0,X.jsxs)(b.MJ,{display:"flex",alignItems:"center",children:[(0,X.jsx)(j.l,{mb:0,color:ue,children:"Create draft invoice for full amount"}),(0,X.jsx)(z.d,{isChecked:re,onChange:e=>ie(e.target.checked),colorScheme:"green"})]}),re&&(0,X.jsxs)(d.F,{status:"success",variant:"subtle",children:[(0,X.jsx)(m._,{}),(0,X.jsxs)(G.E,{fontSize:"sm",children:["A draft invoice for $",t.suggestedPrice," will be created. You can then generate a 50% upfront invoice from it."]})]})]})})]})]}):null}),(0,X.jsxs)(E.j,{children:[(0,X.jsx)(x.$,{variant:"ghost",mr:3,onClick:n,isDisabled:oe,children:"Cancel"}),(0,X.jsx)(x.$,{leftIcon:(0,X.jsx)(Q.est,{}),colorScheme:"green",onClick:async()=>{if(t){ne(!0);try{var e,o;const a=null===(e=(await le({variables:{input:{projectName:t.projectName,projectGoal:t.projectSummary,projectDescription:t.specialRequirements||"",billingClient:"000000000000000000000000",clientEmail:t.clientEmail,clientPhone:t.clientPhone,suggestedPrice:t.suggestedPrice,upfrontPayment:t.upfrontPayment,finalPayment:t.finalPayment,deliveryTimeline:t.deliveryTimeline,deliverables:t.deliverables,specialRequirements:t.specialRequirements,sourceEmailId:r.id,proposalStatus:"draft"}}})).data)||void 0===e||null===(o=e.createProject)||void 0===o?void 0:o.id;if(a){for(const e of t.tasks)await ce({variables:{input:{projectId:a,name:e.title,description:e.description,estimatedHours:e.estimatedHours,order:e.order,category:e.category,status:"TODO"}}});if(re&&t.suggestedPrice>0)try{await de({variables:{input:{projectId:a,isPaid:!1,status:"DRAFT",currency:"AUD",showPaymentDetails:!1,lineItems:[{description:"".concat(t.projectName," - Complete Project"),amount:t.suggestedPrice}],paymentTerms:"Total project value. 50% upfront ($".concat(t.upfrontPayment,"), 50% on completion ($").concat(t.finalPayment,")")}}})}catch(s){console.error("Failed to create draft invoice:",s)}i({title:"Project Created! \ud83c\udf89",description:"Created project with ".concat(t.tasks.length," tasks").concat(re?" and draft invoice":""),status:"success",duration:5e3}),window.open("/projects/".concat(a),"_blank"),n()}}catch(a){console.error("Failed to create project:",a),i({title:"Failed to create project",description:"Please try again",status:"error",duration:5e3})}finally{ne(!1)}}},isLoading:oe,isDisabled:!t||!t.projectName||l,children:"Create Project & Open"})]})]})]})}}}]);
//# sourceMappingURL=5401.eef8dcfd.chunk.js.map