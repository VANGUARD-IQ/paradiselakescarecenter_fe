"use strict";(self.webpackChunkbusiness_builder_master_frontend=self.webpackChunkbusiness_builder_master_frontend||[]).push([[4364],{84364:(e,o,r)=>{r.r(o),r.d(o,{default:()=>M});var t,s=r(57528),i=r(65043),n=r(73216),l=r(35475),a=r(10585),c=r(70459),d=r(96870),p=r(87139),x=r(22107),m=r(98662),h=r(42703),u=r(98939),j=r(82459),g=r(25011),f=r(33572),b=r(67516),y=r(35929),k=r(11054),v=r(78460),w=r(25722),C=r(76659),E=r(96148),T=r(10202),S=r(28846),A=r(39081),F=r(1009),P=r(52003),D=r(63295),K=r(95214),U=r(29066),z=r(26312),_=r(80454),I=r(2332),H=r(8987),N=r(26424),L=r(39985),Q=r(66037),R=r(26163),V=r(82892),O=r(70579);I.EA.workerSrc="//unpkg.com/pdfjs-dist@".concat(I.rE,"/build/pdf.worker.min.mjs");const W=(0,c.J1)(t||(t=(0,s.A)(["\n  query GetProjectTimeline($id: ID!) {\n    project(id: $id) {\n      id\n      projectName\n      projectGoal\n      createdAt\n      tasks {\n        id\n        description\n        status\n        order\n        createdAt\n        updatedAt\n        media {\n          url\n          description\n          fileType\n        }\n      }\n    }\n  }\n"]))),G=e=>{try{console.log("Attempting to format date: ".concat(e));const o=new Date(e);return isNaN(o.getTime())?(console.log("Invalid date created from: ".concat(e)),e):(console.log("Parsed date: ".concat(o.toString())),(0,_.GP)(o,"MMMM d, yyyy, h:mm a"))}catch(o){return console.error("Error formatting date: ".concat(e),o),e}},M=()=>{(0,Q.H)("Project Timeline");const{id:e}=(0,n.g)(),{isAuthenticated:o,user:r}=(0,U.A)(),t=(0,L.oU)("background.main"),s=(0,L.oU)("background.cardGradient"),c=(0,L.oU)("border.darkCard"),_=(0,L.oU)("text.primaryDark"),I=(0,L.oU)("text.secondaryDark"),M=((0,L.oU)("text.mutedDark"),s),$=c,{isOpen:B,onOpen:q,onClose:J}=(0,d.j)(),[X,Y]=(0,i.useState)(null),[Z,ee]=(0,i.useState)(10),oe=(0,i.useRef)(null),[re,te]=(0,i.useState)(!0),[se,ie]=(0,i.useState)([]),[ne,le]=(0,i.useState)(!1),{loading:ae,error:ce,data:de}=(0,a.IT)(W,{variables:{id:e},onCompleted:e=>{var o;console.log("GraphQL query completed, data:",e),null!==e&&void 0!==e&&null!==(o=e.project)&&void 0!==o&&o.tasks?console.log("Project has ".concat(e.project.tasks.length," tasks")):console.log("No tasks found in the response or tasks array is empty")},onError:e=>{console.error("GraphQL query error:",e.message)}});(0,i.useEffect)(()=>{if(null!==de&&void 0!==de&&de.project){console.log("Project data received:",de.project),console.log("Tasks array:",de.project.tasks);const e=[];Array.isArray(de.project.tasks)?de.project.tasks.forEach(o=>{console.log("Processing task:",o),o&&o.id&&o.media&&Array.isArray(o.media)&&o.media.length>0&&(console.log("Task ".concat(o.id," has ").concat(o.media.length," media items")),o.media.forEach((r,t)=>{r&&r.url&&e.push({id:"media-".concat(o.id,"-").concat(t),type:"media",taskId:o.id,taskDescription:o.description||"Unknown task",url:r.url,fileType:r.fileType||"image/jpeg",description:r.description||"",createdAt:o.updatedAt||o.createdAt||de.project.createdAt||(new Date).toISOString()})}))}):console.warn("Project tasks is not an array:",de.project.tasks),e.sort((e,o)=>{const r=e=>{try{const o=new Date(e);return isNaN(o.getTime())?Date.now():o.getTime()}catch(o){return Date.now()}},t=r(e.createdAt);return r(o.createdAt)-t}),console.log("Final timeline items:",e),ie(e),te(e.length>Z)}else console.log("No project data received or project is undefined")},[de,Z]);const pe=(0,i.useRef)(null),xe=(0,i.useCallback)(e=>{ae||(pe.current&&pe.current.disconnect(),pe.current=new IntersectionObserver(e=>{e[0].isIntersecting&&re&&ee(e=>e+10)}),e&&pe.current.observe(e))},[ae,re]),me=(e,o)=>{Y({url:e,type:o}),q()};return ae?(0,O.jsxs)(x.a,{bg:t,minHeight:"100vh",display:"flex",flexDirection:"column",children:[(0,O.jsx)(P.m,{}),(0,O.jsx)(K.y,{moduleConfig:z.default}),(0,O.jsx)(u.m,{maxW:"container.xl",py:10,flex:"1",children:(0,O.jsxs)(T.T,{spacing:8,align:"center",children:[(0,O.jsx)(C.y,{size:"xl",color:(0,L.oU)("primary"),thickness:"4px"}),(0,O.jsx)(A.E,{color:_,fontFamily:L.Kk.fonts.body,children:"Loading project timeline..."})]})}),(0,O.jsx)(D.n,{})]}):ce?(0,O.jsxs)(x.a,{bg:t,minHeight:"100vh",display:"flex",flexDirection:"column",children:[(0,O.jsx)(P.m,{}),(0,O.jsx)(K.y,{moduleConfig:z.default}),(0,O.jsx)(u.m,{maxW:"container.xl",py:10,flex:"1",children:(0,O.jsxs)(T.T,{spacing:6,align:"start",children:[(0,O.jsx)(S.D,{size:"lg",color:(0,L.oU)("status.error"),fontFamily:L.Kk.fonts.heading,children:"Error Loading Timeline"}),(0,O.jsx)(A.E,{color:I,fontFamily:L.Kk.fonts.body,children:ce.message}),(0,O.jsxs)(m.$,{as:l.N_,to:"/project/".concat(e),bg:(0,L.QQ)("button","primaryBg"),color:"white",_hover:{bg:(0,L.QQ)("button","primaryHover")},fontFamily:L.Kk.fonts.body,children:[(0,O.jsx)(g.I,{as:F.irw,mr:2}),"Back to Project"]})]})}),(0,O.jsx)(D.n,{})]}):de&&de.project?(0,O.jsxs)(x.a,{bg:t,minHeight:"100vh",display:"flex",flexDirection:"column",children:[(0,O.jsx)(P.m,{}),(0,O.jsx)(K.y,{moduleConfig:z.default}),(0,O.jsx)(u.m,{maxW:"container.xl",py:10,flex:"1",children:(0,O.jsxs)(T.T,{spacing:8,align:"stretch",children:[(0,O.jsxs)(E.z,{justify:"space-between",wrap:"wrap",gap:4,children:[(0,O.jsxs)(T.T,{align:"start",spacing:1,children:[(0,O.jsxs)(S.D,{size:"xl",color:L.Kk.colors.text.inverse,fontFamily:L.Kk.fonts.heading,children:[de.project.projectName," - Evidence Timeline"]}),(0,O.jsxs)(A.E,{color:L.Kk.colors.text.inverse,fontFamily:L.Kk.fonts.body,children:["Project started on ",G(de.project.createdAt)]})]}),(0,O.jsxs)(m.$,{as:l.N_,to:"/project/".concat(e),bg:(0,L.QQ)("button","secondaryBg"),color:L.Kk.colors.text.inverse,borderColor:$,_hover:{bg:(0,L.QQ)("button","secondaryHover"),borderColor:(0,L.oU)("primary")},variant:"outline",fontFamily:L.Kk.fonts.body,children:[(0,O.jsx)(g.I,{as:F.irw,mr:2,color:L.Kk.colors.text.inverse}),"Back to Project"]})]}),(0,O.jsx)(j.c,{borderColor:$}),(0,O.jsx)(x.a,{p:4,bg:(0,L.oU)("status.info"),borderRadius:"md",mb:6,children:(0,O.jsx)(A.E,{color:(0,L.oU)("text.inverse"),fontFamily:L.Kk.fonts.body,children:"This timeline shows all evidence files uploaded for this project. Media uploads are displayed in chronological order. Scroll down to load more items."})}),(0,O.jsxs)(T.T,{spacing:8,align:"stretch",position:"relative",children:[(0,O.jsx)(x.a,{position:"absolute",left:"24px",top:0,bottom:0,width:"2px",bg:(0,L.oU)("primary"),zIndex:1}),se.slice(0,Z).map((e,o)=>(0,O.jsxs)(x.a,{ref:o===Z-1?xe:null,position:"relative",pl:{base:10,md:16},ml:2,children:[(0,O.jsx)(x.a,{position:"absolute",left:0,top:0,width:"12px",height:"12px",borderRadius:"full",bg:(0,L.oU)("secondary"),border:"2px solid",borderColor:(0,L.oU)("primary"),zIndex:2,mt:2}),(0,O.jsxs)(T.T,{align:"start",spacing:3,children:[(0,O.jsxs)(E.z,{children:[(0,O.jsx)(g.I,{as:F.wIk,color:(0,L.oU)("text.muted")}),(0,O.jsx)(A.E,{fontSize:"sm",color:(0,L.oU)("text.muted"),fontFamily:L.Kk.fonts.body,children:G(e.createdAt)})]}),(0,O.jsx)(x.a,{bg:M,borderRadius:"md",borderWidth:"1px",borderColor:$,p:4,shadow:"md",width:"full",children:"task"===e.type?(0,O.jsxs)(T.T,{align:"start",spacing:2,children:[(0,O.jsx)(p.E,{colorScheme:"green",px:2,py:1,children:"Task Created"}),(0,O.jsx)(A.E,{fontSize:"lg",fontWeight:"bold",color:(0,L.oU)("text.primary"),fontFamily:L.Kk.fonts.body,children:e.taskDescription}),(0,O.jsx)(p.E,{colorScheme:"COMPLETED"===e.taskStatus?"green":"IN_PROGRESS"===e.taskStatus?"yellow":"gray",children:"COMPLETED"===e.taskStatus?"Completed":"IN_PROGRESS"===e.taskStatus?"In Progress":"Pending"})]}):(0,O.jsxs)(T.T,{align:"start",spacing:3,children:[(0,O.jsxs)(E.z,{children:[(0,O.jsx)(p.E,{colorScheme:"purple",px:2,py:1,children:"Evidence File"}),(0,O.jsxs)(A.E,{fontSize:"sm",color:(0,L.oU)("text.muted"),fontFamily:L.Kk.fonts.body,children:["for task: ",e.taskDescription]})]}),e.description&&(0,O.jsx)(A.E,{color:(0,L.oU)("text.primary"),fontFamily:L.Kk.fonts.body,children:e.description}),(0,O.jsx)(x.a,{width:"full",position:"relative",children:e.url&&(0,O.jsx)(O.Fragment,{children:"application/pdf"===e.fileType||e.url.toLowerCase().includes("pdf")?(0,O.jsxs)(x.a,{maxH:"300px",overflow:"hidden",position:"relative",cursor:"pointer",borderRadius:"md",border:"1px solid",borderColor:$,onClick:()=>window.open((0,R.jV)(e.url),"_blank"),children:[(0,O.jsx)(H.A,{file:(0,R.jV)(e.url),onLoadSuccess:o=>{let{numPages:r}=o;console.log("Timeline PDF loaded successfully:",{url:e.url,numPages:r})},onLoadError:o=>{console.error("Timeline PDF load error:",o,"URL:",e.url)},children:(0,O.jsx)(N.A,{pageNumber:1,width:300})}),(0,O.jsx)(m.$,{position:"absolute",bottom:2,right:2,size:"sm",colorScheme:"blue",onClick:o=>{o.stopPropagation(),window.open((0,R.jV)(e.url),"_blank")},children:"Open PDF"})]}):"video/mp4"===e.fileType||e.url.toLowerCase().includes(".mp4")?(0,O.jsxs)(x.a,{position:"relative",borderRadius:"md",overflow:"hidden",maxH:"300px",border:"1px solid",borderColor:$,children:[(0,O.jsx)("video",{src:(0,R.jV)(e.url),controls:!0,style:{width:"100%",maxHeight:"300px",objectFit:"cover"},onClick:e=>e.stopPropagation()}),(0,O.jsx)(p.E,{position:"absolute",top:2,left:2,colorScheme:"blue",fontSize:"xs",children:"Video"}),(0,O.jsx)(h.K,{"aria-label":"View full screen",icon:(0,O.jsx)(F.KFS,{}),size:"sm",position:"absolute",bottom:2,right:2,onClick:o=>{o.stopPropagation(),me((0,R.jV)(e.url),e.fileType)},bg:"blackAlpha.600",color:"white",_hover:{bg:"blackAlpha.800"}})]}):(0,O.jsxs)(x.a,{position:"relative",borderRadius:"md",overflow:"hidden",maxH:"300px",cursor:"pointer",border:"1px solid",borderColor:$,onClick:()=>me((0,R.jV)(e.url),e.fileType||"image"),children:[(0,O.jsx)(f._,{src:(0,R.jV)(e.url),alt:e.description||"Project evidence",width:"100%",maxH:"300px",objectFit:"cover",onError:o=>{console.error("Timeline image load error:",o,"URL:",(0,R.jV)(e.url))}}),(0,O.jsx)(p.E,{position:"absolute",top:2,left:2,colorScheme:"purple",fontSize:"xs",children:e.description?"Proof of Work":"Evidence"}),(0,O.jsx)(h.K,{"aria-label":"View full size",icon:(0,O.jsx)(F.KFS,{}),size:"sm",position:"absolute",bottom:2,right:2,onClick:o=>{o.stopPropagation(),me((0,R.jV)(e.url),e.fileType||"image")},bg:"blackAlpha.600",color:"white",_hover:{bg:"blackAlpha.800"}})]})})})]})})]})]},e.id)),re&&(0,O.jsx)(x.a,{ref:oe,textAlign:"center",py:8,children:(0,O.jsx)(C.y,{size:"md"})}),!re&&se.length>0&&(0,O.jsx)(x.a,{textAlign:"center",py:8,children:(0,O.jsx)(A.E,{color:(0,L.oU)("text.muted"),fontFamily:L.Kk.fonts.body,children:"End of timeline"})}),0===se.length&&(0,O.jsxs)(x.a,{textAlign:"center",py:12,children:[(0,O.jsx)(S.D,{size:"md",color:(0,L.oU)("text.primary"),fontFamily:L.Kk.fonts.heading,children:"No evidence files available"}),(0,O.jsx)(A.E,{mt:2,color:(0,L.oU)("text.muted"),fontFamily:L.Kk.fonts.body,children:"This project doesn't have any uploaded evidence files yet."})]})]})]})}),(0,O.jsx)(D.n,{}),(0,O.jsxs)(v.aF,{isOpen:B,onClose:J,size:"6xl",isCentered:!0,children:[(0,O.jsx)(k.m,{}),(0,O.jsxs)(w.$,{bg:"transparent",boxShadow:"none",maxW:"90vw",children:[(0,O.jsx)(y.s,{color:"white",bg:"blackAlpha.600",_hover:{bg:"blackAlpha.800"}}),(0,O.jsx)(b.c,{p:0,children:X&&("video/mp4"===X.type||X.url.toLowerCase().includes(".mp4")?(0,O.jsx)(x.a,{maxH:"90vh",display:"flex",justifyContent:"center",alignItems:"center",children:(0,O.jsx)("video",{src:(0,R.jV)(X.url),controls:!0,autoPlay:!0,style:{maxHeight:"90vh",maxWidth:"100%",margin:"0 auto"}})}):(0,O.jsx)(f._,{src:(0,R.jV)(X.url),alt:"Full size view",maxH:"90vh",margin:"0 auto",objectFit:"contain"}))})]})]}),(0,O.jsx)(V.cf,{isOpen:ne,onClose:()=>{le(!1)},onLoginSuccess:()=>{le(!1)}})]}):(0,O.jsxs)(x.a,{bg:t,minHeight:"100vh",display:"flex",flexDirection:"column",children:[(0,O.jsx)(P.m,{}),(0,O.jsx)(K.y,{moduleConfig:z.default}),(0,O.jsx)(u.m,{maxW:"container.xl",py:10,flex:"1",children:(0,O.jsxs)(T.T,{spacing:6,align:"start",children:[(0,O.jsx)(S.D,{size:"lg",color:_,fontFamily:L.Kk.fonts.heading,children:"Project Not Found"}),(0,O.jsxs)(m.$,{as:l.N_,to:"/projects",bg:(0,L.QQ)("button","primaryBg"),color:"white",_hover:{bg:(0,L.QQ)("button","primaryHover")},fontFamily:L.Kk.fonts.body,children:[(0,O.jsx)(g.I,{as:F.irw,mr:2}),"Back to Projects"]})]})}),(0,O.jsx)(D.n,{})]})}}}]);
//# sourceMappingURL=4364.3cce5719.chunk.js.map