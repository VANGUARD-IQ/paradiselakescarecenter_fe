{"version":3,"file":"static/js/786.c7d1ef25.chunk.js","mappings":"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","sources":["../node_modules/@babel/runtime/helpers/esm/toSetter.js","../node_modules/@babel/runtime/helpers/esm/checkPrivateRedeclaration.js","../node_modules/@babel/runtime/helpers/esm/classPrivateMethodInitSpec.js","../node_modules/@babel/runtime/helpers/esm/classPrivateFieldInitSpec.js","../node_modules/@babel/runtime/helpers/esm/assertClassBrand.js","../node_modules/@babel/runtime/helpers/esm/classPrivateGetter.js","../node_modules/@babel/runtime/helpers/esm/classPrivateFieldGet2.js","../node_modules/@babel/runtime/helpers/esm/classPrivateFieldSet2.js","../node_modules/@babel/runtime/helpers/esm/asyncIterator.js","../pdf.js/src/shared/util.js","../pdf.js/src/display/display_utils.js","../pdf.js/src/display/editor/toolbar.js","../pdf.js/src/display/editor/tools.js","../pdf.js/src/display/editor/alt_text.js","../pdf.js/src/display/touch_manager.js","../pdf.js/src/display/editor/editor.js","../pdf.js/src/shared/murmurhash3.js","../pdf.js/src/display/annotation_storage.js","../pdf.js/src/display/font_loader.js","../pdf.js/src/display/api_utils.js","../pdf.js/src/shared/message_handler.js","../pdf.js/src/display/canvas_factory.js","../pdf.js/src/display/cmap_reader_factory.js","../pdf.js/src/display/filter_factory.js","../pdf.js/src/display/standard_fontdata_factory.js","../pdf.js/src/display/wasm_factory.js","../pdf.js/src/display/node_utils.js","../pdf.js/src/display/pattern_helper.js","../pdf.js/src/shared/image_utils.js","../pdf.js/src/display/canvas.js","../pdf.js/src/display/worker_options.js","../pdf.js/src/display/metadata.js","../pdf.js/src/display/optional_content_config.js","../pdf.js/src/display/transport_stream.js","../pdf.js/src/display/network_utils.js","../pdf.js/src/display/content_disposition.js","../pdf.js/src/display/fetch_stream.js","../pdf.js/src/display/network.js","../pdf.js/src/display/node_stream.js","../pdf.js/src/display/pdf_objects.js","../pdf.js/src/display/text_layer.js","../pdf.js/src/display/xfa_text.js","../pdf.js/src/display/api.js","../pdf.js/src/shared/scripting_utils.js","../pdf.js/src/display/svg_factory.js","../pdf.js/src/display/xfa_layer.js","../pdf.js/src/display/annotation_layer.js","../pdf.js/src/display/editor/freetext.js","../pdf.js/src/display/editor/drawers/outline.js","../pdf.js/src/display/editor/drawers/freedraw.js","../pdf.js/src/display/editor/drawers/highlight.js","../pdf.js/src/display/editor/color_picker.js","../pdf.js/src/display/editor/highlight.js","../pdf.js/src/display/editor/draw.js","../pdf.js/src/display/editor/drawers/inkdraw.js","../pdf.js/src/display/editor/ink.js","../pdf.js/src/display/editor/drawers/contour.js","../pdf.js/src/display/editor/drawers/signaturedraw.js","../pdf.js/src/display/editor/signature.js","../pdf.js/src/display/editor/stamp.js","../pdf.js/src/display/editor/annotation_editor_layer.js","../pdf.js/src/display/draw_layer.js","../pdf.js/src/pdf.js","../node_modules/tiny-invariant/dist/esm/tiny-invariant.js","../node_modules/dequal/dist/index.mjs","../node_modules/react-pdf/dist/LinkService.js","../node_modules/react-pdf/dist/PasswordResponses.js","../node_modules/react-pdf/dist/Document.js","../node_modules/make-cancellable-promise/dist/index.js","../node_modules/merge-refs/dist/index.js","../node_modules/react-pdf/dist/shared/hooks/useDocumentContext.js","../node_modules/react-pdf/dist/PageContext.js","../node_modules/react-pdf/dist/shared/hooks/usePageContext.js","../node_modules/react-pdf/dist/Page/AnnotationLayer.js","../node_modules/react-pdf/dist/shared/constants.js","../node_modules/react-pdf/dist/shared/structTreeUtils.js","../node_modules/react-pdf/dist/StructTreeItem.js","../node_modules/react-pdf/dist/StructTree.js","../node_modules/react-pdf/dist/Page/Canvas.js","../node_modules/react-pdf/dist/Page/TextLayer.js","../node_modules/react-pdf/dist/Page.js","../node_modules/react-pdf/dist/shared/hooks/useResolver.js","../node_modules/make-event-props/dist/index.js","../node_modules/react-pdf/dist/DocumentContext.js","../node_modules/clsx/dist/clsx.mjs","../node_modules/react-pdf/dist/shared/utils.js","../node_modules/react-pdf/dist/Message.js","../node_modules/warning/warning.js"],"sourcesContent":["function _toSetter(t, e, n) {\n  e || (e = []);\n  var r = e.length++;\n  return Object.defineProperty({}, \"_\", {\n    set: function set(o) {\n      e[r] = o, t.apply(n, e);\n    }\n  });\n}\nexport { _toSetter as default };","function _checkPrivateRedeclaration(e, t) {\n  if (t.has(e)) throw new TypeError(\"Cannot initialize the same private elements twice on an object\");\n}\nexport { _checkPrivateRedeclaration as default };","import checkPrivateRedeclaration from \"./checkPrivateRedeclaration.js\";\nfunction _classPrivateMethodInitSpec(e, a) {\n  checkPrivateRedeclaration(e, a), a.add(e);\n}\nexport { _classPrivateMethodInitSpec as default };","import checkPrivateRedeclaration from \"./checkPrivateRedeclaration.js\";\nfunction _classPrivateFieldInitSpec(e, t, a) {\n  checkPrivateRedeclaration(e, t), t.set(e, a);\n}\nexport { _classPrivateFieldInitSpec as default };","function _assertClassBrand(e, t, n) {\n  if (\"function\" == typeof e ? e === t : e.has(t)) return arguments.length < 3 ? t : n;\n  throw new TypeError(\"Private element is not present on this object\");\n}\nexport { _assertClassBrand as default };","import assertClassBrand from \"./assertClassBrand.js\";\nfunction _classPrivateGetter(s, r, a) {\n  return a(assertClassBrand(s, r));\n}\nexport { _classPrivateGetter as default };","import assertClassBrand from \"./assertClassBrand.js\";\nfunction _classPrivateFieldGet2(s, a) {\n  return s.get(assertClassBrand(s, a));\n}\nexport { _classPrivateFieldGet2 as default };","import assertClassBrand from \"./assertClassBrand.js\";\nfunction _classPrivateFieldSet2(s, a, r) {\n  return s.set(assertClassBrand(s, a), r), r;\n}\nexport { _classPrivateFieldSet2 as default };","function _asyncIterator(r) {\n  var n,\n    t,\n    o,\n    e = 2;\n  for (\"undefined\" != typeof Symbol && (t = Symbol.asyncIterator, o = Symbol.iterator); e--;) {\n    if (t && null != (n = r[t])) return n.call(r);\n    if (o && null != (n = r[o])) return new AsyncFromSyncIterator(n.call(r));\n    t = \"@@asyncIterator\", o = \"@@iterator\";\n  }\n  throw new TypeError(\"Object is not async iterable\");\n}\nfunction AsyncFromSyncIterator(r) {\n  function AsyncFromSyncIteratorContinuation(r) {\n    if (Object(r) !== r) return Promise.reject(new TypeError(r + \" is not an object.\"));\n    var n = r.done;\n    return Promise.resolve(r.value).then(function (r) {\n      return {\n        value: r,\n        done: n\n      };\n    });\n  }\n  return AsyncFromSyncIterator = function AsyncFromSyncIterator(r) {\n    this.s = r, this.n = r.next;\n  }, AsyncFromSyncIterator.prototype = {\n    s: null,\n    n: null,\n    next: function next() {\n      return AsyncFromSyncIteratorContinuation(this.n.apply(this.s, arguments));\n    },\n    \"return\": function _return(r) {\n      var n = this.s[\"return\"];\n      return void 0 === n ? Promise.resolve({\n        value: r,\n        done: !0\n      }) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments));\n    },\n    \"throw\": function _throw(r) {\n      var n = this.s[\"return\"];\n      return void 0 === n ? Promise.reject(r) : AsyncFromSyncIteratorContinuation(n.apply(this.s, arguments));\n    }\n  }, new AsyncFromSyncIterator(r);\n}\nexport { _asyncIterator as default };","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* globals process */\n\n// NW.js / Electron is a browser context, but copies some Node.js objects; see\n// http://docs.nwjs.io/en/latest/For%20Users/Advanced/JavaScript%20Contexts%20in%20NW.js/#access-nodejs-and-nwjs-api-in-browser-context\n// https://www.electronjs.org/docs/api/process#processversionselectron-readonly\n// https://www.electronjs.org/docs/api/process#processtype-readonly\nconst isNodeJS =\n  (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n  typeof process === \"object\" &&\n  process + \"\" === \"[object process]\" &&\n  !process.versions.nw &&\n  !(process.versions.electron && process.type && process.type !== \"browser\");\n\nconst FONT_IDENTITY_MATRIX = [0.001, 0, 0, 0.001, 0, 0];\n\n// Represent the percentage of the height of a single-line field over\n// the font size. Acrobat seems to use this value.\nconst LINE_FACTOR = 1.35;\nconst LINE_DESCENT_FACTOR = 0.35;\nconst BASELINE_FACTOR = LINE_DESCENT_FACTOR / LINE_FACTOR;\n\n/**\n * Refer to the `WorkerTransport.getRenderingIntent`-method in the API, to see\n * how these flags are being used:\n *  - ANY, DISPLAY, and PRINT are the normal rendering intents, note the\n *    `PDFPageProxy.{render, getOperatorList, getAnnotations}`-methods.\n *  - SAVE is used, on the worker-thread, when saving modified annotations.\n *  - ANNOTATIONS_FORMS, ANNOTATIONS_STORAGE, ANNOTATIONS_DISABLE control which\n *    annotations are rendered onto the canvas (i.e. by being included in the\n *    operatorList), note the `PDFPageProxy.{render, getOperatorList}`-methods\n *    and their `annotationMode`-option.\n *  - IS_EDITING is used when editing is active in the viewer.\n *  - OPLIST is used with the `PDFPageProxy.getOperatorList`-method, note the\n *    `OperatorList`-constructor (on the worker-thread).\n */\nconst RenderingIntentFlag = {\n  ANY: 0x01,\n  DISPLAY: 0x02,\n  PRINT: 0x04,\n  SAVE: 0x08,\n  ANNOTATIONS_FORMS: 0x10,\n  ANNOTATIONS_STORAGE: 0x20,\n  ANNOTATIONS_DISABLE: 0x40,\n  IS_EDITING: 0x80,\n  OPLIST: 0x100,\n};\n\nconst AnnotationMode = {\n  DISABLE: 0,\n  ENABLE: 1,\n  ENABLE_FORMS: 2,\n  ENABLE_STORAGE: 3,\n};\n\nconst AnnotationEditorPrefix = \"pdfjs_internal_editor_\";\n\nconst AnnotationEditorType = {\n  DISABLE: -1,\n  NONE: 0,\n  FREETEXT: 3,\n  HIGHLIGHT: 9,\n  STAMP: 13,\n  INK: 15,\n  SIGNATURE: 101,\n};\n\nconst AnnotationEditorParamsType = {\n  RESIZE: 1,\n  CREATE: 2,\n  FREETEXT_SIZE: 11,\n  FREETEXT_COLOR: 12,\n  FREETEXT_OPACITY: 13,\n  INK_COLOR: 21,\n  INK_THICKNESS: 22,\n  INK_OPACITY: 23,\n  HIGHLIGHT_COLOR: 31,\n  HIGHLIGHT_DEFAULT_COLOR: 32,\n  HIGHLIGHT_THICKNESS: 33,\n  HIGHLIGHT_FREE: 34,\n  HIGHLIGHT_SHOW_ALL: 35,\n  DRAW_STEP: 41,\n};\n\n// Permission flags from Table 22, Section 7.6.3.2 of the PDF specification.\nconst PermissionFlag = {\n  PRINT: 0x04,\n  MODIFY_CONTENTS: 0x08,\n  COPY: 0x10,\n  MODIFY_ANNOTATIONS: 0x20,\n  FILL_INTERACTIVE_FORMS: 0x100,\n  COPY_FOR_ACCESSIBILITY: 0x200,\n  ASSEMBLE: 0x400,\n  PRINT_HIGH_QUALITY: 0x800,\n};\n\nconst TextRenderingMode = {\n  FILL: 0,\n  STROKE: 1,\n  FILL_STROKE: 2,\n  INVISIBLE: 3,\n  FILL_ADD_TO_PATH: 4,\n  STROKE_ADD_TO_PATH: 5,\n  FILL_STROKE_ADD_TO_PATH: 6,\n  ADD_TO_PATH: 7,\n  FILL_STROKE_MASK: 3,\n  ADD_TO_PATH_FLAG: 4,\n};\n\nconst ImageKind = {\n  GRAYSCALE_1BPP: 1,\n  RGB_24BPP: 2,\n  RGBA_32BPP: 3,\n};\n\nconst AnnotationType = {\n  TEXT: 1,\n  LINK: 2,\n  FREETEXT: 3,\n  LINE: 4,\n  SQUARE: 5,\n  CIRCLE: 6,\n  POLYGON: 7,\n  POLYLINE: 8,\n  HIGHLIGHT: 9,\n  UNDERLINE: 10,\n  SQUIGGLY: 11,\n  STRIKEOUT: 12,\n  STAMP: 13,\n  CARET: 14,\n  INK: 15,\n  POPUP: 16,\n  FILEATTACHMENT: 17,\n  SOUND: 18,\n  MOVIE: 19,\n  WIDGET: 20,\n  SCREEN: 21,\n  PRINTERMARK: 22,\n  TRAPNET: 23,\n  WATERMARK: 24,\n  THREED: 25,\n  REDACT: 26,\n};\n\nconst AnnotationReplyType = {\n  GROUP: \"Group\",\n  REPLY: \"R\",\n};\n\nconst AnnotationFlag = {\n  INVISIBLE: 0x01,\n  HIDDEN: 0x02,\n  PRINT: 0x04,\n  NOZOOM: 0x08,\n  NOROTATE: 0x10,\n  NOVIEW: 0x20,\n  READONLY: 0x40,\n  LOCKED: 0x80,\n  TOGGLENOVIEW: 0x100,\n  LOCKEDCONTENTS: 0x200,\n};\n\nconst AnnotationFieldFlag = {\n  READONLY: 0x0000001,\n  REQUIRED: 0x0000002,\n  NOEXPORT: 0x0000004,\n  MULTILINE: 0x0001000,\n  PASSWORD: 0x0002000,\n  NOTOGGLETOOFF: 0x0004000,\n  RADIO: 0x0008000,\n  PUSHBUTTON: 0x0010000,\n  COMBO: 0x0020000,\n  EDIT: 0x0040000,\n  SORT: 0x0080000,\n  FILESELECT: 0x0100000,\n  MULTISELECT: 0x0200000,\n  DONOTSPELLCHECK: 0x0400000,\n  DONOTSCROLL: 0x0800000,\n  COMB: 0x1000000,\n  RICHTEXT: 0x2000000,\n  RADIOSINUNISON: 0x2000000,\n  COMMITONSELCHANGE: 0x4000000,\n};\n\nconst AnnotationBorderStyleType = {\n  SOLID: 1,\n  DASHED: 2,\n  BEVELED: 3,\n  INSET: 4,\n  UNDERLINE: 5,\n};\n\nconst AnnotationActionEventType = {\n  E: \"Mouse Enter\",\n  X: \"Mouse Exit\",\n  D: \"Mouse Down\",\n  U: \"Mouse Up\",\n  Fo: \"Focus\",\n  Bl: \"Blur\",\n  PO: \"PageOpen\",\n  PC: \"PageClose\",\n  PV: \"PageVisible\",\n  PI: \"PageInvisible\",\n  K: \"Keystroke\",\n  F: \"Format\",\n  V: \"Validate\",\n  C: \"Calculate\",\n};\n\nconst DocumentActionEventType = {\n  WC: \"WillClose\",\n  WS: \"WillSave\",\n  DS: \"DidSave\",\n  WP: \"WillPrint\",\n  DP: \"DidPrint\",\n};\n\nconst PageActionEventType = {\n  O: \"PageOpen\",\n  C: \"PageClose\",\n};\n\nconst VerbosityLevel = {\n  ERRORS: 0,\n  WARNINGS: 1,\n  INFOS: 5,\n};\n\n// All the possible operations for an operator list.\nconst OPS = {\n  // Intentionally start from 1 so it is easy to spot bad operators that will be\n  // 0's.\n  // PLEASE NOTE: We purposely keep any removed operators commented out, since\n  //              re-numbering the list would risk breaking third-party users.\n  dependency: 1,\n  setLineWidth: 2,\n  setLineCap: 3,\n  setLineJoin: 4,\n  setMiterLimit: 5,\n  setDash: 6,\n  setRenderingIntent: 7,\n  setFlatness: 8,\n  setGState: 9,\n  save: 10,\n  restore: 11,\n  transform: 12,\n  moveTo: 13,\n  lineTo: 14,\n  curveTo: 15,\n  curveTo2: 16,\n  curveTo3: 17,\n  closePath: 18,\n  rectangle: 19,\n  stroke: 20,\n  closeStroke: 21,\n  fill: 22,\n  eoFill: 23,\n  fillStroke: 24,\n  eoFillStroke: 25,\n  closeFillStroke: 26,\n  closeEOFillStroke: 27,\n  endPath: 28,\n  clip: 29,\n  eoClip: 30,\n  beginText: 31,\n  endText: 32,\n  setCharSpacing: 33,\n  setWordSpacing: 34,\n  setHScale: 35,\n  setLeading: 36,\n  setFont: 37,\n  setTextRenderingMode: 38,\n  setTextRise: 39,\n  moveText: 40,\n  setLeadingMoveText: 41,\n  setTextMatrix: 42,\n  nextLine: 43,\n  showText: 44,\n  showSpacedText: 45,\n  nextLineShowText: 46,\n  nextLineSetSpacingShowText: 47,\n  setCharWidth: 48,\n  setCharWidthAndBounds: 49,\n  setStrokeColorSpace: 50,\n  setFillColorSpace: 51,\n  setStrokeColor: 52,\n  setStrokeColorN: 53,\n  setFillColor: 54,\n  setFillColorN: 55,\n  setStrokeGray: 56,\n  setFillGray: 57,\n  setStrokeRGBColor: 58,\n  setFillRGBColor: 59,\n  setStrokeCMYKColor: 60,\n  setFillCMYKColor: 61,\n  shadingFill: 62,\n  beginInlineImage: 63,\n  beginImageData: 64,\n  endInlineImage: 65,\n  paintXObject: 66,\n  markPoint: 67,\n  markPointProps: 68,\n  beginMarkedContent: 69,\n  beginMarkedContentProps: 70,\n  endMarkedContent: 71,\n  beginCompat: 72,\n  endCompat: 73,\n  paintFormXObjectBegin: 74,\n  paintFormXObjectEnd: 75,\n  beginGroup: 76,\n  endGroup: 77,\n  // beginAnnotations: 78,\n  // endAnnotations: 79,\n  beginAnnotation: 80,\n  endAnnotation: 81,\n  // paintJpegXObject: 82,\n  paintImageMaskXObject: 83,\n  paintImageMaskXObjectGroup: 84,\n  paintImageXObject: 85,\n  paintInlineImageXObject: 86,\n  paintInlineImageXObjectGroup: 87,\n  paintImageXObjectRepeat: 88,\n  paintImageMaskXObjectRepeat: 89,\n  paintSolidColorImageMask: 90,\n  constructPath: 91,\n  setStrokeTransparent: 92,\n  setFillTransparent: 93,\n  rawFillPath: 94,\n};\n\n// In order to have a switch statement that is fast (i.e. which use a jump\n// table), we need to have the OPS in a contiguous range.\nconst DrawOPS = {\n  moveTo: 0,\n  lineTo: 1,\n  curveTo: 2,\n  closePath: 3,\n};\n\nconst PasswordResponses = {\n  NEED_PASSWORD: 1,\n  INCORRECT_PASSWORD: 2,\n};\n\nlet verbosity = VerbosityLevel.WARNINGS;\n\nfunction setVerbosityLevel(level) {\n  if (Number.isInteger(level)) {\n    verbosity = level;\n  }\n}\n\nfunction getVerbosityLevel() {\n  return verbosity;\n}\n\n// A notice for devs. These are good for things that are helpful to devs, such\n// as warning that Workers were disabled, which is important to devs but not\n// end users.\nfunction info(msg) {\n  if (verbosity >= VerbosityLevel.INFOS) {\n    // eslint-disable-next-line no-console\n    console.log(`Info: ${msg}`);\n  }\n}\n\n// Non-fatal warnings.\nfunction warn(msg) {\n  if (verbosity >= VerbosityLevel.WARNINGS) {\n    // eslint-disable-next-line no-console\n    console.log(`Warning: ${msg}`);\n  }\n}\n\nfunction unreachable(msg) {\n  throw new Error(msg);\n}\n\nfunction assert(cond, msg) {\n  if (!cond) {\n    unreachable(msg);\n  }\n}\n\n// Checks if URLs use one of the allowed protocols, e.g. to avoid XSS.\nfunction _isValidProtocol(url) {\n  switch (url?.protocol) {\n    case \"http:\":\n    case \"https:\":\n    case \"ftp:\":\n    case \"mailto:\":\n    case \"tel:\":\n      return true;\n    default:\n      return false;\n  }\n}\n\n/**\n * Attempts to create a valid absolute URL.\n *\n * @param {URL|string} url - An absolute, or relative, URL.\n * @param {URL|string} [baseUrl] - An absolute URL.\n * @param {Object} [options]\n * @returns Either a valid {URL}, or `null` otherwise.\n */\nfunction createValidAbsoluteUrl(url, baseUrl = null, options = null) {\n  if (!url) {\n    return null;\n  }\n  if (options && typeof url === \"string\") {\n    // Let URLs beginning with \"www.\" default to using the \"http://\" protocol.\n    if (options.addDefaultProtocol && url.startsWith(\"www.\")) {\n      const dots = url.match(/\\./g);\n      // Avoid accidentally matching a *relative* URL pointing to a file named\n      // e.g. \"www.pdf\" or similar.\n      if (dots?.length >= 2) {\n        url = `http://${url}`;\n      }\n    }\n\n    // According to ISO 32000-1:2008, section 12.6.4.7, URIs should be encoded\n    // in 7-bit ASCII. Some bad PDFs use UTF-8 encoding; see bug 1122280.\n    if (options.tryConvertEncoding) {\n      try {\n        url = stringToUTF8String(url);\n      } catch {}\n    }\n  }\n\n  const absoluteUrl = baseUrl ? URL.parse(url, baseUrl) : URL.parse(url);\n  return _isValidProtocol(absoluteUrl) ? absoluteUrl : null;\n}\n\n/**\n * Remove, or replace, the hash property of the URL.\n *\n * @param {URL|string} url - The absolute, or relative, URL.\n * @param {string} hash - The hash property (use an empty string to remove it).\n * @param {boolean} [allowRel] - Allow relative URLs.\n * @returns {string} The resulting URL string.\n */\nfunction updateUrlHash(url, hash, allowRel = false) {\n  const res = URL.parse(url);\n  if (res) {\n    res.hash = hash;\n    return res.href;\n  }\n  // Support well-formed relative URLs, necessary for `web/app.js` in GENERIC\n  // builds, by optionally falling back to string parsing.\n  if (allowRel && createValidAbsoluteUrl(url, \"http://example.com\")) {\n    return url.split(\"#\", 1)[0] + `${hash ? `#${hash}` : \"\"}`;\n  }\n  return \"\";\n}\n\nfunction shadow(obj, prop, value, nonSerializable = false) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n    assert(\n      prop in obj,\n      `shadow: Property \"${prop && prop.toString()}\" not found in object.`\n    );\n  }\n  Object.defineProperty(obj, prop, {\n    value,\n    enumerable: !nonSerializable,\n    configurable: true,\n    writable: false,\n  });\n  return value;\n}\n\n/**\n * @type {any}\n */\nconst BaseException = (function BaseExceptionClosure() {\n  // eslint-disable-next-line no-shadow\n  function BaseException(message, name) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseException\n    ) {\n      unreachable(\"Cannot initialize BaseException.\");\n    }\n    this.message = message;\n    this.name = name;\n  }\n  BaseException.prototype = new Error();\n  BaseException.constructor = BaseException;\n\n  return BaseException;\n})();\n\nclass PasswordException extends BaseException {\n  constructor(msg, code) {\n    super(msg, \"PasswordException\");\n    this.code = code;\n  }\n}\n\nclass UnknownErrorException extends BaseException {\n  constructor(msg, details) {\n    super(msg, \"UnknownErrorException\");\n    this.details = details;\n  }\n}\n\nclass InvalidPDFException extends BaseException {\n  constructor(msg) {\n    super(msg, \"InvalidPDFException\");\n  }\n}\n\nclass ResponseException extends BaseException {\n  constructor(msg, status, missing) {\n    super(msg, \"ResponseException\");\n    this.status = status;\n    this.missing = missing;\n  }\n}\n\n/**\n * Error caused during parsing PDF data.\n */\nclass FormatError extends BaseException {\n  constructor(msg) {\n    super(msg, \"FormatError\");\n  }\n}\n\n/**\n * Error used to indicate task cancellation.\n */\nclass AbortException extends BaseException {\n  constructor(msg) {\n    super(msg, \"AbortException\");\n  }\n}\n\nfunction bytesToString(bytes) {\n  if (typeof bytes !== \"object\" || bytes?.length === undefined) {\n    unreachable(\"Invalid argument for bytesToString\");\n  }\n  const length = bytes.length;\n  const MAX_ARGUMENT_COUNT = 8192;\n  if (length < MAX_ARGUMENT_COUNT) {\n    return String.fromCharCode.apply(null, bytes);\n  }\n  const strBuf = [];\n  for (let i = 0; i < length; i += MAX_ARGUMENT_COUNT) {\n    const chunkEnd = Math.min(i + MAX_ARGUMENT_COUNT, length);\n    const chunk = bytes.subarray(i, chunkEnd);\n    strBuf.push(String.fromCharCode.apply(null, chunk));\n  }\n  return strBuf.join(\"\");\n}\n\nfunction stringToBytes(str) {\n  if (typeof str !== \"string\") {\n    unreachable(\"Invalid argument for stringToBytes\");\n  }\n  const length = str.length;\n  const bytes = new Uint8Array(length);\n  for (let i = 0; i < length; ++i) {\n    bytes[i] = str.charCodeAt(i) & 0xff;\n  }\n  return bytes;\n}\n\nfunction string32(value) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n    assert(\n      typeof value === \"number\" && Math.abs(value) < 2 ** 32,\n      `string32: Unexpected input \"${value}\".`\n    );\n  }\n  return String.fromCharCode(\n    (value >> 24) & 0xff,\n    (value >> 16) & 0xff,\n    (value >> 8) & 0xff,\n    value & 0xff\n  );\n}\n\nfunction objectSize(obj) {\n  return Object.keys(obj).length;\n}\n\n// Checks the endianness of the platform.\nfunction isLittleEndian() {\n  const buffer8 = new Uint8Array(4);\n  buffer8[0] = 1;\n  const view32 = new Uint32Array(buffer8.buffer, 0, 1);\n  return view32[0] === 1;\n}\n\n// Checks if it's possible to eval JS expressions.\nfunction isEvalSupported() {\n  try {\n    new Function(\"\"); // eslint-disable-line no-new, no-new-func\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nclass FeatureTest {\n  static get isLittleEndian() {\n    return shadow(this, \"isLittleEndian\", isLittleEndian());\n  }\n\n  static get isEvalSupported() {\n    return shadow(this, \"isEvalSupported\", isEvalSupported());\n  }\n\n  static get isOffscreenCanvasSupported() {\n    return shadow(\n      this,\n      \"isOffscreenCanvasSupported\",\n      typeof OffscreenCanvas !== \"undefined\"\n    );\n  }\n\n  static get isImageDecoderSupported() {\n    return shadow(\n      this,\n      \"isImageDecoderSupported\",\n      typeof ImageDecoder !== \"undefined\"\n    );\n  }\n\n  static get platform() {\n    const { platform, userAgent } = navigator;\n\n    return shadow(this, \"platform\", {\n      isAndroid: userAgent.includes(\"Android\"),\n      isLinux: platform.includes(\"Linux\"),\n      isMac: platform.includes(\"Mac\"),\n      isWindows: platform.includes(\"Win\"),\n      isFirefox:\n        (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n        userAgent.includes(\"Firefox\"),\n    });\n  }\n\n  static get isCSSRoundSupported() {\n    return shadow(\n      this,\n      \"isCSSRoundSupported\",\n      globalThis.CSS?.supports?.(\"width: round(1.5px, 1px)\")\n    );\n  }\n}\n\nconst hexNumbers = Array.from(Array(256).keys(), n =>\n  n.toString(16).padStart(2, \"0\")\n);\n\nclass Util {\n  static makeHexColor(r, g, b) {\n    return `#${hexNumbers[r]}${hexNumbers[g]}${hexNumbers[b]}`;\n  }\n\n  // Apply a scaling matrix to some min/max values.\n  // If a scaling factor is negative then min and max must be\n  // swapped.\n  static scaleMinMax(transform, minMax) {\n    let temp;\n    if (transform[0]) {\n      if (transform[0] < 0) {\n        temp = minMax[0];\n        minMax[0] = minMax[2];\n        minMax[2] = temp;\n      }\n      minMax[0] *= transform[0];\n      minMax[2] *= transform[0];\n\n      if (transform[3] < 0) {\n        temp = minMax[1];\n        minMax[1] = minMax[3];\n        minMax[3] = temp;\n      }\n      minMax[1] *= transform[3];\n      minMax[3] *= transform[3];\n    } else {\n      temp = minMax[0];\n      minMax[0] = minMax[1];\n      minMax[1] = temp;\n      temp = minMax[2];\n      minMax[2] = minMax[3];\n      minMax[3] = temp;\n\n      if (transform[1] < 0) {\n        temp = minMax[1];\n        minMax[1] = minMax[3];\n        minMax[3] = temp;\n      }\n      minMax[1] *= transform[1];\n      minMax[3] *= transform[1];\n\n      if (transform[2] < 0) {\n        temp = minMax[0];\n        minMax[0] = minMax[2];\n        minMax[2] = temp;\n      }\n      minMax[0] *= transform[2];\n      minMax[2] *= transform[2];\n    }\n    minMax[0] += transform[4];\n    minMax[1] += transform[5];\n    minMax[2] += transform[4];\n    minMax[3] += transform[5];\n  }\n\n  // Concatenates two transformation matrices together and returns the result.\n  static transform(m1, m2) {\n    return [\n      m1[0] * m2[0] + m1[2] * m2[1],\n      m1[1] * m2[0] + m1[3] * m2[1],\n      m1[0] * m2[2] + m1[2] * m2[3],\n      m1[1] * m2[2] + m1[3] * m2[3],\n      m1[0] * m2[4] + m1[2] * m2[5] + m1[4],\n      m1[1] * m2[4] + m1[3] * m2[5] + m1[5],\n    ];\n  }\n\n  // For 2d affine transforms\n  static applyTransform(p, m, pos = 0) {\n    const p0 = p[pos];\n    const p1 = p[pos + 1];\n    p[pos] = p0 * m[0] + p1 * m[2] + m[4];\n    p[pos + 1] = p0 * m[1] + p1 * m[3] + m[5];\n  }\n\n  static applyTransformToBezier(p, transform, pos = 0) {\n    const m0 = transform[0];\n    const m1 = transform[1];\n    const m2 = transform[2];\n    const m3 = transform[3];\n    const m4 = transform[4];\n    const m5 = transform[5];\n    for (let i = 0; i < 6; i += 2) {\n      const pI = p[pos + i];\n      const pI1 = p[pos + i + 1];\n      p[pos + i] = pI * m0 + pI1 * m2 + m4;\n      p[pos + i + 1] = pI * m1 + pI1 * m3 + m5;\n    }\n  }\n\n  static applyInverseTransform(p, m) {\n    const p0 = p[0];\n    const p1 = p[1];\n    const d = m[0] * m[3] - m[1] * m[2];\n    p[0] = (p0 * m[3] - p1 * m[2] + m[2] * m[5] - m[4] * m[3]) / d;\n    p[1] = (-p0 * m[1] + p1 * m[0] + m[4] * m[1] - m[5] * m[0]) / d;\n  }\n\n  // Applies the transform to the rectangle and finds the minimum axially\n  // aligned bounding box.\n  static axialAlignedBoundingBox(rect, transform, output) {\n    const m0 = transform[0];\n    const m1 = transform[1];\n    const m2 = transform[2];\n    const m3 = transform[3];\n    const m4 = transform[4];\n    const m5 = transform[5];\n    const r0 = rect[0];\n    const r1 = rect[1];\n    const r2 = rect[2];\n    const r3 = rect[3];\n\n    let a0 = m0 * r0 + m4;\n    let a2 = a0;\n    let a1 = m0 * r2 + m4;\n    let a3 = a1;\n    let b0 = m3 * r1 + m5;\n    let b2 = b0;\n    let b1 = m3 * r3 + m5;\n    let b3 = b1;\n\n    if (m1 !== 0 || m2 !== 0) {\n      // Non-scaling matrix: shouldn't be frequent.\n      const m1r0 = m1 * r0;\n      const m1r2 = m1 * r2;\n      const m2r1 = m2 * r1;\n      const m2r3 = m2 * r3;\n      a0 += m2r1;\n      a3 += m2r1;\n      a1 += m2r3;\n      a2 += m2r3;\n      b0 += m1r0;\n      b3 += m1r0;\n      b1 += m1r2;\n      b2 += m1r2;\n    }\n\n    output[0] = Math.min(output[0], a0, a1, a2, a3);\n    output[1] = Math.min(output[1], b0, b1, b2, b3);\n    output[2] = Math.max(output[2], a0, a1, a2, a3);\n    output[3] = Math.max(output[3], b0, b1, b2, b3);\n  }\n\n  static inverseTransform(m) {\n    const d = m[0] * m[3] - m[1] * m[2];\n    return [\n      m[3] / d,\n      -m[1] / d,\n      -m[2] / d,\n      m[0] / d,\n      (m[2] * m[5] - m[4] * m[3]) / d,\n      (m[4] * m[1] - m[5] * m[0]) / d,\n    ];\n  }\n\n  // This calculation uses Singular Value Decomposition.\n  // The SVD can be represented with formula A = USV. We are interested in the\n  // matrix S here because it represents the scale values.\n  static singularValueDecompose2dScale(matrix, output) {\n    const m0 = matrix[0];\n    const m1 = matrix[1];\n    const m2 = matrix[2];\n    const m3 = matrix[3];\n    // Multiply matrix m with its transpose.\n    const a = m0 ** 2 + m1 ** 2;\n    const b = m0 * m2 + m1 * m3;\n    const c = m2 ** 2 + m3 ** 2;\n\n    // Solve the second degree polynomial to get roots.\n    const first = (a + c) / 2;\n    const second = Math.sqrt(first ** 2 - (a * c - b ** 2));\n    output[0] = Math.sqrt(first + second || 1);\n    output[1] = Math.sqrt(first - second || 1);\n  }\n\n  // Normalize rectangle rect=[x1, y1, x2, y2] so that (x1,y1) < (x2,y2)\n  // For coordinate systems whose origin lies in the bottom-left, this\n  // means normalization to (BL,TR) ordering. For systems with origin in the\n  // top-left, this means (TL,BR) ordering.\n  static normalizeRect(rect) {\n    const r = rect.slice(0); // clone rect\n    if (rect[0] > rect[2]) {\n      r[0] = rect[2];\n      r[2] = rect[0];\n    }\n    if (rect[1] > rect[3]) {\n      r[1] = rect[3];\n      r[3] = rect[1];\n    }\n    return r;\n  }\n\n  // Returns a rectangle [x1, y1, x2, y2] corresponding to the\n  // intersection of rect1 and rect2. If no intersection, returns 'null'\n  // The rectangle coordinates of rect1, rect2 should be [x1, y1, x2, y2]\n  static intersect(rect1, rect2) {\n    const xLow = Math.max(\n      Math.min(rect1[0], rect1[2]),\n      Math.min(rect2[0], rect2[2])\n    );\n    const xHigh = Math.min(\n      Math.max(rect1[0], rect1[2]),\n      Math.max(rect2[0], rect2[2])\n    );\n    if (xLow > xHigh) {\n      return null;\n    }\n    const yLow = Math.max(\n      Math.min(rect1[1], rect1[3]),\n      Math.min(rect2[1], rect2[3])\n    );\n    const yHigh = Math.min(\n      Math.max(rect1[1], rect1[3]),\n      Math.max(rect2[1], rect2[3])\n    );\n    if (yLow > yHigh) {\n      return null;\n    }\n\n    return [xLow, yLow, xHigh, yHigh];\n  }\n\n  static pointBoundingBox(x, y, minMax) {\n    minMax[0] = Math.min(minMax[0], x);\n    minMax[1] = Math.min(minMax[1], y);\n    minMax[2] = Math.max(minMax[2], x);\n    minMax[3] = Math.max(minMax[3], y);\n  }\n\n  static rectBoundingBox(x0, y0, x1, y1, minMax) {\n    minMax[0] = Math.min(minMax[0], x0, x1);\n    minMax[1] = Math.min(minMax[1], y0, y1);\n    minMax[2] = Math.max(minMax[2], x0, x1);\n    minMax[3] = Math.max(minMax[3], y0, y1);\n  }\n\n  static #getExtremumOnCurve(x0, x1, x2, x3, y0, y1, y2, y3, t, minMax) {\n    if (t <= 0 || t >= 1) {\n      return;\n    }\n    const mt = 1 - t;\n    const tt = t * t;\n    const ttt = tt * t;\n    const x = mt * (mt * (mt * x0 + 3 * t * x1) + 3 * tt * x2) + ttt * x3;\n    const y = mt * (mt * (mt * y0 + 3 * t * y1) + 3 * tt * y2) + ttt * y3;\n    minMax[0] = Math.min(minMax[0], x);\n    minMax[1] = Math.min(minMax[1], y);\n    minMax[2] = Math.max(minMax[2], x);\n    minMax[3] = Math.max(minMax[3], y);\n  }\n\n  static #getExtremum(x0, x1, x2, x3, y0, y1, y2, y3, a, b, c, minMax) {\n    if (Math.abs(a) < 1e-12) {\n      if (Math.abs(b) >= 1e-12) {\n        this.#getExtremumOnCurve(\n          x0,\n          x1,\n          x2,\n          x3,\n          y0,\n          y1,\n          y2,\n          y3,\n          -c / b,\n          minMax\n        );\n      }\n      return;\n    }\n\n    const delta = b ** 2 - 4 * c * a;\n    if (delta < 0) {\n      return;\n    }\n    const sqrtDelta = Math.sqrt(delta);\n    const a2 = 2 * a;\n    this.#getExtremumOnCurve(\n      x0,\n      x1,\n      x2,\n      x3,\n      y0,\n      y1,\n      y2,\n      y3,\n      (-b + sqrtDelta) / a2,\n      minMax\n    );\n    this.#getExtremumOnCurve(\n      x0,\n      x1,\n      x2,\n      x3,\n      y0,\n      y1,\n      y2,\n      y3,\n      (-b - sqrtDelta) / a2,\n      minMax\n    );\n  }\n\n  // From https://github.com/adobe-webplatform/Snap.svg/blob/b365287722a72526000ac4bfcf0ce4cac2faa015/src/path.js#L852\n  static bezierBoundingBox(x0, y0, x1, y1, x2, y2, x3, y3, minMax) {\n    minMax[0] = Math.min(minMax[0], x0, x3);\n    minMax[1] = Math.min(minMax[1], y0, y3);\n    minMax[2] = Math.max(minMax[2], x0, x3);\n    minMax[3] = Math.max(minMax[3], y0, y3);\n\n    this.#getExtremum(\n      x0,\n      x1,\n      x2,\n      x3,\n      y0,\n      y1,\n      y2,\n      y3,\n      3 * (-x0 + 3 * (x1 - x2) + x3),\n      6 * (x0 - 2 * x1 + x2),\n      3 * (x1 - x0),\n      minMax\n    );\n    this.#getExtremum(\n      x0,\n      x1,\n      x2,\n      x3,\n      y0,\n      y1,\n      y2,\n      y3,\n      3 * (-y0 + 3 * (y1 - y2) + y3),\n      6 * (y0 - 2 * y1 + y2),\n      3 * (y1 - y0),\n      minMax\n    );\n  }\n}\n\nconst PDFStringTranslateTable = [\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0x2d8,\n  0x2c7, 0x2c6, 0x2d9, 0x2dd, 0x2db, 0x2da, 0x2dc, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,\n  0, 0, 0, 0, 0, 0, 0, 0, 0x2022, 0x2020, 0x2021, 0x2026, 0x2014, 0x2013, 0x192,\n  0x2044, 0x2039, 0x203a, 0x2212, 0x2030, 0x201e, 0x201c, 0x201d, 0x2018,\n  0x2019, 0x201a, 0x2122, 0xfb01, 0xfb02, 0x141, 0x152, 0x160, 0x178, 0x17d,\n  0x131, 0x142, 0x153, 0x161, 0x17e, 0, 0x20ac,\n];\n\nfunction stringToPDFString(str, keepEscapeSequence = false) {\n  // See section 7.9.2.2 Text String Type.\n  // The string can contain some language codes bracketed with 0x1b,\n  // so we must remove them.\n  if (str[0] >= \"\\xEF\") {\n    let encoding;\n    if (str[0] === \"\\xFE\" && str[1] === \"\\xFF\") {\n      encoding = \"utf-16be\";\n      if (str.length % 2 === 1) {\n        str = str.slice(0, -1);\n      }\n    } else if (str[0] === \"\\xFF\" && str[1] === \"\\xFE\") {\n      encoding = \"utf-16le\";\n      if (str.length % 2 === 1) {\n        str = str.slice(0, -1);\n      }\n    } else if (str[0] === \"\\xEF\" && str[1] === \"\\xBB\" && str[2] === \"\\xBF\") {\n      encoding = \"utf-8\";\n    }\n\n    if (encoding) {\n      try {\n        const decoder = new TextDecoder(encoding, { fatal: true });\n        const buffer = stringToBytes(str);\n        const decoded = decoder.decode(buffer);\n        if (keepEscapeSequence || !decoded.includes(\"\\x1b\")) {\n          return decoded;\n        }\n        return decoded.replaceAll(/\\x1b[^\\x1b]*(?:\\x1b|$)/g, \"\");\n      } catch (ex) {\n        warn(`stringToPDFString: \"${ex}\".`);\n      }\n    }\n  }\n  // ISO Latin 1\n  const strBuf = [];\n  for (let i = 0, ii = str.length; i < ii; i++) {\n    const charCode = str.charCodeAt(i);\n    if (!keepEscapeSequence && charCode === 0x1b) {\n      // eslint-disable-next-line no-empty\n      while (++i < ii && str.charCodeAt(i) !== 0x1b) {}\n      continue;\n    }\n    const code = PDFStringTranslateTable[charCode];\n    strBuf.push(code ? String.fromCharCode(code) : str.charAt(i));\n  }\n  return strBuf.join(\"\");\n}\n\nfunction stringToUTF8String(str) {\n  return decodeURIComponent(escape(str));\n}\n\nfunction utf8StringToString(str) {\n  return unescape(encodeURIComponent(str));\n}\n\nfunction isArrayEqual(arr1, arr2) {\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n  for (let i = 0, ii = arr1.length; i < ii; i++) {\n    if (arr1[i] !== arr2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nfunction getModificationDate(date = new Date()) {\n  const buffer = [\n    date.getUTCFullYear().toString(),\n    (date.getUTCMonth() + 1).toString().padStart(2, \"0\"),\n    date.getUTCDate().toString().padStart(2, \"0\"),\n    date.getUTCHours().toString().padStart(2, \"0\"),\n    date.getUTCMinutes().toString().padStart(2, \"0\"),\n    date.getUTCSeconds().toString().padStart(2, \"0\"),\n  ];\n\n  return buffer.join(\"\");\n}\n\nlet NormalizeRegex = null;\nlet NormalizationMap = null;\nfunction normalizeUnicode(str) {\n  if (!NormalizeRegex) {\n    // In order to generate the following regex:\n    //  - create a PDF containing all the chars in the range 0000-FFFF with\n    //    a NFKC which is different of the char.\n    //  - copy and paste all those chars and get the ones where NFKC is\n    //    required.\n    // It appears that most the chars here contain some ligatures.\n    NormalizeRegex =\n      /([\\u00a0\\u00b5\\u037e\\u0eb3\\u2000-\\u200a\\u202f\\u2126\\ufb00-\\ufb04\\ufb06\\ufb20-\\ufb36\\ufb38-\\ufb3c\\ufb3e\\ufb40-\\ufb41\\ufb43-\\ufb44\\ufb46-\\ufba1\\ufba4-\\ufba9\\ufbae-\\ufbb1\\ufbd3-\\ufbdc\\ufbde-\\ufbe7\\ufbea-\\ufbf8\\ufbfc-\\ufbfd\\ufc00-\\ufc5d\\ufc64-\\ufcf1\\ufcf5-\\ufd3d\\ufd88\\ufdf4\\ufdfa-\\ufdfb\\ufe71\\ufe77\\ufe79\\ufe7b\\ufe7d]+)|(\\ufb05+)/gu;\n    NormalizationMap = new Map([[\"\", \"t\"]]);\n  }\n  return str.replaceAll(NormalizeRegex, (_, p1, p2) =>\n    p1 ? p1.normalize(\"NFKC\") : NormalizationMap.get(p2)\n  );\n}\n\nfunction getUuid() {\n  if (\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n    typeof crypto.randomUUID === \"function\"\n  ) {\n    return crypto.randomUUID();\n  }\n  const buf = new Uint8Array(32);\n  crypto.getRandomValues(buf);\n  return bytesToString(buf);\n}\n\nconst AnnotationPrefix = \"pdfjs_internal_id_\";\n\nfunction _isValidExplicitDest(validRef, validName, dest) {\n  if (!Array.isArray(dest) || dest.length < 2) {\n    return false;\n  }\n  const [page, zoom, ...args] = dest;\n  if (!validRef(page) && !Number.isInteger(page)) {\n    return false;\n  }\n  if (!validName(zoom)) {\n    return false;\n  }\n  const argsLen = args.length;\n  let allowNull = true;\n  switch (zoom.name) {\n    case \"XYZ\":\n      if (argsLen < 2 || argsLen > 3) {\n        return false;\n      }\n      break;\n    case \"Fit\":\n    case \"FitB\":\n      return argsLen === 0;\n    case \"FitH\":\n    case \"FitBH\":\n    case \"FitV\":\n    case \"FitBV\":\n      if (argsLen > 1) {\n        return false;\n      }\n      break;\n    case \"FitR\":\n      if (argsLen !== 4) {\n        return false;\n      }\n      allowNull = false;\n      break;\n    default:\n      return false;\n  }\n  for (const arg of args) {\n    if (typeof arg === \"number\" || (allowNull && arg === null)) {\n      continue;\n    }\n    return false;\n  }\n  return true;\n}\n\n// TOOD: Replace all occurrences of this function with `Math.clamp` once\n//       https://github.com/tc39/proposal-math-clamp/ is generally available.\nfunction MathClamp(v, min, max) {\n  return Math.min(Math.max(v, min), max);\n}\n\n// TODO: Remove this once `Uint8Array.prototype.toHex` is generally available.\nfunction toHexUtil(arr) {\n  if (Uint8Array.prototype.toHex) {\n    return arr.toHex();\n  }\n  return Array.from(arr, num => hexNumbers[num]).join(\"\");\n}\n\n// TODO: Remove this once `Uint8Array.prototype.toBase64` is generally\n//       available.\nfunction toBase64Util(arr) {\n  if (Uint8Array.prototype.toBase64) {\n    return arr.toBase64();\n  }\n  return btoa(bytesToString(arr));\n}\n\n// TODO: Remove this once `Uint8Array.fromBase64` is generally available.\nfunction fromBase64Util(str) {\n  if (Uint8Array.fromBase64) {\n    return Uint8Array.fromBase64(str);\n  }\n  return stringToBytes(atob(str));\n}\n\n// TODO: Remove this once https://bugzilla.mozilla.org/show_bug.cgi?id=1928493\n//       is fixed.\nif (\n  (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"SKIP_BABEL\")) &&\n  typeof Promise.try !== \"function\"\n) {\n  Promise.try = function (fn, ...args) {\n    return new Promise(resolve => {\n      resolve(fn(...args));\n    });\n  };\n}\n\n// TODO: Remove this once the `javascript.options.experimental.math_sumprecise`\n//       preference is removed from Firefox.\nif (typeof Math.sumPrecise !== \"function\") {\n  // Note that this isn't a \"proper\" polyfill, but since we're only using it to\n  // replace `Array.prototype.reduce()` invocations it should be fine.\n  Math.sumPrecise = function (numbers) {\n    return numbers.reduce((a, b) => a + b, 0);\n  };\n}\n\nif (\n  typeof PDFJSDev !== \"undefined\" &&\n  !PDFJSDev.test(\"SKIP_BABEL\") &&\n  typeof AbortSignal.any !== \"function\"\n) {\n  AbortSignal.any = function (iterable) {\n    const ac = new AbortController();\n    const { signal } = ac;\n\n    // Return immediately if any of the signals are already aborted.\n    for (const s of iterable) {\n      if (s.aborted) {\n        ac.abort(s.reason);\n        return signal;\n      }\n    }\n    // Register \"abort\" listeners for all signals.\n    for (const s of iterable) {\n      s.addEventListener(\n        \"abort\",\n        () => {\n          ac.abort(s.reason);\n        },\n        { signal } // Automatically remove the listener.\n      );\n    }\n\n    return signal;\n  };\n}\n\nexport {\n  _isValidExplicitDest,\n  AbortException,\n  AnnotationActionEventType,\n  AnnotationBorderStyleType,\n  AnnotationEditorParamsType,\n  AnnotationEditorPrefix,\n  AnnotationEditorType,\n  AnnotationFieldFlag,\n  AnnotationFlag,\n  AnnotationMode,\n  AnnotationPrefix,\n  AnnotationReplyType,\n  AnnotationType,\n  assert,\n  BaseException,\n  BASELINE_FACTOR,\n  bytesToString,\n  createValidAbsoluteUrl,\n  DocumentActionEventType,\n  DrawOPS,\n  FeatureTest,\n  FONT_IDENTITY_MATRIX,\n  FormatError,\n  fromBase64Util,\n  getModificationDate,\n  getUuid,\n  getVerbosityLevel,\n  hexNumbers,\n  ImageKind,\n  info,\n  InvalidPDFException,\n  isArrayEqual,\n  isNodeJS,\n  LINE_DESCENT_FACTOR,\n  LINE_FACTOR,\n  MathClamp,\n  normalizeUnicode,\n  objectSize,\n  OPS,\n  PageActionEventType,\n  PasswordException,\n  PasswordResponses,\n  PermissionFlag,\n  RenderingIntentFlag,\n  ResponseException,\n  setVerbosityLevel,\n  shadow,\n  string32,\n  stringToBytes,\n  stringToPDFString,\n  stringToUTF8String,\n  TextRenderingMode,\n  toBase64Util,\n  toHexUtil,\n  UnknownErrorException,\n  unreachable,\n  updateUrlHash,\n  utf8StringToString,\n  Util,\n  VerbosityLevel,\n  warn,\n};\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  BaseException,\n  FeatureTest,\n  shadow,\n  Util,\n  warn,\n} from \"../shared/util.js\";\n\nconst SVG_NS = \"http://www.w3.org/2000/svg\";\n\nclass PixelsPerInch {\n  static CSS = 96.0;\n\n  static PDF = 72.0;\n\n  static PDF_TO_CSS_UNITS = this.CSS / this.PDF;\n}\n\nasync function fetchData(url, type = \"text\") {\n  if (\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n    isValidFetchUrl(url, document.baseURI)\n  ) {\n    const response = await fetch(url);\n    if (!response.ok) {\n      throw new Error(response.statusText);\n    }\n    switch (type) {\n      case \"arraybuffer\":\n        return response.arrayBuffer();\n      case \"blob\":\n        return response.blob();\n      case \"json\":\n        return response.json();\n    }\n    return response.text();\n  }\n\n  // The Fetch API is not supported.\n  return new Promise((resolve, reject) => {\n    const request = new XMLHttpRequest();\n    request.open(\"GET\", url, /* async = */ true);\n    request.responseType = type;\n\n    request.onreadystatechange = () => {\n      if (request.readyState !== XMLHttpRequest.DONE) {\n        return;\n      }\n      if (request.status === 200 || request.status === 0) {\n        switch (type) {\n          case \"arraybuffer\":\n          case \"blob\":\n          case \"json\":\n            resolve(request.response);\n            return;\n        }\n        resolve(request.responseText);\n        return;\n      }\n      reject(new Error(request.statusText));\n    };\n\n    request.send(null);\n  });\n}\n\n/**\n * @typedef {Object} PageViewportParameters\n * @property {Array<number>} viewBox - The xMin, yMin, xMax and\n *   yMax coordinates.\n * @property {number} userUnit - The size of units.\n * @property {number} scale - The scale of the viewport.\n * @property {number} rotation - The rotation, in degrees, of the viewport.\n * @property {number} [offsetX] - The horizontal, i.e. x-axis, offset. The\n *   default value is `0`.\n * @property {number} [offsetY] - The vertical, i.e. y-axis, offset. The\n *   default value is `0`.\n * @property {boolean} [dontFlip] - If true, the y-axis will not be flipped.\n *   The default value is `false`.\n */\n\n/**\n * @typedef {Object} PageViewportCloneParameters\n * @property {number} [scale] - The scale, overriding the one in the cloned\n *   viewport. The default value is `this.scale`.\n * @property {number} [rotation] - The rotation, in degrees, overriding the one\n *   in the cloned viewport. The default value is `this.rotation`.\n * @property {number} [offsetX] - The horizontal, i.e. x-axis, offset.\n *   The default value is `this.offsetX`.\n * @property {number} [offsetY] - The vertical, i.e. y-axis, offset.\n *   The default value is `this.offsetY`.\n * @property {boolean} [dontFlip] - If true, the x-axis will not be flipped.\n *   The default value is `false`.\n */\n\n/**\n * PDF page viewport created based on scale, rotation and offset.\n */\nclass PageViewport {\n  /**\n   * @param {PageViewportParameters}\n   */\n  constructor({\n    viewBox,\n    userUnit,\n    scale,\n    rotation,\n    offsetX = 0,\n    offsetY = 0,\n    dontFlip = false,\n  }) {\n    this.viewBox = viewBox;\n    this.userUnit = userUnit;\n    this.scale = scale;\n    this.rotation = rotation;\n    this.offsetX = offsetX;\n    this.offsetY = offsetY;\n\n    scale *= userUnit; // Take the userUnit into account.\n\n    // creating transform to convert pdf coordinate system to the normal\n    // canvas like coordinates taking in account scale and rotation\n    const centerX = (viewBox[2] + viewBox[0]) / 2;\n    const centerY = (viewBox[3] + viewBox[1]) / 2;\n    let rotateA, rotateB, rotateC, rotateD;\n    // Normalize the rotation, by clamping it to the [0, 360) range.\n    rotation %= 360;\n    if (rotation < 0) {\n      rotation += 360;\n    }\n    switch (rotation) {\n      case 180:\n        rotateA = -1;\n        rotateB = 0;\n        rotateC = 0;\n        rotateD = 1;\n        break;\n      case 90:\n        rotateA = 0;\n        rotateB = 1;\n        rotateC = 1;\n        rotateD = 0;\n        break;\n      case 270:\n        rotateA = 0;\n        rotateB = -1;\n        rotateC = -1;\n        rotateD = 0;\n        break;\n      case 0:\n        rotateA = 1;\n        rotateB = 0;\n        rotateC = 0;\n        rotateD = -1;\n        break;\n      default:\n        throw new Error(\n          \"PageViewport: Invalid rotation, must be a multiple of 90 degrees.\"\n        );\n    }\n\n    if (dontFlip) {\n      rotateC = -rotateC;\n      rotateD = -rotateD;\n    }\n\n    let offsetCanvasX, offsetCanvasY;\n    let width, height;\n    if (rotateA === 0) {\n      offsetCanvasX = Math.abs(centerY - viewBox[1]) * scale + offsetX;\n      offsetCanvasY = Math.abs(centerX - viewBox[0]) * scale + offsetY;\n      width = (viewBox[3] - viewBox[1]) * scale;\n      height = (viewBox[2] - viewBox[0]) * scale;\n    } else {\n      offsetCanvasX = Math.abs(centerX - viewBox[0]) * scale + offsetX;\n      offsetCanvasY = Math.abs(centerY - viewBox[1]) * scale + offsetY;\n      width = (viewBox[2] - viewBox[0]) * scale;\n      height = (viewBox[3] - viewBox[1]) * scale;\n    }\n    // creating transform for the following operations:\n    // translate(-centerX, -centerY), rotate and flip vertically,\n    // scale, and translate(offsetCanvasX, offsetCanvasY)\n    this.transform = [\n      rotateA * scale,\n      rotateB * scale,\n      rotateC * scale,\n      rotateD * scale,\n      offsetCanvasX - rotateA * scale * centerX - rotateC * scale * centerY,\n      offsetCanvasY - rotateB * scale * centerX - rotateD * scale * centerY,\n    ];\n\n    this.width = width;\n    this.height = height;\n  }\n\n  /**\n   * The original, un-scaled, viewport dimensions.\n   * @type {Object}\n   */\n  get rawDims() {\n    const dims = this.viewBox;\n\n    return shadow(this, \"rawDims\", {\n      pageWidth: dims[2] - dims[0],\n      pageHeight: dims[3] - dims[1],\n      pageX: dims[0],\n      pageY: dims[1],\n    });\n  }\n\n  /**\n   * Clones viewport, with optional additional properties.\n   * @param {PageViewportCloneParameters} [params]\n   * @returns {PageViewport} Cloned viewport.\n   */\n  clone({\n    scale = this.scale,\n    rotation = this.rotation,\n    offsetX = this.offsetX,\n    offsetY = this.offsetY,\n    dontFlip = false,\n  } = {}) {\n    return new PageViewport({\n      viewBox: this.viewBox.slice(),\n      userUnit: this.userUnit,\n      scale,\n      rotation,\n      offsetX,\n      offsetY,\n      dontFlip,\n    });\n  }\n\n  /**\n   * Converts PDF point to the viewport coordinates. For examples, useful for\n   * converting PDF location into canvas pixel coordinates.\n   * @param {number} x - The x-coordinate.\n   * @param {number} y - The y-coordinate.\n   * @returns {Array} Array containing `x`- and `y`-coordinates of the\n   *   point in the viewport coordinate space.\n   * @see {@link convertToPdfPoint}\n   * @see {@link convertToViewportRectangle}\n   */\n  convertToViewportPoint(x, y) {\n    const p = [x, y];\n    Util.applyTransform(p, this.transform);\n    return p;\n  }\n\n  /**\n   * Converts PDF rectangle to the viewport coordinates.\n   * @param {Array} rect - The xMin, yMin, xMax and yMax coordinates.\n   * @returns {Array} Array containing corresponding coordinates of the\n   *   rectangle in the viewport coordinate space.\n   * @see {@link convertToViewportPoint}\n   */\n  convertToViewportRectangle(rect) {\n    const topLeft = [rect[0], rect[1]];\n    Util.applyTransform(topLeft, this.transform);\n    const bottomRight = [rect[2], rect[3]];\n    Util.applyTransform(bottomRight, this.transform);\n    return [topLeft[0], topLeft[1], bottomRight[0], bottomRight[1]];\n  }\n\n  /**\n   * Converts viewport coordinates to the PDF location. For examples, useful\n   * for converting canvas pixel location into PDF one.\n   * @param {number} x - The x-coordinate.\n   * @param {number} y - The y-coordinate.\n   * @returns {Array} Array containing `x`- and `y`-coordinates of the\n   *   point in the PDF coordinate space.\n   * @see {@link convertToViewportPoint}\n   */\n  convertToPdfPoint(x, y) {\n    const p = [x, y];\n    Util.applyInverseTransform(p, this.transform);\n    return p;\n  }\n}\n\nclass RenderingCancelledException extends BaseException {\n  constructor(msg, extraDelay = 0) {\n    super(msg, \"RenderingCancelledException\");\n    this.extraDelay = extraDelay;\n  }\n}\n\nfunction isDataScheme(url) {\n  const ii = url.length;\n  let i = 0;\n  while (i < ii && url[i].trim() === \"\") {\n    i++;\n  }\n  return url.substring(i, i + 5).toLowerCase() === \"data:\";\n}\n\nfunction isPdfFile(filename) {\n  return typeof filename === \"string\" && /\\.pdf$/i.test(filename);\n}\n\n/**\n * Gets the filename from a given URL.\n * @param {string} url\n * @returns {string}\n */\nfunction getFilenameFromUrl(url) {\n  [url] = url.split(/[#?]/, 1);\n  return url.substring(url.lastIndexOf(\"/\") + 1);\n}\n\n/**\n * Returns the filename or guessed filename from the url (see issue 3455).\n * @param {string} url - The original PDF location.\n * @param {string} defaultFilename - The value returned if the filename is\n *   unknown, or the protocol is unsupported.\n * @returns {string} Guessed PDF filename.\n */\nfunction getPdfFilenameFromUrl(url, defaultFilename = \"document.pdf\") {\n  if (typeof url !== \"string\") {\n    return defaultFilename;\n  }\n  if (isDataScheme(url)) {\n    warn('getPdfFilenameFromUrl: ignore \"data:\"-URL for performance reasons.');\n    return defaultFilename;\n  }\n\n  const getURL = urlString => {\n    try {\n      return new URL(urlString);\n    } catch {\n      try {\n        return new URL(decodeURIComponent(urlString));\n      } catch {\n        try {\n          // Attempt to parse the URL using the document's base URI.\n          return new URL(urlString, \"https://foo.bar\");\n        } catch {\n          try {\n            return new URL(decodeURIComponent(urlString), \"https://foo.bar\");\n          } catch {\n            return null;\n          }\n        }\n      }\n    }\n  };\n\n  const newURL = getURL(url);\n  if (!newURL) {\n    // If the URL is invalid, return the default filename.\n    return defaultFilename;\n  }\n\n  const decode = name => {\n    try {\n      let decoded = decodeURIComponent(name);\n      if (decoded.includes(\"/\")) {\n        decoded = decoded.split(\"/\").at(-1);\n        if (decoded.test(/^\\.pdf$/i)) {\n          return decoded;\n        }\n        return name;\n      }\n      return decoded;\n    } catch {\n      return name;\n    }\n  };\n\n  const pdfRegex = /\\.pdf$/i;\n  const filename = newURL.pathname.split(\"/\").at(-1);\n  if (pdfRegex.test(filename)) {\n    return decode(filename);\n  }\n\n  if (newURL.searchParams.size > 0) {\n    const values = Array.from(newURL.searchParams.values()).reverse();\n    for (const value of values) {\n      if (pdfRegex.test(value)) {\n        // If any of the search parameters ends with \".pdf\", return it.\n        return decode(value);\n      }\n    }\n    const keys = Array.from(newURL.searchParams.keys()).reverse();\n    for (const key of keys) {\n      if (pdfRegex.test(key)) {\n        // If any of the search parameter keys ends with \".pdf\", return it.\n        return decode(key);\n      }\n    }\n  }\n\n  if (newURL.hash) {\n    const reFilename = /[^/?#=]+\\.pdf\\b(?!.*\\.pdf\\b)/i;\n    const hashFilename = reFilename.exec(newURL.hash);\n    if (hashFilename) {\n      return decode(hashFilename[0]);\n    }\n  }\n\n  return defaultFilename;\n}\n\nclass StatTimer {\n  started = Object.create(null);\n\n  times = [];\n\n  time(name) {\n    if (name in this.started) {\n      warn(`Timer is already running for ${name}`);\n    }\n    this.started[name] = Date.now();\n  }\n\n  timeEnd(name) {\n    if (!(name in this.started)) {\n      warn(`Timer has not been started for ${name}`);\n    }\n    this.times.push({\n      name,\n      start: this.started[name],\n      end: Date.now(),\n    });\n    // Remove timer from started so it can be called again.\n    delete this.started[name];\n  }\n\n  toString() {\n    // Find the longest name for padding purposes.\n    const outBuf = [];\n    let longest = 0;\n    for (const { name } of this.times) {\n      longest = Math.max(name.length, longest);\n    }\n    for (const { name, start, end } of this.times) {\n      outBuf.push(`${name.padEnd(longest)} ${end - start}ms\\n`);\n    }\n    return outBuf.join(\"\");\n  }\n}\n\nfunction isValidFetchUrl(url, baseUrl) {\n  if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n    throw new Error(\"Not implemented: isValidFetchUrl\");\n  }\n  const res = baseUrl ? URL.parse(url, baseUrl) : URL.parse(url);\n  // The Fetch API only supports the http/https protocols, and not file/ftp.\n  return res?.protocol === \"http:\" || res?.protocol === \"https:\";\n}\n\n/**\n * Event handler to suppress context menu.\n */\nfunction noContextMenu(e) {\n  e.preventDefault();\n}\n\nfunction stopEvent(e) {\n  e.preventDefault();\n  e.stopPropagation();\n}\n\n// Deprecated API function -- display regardless of the `verbosity` setting.\nfunction deprecated(details) {\n  // eslint-disable-next-line no-console\n  console.log(\"Deprecated API usage: \" + details);\n}\n\nclass PDFDateString {\n  static #regex;\n\n  /**\n   * Convert a PDF date string to a JavaScript `Date` object.\n   *\n   * The PDF date string format is described in section 7.9.4 of the official\n   * PDF 32000-1:2008 specification. However, in the PDF 1.7 reference (sixth\n   * edition) Adobe describes the same format including a trailing apostrophe.\n   * This syntax in incorrect, but Adobe Acrobat creates PDF files that contain\n   * them. We ignore all apostrophes as they are not necessary for date parsing.\n   *\n   * Moreover, Adobe Acrobat doesn't handle changing the date to universal time\n   * and doesn't use the user's time zone (effectively ignoring the HH' and mm'\n   * parts of the date string).\n   *\n   * @param {string} input\n   * @returns {Date|null}\n   */\n  static toDateObject(input) {\n    if (!input || typeof input !== \"string\") {\n      return null;\n    }\n\n    // Lazily initialize the regular expression.\n    this.#regex ||= new RegExp(\n      \"^D:\" + // Prefix (required)\n        \"(\\\\d{4})\" + // Year (required)\n        \"(\\\\d{2})?\" + // Month (optional)\n        \"(\\\\d{2})?\" + // Day (optional)\n        \"(\\\\d{2})?\" + // Hour (optional)\n        \"(\\\\d{2})?\" + // Minute (optional)\n        \"(\\\\d{2})?\" + // Second (optional)\n        \"([Z|+|-])?\" + // Universal time relation (optional)\n        \"(\\\\d{2})?\" + // Offset hour (optional)\n        \"'?\" + // Splitting apostrophe (optional)\n        \"(\\\\d{2})?\" + // Offset minute (optional)\n        \"'?\" // Trailing apostrophe (optional)\n    );\n\n    // Optional fields that don't satisfy the requirements from the regular\n    // expression (such as incorrect digit counts or numbers that are out of\n    // range) will fall back the defaults from the specification.\n    const matches = this.#regex.exec(input);\n    if (!matches) {\n      return null;\n    }\n\n    // JavaScript's `Date` object expects the month to be between 0 and 11\n    // instead of 1 and 12, so we have to correct for that.\n    const year = parseInt(matches[1], 10);\n    let month = parseInt(matches[2], 10);\n    month = month >= 1 && month <= 12 ? month - 1 : 0;\n    let day = parseInt(matches[3], 10);\n    day = day >= 1 && day <= 31 ? day : 1;\n    let hour = parseInt(matches[4], 10);\n    hour = hour >= 0 && hour <= 23 ? hour : 0;\n    let minute = parseInt(matches[5], 10);\n    minute = minute >= 0 && minute <= 59 ? minute : 0;\n    let second = parseInt(matches[6], 10);\n    second = second >= 0 && second <= 59 ? second : 0;\n    const universalTimeRelation = matches[7] || \"Z\";\n    let offsetHour = parseInt(matches[8], 10);\n    offsetHour = offsetHour >= 0 && offsetHour <= 23 ? offsetHour : 0;\n    let offsetMinute = parseInt(matches[9], 10) || 0;\n    offsetMinute = offsetMinute >= 0 && offsetMinute <= 59 ? offsetMinute : 0;\n\n    // Universal time relation 'Z' means that the local time is equal to the\n    // universal time, whereas the relations '+'/'-' indicate that the local\n    // time is later respectively earlier than the universal time. Every date\n    // is normalized to universal time.\n    if (universalTimeRelation === \"-\") {\n      hour += offsetHour;\n      minute += offsetMinute;\n    } else if (universalTimeRelation === \"+\") {\n      hour -= offsetHour;\n      minute -= offsetMinute;\n    }\n\n    return new Date(Date.UTC(year, month, day, hour, minute, second));\n  }\n}\n\n/**\n * NOTE: This is (mostly) intended to support printing of XFA forms.\n */\nfunction getXfaPageViewport(xfaPage, { scale = 1, rotation = 0 }) {\n  const { width, height } = xfaPage.attributes.style;\n  const viewBox = [0, 0, parseInt(width), parseInt(height)];\n\n  return new PageViewport({\n    viewBox,\n    userUnit: 1,\n    scale,\n    rotation,\n  });\n}\n\nfunction getRGB(color) {\n  if (color.startsWith(\"#\")) {\n    const colorRGB = parseInt(color.slice(1), 16);\n    return [\n      (colorRGB & 0xff0000) >> 16,\n      (colorRGB & 0x00ff00) >> 8,\n      colorRGB & 0x0000ff,\n    ];\n  }\n\n  if (color.startsWith(\"rgb(\")) {\n    // getComputedStyle(...).color returns a `rgb(R, G, B)` color.\n    return color\n      .slice(/* \"rgb(\".length */ 4, -1) // Strip out \"rgb(\" and \")\".\n      .split(\",\")\n      .map(x => parseInt(x));\n  }\n\n  if (color.startsWith(\"rgba(\")) {\n    return color\n      .slice(/* \"rgba(\".length */ 5, -1) // Strip out \"rgba(\" and \")\".\n      .split(\",\")\n      .map(x => parseInt(x))\n      .slice(0, 3);\n  }\n\n  warn(`Not a valid color format: \"${color}\"`);\n  return [0, 0, 0];\n}\n\nfunction getColorValues(colors) {\n  const span = document.createElement(\"span\");\n  span.style.visibility = \"hidden\";\n  // NOTE: The following does *not* affect `forced-colors: active` mode.\n  span.style.colorScheme = \"only light\";\n  document.body.append(span);\n  for (const name of colors.keys()) {\n    span.style.color = name;\n    const computedColor = window.getComputedStyle(span).color;\n    colors.set(name, getRGB(computedColor));\n  }\n  span.remove();\n}\n\nfunction getCurrentTransform(ctx) {\n  const { a, b, c, d, e, f } = ctx.getTransform();\n  return [a, b, c, d, e, f];\n}\n\nfunction getCurrentTransformInverse(ctx) {\n  const { a, b, c, d, e, f } = ctx.getTransform().invertSelf();\n  return [a, b, c, d, e, f];\n}\n\n/**\n * @param {HTMLDivElement} div\n * @param {PageViewport} viewport\n * @param {boolean} mustFlip\n * @param {boolean} mustRotate\n */\nfunction setLayerDimensions(\n  div,\n  viewport,\n  mustFlip = false,\n  mustRotate = true\n) {\n  if (viewport instanceof PageViewport) {\n    const { pageWidth, pageHeight } = viewport.rawDims;\n    const { style } = div;\n    const useRound = FeatureTest.isCSSRoundSupported;\n\n    const w = `var(--total-scale-factor) * ${pageWidth}px`,\n      h = `var(--total-scale-factor) * ${pageHeight}px`;\n    const widthStr = useRound\n        ? `round(down, ${w}, var(--scale-round-x))`\n        : `calc(${w})`,\n      heightStr = useRound\n        ? `round(down, ${h}, var(--scale-round-y))`\n        : `calc(${h})`;\n\n    if (!mustFlip || viewport.rotation % 180 === 0) {\n      style.width = widthStr;\n      style.height = heightStr;\n    } else {\n      style.width = heightStr;\n      style.height = widthStr;\n    }\n  }\n\n  if (mustRotate) {\n    div.setAttribute(\"data-main-rotation\", viewport.rotation);\n  }\n}\n\n/**\n * Scale factors for the canvas, necessary with HiDPI displays.\n */\nclass OutputScale {\n  constructor() {\n    const { pixelRatio } = OutputScale;\n\n    /**\n     * @type {number} Horizontal scale.\n     */\n    this.sx = pixelRatio;\n\n    /**\n     * @type {number} Vertical scale.\n     */\n    this.sy = pixelRatio;\n  }\n\n  /**\n   * @type {boolean} Returns `true` when scaling is required, `false` otherwise.\n   */\n  get scaled() {\n    return this.sx !== 1 || this.sy !== 1;\n  }\n\n  /**\n   * @type {boolean} Returns `true` when scaling is symmetric,\n   *   `false` otherwise.\n   */\n  get symmetric() {\n    return this.sx === this.sy;\n  }\n\n  /**\n   * @returns {boolean} Returns `true` if scaling was limited,\n   *   `false` otherwise.\n   */\n  limitCanvas(width, height, maxPixels, maxDim, capAreaFactor = -1) {\n    let maxAreaScale = Infinity,\n      maxWidthScale = Infinity,\n      maxHeightScale = Infinity;\n\n    maxPixels = OutputScale.capPixels(maxPixels, capAreaFactor);\n    if (maxPixels > 0) {\n      maxAreaScale = Math.sqrt(maxPixels / (width * height));\n    }\n    if (maxDim !== -1) {\n      maxWidthScale = maxDim / width;\n      maxHeightScale = maxDim / height;\n    }\n    const maxScale = Math.min(maxAreaScale, maxWidthScale, maxHeightScale);\n\n    if (this.sx > maxScale || this.sy > maxScale) {\n      this.sx = maxScale;\n      this.sy = maxScale;\n      return true;\n    }\n    return false;\n  }\n\n  static get pixelRatio() {\n    return globalThis.devicePixelRatio || 1;\n  }\n\n  static capPixels(maxPixels, capAreaFactor) {\n    if (capAreaFactor >= 0) {\n      const winPixels = Math.ceil(\n        (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")\n          ? window.innerWidth * window.innerHeight\n          : window.screen.availWidth * window.screen.availHeight) *\n          this.pixelRatio ** 2 *\n          (1 + capAreaFactor / 100)\n      );\n      return maxPixels > 0 ? Math.min(maxPixels, winPixels) : winPixels;\n    }\n    return maxPixels;\n  }\n}\n\n// See https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Image_types\n// to know which types are supported by the browser.\nconst SupportedImageMimeTypes = [\n  \"image/apng\",\n  \"image/avif\",\n  \"image/bmp\",\n  \"image/gif\",\n  \"image/jpeg\",\n  \"image/png\",\n  \"image/svg+xml\",\n  \"image/webp\",\n  \"image/x-icon\",\n];\n\nexport {\n  deprecated,\n  fetchData,\n  getColorValues,\n  getCurrentTransform,\n  getCurrentTransformInverse,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getRGB,\n  getXfaPageViewport,\n  isDataScheme,\n  isPdfFile,\n  isValidFetchUrl,\n  noContextMenu,\n  OutputScale,\n  PageViewport,\n  PDFDateString,\n  PixelsPerInch,\n  RenderingCancelledException,\n  setLayerDimensions,\n  StatTimer,\n  stopEvent,\n  SupportedImageMimeTypes,\n  SVG_NS,\n};\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { noContextMenu, stopEvent } from \"../display_utils.js\";\n\nclass EditorToolbar {\n  #toolbar = null;\n\n  #colorPicker = null;\n\n  #editor;\n\n  #buttons = null;\n\n  #altText = null;\n\n  #signatureDescriptionButton = null;\n\n  static #l10nRemove = null;\n\n  constructor(editor) {\n    this.#editor = editor;\n\n    EditorToolbar.#l10nRemove ||= Object.freeze({\n      freetext: \"pdfjs-editor-remove-freetext-button\",\n      highlight: \"pdfjs-editor-remove-highlight-button\",\n      ink: \"pdfjs-editor-remove-ink-button\",\n      stamp: \"pdfjs-editor-remove-stamp-button\",\n      signature: \"pdfjs-editor-remove-signature-button\",\n    });\n  }\n\n  render() {\n    const editToolbar = (this.#toolbar = document.createElement(\"div\"));\n    editToolbar.classList.add(\"editToolbar\", \"hidden\");\n    editToolbar.setAttribute(\"role\", \"toolbar\");\n    const signal = this.#editor._uiManager._signal;\n    editToolbar.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    editToolbar.addEventListener(\"pointerdown\", EditorToolbar.#pointerDown, {\n      signal,\n    });\n\n    const buttons = (this.#buttons = document.createElement(\"div\"));\n    buttons.className = \"buttons\";\n    editToolbar.append(buttons);\n\n    const position = this.#editor.toolbarPosition;\n    if (position) {\n      const { style } = editToolbar;\n      const x =\n        this.#editor._uiManager.direction === \"ltr\"\n          ? 1 - position[0]\n          : position[0];\n      style.insetInlineEnd = `${100 * x}%`;\n      style.top = `calc(${\n        100 * position[1]\n      }% + var(--editor-toolbar-vert-offset))`;\n    }\n\n    return editToolbar;\n  }\n\n  get div() {\n    return this.#toolbar;\n  }\n\n  static #pointerDown(e) {\n    e.stopPropagation();\n  }\n\n  #focusIn(e) {\n    this.#editor._focusEventsAllowed = false;\n    stopEvent(e);\n  }\n\n  #focusOut(e) {\n    this.#editor._focusEventsAllowed = true;\n    stopEvent(e);\n  }\n\n  #addListenersToElement(element) {\n    // If we're clicking on a button with the keyboard or with\n    // the mouse, we don't want to trigger any focus events on\n    // the editor.\n    const signal = this.#editor._uiManager._signal;\n    element.addEventListener(\"focusin\", this.#focusIn.bind(this), {\n      capture: true,\n      signal,\n    });\n    element.addEventListener(\"focusout\", this.#focusOut.bind(this), {\n      capture: true,\n      signal,\n    });\n    element.addEventListener(\"contextmenu\", noContextMenu, { signal });\n  }\n\n  hide() {\n    this.#toolbar.classList.add(\"hidden\");\n    this.#colorPicker?.hideDropdown();\n  }\n\n  show() {\n    this.#toolbar.classList.remove(\"hidden\");\n    this.#altText?.shown();\n  }\n\n  addDeleteButton() {\n    const { editorType, _uiManager } = this.#editor;\n\n    const button = document.createElement(\"button\");\n    button.className = \"delete\";\n    button.tabIndex = 0;\n    button.setAttribute(\"data-l10n-id\", EditorToolbar.#l10nRemove[editorType]);\n    this.#addListenersToElement(button);\n    button.addEventListener(\n      \"click\",\n      e => {\n        _uiManager.delete();\n      },\n      { signal: _uiManager._signal }\n    );\n    this.#buttons.append(button);\n  }\n\n  get #divider() {\n    const divider = document.createElement(\"div\");\n    divider.className = \"divider\";\n    return divider;\n  }\n\n  async addAltText(altText) {\n    const button = await altText.render();\n    this.#addListenersToElement(button);\n    this.#buttons.append(button, this.#divider);\n    this.#altText = altText;\n  }\n\n  addColorPicker(colorPicker) {\n    this.#colorPicker = colorPicker;\n    const button = colorPicker.renderButton();\n    this.#addListenersToElement(button);\n    this.#buttons.append(button, this.#divider);\n  }\n\n  async addEditSignatureButton(signatureManager) {\n    const button = (this.#signatureDescriptionButton =\n      await signatureManager.renderEditButton(this.#editor));\n    this.#addListenersToElement(button);\n    this.#buttons.append(button, this.#divider);\n  }\n\n  async addButton(name, tool) {\n    switch (name) {\n      case \"colorPicker\":\n        this.addColorPicker(tool);\n        break;\n      case \"altText\":\n        await this.addAltText(tool);\n        break;\n      case \"editSignature\":\n        await this.addEditSignatureButton(tool);\n        break;\n      case \"delete\":\n        this.addDeleteButton();\n        break;\n    }\n  }\n\n  updateEditSignatureButton(description) {\n    if (this.#signatureDescriptionButton) {\n      this.#signatureDescriptionButton.title = description;\n    }\n  }\n\n  remove() {\n    this.#toolbar.remove();\n    this.#colorPicker?.destroy();\n    this.#colorPicker = null;\n  }\n}\n\nclass HighlightToolbar {\n  #buttons = null;\n\n  #toolbar = null;\n\n  #uiManager;\n\n  constructor(uiManager) {\n    this.#uiManager = uiManager;\n  }\n\n  #render() {\n    const editToolbar = (this.#toolbar = document.createElement(\"div\"));\n    editToolbar.className = \"editToolbar\";\n    editToolbar.setAttribute(\"role\", \"toolbar\");\n    editToolbar.addEventListener(\"contextmenu\", noContextMenu, {\n      signal: this.#uiManager._signal,\n    });\n\n    const buttons = (this.#buttons = document.createElement(\"div\"));\n    buttons.className = \"buttons\";\n    editToolbar.append(buttons);\n\n    this.#addHighlightButton();\n\n    return editToolbar;\n  }\n\n  #getLastPoint(boxes, isLTR) {\n    let lastY = 0;\n    let lastX = 0;\n    for (const box of boxes) {\n      const y = box.y + box.height;\n      if (y < lastY) {\n        continue;\n      }\n      const x = box.x + (isLTR ? box.width : 0);\n      if (y > lastY) {\n        lastX = x;\n        lastY = y;\n        continue;\n      }\n      if (isLTR) {\n        if (x > lastX) {\n          lastX = x;\n        }\n      } else if (x < lastX) {\n        lastX = x;\n      }\n    }\n    return [isLTR ? 1 - lastX : lastX, lastY];\n  }\n\n  show(parent, boxes, isLTR) {\n    const [x, y] = this.#getLastPoint(boxes, isLTR);\n    const { style } = (this.#toolbar ||= this.#render());\n    parent.append(this.#toolbar);\n    style.insetInlineEnd = `${100 * x}%`;\n    style.top = `calc(${100 * y}% + var(--editor-toolbar-vert-offset))`;\n  }\n\n  hide() {\n    this.#toolbar.remove();\n  }\n\n  #addHighlightButton() {\n    const button = document.createElement(\"button\");\n    button.className = \"highlightButton\";\n    button.tabIndex = 0;\n    button.setAttribute(\"data-l10n-id\", `pdfjs-highlight-floating-button1`);\n    const span = document.createElement(\"span\");\n    button.append(span);\n    span.className = \"visuallyHidden\";\n    span.setAttribute(\"data-l10n-id\", \"pdfjs-highlight-floating-button-label\");\n    const signal = this.#uiManager._signal;\n    button.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    button.addEventListener(\n      \"click\",\n      () => {\n        this.#uiManager.highlightSelection(\"floating_button\");\n      },\n      { signal }\n    );\n    this.#buttons.append(button);\n  }\n}\n\nexport { EditorToolbar, HighlightToolbar };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./editor.js\").AnnotationEditor} AnnotationEditor */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_editor_layer.js\").AnnotationEditorLayer} AnnotationEditorLayer */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorPrefix,\n  AnnotationEditorType,\n  FeatureTest,\n  getUuid,\n  shadow,\n  Util,\n  warn,\n} from \"../../shared/util.js\";\nimport {\n  fetchData,\n  getColorValues,\n  getRGB,\n  PixelsPerInch,\n  stopEvent,\n} from \"../display_utils.js\";\nimport { HighlightToolbar } from \"./toolbar.js\";\n\nfunction bindEvents(obj, element, names) {\n  for (const name of names) {\n    element.addEventListener(name, obj[name].bind(obj));\n  }\n}\n\n/**\n * Class to create some unique ids for the different editors.\n */\nclass IdManager {\n  #id = 0;\n\n  constructor() {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      Object.defineProperty(this, \"reset\", {\n        value: () => (this.#id = 0),\n      });\n    }\n  }\n\n  /**\n   * Get a unique id.\n   * @returns {string}\n   */\n  get id() {\n    return `${AnnotationEditorPrefix}${this.#id++}`;\n  }\n}\n\n/**\n * Class to manage the images used by the editors.\n * The main idea is to try to minimize the memory used by the images.\n * The images are cached and reused when possible\n * We use a refCounter to know when an image is not used anymore but we need to\n * be able to restore an image after a remove+undo, so we keep a file reference\n * or an url one.\n */\nclass ImageManager {\n  #baseId = getUuid();\n\n  #id = 0;\n\n  #cache = null;\n\n  static get _isSVGFittingCanvas() {\n    // By default, Firefox doesn't rescale without preserving the aspect ratio\n    // when drawing an SVG image on a canvas, see https://bugzilla.mozilla.org/1547776.\n    // The \"workaround\" is to append \"svgView(preserveAspectRatio(none))\" to the\n    // url, but according to comment #15, it seems that it leads to unexpected\n    // behavior in Safari.\n    const svg = `data:image/svg+xml;charset=UTF-8,<svg viewBox=\"0 0 1 1\" width=\"1\" height=\"1\" xmlns=\"http://www.w3.org/2000/svg\"><rect width=\"1\" height=\"1\" style=\"fill:red;\"/></svg>`;\n    const canvas = new OffscreenCanvas(1, 3);\n    const ctx = canvas.getContext(\"2d\", { willReadFrequently: true });\n    const image = new Image();\n    image.src = svg;\n    const promise = image.decode().then(() => {\n      ctx.drawImage(image, 0, 0, 1, 1, 0, 0, 1, 3);\n      return new Uint32Array(ctx.getImageData(0, 0, 1, 1).data.buffer)[0] === 0;\n    });\n\n    return shadow(this, \"_isSVGFittingCanvas\", promise);\n  }\n\n  async #get(key, rawData) {\n    this.#cache ||= new Map();\n    let data = this.#cache.get(key);\n    if (data === null) {\n      // We already tried to load the image but it failed.\n      return null;\n    }\n    if (data?.bitmap) {\n      data.refCounter += 1;\n      return data;\n    }\n    try {\n      data ||= {\n        bitmap: null,\n        id: `image_${this.#baseId}_${this.#id++}`,\n        refCounter: 0,\n        isSvg: false,\n      };\n      let image;\n      if (typeof rawData === \"string\") {\n        data.url = rawData;\n        image = await fetchData(rawData, \"blob\");\n      } else if (rawData instanceof File) {\n        image = data.file = rawData;\n      } else if (rawData instanceof Blob) {\n        image = rawData;\n      }\n\n      if (image.type === \"image/svg+xml\") {\n        // Unfortunately, createImageBitmap doesn't work with SVG images.\n        // (see https://bugzilla.mozilla.org/1841972).\n        const mustRemoveAspectRatioPromise = ImageManager._isSVGFittingCanvas;\n        const fileReader = new FileReader();\n        const imageElement = new Image();\n        const imagePromise = new Promise((resolve, reject) => {\n          imageElement.onload = () => {\n            data.bitmap = imageElement;\n            data.isSvg = true;\n            resolve();\n          };\n          fileReader.onload = async () => {\n            const url = (data.svgUrl = fileReader.result);\n            // We need to set the preserveAspectRatio to none in order to let\n            // the image fits the canvas when resizing.\n            imageElement.src = (await mustRemoveAspectRatioPromise)\n              ? `${url}#svgView(preserveAspectRatio(none))`\n              : url;\n          };\n          imageElement.onerror = fileReader.onerror = reject;\n        });\n        fileReader.readAsDataURL(image);\n        await imagePromise;\n      } else {\n        data.bitmap = await createImageBitmap(image);\n      }\n      data.refCounter = 1;\n    } catch (e) {\n      warn(e);\n      data = null;\n    }\n    this.#cache.set(key, data);\n    if (data) {\n      this.#cache.set(data.id, data);\n    }\n    return data;\n  }\n\n  async getFromFile(file) {\n    const { lastModified, name, size, type } = file;\n    return this.#get(`${lastModified}_${name}_${size}_${type}`, file);\n  }\n\n  async getFromUrl(url) {\n    return this.#get(url, url);\n  }\n\n  async getFromBlob(id, blobPromise) {\n    const blob = await blobPromise;\n    return this.#get(id, blob);\n  }\n\n  async getFromId(id) {\n    this.#cache ||= new Map();\n    const data = this.#cache.get(id);\n    if (!data) {\n      return null;\n    }\n    if (data.bitmap) {\n      data.refCounter += 1;\n      return data;\n    }\n\n    if (data.file) {\n      return this.getFromFile(data.file);\n    }\n    if (data.blobPromise) {\n      const { blobPromise } = data;\n      delete data.blobPromise;\n      return this.getFromBlob(data.id, blobPromise);\n    }\n    return this.getFromUrl(data.url);\n  }\n\n  getFromCanvas(id, canvas) {\n    this.#cache ||= new Map();\n    let data = this.#cache.get(id);\n    if (data?.bitmap) {\n      data.refCounter += 1;\n      return data;\n    }\n    const offscreen = new OffscreenCanvas(canvas.width, canvas.height);\n    const ctx = offscreen.getContext(\"2d\");\n    ctx.drawImage(canvas, 0, 0);\n    data = {\n      bitmap: offscreen.transferToImageBitmap(),\n      id: `image_${this.#baseId}_${this.#id++}`,\n      refCounter: 1,\n      isSvg: false,\n    };\n    this.#cache.set(id, data);\n    this.#cache.set(data.id, data);\n    return data;\n  }\n\n  getSvgUrl(id) {\n    const data = this.#cache.get(id);\n    if (!data?.isSvg) {\n      return null;\n    }\n    return data.svgUrl;\n  }\n\n  deleteId(id) {\n    this.#cache ||= new Map();\n    const data = this.#cache.get(id);\n    if (!data) {\n      return;\n    }\n    data.refCounter -= 1;\n    if (data.refCounter !== 0) {\n      return;\n    }\n    const { bitmap } = data;\n    if (!data.url && !data.file) {\n      // The image has no way to be restored (ctrl+z) so we must fix that.\n      const canvas = new OffscreenCanvas(bitmap.width, bitmap.height);\n      const ctx = canvas.getContext(\"bitmaprenderer\");\n      ctx.transferFromImageBitmap(bitmap);\n      data.blobPromise = canvas.convertToBlob();\n    }\n\n    bitmap.close?.();\n    data.bitmap = null;\n  }\n\n  // We can use the id only if it belongs this manager.\n  // We must take care of having the right manager because we can copy/paste\n  // some images from other documents, hence it'd be a pity to use an id from an\n  // other manager.\n  isValidId(id) {\n    return id.startsWith(`image_${this.#baseId}_`);\n  }\n}\n\n/**\n * Class to handle undo/redo.\n * Commands are just saved in a buffer.\n * If we hit some memory issues we could likely use a circular buffer.\n * It has to be used as a singleton.\n */\nclass CommandManager {\n  #commands = [];\n\n  #locked = false;\n\n  #maxSize;\n\n  #position = -1;\n\n  constructor(maxSize = 128) {\n    this.#maxSize = maxSize;\n  }\n\n  /**\n   * @typedef {Object} addOptions\n   * @property {function} cmd\n   * @property {function} undo\n   * @property {function} [post]\n   * @property {boolean} mustExec\n   * @property {number} type\n   * @property {boolean} overwriteIfSameType\n   * @property {boolean} keepUndo\n   */\n\n  /**\n   * Add a new couple of commands to be used in case of redo/undo.\n   * @param {addOptions} options\n   */\n  add({\n    cmd,\n    undo,\n    post,\n    mustExec,\n    type = NaN,\n    overwriteIfSameType = false,\n    keepUndo = false,\n  }) {\n    if (mustExec) {\n      cmd();\n    }\n\n    if (this.#locked) {\n      return;\n    }\n\n    const save = { cmd, undo, post, type };\n    if (this.#position === -1) {\n      if (this.#commands.length > 0) {\n        // All the commands have been undone and then a new one is added\n        // hence we clear the queue.\n        this.#commands.length = 0;\n      }\n      this.#position = 0;\n      this.#commands.push(save);\n      return;\n    }\n\n    if (overwriteIfSameType && this.#commands[this.#position].type === type) {\n      // For example when we change a color we don't want to\n      // be able to undo all the steps, hence we only want to\n      // keep the last undoable action in this sequence of actions.\n      if (keepUndo) {\n        save.undo = this.#commands[this.#position].undo;\n      }\n      this.#commands[this.#position] = save;\n      return;\n    }\n\n    const next = this.#position + 1;\n    if (next === this.#maxSize) {\n      this.#commands.splice(0, 1);\n    } else {\n      this.#position = next;\n      if (next < this.#commands.length) {\n        this.#commands.splice(next);\n      }\n    }\n\n    this.#commands.push(save);\n  }\n\n  /**\n   * Undo the last command.\n   */\n  undo() {\n    if (this.#position === -1) {\n      // Nothing to undo.\n      return;\n    }\n\n    // Avoid to insert something during the undo execution.\n    this.#locked = true;\n    const { undo, post } = this.#commands[this.#position];\n    undo();\n    post?.();\n    this.#locked = false;\n\n    this.#position -= 1;\n  }\n\n  /**\n   * Redo the last command.\n   */\n  redo() {\n    if (this.#position < this.#commands.length - 1) {\n      this.#position += 1;\n\n      // Avoid to insert something during the redo execution.\n      this.#locked = true;\n      const { cmd, post } = this.#commands[this.#position];\n      cmd();\n      post?.();\n      this.#locked = false;\n    }\n  }\n\n  /**\n   * Check if there is something to undo.\n   * @returns {boolean}\n   */\n  hasSomethingToUndo() {\n    return this.#position !== -1;\n  }\n\n  /**\n   * Check if there is something to redo.\n   * @returns {boolean}\n   */\n  hasSomethingToRedo() {\n    return this.#position < this.#commands.length - 1;\n  }\n\n  cleanType(type) {\n    if (this.#position === -1) {\n      return;\n    }\n    for (let i = this.#position; i >= 0; i--) {\n      if (this.#commands[i].type !== type) {\n        this.#commands.splice(i + 1, this.#position - i);\n        this.#position = i;\n        return;\n      }\n    }\n    this.#commands.length = 0;\n    this.#position = -1;\n  }\n\n  destroy() {\n    this.#commands = null;\n  }\n}\n\n/**\n * Class to handle the different keyboards shortcuts we can have on mac or\n * non-mac OSes.\n */\nclass KeyboardManager {\n  /**\n   * Create a new keyboard manager class.\n   * @param {Array<Array>} callbacks - an array containing an array of shortcuts\n   * and a callback to call.\n   * A shortcut is a string like `ctrl+c` or `mac+ctrl+c` for mac OS.\n   */\n  constructor(callbacks) {\n    this.buffer = [];\n    this.callbacks = new Map();\n    this.allKeys = new Set();\n\n    const { isMac } = FeatureTest.platform;\n    for (const [keys, callback, options = {}] of callbacks) {\n      for (const key of keys) {\n        const isMacKey = key.startsWith(\"mac+\");\n        if (isMac && isMacKey) {\n          this.callbacks.set(key.slice(4), { callback, options });\n          this.allKeys.add(key.split(\"+\").at(-1));\n        } else if (!isMac && !isMacKey) {\n          this.callbacks.set(key, { callback, options });\n          this.allKeys.add(key.split(\"+\").at(-1));\n        }\n      }\n    }\n  }\n\n  /**\n   * Serialize an event into a string in order to match a\n   * potential key for a callback.\n   * @param {KeyboardEvent} event\n   * @returns {string}\n   */\n  #serialize(event) {\n    if (event.altKey) {\n      this.buffer.push(\"alt\");\n    }\n    if (event.ctrlKey) {\n      this.buffer.push(\"ctrl\");\n    }\n    if (event.metaKey) {\n      this.buffer.push(\"meta\");\n    }\n    if (event.shiftKey) {\n      this.buffer.push(\"shift\");\n    }\n    this.buffer.push(event.key);\n    const str = this.buffer.join(\"+\");\n    this.buffer.length = 0;\n\n    return str;\n  }\n\n  /**\n   * Execute a callback, if any, for a given keyboard event.\n   * The self is used as `this` in the callback.\n   * @param {Object} self\n   * @param {KeyboardEvent} event\n   * @returns\n   */\n  exec(self, event) {\n    if (!this.allKeys.has(event.key)) {\n      return;\n    }\n    const info = this.callbacks.get(this.#serialize(event));\n    if (!info) {\n      return;\n    }\n    const {\n      callback,\n      options: { bubbles = false, args = [], checker = null },\n    } = info;\n\n    if (checker && !checker(self, event)) {\n      return;\n    }\n    callback.bind(self, ...args, event)();\n\n    // For example, ctrl+s in a FreeText must be handled by the viewer, hence\n    // the event must bubble.\n    if (!bubbles) {\n      stopEvent(event);\n    }\n  }\n}\n\nclass ColorManager {\n  static _colorsMapping = new Map([\n    [\"CanvasText\", [0, 0, 0]],\n    [\"Canvas\", [255, 255, 255]],\n  ]);\n\n  get _colors() {\n    if (\n      typeof PDFJSDev !== \"undefined\" &&\n      PDFJSDev.test(\"LIB\") &&\n      typeof document === \"undefined\"\n    ) {\n      return shadow(this, \"_colors\", ColorManager._colorsMapping);\n    }\n\n    const colors = new Map([\n      [\"CanvasText\", null],\n      [\"Canvas\", null],\n    ]);\n    getColorValues(colors);\n    return shadow(this, \"_colors\", colors);\n  }\n\n  /**\n   * In High Contrast Mode, the color on the screen is not always the\n   * real color used in the pdf.\n   * For example in some cases white can appear to be black but when saving\n   * we want to have white.\n   * @param {string} color\n   * @returns {Array<number>}\n   */\n  convert(color) {\n    const rgb = getRGB(color);\n    if (!window.matchMedia(\"(forced-colors: active)\").matches) {\n      return rgb;\n    }\n\n    for (const [name, RGB] of this._colors) {\n      if (RGB.every((x, i) => x === rgb[i])) {\n        return ColorManager._colorsMapping.get(name);\n      }\n    }\n    return rgb;\n  }\n\n  /**\n   * An input element must have its color value as a hex string\n   * and not as color name.\n   * So this function converts a name into an hex string.\n   * @param {string} name\n   * @returns {string}\n   */\n  getHexCode(name) {\n    const rgb = this._colors.get(name);\n    if (!rgb) {\n      return name;\n    }\n    return Util.makeHexColor(...rgb);\n  }\n}\n\n/**\n * A pdf has several pages and each of them when it will rendered\n * will have an AnnotationEditorLayer which will contain the some\n * new Annotations associated to an editor in order to modify them.\n *\n * This class is used to manage all the different layers, editors and\n * some action like copy/paste, undo/redo, ...\n */\nclass AnnotationEditorUIManager {\n  #abortController = new AbortController();\n\n  #activeEditor = null;\n\n  #allEditors = new Map();\n\n  #allLayers = new Map();\n\n  #altTextManager = null;\n\n  #annotationStorage = null;\n\n  #changedExistingAnnotations = null;\n\n  #commandManager = new CommandManager();\n\n  #copyPasteAC = null;\n\n  #currentDrawingSession = null;\n\n  #currentPageIndex = 0;\n\n  #deletedAnnotationsElementIds = new Set();\n\n  #draggingEditors = null;\n\n  #editorTypes = null;\n\n  #editorsToRescale = new Set();\n\n  _editorUndoBar = null;\n\n  #enableHighlightFloatingButton = false;\n\n  #enableUpdatedAddImage = false;\n\n  #enableNewAltTextWhenAddingImage = false;\n\n  #filterFactory = null;\n\n  #focusMainContainerTimeoutId = null;\n\n  #focusManagerAC = null;\n\n  #highlightColors = null;\n\n  #highlightWhenShiftUp = false;\n\n  #highlightToolbar = null;\n\n  #idManager = new IdManager();\n\n  #isEnabled = false;\n\n  #isWaiting = false;\n\n  #keyboardManagerAC = null;\n\n  #lastActiveElement = null;\n\n  #mainHighlightColorPicker = null;\n\n  #missingCanvases = null;\n\n  #mlManager = null;\n\n  #mode = AnnotationEditorType.NONE;\n\n  #selectedEditors = new Set();\n\n  #selectedTextNode = null;\n\n  #signatureManager = null;\n\n  #pageColors = null;\n\n  #showAllStates = null;\n\n  #previousStates = {\n    isEditing: false,\n    isEmpty: true,\n    hasSomethingToUndo: false,\n    hasSomethingToRedo: false,\n    hasSelectedEditor: false,\n    hasSelectedText: false,\n  };\n\n  #translation = [0, 0];\n\n  #translationTimeoutId = null;\n\n  #container = null;\n\n  #viewer = null;\n\n  #viewerAlert = null;\n\n  #updateModeCapability = null;\n\n  static TRANSLATE_SMALL = 1; // page units.\n\n  static TRANSLATE_BIG = 10; // page units.\n\n  static get _keyboardManager() {\n    const proto = AnnotationEditorUIManager.prototype;\n\n    /**\n     * If the focused element is an input, we don't want to handle the arrow.\n     * For example, sliders can be controlled with the arrow keys.\n     */\n    const arrowChecker = self =>\n      self.#container.contains(document.activeElement) &&\n      document.activeElement.tagName !== \"BUTTON\" &&\n      self.hasSomethingToControl();\n\n    const textInputChecker = (_self, { target: el }) => {\n      if (el instanceof HTMLInputElement) {\n        const { type } = el;\n        return type !== \"text\" && type !== \"number\";\n      }\n      return true;\n    };\n\n    const small = this.TRANSLATE_SMALL;\n    const big = this.TRANSLATE_BIG;\n\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [\n          [\"ctrl+a\", \"mac+meta+a\"],\n          proto.selectAll,\n          { checker: textInputChecker },\n        ],\n        [[\"ctrl+z\", \"mac+meta+z\"], proto.undo, { checker: textInputChecker }],\n        [\n          // On mac, depending of the OS version, the event.key is either \"z\" or\n          // \"Z\" when the user presses \"meta+shift+z\".\n          [\n            \"ctrl+y\",\n            \"ctrl+shift+z\",\n            \"mac+meta+shift+z\",\n            \"ctrl+shift+Z\",\n            \"mac+meta+shift+Z\",\n          ],\n          proto.redo,\n          { checker: textInputChecker },\n        ],\n        [\n          [\n            \"Backspace\",\n            \"alt+Backspace\",\n            \"ctrl+Backspace\",\n            \"shift+Backspace\",\n            \"mac+Backspace\",\n            \"mac+alt+Backspace\",\n            \"mac+ctrl+Backspace\",\n            \"Delete\",\n            \"ctrl+Delete\",\n            \"shift+Delete\",\n            \"mac+Delete\",\n          ],\n          proto.delete,\n          { checker: textInputChecker },\n        ],\n        [\n          [\"Enter\", \"mac+Enter\"],\n          proto.addNewEditorFromKeyboard,\n          {\n            // Those shortcuts can be used in the toolbar for some other actions\n            // like zooming, hence we need to check if the container has the\n            // focus.\n            checker: (self, { target: el }) =>\n              !(el instanceof HTMLButtonElement) &&\n              self.#container.contains(el) &&\n              !self.isEnterHandled,\n          },\n        ],\n        [\n          [\" \", \"mac+ \"],\n          proto.addNewEditorFromKeyboard,\n          {\n            // Those shortcuts can be used in the toolbar for some other actions\n            // like zooming, hence we need to check if the container has the\n            // focus.\n            checker: (self, { target: el }) =>\n              !(el instanceof HTMLButtonElement) &&\n              self.#container.contains(document.activeElement),\n          },\n        ],\n        [[\"Escape\", \"mac+Escape\"], proto.unselectAll],\n        [\n          [\"ArrowLeft\", \"mac+ArrowLeft\"],\n          proto.translateSelectedEditors,\n          { args: [-small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowLeft\", \"mac+shift+ArrowLeft\"],\n          proto.translateSelectedEditors,\n          { args: [-big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowRight\", \"mac+ArrowRight\"],\n          proto.translateSelectedEditors,\n          { args: [small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowRight\", \"mac+shift+ArrowRight\"],\n          proto.translateSelectedEditors,\n          { args: [big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowUp\", \"mac+ArrowUp\"],\n          proto.translateSelectedEditors,\n          { args: [0, -small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowUp\", \"mac+shift+ArrowUp\"],\n          proto.translateSelectedEditors,\n          { args: [0, -big], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowDown\", \"mac+ArrowDown\"],\n          proto.translateSelectedEditors,\n          { args: [0, small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowDown\", \"mac+shift+ArrowDown\"],\n          proto.translateSelectedEditors,\n          { args: [0, big], checker: arrowChecker },\n        ],\n      ])\n    );\n  }\n\n  constructor(\n    container,\n    viewer,\n    viewerAlert,\n    altTextManager,\n    signatureManager,\n    eventBus,\n    pdfDocument,\n    pageColors,\n    highlightColors,\n    enableHighlightFloatingButton,\n    enableUpdatedAddImage,\n    enableNewAltTextWhenAddingImage,\n    mlManager,\n    editorUndoBar,\n    supportsPinchToZoom\n  ) {\n    const signal = (this._signal = this.#abortController.signal);\n    this.#container = container;\n    this.#viewer = viewer;\n    this.#viewerAlert = viewerAlert;\n    this.#altTextManager = altTextManager;\n    this.#signatureManager = signatureManager;\n    this._eventBus = eventBus;\n    eventBus._on(\"editingaction\", this.onEditingAction.bind(this), { signal });\n    eventBus._on(\"pagechanging\", this.onPageChanging.bind(this), { signal });\n    eventBus._on(\"scalechanging\", this.onScaleChanging.bind(this), { signal });\n    eventBus._on(\"rotationchanging\", this.onRotationChanging.bind(this), {\n      signal,\n    });\n    eventBus._on(\"setpreference\", this.onSetPreference.bind(this), { signal });\n    eventBus._on(\n      \"switchannotationeditorparams\",\n      evt => this.updateParams(evt.type, evt.value),\n      { signal }\n    );\n    this.#addSelectionListener();\n    this.#addDragAndDropListeners();\n    this.#addKeyboardManager();\n    this.#annotationStorage = pdfDocument.annotationStorage;\n    this.#filterFactory = pdfDocument.filterFactory;\n    this.#pageColors = pageColors;\n    this.#highlightColors = highlightColors || null;\n    this.#enableHighlightFloatingButton = enableHighlightFloatingButton;\n    this.#enableUpdatedAddImage = enableUpdatedAddImage;\n    this.#enableNewAltTextWhenAddingImage = enableNewAltTextWhenAddingImage;\n    this.#mlManager = mlManager || null;\n    this.viewParameters = {\n      realScale: PixelsPerInch.PDF_TO_CSS_UNITS,\n      rotation: 0,\n    };\n    this.isShiftKeyDown = false;\n    this._editorUndoBar = editorUndoBar || null;\n    this._supportsPinchToZoom = supportsPinchToZoom !== false;\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      Object.defineProperty(this, \"reset\", {\n        value: () => {\n          this.selectAll();\n          this.delete();\n          this.#idManager.reset();\n        },\n      });\n    }\n  }\n\n  destroy() {\n    this.#updateModeCapability?.resolve();\n    this.#updateModeCapability = null;\n\n    this.#abortController?.abort();\n    this.#abortController = null;\n    this._signal = null;\n\n    for (const layer of this.#allLayers.values()) {\n      layer.destroy();\n    }\n    this.#allLayers.clear();\n    this.#allEditors.clear();\n    this.#editorsToRescale.clear();\n    this.#missingCanvases?.clear();\n    this.#activeEditor = null;\n    this.#selectedEditors.clear();\n    this.#commandManager.destroy();\n    this.#altTextManager?.destroy();\n    this.#signatureManager?.destroy();\n    this.#highlightToolbar?.hide();\n    this.#highlightToolbar = null;\n    this.#mainHighlightColorPicker?.destroy();\n    this.#mainHighlightColorPicker = null;\n    if (this.#focusMainContainerTimeoutId) {\n      clearTimeout(this.#focusMainContainerTimeoutId);\n      this.#focusMainContainerTimeoutId = null;\n    }\n    if (this.#translationTimeoutId) {\n      clearTimeout(this.#translationTimeoutId);\n      this.#translationTimeoutId = null;\n    }\n    this._editorUndoBar?.destroy();\n  }\n\n  combinedSignal(ac) {\n    return AbortSignal.any([this._signal, ac.signal]);\n  }\n\n  get mlManager() {\n    return this.#mlManager;\n  }\n\n  get useNewAltTextFlow() {\n    return this.#enableUpdatedAddImage;\n  }\n\n  get useNewAltTextWhenAddingImage() {\n    return this.#enableNewAltTextWhenAddingImage;\n  }\n\n  get hcmFilter() {\n    return shadow(\n      this,\n      \"hcmFilter\",\n      this.#pageColors\n        ? this.#filterFactory.addHCMFilter(\n            this.#pageColors.foreground,\n            this.#pageColors.background\n          )\n        : \"none\"\n    );\n  }\n\n  get direction() {\n    return shadow(\n      this,\n      \"direction\",\n      getComputedStyle(this.#container).direction\n    );\n  }\n\n  get highlightColors() {\n    return shadow(\n      this,\n      \"highlightColors\",\n      this.#highlightColors\n        ? new Map(\n            this.#highlightColors.split(\",\").map(pair => {\n              pair = pair.split(\"=\").map(x => x.trim());\n              pair[1] = pair[1].toUpperCase();\n              return pair;\n            })\n          )\n        : null\n    );\n  }\n\n  get highlightColorNames() {\n    return shadow(\n      this,\n      \"highlightColorNames\",\n      this.highlightColors\n        ? new Map(Array.from(this.highlightColors, e => e.reverse()))\n        : null\n    );\n  }\n\n  /**\n   * Set the current drawing session.\n   * @param {AnnotationEditorLayer} layer\n   */\n  setCurrentDrawingSession(layer) {\n    if (layer) {\n      this.unselectAll();\n      this.disableUserSelect(true);\n    } else {\n      this.disableUserSelect(false);\n    }\n    this.#currentDrawingSession = layer;\n  }\n\n  setMainHighlightColorPicker(colorPicker) {\n    this.#mainHighlightColorPicker = colorPicker;\n  }\n\n  editAltText(editor, firstTime = false) {\n    this.#altTextManager?.editAltText(this, editor, firstTime);\n  }\n\n  getSignature(editor) {\n    this.#signatureManager?.getSignature({ uiManager: this, editor });\n  }\n\n  get signatureManager() {\n    return this.#signatureManager;\n  }\n\n  switchToMode(mode, callback) {\n    // Switching to a mode can be asynchronous.\n    this._eventBus.on(\"annotationeditormodechanged\", callback, {\n      once: true,\n      signal: this._signal,\n    });\n    this._eventBus.dispatch(\"showannotationeditorui\", {\n      source: this,\n      mode,\n    });\n  }\n\n  setPreference(name, value) {\n    this._eventBus.dispatch(\"setpreference\", {\n      source: this,\n      name,\n      value,\n    });\n  }\n\n  onSetPreference({ name, value }) {\n    switch (name) {\n      case \"enableNewAltTextWhenAddingImage\":\n        this.#enableNewAltTextWhenAddingImage = value;\n        break;\n    }\n  }\n\n  onPageChanging({ pageNumber }) {\n    this.#currentPageIndex = pageNumber - 1;\n  }\n\n  focusMainContainer() {\n    this.#container.focus();\n  }\n\n  findParent(x, y) {\n    for (const layer of this.#allLayers.values()) {\n      const {\n        x: layerX,\n        y: layerY,\n        width,\n        height,\n      } = layer.div.getBoundingClientRect();\n      if (\n        x >= layerX &&\n        x <= layerX + width &&\n        y >= layerY &&\n        y <= layerY + height\n      ) {\n        return layer;\n      }\n    }\n    return null;\n  }\n\n  disableUserSelect(value = false) {\n    this.#viewer.classList.toggle(\"noUserSelect\", value);\n  }\n\n  addShouldRescale(editor) {\n    this.#editorsToRescale.add(editor);\n  }\n\n  removeShouldRescale(editor) {\n    this.#editorsToRescale.delete(editor);\n  }\n\n  onScaleChanging({ scale }) {\n    this.commitOrRemove();\n    this.viewParameters.realScale = scale * PixelsPerInch.PDF_TO_CSS_UNITS;\n    for (const editor of this.#editorsToRescale) {\n      editor.onScaleChanging();\n    }\n    this.#currentDrawingSession?.onScaleChanging();\n  }\n\n  onRotationChanging({ pagesRotation }) {\n    this.commitOrRemove();\n    this.viewParameters.rotation = pagesRotation;\n  }\n\n  #getAnchorElementForSelection({ anchorNode }) {\n    return anchorNode.nodeType === Node.TEXT_NODE\n      ? anchorNode.parentElement\n      : anchorNode;\n  }\n\n  #getLayerForTextLayer(textLayer) {\n    const { currentLayer } = this;\n    if (currentLayer.hasTextLayer(textLayer)) {\n      return currentLayer;\n    }\n    for (const layer of this.#allLayers.values()) {\n      if (layer.hasTextLayer(textLayer)) {\n        return layer;\n      }\n    }\n    return null;\n  }\n\n  highlightSelection(methodOfCreation = \"\") {\n    const selection = document.getSelection();\n    if (!selection || selection.isCollapsed) {\n      return;\n    }\n    const { anchorNode, anchorOffset, focusNode, focusOffset } = selection;\n    const text = selection.toString();\n    const anchorElement = this.#getAnchorElementForSelection(selection);\n    const textLayer = anchorElement.closest(\".textLayer\");\n    const boxes = this.getSelectionBoxes(textLayer);\n    if (!boxes) {\n      return;\n    }\n    selection.empty();\n\n    const layer = this.#getLayerForTextLayer(textLayer);\n    const isNoneMode = this.#mode === AnnotationEditorType.NONE;\n    const callback = () => {\n      layer?.createAndAddNewEditor({ x: 0, y: 0 }, false, {\n        methodOfCreation,\n        boxes,\n        anchorNode,\n        anchorOffset,\n        focusNode,\n        focusOffset,\n        text,\n      });\n      if (isNoneMode) {\n        this.showAllEditors(\"highlight\", true, /* updateButton = */ true);\n      }\n    };\n    if (isNoneMode) {\n      this.switchToMode(AnnotationEditorType.HIGHLIGHT, callback);\n      return;\n    }\n    callback();\n  }\n\n  #displayHighlightToolbar() {\n    const selection = document.getSelection();\n    if (!selection || selection.isCollapsed) {\n      return;\n    }\n    const anchorElement = this.#getAnchorElementForSelection(selection);\n    const textLayer = anchorElement.closest(\".textLayer\");\n    const boxes = this.getSelectionBoxes(textLayer);\n    if (!boxes) {\n      return;\n    }\n    this.#highlightToolbar ||= new HighlightToolbar(this);\n    this.#highlightToolbar.show(textLayer, boxes, this.direction === \"ltr\");\n  }\n\n  /**\n   * Add an editor in the annotation storage.\n   * @param {AnnotationEditor} editor\n   */\n  addToAnnotationStorage(editor) {\n    if (\n      !editor.isEmpty() &&\n      this.#annotationStorage &&\n      !this.#annotationStorage.has(editor.id)\n    ) {\n      this.#annotationStorage.setValue(editor.id, editor);\n    }\n  }\n\n  a11yAlert(messageId, args = null) {\n    const viewerAlert = this.#viewerAlert;\n    if (!viewerAlert) {\n      return;\n    }\n    viewerAlert.setAttribute(\"data-l10n-id\", messageId);\n    if (args) {\n      viewerAlert.setAttribute(\"data-l10n-args\", JSON.stringify(args));\n    } else {\n      viewerAlert.removeAttribute(\"data-l10n-args\");\n    }\n  }\n\n  #selectionChange() {\n    const selection = document.getSelection();\n    if (!selection || selection.isCollapsed) {\n      if (this.#selectedTextNode) {\n        this.#highlightToolbar?.hide();\n        this.#selectedTextNode = null;\n        this.#dispatchUpdateStates({\n          hasSelectedText: false,\n        });\n      }\n      return;\n    }\n    const { anchorNode } = selection;\n    if (anchorNode === this.#selectedTextNode) {\n      return;\n    }\n\n    const anchorElement = this.#getAnchorElementForSelection(selection);\n    const textLayer = anchorElement.closest(\".textLayer\");\n    if (!textLayer) {\n      if (this.#selectedTextNode) {\n        this.#highlightToolbar?.hide();\n        this.#selectedTextNode = null;\n        this.#dispatchUpdateStates({\n          hasSelectedText: false,\n        });\n      }\n      return;\n    }\n\n    this.#highlightToolbar?.hide();\n    this.#selectedTextNode = anchorNode;\n    this.#dispatchUpdateStates({\n      hasSelectedText: true,\n    });\n\n    if (\n      this.#mode !== AnnotationEditorType.HIGHLIGHT &&\n      this.#mode !== AnnotationEditorType.NONE\n    ) {\n      return;\n    }\n\n    if (this.#mode === AnnotationEditorType.HIGHLIGHT) {\n      this.showAllEditors(\"highlight\", true, /* updateButton = */ true);\n    }\n\n    this.#highlightWhenShiftUp = this.isShiftKeyDown;\n    if (!this.isShiftKeyDown) {\n      const activeLayer =\n        this.#mode === AnnotationEditorType.HIGHLIGHT\n          ? this.#getLayerForTextLayer(textLayer)\n          : null;\n      activeLayer?.toggleDrawing();\n\n      const ac = new AbortController();\n      const signal = this.combinedSignal(ac);\n\n      const pointerup = e => {\n        if (e.type === \"pointerup\" && e.button !== 0) {\n          // Do nothing on right click.\n          return;\n        }\n        ac.abort();\n        activeLayer?.toggleDrawing(true);\n        if (e.type === \"pointerup\") {\n          this.#onSelectEnd(\"main_toolbar\");\n        }\n      };\n      window.addEventListener(\"pointerup\", pointerup, { signal });\n      window.addEventListener(\"blur\", pointerup, { signal });\n    }\n  }\n\n  #onSelectEnd(methodOfCreation = \"\") {\n    if (this.#mode === AnnotationEditorType.HIGHLIGHT) {\n      this.highlightSelection(methodOfCreation);\n    } else if (this.#enableHighlightFloatingButton) {\n      this.#displayHighlightToolbar();\n    }\n  }\n\n  #addSelectionListener() {\n    document.addEventListener(\n      \"selectionchange\",\n      this.#selectionChange.bind(this),\n      { signal: this._signal }\n    );\n  }\n\n  #addFocusManager() {\n    if (this.#focusManagerAC) {\n      return;\n    }\n    this.#focusManagerAC = new AbortController();\n    const signal = this.combinedSignal(this.#focusManagerAC);\n\n    window.addEventListener(\"focus\", this.focus.bind(this), { signal });\n    window.addEventListener(\"blur\", this.blur.bind(this), { signal });\n  }\n\n  #removeFocusManager() {\n    this.#focusManagerAC?.abort();\n    this.#focusManagerAC = null;\n  }\n\n  blur() {\n    this.isShiftKeyDown = false;\n    if (this.#highlightWhenShiftUp) {\n      this.#highlightWhenShiftUp = false;\n      this.#onSelectEnd(\"main_toolbar\");\n    }\n    if (!this.hasSelection) {\n      return;\n    }\n    // When several editors are selected and the window loses focus, we want to\n    // keep the last active element in order to be able to focus it again when\n    // the window gets the focus back but we don't want to trigger any focus\n    // callbacks else only one editor will be selected.\n    const { activeElement } = document;\n    for (const editor of this.#selectedEditors) {\n      if (editor.div.contains(activeElement)) {\n        this.#lastActiveElement = [editor, activeElement];\n        editor._focusEventsAllowed = false;\n        break;\n      }\n    }\n  }\n\n  focus() {\n    if (!this.#lastActiveElement) {\n      return;\n    }\n    const [lastEditor, lastActiveElement] = this.#lastActiveElement;\n    this.#lastActiveElement = null;\n    lastActiveElement.addEventListener(\n      \"focusin\",\n      () => {\n        lastEditor._focusEventsAllowed = true;\n      },\n      { once: true, signal: this._signal }\n    );\n    lastActiveElement.focus();\n  }\n\n  #addKeyboardManager() {\n    if (this.#keyboardManagerAC) {\n      return;\n    }\n    this.#keyboardManagerAC = new AbortController();\n    const signal = this.combinedSignal(this.#keyboardManagerAC);\n\n    // The keyboard events are caught at the container level in order to be able\n    // to execute some callbacks even if the current page doesn't have focus.\n    window.addEventListener(\"keydown\", this.keydown.bind(this), { signal });\n    window.addEventListener(\"keyup\", this.keyup.bind(this), { signal });\n  }\n\n  #removeKeyboardManager() {\n    this.#keyboardManagerAC?.abort();\n    this.#keyboardManagerAC = null;\n  }\n\n  #addCopyPasteListeners() {\n    if (this.#copyPasteAC) {\n      return;\n    }\n    this.#copyPasteAC = new AbortController();\n    const signal = this.combinedSignal(this.#copyPasteAC);\n\n    document.addEventListener(\"copy\", this.copy.bind(this), { signal });\n    document.addEventListener(\"cut\", this.cut.bind(this), { signal });\n    document.addEventListener(\"paste\", this.paste.bind(this), { signal });\n  }\n\n  #removeCopyPasteListeners() {\n    this.#copyPasteAC?.abort();\n    this.#copyPasteAC = null;\n  }\n\n  #addDragAndDropListeners() {\n    const signal = this._signal;\n    document.addEventListener(\"dragover\", this.dragOver.bind(this), { signal });\n    document.addEventListener(\"drop\", this.drop.bind(this), { signal });\n  }\n\n  addEditListeners() {\n    this.#addKeyboardManager();\n    this.#addCopyPasteListeners();\n  }\n\n  removeEditListeners() {\n    this.#removeKeyboardManager();\n    this.#removeCopyPasteListeners();\n  }\n\n  dragOver(event) {\n    for (const { type } of event.dataTransfer.items) {\n      for (const editorType of this.#editorTypes) {\n        if (editorType.isHandlingMimeForPasting(type)) {\n          event.dataTransfer.dropEffect = \"copy\";\n          event.preventDefault();\n          return;\n        }\n      }\n    }\n  }\n\n  /**\n   * Drop callback.\n   * @param {DragEvent} event\n   */\n  drop(event) {\n    for (const item of event.dataTransfer.items) {\n      for (const editorType of this.#editorTypes) {\n        if (editorType.isHandlingMimeForPasting(item.type)) {\n          editorType.paste(item, this.currentLayer);\n          event.preventDefault();\n          return;\n        }\n      }\n    }\n  }\n\n  /**\n   * Copy callback.\n   * @param {ClipboardEvent} event\n   */\n  copy(event) {\n    event.preventDefault();\n\n    // An editor is being edited so just commit it.\n    this.#activeEditor?.commitOrRemove();\n\n    if (!this.hasSelection) {\n      return;\n    }\n\n    const editors = [];\n    for (const editor of this.#selectedEditors) {\n      const serialized = editor.serialize(/* isForCopying = */ true);\n      if (serialized) {\n        editors.push(serialized);\n      }\n    }\n    if (editors.length === 0) {\n      return;\n    }\n\n    event.clipboardData.setData(\"application/pdfjs\", JSON.stringify(editors));\n  }\n\n  /**\n   * Cut callback.\n   * @param {ClipboardEvent} event\n   */\n  cut(event) {\n    this.copy(event);\n    this.delete();\n  }\n\n  /**\n   * Paste callback.\n   * @param {ClipboardEvent} event\n   */\n  async paste(event) {\n    event.preventDefault();\n    const { clipboardData } = event;\n    for (const item of clipboardData.items) {\n      for (const editorType of this.#editorTypes) {\n        if (editorType.isHandlingMimeForPasting(item.type)) {\n          editorType.paste(item, this.currentLayer);\n          return;\n        }\n      }\n    }\n\n    let data = clipboardData.getData(\"application/pdfjs\");\n    if (!data) {\n      return;\n    }\n\n    try {\n      data = JSON.parse(data);\n    } catch (ex) {\n      warn(`paste: \"${ex.message}\".`);\n      return;\n    }\n\n    if (!Array.isArray(data)) {\n      return;\n    }\n\n    this.unselectAll();\n    const layer = this.currentLayer;\n\n    try {\n      const newEditors = [];\n      for (const editor of data) {\n        const deserializedEditor = await layer.deserialize(editor);\n        if (!deserializedEditor) {\n          return;\n        }\n        newEditors.push(deserializedEditor);\n      }\n\n      const cmd = () => {\n        for (const editor of newEditors) {\n          this.#addEditorToLayer(editor);\n        }\n        this.#selectEditors(newEditors);\n      };\n      const undo = () => {\n        for (const editor of newEditors) {\n          editor.remove();\n        }\n      };\n      this.addCommands({ cmd, undo, mustExec: true });\n    } catch (ex) {\n      warn(`paste: \"${ex.message}\".`);\n    }\n  }\n\n  /**\n   * Keydown callback.\n   * @param {KeyboardEvent} event\n   */\n  keydown(event) {\n    if (!this.isShiftKeyDown && event.key === \"Shift\") {\n      this.isShiftKeyDown = true;\n    }\n    if (\n      this.#mode !== AnnotationEditorType.NONE &&\n      !this.isEditorHandlingKeyboard\n    ) {\n      AnnotationEditorUIManager._keyboardManager.exec(this, event);\n    }\n  }\n\n  /**\n   * Keyup callback.\n   * @param {KeyboardEvent} event\n   */\n  keyup(event) {\n    if (this.isShiftKeyDown && event.key === \"Shift\") {\n      this.isShiftKeyDown = false;\n      if (this.#highlightWhenShiftUp) {\n        this.#highlightWhenShiftUp = false;\n        this.#onSelectEnd(\"main_toolbar\");\n      }\n    }\n  }\n\n  /**\n   * Execute an action for a given name.\n   * For example, the user can click on the \"Undo\" entry in the context menu\n   * and it'll trigger the undo action.\n   */\n  onEditingAction({ name }) {\n    switch (name) {\n      case \"undo\":\n      case \"redo\":\n      case \"delete\":\n      case \"selectAll\":\n        this[name]();\n        break;\n      case \"highlightSelection\":\n        this.highlightSelection(\"context_menu\");\n        break;\n    }\n  }\n\n  /**\n   * Update the different possible states of this manager, e.g. is there\n   * something to undo, redo, ...\n   * @param {Object} details\n   */\n  #dispatchUpdateStates(details) {\n    const hasChanged = Object.entries(details).some(\n      ([key, value]) => this.#previousStates[key] !== value\n    );\n\n    if (hasChanged) {\n      this._eventBus.dispatch(\"annotationeditorstateschanged\", {\n        source: this,\n        details: Object.assign(this.#previousStates, details),\n      });\n      // We could listen on our own event but it sounds like a bit weird and\n      // it's a way to simpler to handle that stuff here instead of having to\n      // add something in every place where an editor can be unselected.\n      if (\n        this.#mode === AnnotationEditorType.HIGHLIGHT &&\n        details.hasSelectedEditor === false\n      ) {\n        this.#dispatchUpdateUI([\n          [AnnotationEditorParamsType.HIGHLIGHT_FREE, true],\n        ]);\n      }\n    }\n  }\n\n  #dispatchUpdateUI(details) {\n    this._eventBus.dispatch(\"annotationeditorparamschanged\", {\n      source: this,\n      details,\n    });\n  }\n\n  /**\n   * Set the editing state.\n   * It can be useful to temporarily disable it when the user is editing a\n   * FreeText annotation.\n   * @param {boolean} isEditing\n   */\n  setEditingState(isEditing) {\n    if (isEditing) {\n      this.#addFocusManager();\n      this.#addCopyPasteListeners();\n      this.#dispatchUpdateStates({\n        isEditing: this.#mode !== AnnotationEditorType.NONE,\n        isEmpty: this.#isEmpty(),\n        hasSomethingToUndo: this.#commandManager.hasSomethingToUndo(),\n        hasSomethingToRedo: this.#commandManager.hasSomethingToRedo(),\n        hasSelectedEditor: false,\n      });\n    } else {\n      this.#removeFocusManager();\n      this.#removeCopyPasteListeners();\n      this.#dispatchUpdateStates({\n        isEditing: false,\n      });\n      this.disableUserSelect(false);\n    }\n  }\n\n  registerEditorTypes(types) {\n    if (this.#editorTypes) {\n      return;\n    }\n    this.#editorTypes = types;\n    for (const editorType of this.#editorTypes) {\n      this.#dispatchUpdateUI(editorType.defaultPropertiesToUpdate);\n    }\n  }\n\n  /**\n   * Get an id.\n   * @returns {string}\n   */\n  getId() {\n    return this.#idManager.id;\n  }\n\n  get currentLayer() {\n    return this.#allLayers.get(this.#currentPageIndex);\n  }\n\n  getLayer(pageIndex) {\n    return this.#allLayers.get(pageIndex);\n  }\n\n  get currentPageIndex() {\n    return this.#currentPageIndex;\n  }\n\n  /**\n   * Add a new layer for a page which will contains the editors.\n   * @param {AnnotationEditorLayer} layer\n   */\n  addLayer(layer) {\n    this.#allLayers.set(layer.pageIndex, layer);\n    if (this.#isEnabled) {\n      layer.enable();\n    } else {\n      layer.disable();\n    }\n  }\n\n  /**\n   * Remove a layer.\n   * @param {AnnotationEditorLayer} layer\n   */\n  removeLayer(layer) {\n    this.#allLayers.delete(layer.pageIndex);\n  }\n\n  /**\n   * Change the editor mode (None, FreeText, Ink, ...)\n   * @param {number} mode\n   * @param {string|null} editId\n   * @param {boolean} [isFromKeyboard] - true if the mode change is due to a\n   *   keyboard action.\n   * @param {boolean} [mustEnterInEditMode] - true if the editor must enter in\n   *   edit mode.\n   */\n  async updateMode(\n    mode,\n    editId = null,\n    isFromKeyboard = false,\n    mustEnterInEditMode = false\n  ) {\n    if (this.#mode === mode) {\n      return;\n    }\n\n    if (this.#updateModeCapability) {\n      await this.#updateModeCapability.promise;\n      if (!this.#updateModeCapability) {\n        // This ui manager has been destroyed.\n        return;\n      }\n    }\n\n    this.#updateModeCapability = Promise.withResolvers();\n    this.#currentDrawingSession?.commitOrRemove();\n\n    this.#mode = mode;\n    if (mode === AnnotationEditorType.NONE) {\n      this.setEditingState(false);\n      this.#disableAll();\n\n      this._editorUndoBar?.hide();\n\n      this.#updateModeCapability.resolve();\n      return;\n    }\n    if (mode === AnnotationEditorType.SIGNATURE) {\n      await this.#signatureManager?.loadSignatures();\n    }\n    this.setEditingState(true);\n    await this.#enableAll();\n    this.unselectAll();\n    for (const layer of this.#allLayers.values()) {\n      layer.updateMode(mode);\n    }\n    if (!editId) {\n      if (isFromKeyboard) {\n        this.addNewEditorFromKeyboard();\n      }\n\n      this.#updateModeCapability.resolve();\n      return;\n    }\n\n    for (const editor of this.#allEditors.values()) {\n      if (editor.annotationElementId === editId || editor.id === editId) {\n        this.setSelected(editor);\n        if (mustEnterInEditMode) {\n          editor.enterInEditMode();\n        }\n      } else {\n        editor.unselect();\n      }\n    }\n\n    this.#updateModeCapability.resolve();\n  }\n\n  addNewEditorFromKeyboard() {\n    if (this.currentLayer.canCreateNewEmptyEditor()) {\n      this.currentLayer.addNewEditor();\n    }\n  }\n\n  /**\n   * Update the toolbar if it's required to reflect the tool currently used.\n   * @param {Object} options\n   * @param {number} mode\n   * @returns {undefined}\n   */\n  updateToolbar(options) {\n    if (options.mode === this.#mode) {\n      return;\n    }\n    this._eventBus.dispatch(\"switchannotationeditormode\", {\n      source: this,\n      ...options,\n    });\n  }\n\n  /**\n   * Update a parameter in the current editor or globally.\n   * @param {number} type\n   * @param {*} value\n   */\n  updateParams(type, value) {\n    if (!this.#editorTypes) {\n      return;\n    }\n\n    switch (type) {\n      case AnnotationEditorParamsType.CREATE:\n        this.currentLayer.addNewEditor(value);\n        return;\n      case AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:\n        this.#mainHighlightColorPicker?.updateColor(value);\n        break;\n      case AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL:\n        this._eventBus.dispatch(\"reporttelemetry\", {\n          source: this,\n          details: {\n            type: \"editing\",\n            data: {\n              type: \"highlight\",\n              action: \"toggle_visibility\",\n            },\n          },\n        });\n        (this.#showAllStates ||= new Map()).set(type, value);\n        this.showAllEditors(\"highlight\", value);\n        break;\n    }\n\n    for (const editor of this.#selectedEditors) {\n      editor.updateParams(type, value);\n    }\n\n    for (const editorType of this.#editorTypes) {\n      editorType.updateDefaultParams(type, value);\n    }\n  }\n\n  showAllEditors(type, visible, updateButton = false) {\n    for (const editor of this.#allEditors.values()) {\n      if (editor.editorType === type) {\n        editor.show(visible);\n      }\n    }\n    const state =\n      this.#showAllStates?.get(AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL) ??\n      true;\n    if (state !== visible) {\n      this.#dispatchUpdateUI([\n        [AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL, visible],\n      ]);\n    }\n  }\n\n  enableWaiting(mustWait = false) {\n    if (this.#isWaiting === mustWait) {\n      return;\n    }\n    this.#isWaiting = mustWait;\n    for (const layer of this.#allLayers.values()) {\n      if (mustWait) {\n        layer.disableClick();\n      } else {\n        layer.enableClick();\n      }\n      layer.div.classList.toggle(\"waiting\", mustWait);\n    }\n  }\n\n  /**\n   * Enable all the layers.\n   */\n  async #enableAll() {\n    if (!this.#isEnabled) {\n      this.#isEnabled = true;\n      const promises = [];\n      for (const layer of this.#allLayers.values()) {\n        promises.push(layer.enable());\n      }\n      await Promise.all(promises);\n      for (const editor of this.#allEditors.values()) {\n        editor.enable();\n      }\n    }\n  }\n\n  /**\n   * Disable all the layers.\n   */\n  #disableAll() {\n    this.unselectAll();\n    if (this.#isEnabled) {\n      this.#isEnabled = false;\n      for (const layer of this.#allLayers.values()) {\n        layer.disable();\n      }\n      for (const editor of this.#allEditors.values()) {\n        editor.disable();\n      }\n    }\n  }\n\n  /**\n   * Get all the editors belonging to a given page.\n   * @param {number} pageIndex\n   * @returns {Array<AnnotationEditor>}\n   */\n  getEditors(pageIndex) {\n    const editors = [];\n    for (const editor of this.#allEditors.values()) {\n      if (editor.pageIndex === pageIndex) {\n        editors.push(editor);\n      }\n    }\n    return editors;\n  }\n\n  /**\n   * Get an editor with the given id.\n   * @param {string} id\n   * @returns {AnnotationEditor}\n   */\n  getEditor(id) {\n    return this.#allEditors.get(id);\n  }\n\n  /**\n   * Add a new editor.\n   * @param {AnnotationEditor} editor\n   */\n  addEditor(editor) {\n    this.#allEditors.set(editor.id, editor);\n  }\n\n  /**\n   * Remove an editor.\n   * @param {AnnotationEditor} editor\n   */\n  removeEditor(editor) {\n    if (editor.div.contains(document.activeElement)) {\n      if (this.#focusMainContainerTimeoutId) {\n        clearTimeout(this.#focusMainContainerTimeoutId);\n      }\n      this.#focusMainContainerTimeoutId = setTimeout(() => {\n        // When the div is removed from DOM the focus can move on the\n        // document.body, so we need to move it back to the main container.\n        this.focusMainContainer();\n        this.#focusMainContainerTimeoutId = null;\n      }, 0);\n    }\n    this.#allEditors.delete(editor.id);\n    if (editor.annotationElementId) {\n      this.#missingCanvases?.delete(editor.annotationElementId);\n    }\n    this.unselect(editor);\n    if (\n      !editor.annotationElementId ||\n      !this.#deletedAnnotationsElementIds.has(editor.annotationElementId)\n    ) {\n      this.#annotationStorage?.remove(editor.id);\n    }\n  }\n\n  /**\n   * The annotation element with the given id has been deleted.\n   * @param {AnnotationEditor} editor\n   */\n  addDeletedAnnotationElement(editor) {\n    this.#deletedAnnotationsElementIds.add(editor.annotationElementId);\n    this.addChangedExistingAnnotation(editor);\n    editor.deleted = true;\n  }\n\n  /**\n   * Check if the annotation element with the given id has been deleted.\n   * @param {string} annotationElementId\n   * @returns {boolean}\n   */\n  isDeletedAnnotationElement(annotationElementId) {\n    return this.#deletedAnnotationsElementIds.has(annotationElementId);\n  }\n\n  /**\n   * The annotation element with the given id have been restored.\n   * @param {AnnotationEditor} editor\n   */\n  removeDeletedAnnotationElement(editor) {\n    this.#deletedAnnotationsElementIds.delete(editor.annotationElementId);\n    this.removeChangedExistingAnnotation(editor);\n    editor.deleted = false;\n  }\n\n  /**\n   * Add an editor to the layer it belongs to or add it to the global map.\n   * @param {AnnotationEditor} editor\n   */\n  #addEditorToLayer(editor) {\n    const layer = this.#allLayers.get(editor.pageIndex);\n    if (layer) {\n      layer.addOrRebuild(editor);\n    } else {\n      this.addEditor(editor);\n      this.addToAnnotationStorage(editor);\n    }\n  }\n\n  /**\n   * Set the given editor as the active one.\n   * @param {AnnotationEditor} editor\n   */\n  setActiveEditor(editor) {\n    if (this.#activeEditor === editor) {\n      return;\n    }\n\n    this.#activeEditor = editor;\n    if (editor) {\n      this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    }\n  }\n\n  get #lastSelectedEditor() {\n    let ed = null;\n    for (ed of this.#selectedEditors) {\n      // Iterate to get the last element.\n    }\n    return ed;\n  }\n\n  /**\n   * Update the UI of the active editor.\n   * @param {AnnotationEditor} editor\n   */\n  updateUI(editor) {\n    if (this.#lastSelectedEditor === editor) {\n      this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    }\n  }\n\n  updateUIForDefaultProperties(editorType) {\n    this.#dispatchUpdateUI(editorType.defaultPropertiesToUpdate);\n  }\n\n  /**\n   * Add or remove an editor the current selection.\n   * @param {AnnotationEditor} editor\n   */\n  toggleSelected(editor) {\n    if (this.#selectedEditors.has(editor)) {\n      this.#selectedEditors.delete(editor);\n      editor.unselect();\n      this.#dispatchUpdateStates({\n        hasSelectedEditor: this.hasSelection,\n      });\n      return;\n    }\n    this.#selectedEditors.add(editor);\n    editor.select();\n    this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: true,\n    });\n  }\n\n  /**\n   * Set the last selected editor.\n   * @param {AnnotationEditor} editor\n   */\n  setSelected(editor) {\n    this.updateToolbar({\n      mode: editor.mode,\n      editId: editor.id,\n    });\n\n    this.#currentDrawingSession?.commitOrRemove();\n    for (const ed of this.#selectedEditors) {\n      if (ed !== editor) {\n        ed.unselect();\n      }\n    }\n    this.#selectedEditors.clear();\n\n    this.#selectedEditors.add(editor);\n    editor.select();\n    this.#dispatchUpdateUI(editor.propertiesToUpdate);\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: true,\n    });\n  }\n\n  /**\n   * Check if the editor is selected.\n   * @param {AnnotationEditor} editor\n   */\n  isSelected(editor) {\n    return this.#selectedEditors.has(editor);\n  }\n\n  get firstSelectedEditor() {\n    return this.#selectedEditors.values().next().value;\n  }\n\n  /**\n   * Unselect an editor.\n   * @param {AnnotationEditor} editor\n   */\n  unselect(editor) {\n    editor.unselect();\n    this.#selectedEditors.delete(editor);\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: this.hasSelection,\n    });\n  }\n\n  get hasSelection() {\n    return this.#selectedEditors.size !== 0;\n  }\n\n  get isEnterHandled() {\n    return (\n      this.#selectedEditors.size === 1 &&\n      this.firstSelectedEditor.isEnterHandled\n    );\n  }\n\n  /**\n   * Undo the last command.\n   */\n  undo() {\n    this.#commandManager.undo();\n    this.#dispatchUpdateStates({\n      hasSomethingToUndo: this.#commandManager.hasSomethingToUndo(),\n      hasSomethingToRedo: true,\n      isEmpty: this.#isEmpty(),\n    });\n    this._editorUndoBar?.hide();\n  }\n\n  /**\n   * Redo the last undoed command.\n   */\n  redo() {\n    this.#commandManager.redo();\n    this.#dispatchUpdateStates({\n      hasSomethingToUndo: true,\n      hasSomethingToRedo: this.#commandManager.hasSomethingToRedo(),\n      isEmpty: this.#isEmpty(),\n    });\n  }\n\n  /**\n   * Add a command to execute (cmd) and another one to undo it.\n   * @param {Object} params\n   */\n  addCommands(params) {\n    this.#commandManager.add(params);\n    this.#dispatchUpdateStates({\n      hasSomethingToUndo: true,\n      hasSomethingToRedo: false,\n      isEmpty: this.#isEmpty(),\n    });\n  }\n\n  cleanUndoStack(type) {\n    this.#commandManager.cleanType(type);\n  }\n\n  #isEmpty() {\n    if (this.#allEditors.size === 0) {\n      return true;\n    }\n\n    if (this.#allEditors.size === 1) {\n      for (const editor of this.#allEditors.values()) {\n        return editor.isEmpty();\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Delete the current editor or all.\n   */\n  delete() {\n    this.commitOrRemove();\n    const drawingEditor = this.currentLayer?.endDrawingSession(\n      /* isAborted = */ true\n    );\n    if (!this.hasSelection && !drawingEditor) {\n      return;\n    }\n\n    const editors = drawingEditor\n      ? [drawingEditor]\n      : [...this.#selectedEditors];\n    const cmd = () => {\n      this._editorUndoBar?.show(\n        undo,\n        editors.length === 1 ? editors[0].editorType : editors.length\n      );\n      for (const editor of editors) {\n        editor.remove();\n      }\n    };\n    const undo = () => {\n      for (const editor of editors) {\n        this.#addEditorToLayer(editor);\n      }\n    };\n\n    this.addCommands({ cmd, undo, mustExec: true });\n  }\n\n  commitOrRemove() {\n    // An editor is being edited so just commit it.\n    this.#activeEditor?.commitOrRemove();\n  }\n\n  hasSomethingToControl() {\n    return this.#activeEditor || this.hasSelection;\n  }\n\n  /**\n   * Select the editors.\n   * @param {Array<AnnotationEditor>} editors\n   */\n  #selectEditors(editors) {\n    for (const editor of this.#selectedEditors) {\n      editor.unselect();\n    }\n    this.#selectedEditors.clear();\n    for (const editor of editors) {\n      if (editor.isEmpty()) {\n        continue;\n      }\n      this.#selectedEditors.add(editor);\n      editor.select();\n    }\n    this.#dispatchUpdateStates({ hasSelectedEditor: this.hasSelection });\n  }\n\n  /**\n   * Select all the editors.\n   */\n  selectAll() {\n    for (const editor of this.#selectedEditors) {\n      editor.commit();\n    }\n    this.#selectEditors(this.#allEditors.values());\n  }\n\n  /**\n   * Unselect all the selected editors.\n   */\n  unselectAll() {\n    if (this.#activeEditor) {\n      // An editor is being edited so just commit it.\n      this.#activeEditor.commitOrRemove();\n      if (this.#mode !== AnnotationEditorType.NONE) {\n        // If the mode is NONE, we want to really unselect the editor, hence we\n        // mustn't return here.\n        return;\n      }\n    }\n\n    if (this.#currentDrawingSession?.commitOrRemove()) {\n      return;\n    }\n\n    if (!this.hasSelection) {\n      return;\n    }\n    for (const editor of this.#selectedEditors) {\n      editor.unselect();\n    }\n    this.#selectedEditors.clear();\n    this.#dispatchUpdateStates({\n      hasSelectedEditor: false,\n    });\n  }\n\n  translateSelectedEditors(x, y, noCommit = false) {\n    if (!noCommit) {\n      this.commitOrRemove();\n    }\n    if (!this.hasSelection) {\n      return;\n    }\n\n    this.#translation[0] += x;\n    this.#translation[1] += y;\n    const [totalX, totalY] = this.#translation;\n    const editors = [...this.#selectedEditors];\n\n    // We don't want to have an undo/redo for each translation so we wait a bit\n    // before adding the command to the command manager.\n    const TIME_TO_WAIT = 1000;\n\n    if (this.#translationTimeoutId) {\n      clearTimeout(this.#translationTimeoutId);\n    }\n\n    this.#translationTimeoutId = setTimeout(() => {\n      this.#translationTimeoutId = null;\n      this.#translation[0] = this.#translation[1] = 0;\n\n      this.addCommands({\n        cmd: () => {\n          for (const editor of editors) {\n            if (this.#allEditors.has(editor.id)) {\n              editor.translateInPage(totalX, totalY);\n              editor.translationDone();\n            }\n          }\n        },\n        undo: () => {\n          for (const editor of editors) {\n            if (this.#allEditors.has(editor.id)) {\n              editor.translateInPage(-totalX, -totalY);\n              editor.translationDone();\n            }\n          }\n        },\n        mustExec: false,\n      });\n    }, TIME_TO_WAIT);\n\n    for (const editor of editors) {\n      editor.translateInPage(x, y);\n      editor.translationDone();\n    }\n  }\n\n  /**\n   * Set up the drag session for moving the selected editors.\n   */\n  setUpDragSession() {\n    // Note: don't use any references to the editor's parent which can be null\n    // if the editor belongs to a destroyed page.\n    if (!this.hasSelection) {\n      return;\n    }\n    // Avoid to have spurious text selection in the text layer when dragging.\n    this.disableUserSelect(true);\n    this.#draggingEditors = new Map();\n    for (const editor of this.#selectedEditors) {\n      this.#draggingEditors.set(editor, {\n        savedX: editor.x,\n        savedY: editor.y,\n        savedPageIndex: editor.pageIndex,\n        newX: 0,\n        newY: 0,\n        newPageIndex: -1,\n      });\n    }\n  }\n\n  /**\n   * Ends the drag session.\n   * @returns {boolean} true if at least one editor has been moved.\n   */\n  endDragSession() {\n    if (!this.#draggingEditors) {\n      return false;\n    }\n    this.disableUserSelect(false);\n    const map = this.#draggingEditors;\n    this.#draggingEditors = null;\n    let mustBeAddedInUndoStack = false;\n\n    for (const [{ x, y, pageIndex }, value] of map) {\n      value.newX = x;\n      value.newY = y;\n      value.newPageIndex = pageIndex;\n      mustBeAddedInUndoStack ||=\n        x !== value.savedX ||\n        y !== value.savedY ||\n        pageIndex !== value.savedPageIndex;\n    }\n\n    if (!mustBeAddedInUndoStack) {\n      return false;\n    }\n\n    const move = (editor, x, y, pageIndex) => {\n      if (this.#allEditors.has(editor.id)) {\n        // The editor can be undone/redone on a page which is not visible (and\n        // which potentially has no annotation editor layer), hence we need to\n        // use the pageIndex instead of the parent.\n        const parent = this.#allLayers.get(pageIndex);\n        if (parent) {\n          editor._setParentAndPosition(parent, x, y);\n        } else {\n          editor.pageIndex = pageIndex;\n          editor.x = x;\n          editor.y = y;\n        }\n      }\n    };\n\n    this.addCommands({\n      cmd: () => {\n        for (const [editor, { newX, newY, newPageIndex }] of map) {\n          move(editor, newX, newY, newPageIndex);\n        }\n      },\n      undo: () => {\n        for (const [editor, { savedX, savedY, savedPageIndex }] of map) {\n          move(editor, savedX, savedY, savedPageIndex);\n        }\n      },\n      mustExec: true,\n    });\n\n    return true;\n  }\n\n  /**\n   * Drag the set of selected editors.\n   * @param {number} tx\n   * @param {number} ty\n   */\n  dragSelectedEditors(tx, ty) {\n    if (!this.#draggingEditors) {\n      return;\n    }\n    for (const editor of this.#draggingEditors.keys()) {\n      editor.drag(tx, ty);\n    }\n  }\n\n  /**\n   * Rebuild the editor (usually on undo/redo actions) on a potentially\n   * non-rendered page.\n   * @param {AnnotationEditor} editor\n   */\n  rebuild(editor) {\n    if (editor.parent === null) {\n      const parent = this.getLayer(editor.pageIndex);\n      if (parent) {\n        parent.changeParent(editor);\n        parent.addOrRebuild(editor);\n      } else {\n        this.addEditor(editor);\n        this.addToAnnotationStorage(editor);\n        editor.rebuild();\n      }\n    } else {\n      editor.parent.addOrRebuild(editor);\n    }\n  }\n\n  get isEditorHandlingKeyboard() {\n    return (\n      this.getActive()?.shouldGetKeyboardEvents() ||\n      (this.#selectedEditors.size === 1 &&\n        this.firstSelectedEditor.shouldGetKeyboardEvents())\n    );\n  }\n\n  /**\n   * Is the current editor the one passed as argument?\n   * @param {AnnotationEditor} editor\n   * @returns\n   */\n  isActive(editor) {\n    return this.#activeEditor === editor;\n  }\n\n  /**\n   * Get the current active editor.\n   * @returns {AnnotationEditor|null}\n   */\n  getActive() {\n    return this.#activeEditor;\n  }\n\n  /**\n   * Get the current editor mode.\n   * @returns {number}\n   */\n  getMode() {\n    return this.#mode;\n  }\n\n  get imageManager() {\n    return shadow(this, \"imageManager\", new ImageManager());\n  }\n\n  getSelectionBoxes(textLayer) {\n    if (!textLayer) {\n      return null;\n    }\n    const selection = document.getSelection();\n    for (let i = 0, ii = selection.rangeCount; i < ii; i++) {\n      if (\n        !textLayer.contains(selection.getRangeAt(i).commonAncestorContainer)\n      ) {\n        return null;\n      }\n    }\n\n    const {\n      x: layerX,\n      y: layerY,\n      width: parentWidth,\n      height: parentHeight,\n    } = textLayer.getBoundingClientRect();\n\n    // We must rotate the boxes because we want to have them in the non-rotated\n    // page coordinates.\n    let rotator;\n    switch (textLayer.getAttribute(\"data-main-rotation\")) {\n      case \"90\":\n        rotator = (x, y, w, h) => ({\n          x: (y - layerY) / parentHeight,\n          y: 1 - (x + w - layerX) / parentWidth,\n          width: h / parentHeight,\n          height: w / parentWidth,\n        });\n        break;\n      case \"180\":\n        rotator = (x, y, w, h) => ({\n          x: 1 - (x + w - layerX) / parentWidth,\n          y: 1 - (y + h - layerY) / parentHeight,\n          width: w / parentWidth,\n          height: h / parentHeight,\n        });\n        break;\n      case \"270\":\n        rotator = (x, y, w, h) => ({\n          x: 1 - (y + h - layerY) / parentHeight,\n          y: (x - layerX) / parentWidth,\n          width: h / parentHeight,\n          height: w / parentWidth,\n        });\n        break;\n      default:\n        rotator = (x, y, w, h) => ({\n          x: (x - layerX) / parentWidth,\n          y: (y - layerY) / parentHeight,\n          width: w / parentWidth,\n          height: h / parentHeight,\n        });\n        break;\n    }\n\n    const boxes = [];\n    for (let i = 0, ii = selection.rangeCount; i < ii; i++) {\n      const range = selection.getRangeAt(i);\n      if (range.collapsed) {\n        continue;\n      }\n      for (const { x, y, width, height } of range.getClientRects()) {\n        if (width === 0 || height === 0) {\n          continue;\n        }\n        boxes.push(rotator(x, y, width, height));\n      }\n    }\n    return boxes.length === 0 ? null : boxes;\n  }\n\n  addChangedExistingAnnotation({ annotationElementId, id }) {\n    (this.#changedExistingAnnotations ||= new Map()).set(\n      annotationElementId,\n      id\n    );\n  }\n\n  removeChangedExistingAnnotation({ annotationElementId }) {\n    this.#changedExistingAnnotations?.delete(annotationElementId);\n  }\n\n  renderAnnotationElement(annotation) {\n    const editorId = this.#changedExistingAnnotations?.get(annotation.data.id);\n    if (!editorId) {\n      return;\n    }\n    const editor = this.#annotationStorage.getRawValue(editorId);\n    if (!editor) {\n      return;\n    }\n    if (this.#mode === AnnotationEditorType.NONE && !editor.hasBeenModified) {\n      return;\n    }\n    editor.renderAnnotationElement(annotation);\n  }\n\n  setMissingCanvas(annotationId, annotationElementId, canvas) {\n    const editor = this.#missingCanvases?.get(annotationId);\n    if (!editor) {\n      return;\n    }\n    editor.setCanvas(annotationElementId, canvas);\n    this.#missingCanvases.delete(annotationId);\n  }\n\n  addMissingCanvas(annotationId, editor) {\n    (this.#missingCanvases ||= new Map()).set(annotationId, editor);\n  }\n}\n\nexport {\n  AnnotationEditorUIManager,\n  bindEvents,\n  ColorManager,\n  CommandManager,\n  KeyboardManager,\n};\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { noContextMenu } from \"../display_utils.js\";\n\nclass AltText {\n  #altText = null;\n\n  #altTextDecorative = false;\n\n  #altTextButton = null;\n\n  #altTextButtonLabel = null;\n\n  #altTextTooltip = null;\n\n  #altTextTooltipTimeout = null;\n\n  #altTextWasFromKeyBoard = false;\n\n  #badge = null;\n\n  #editor = null;\n\n  #guessedText = null;\n\n  #textWithDisclaimer = null;\n\n  #useNewAltTextFlow = false;\n\n  static #l10nNewButton = null;\n\n  static _l10n = null;\n\n  constructor(editor) {\n    this.#editor = editor;\n    this.#useNewAltTextFlow = editor._uiManager.useNewAltTextFlow;\n\n    AltText.#l10nNewButton ||= Object.freeze({\n      added: \"pdfjs-editor-new-alt-text-added-button\",\n      \"added-label\": \"pdfjs-editor-new-alt-text-added-button-label\",\n      missing: \"pdfjs-editor-new-alt-text-missing-button\",\n      \"missing-label\": \"pdfjs-editor-new-alt-text-missing-button-label\",\n      review: \"pdfjs-editor-new-alt-text-to-review-button\",\n      \"review-label\": \"pdfjs-editor-new-alt-text-to-review-button-label\",\n    });\n  }\n\n  static initialize(l10n) {\n    AltText._l10n ??= l10n;\n  }\n\n  async render() {\n    const altText = (this.#altTextButton = document.createElement(\"button\"));\n    altText.className = \"altText\";\n    altText.tabIndex = \"0\";\n\n    const label = (this.#altTextButtonLabel = document.createElement(\"span\"));\n    altText.append(label);\n\n    if (this.#useNewAltTextFlow) {\n      altText.classList.add(\"new\");\n      altText.setAttribute(\"data-l10n-id\", AltText.#l10nNewButton.missing);\n      label.setAttribute(\n        \"data-l10n-id\",\n        AltText.#l10nNewButton[\"missing-label\"]\n      );\n    } else {\n      altText.setAttribute(\"data-l10n-id\", \"pdfjs-editor-alt-text-button\");\n      label.setAttribute(\"data-l10n-id\", \"pdfjs-editor-alt-text-button-label\");\n    }\n\n    const signal = this.#editor._uiManager._signal;\n    altText.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    altText.addEventListener(\"pointerdown\", event => event.stopPropagation(), {\n      signal,\n    });\n\n    const onClick = event => {\n      event.preventDefault();\n      this.#editor._uiManager.editAltText(this.#editor);\n      if (this.#useNewAltTextFlow) {\n        this.#editor._reportTelemetry({\n          action: \"pdfjs.image.alt_text.image_status_label_clicked\",\n          data: { label: this.#label },\n        });\n      }\n    };\n    altText.addEventListener(\"click\", onClick, { capture: true, signal });\n    altText.addEventListener(\n      \"keydown\",\n      event => {\n        if (event.target === altText && event.key === \"Enter\") {\n          this.#altTextWasFromKeyBoard = true;\n          onClick(event);\n        }\n      },\n      { signal }\n    );\n    await this.#setState();\n\n    return altText;\n  }\n\n  get #label() {\n    return (\n      (this.#altText && \"added\") ||\n      (this.#altText === null && this.guessedText && \"review\") ||\n      \"missing\"\n    );\n  }\n\n  finish() {\n    if (!this.#altTextButton) {\n      return;\n    }\n    this.#altTextButton.focus({ focusVisible: this.#altTextWasFromKeyBoard });\n    this.#altTextWasFromKeyBoard = false;\n  }\n\n  isEmpty() {\n    if (this.#useNewAltTextFlow) {\n      return this.#altText === null;\n    }\n    return !this.#altText && !this.#altTextDecorative;\n  }\n\n  hasData() {\n    if (this.#useNewAltTextFlow) {\n      return this.#altText !== null || !!this.#guessedText;\n    }\n    return this.isEmpty();\n  }\n\n  get guessedText() {\n    return this.#guessedText;\n  }\n\n  async setGuessedText(guessedText) {\n    if (this.#altText !== null) {\n      // The user provided their own alt text, so we don't want to overwrite it.\n      return;\n    }\n    this.#guessedText = guessedText;\n    this.#textWithDisclaimer = await AltText._l10n.get(\n      \"pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer\",\n      { generatedAltText: guessedText }\n    );\n    this.#setState();\n  }\n\n  toggleAltTextBadge(visibility = false) {\n    if (!this.#useNewAltTextFlow || this.#altText) {\n      this.#badge?.remove();\n      this.#badge = null;\n      return;\n    }\n    if (!this.#badge) {\n      const badge = (this.#badge = document.createElement(\"div\"));\n      badge.className = \"noAltTextBadge\";\n      this.#editor.div.append(badge);\n    }\n    this.#badge.classList.toggle(\"hidden\", !visibility);\n  }\n\n  serialize(isForCopying) {\n    let altText = this.#altText;\n    if (!isForCopying && this.#guessedText === altText) {\n      altText = this.#textWithDisclaimer;\n    }\n    return {\n      altText,\n      decorative: this.#altTextDecorative,\n      guessedText: this.#guessedText,\n      textWithDisclaimer: this.#textWithDisclaimer,\n    };\n  }\n\n  get data() {\n    return {\n      altText: this.#altText,\n      decorative: this.#altTextDecorative,\n    };\n  }\n\n  /**\n   * Set the alt text data.\n   */\n  set data({\n    altText,\n    decorative,\n    guessedText,\n    textWithDisclaimer,\n    cancel = false,\n  }) {\n    if (guessedText) {\n      this.#guessedText = guessedText;\n      this.#textWithDisclaimer = textWithDisclaimer;\n    }\n    if (this.#altText === altText && this.#altTextDecorative === decorative) {\n      return;\n    }\n    if (!cancel) {\n      this.#altText = altText;\n      this.#altTextDecorative = decorative;\n    }\n    this.#setState();\n  }\n\n  toggle(enabled = false) {\n    if (!this.#altTextButton) {\n      return;\n    }\n    if (!enabled && this.#altTextTooltipTimeout) {\n      clearTimeout(this.#altTextTooltipTimeout);\n      this.#altTextTooltipTimeout = null;\n    }\n    this.#altTextButton.disabled = !enabled;\n  }\n\n  shown() {\n    this.#editor._reportTelemetry({\n      action: \"pdfjs.image.alt_text.image_status_label_displayed\",\n      data: { label: this.#label },\n    });\n  }\n\n  destroy() {\n    this.#altTextButton?.remove();\n    this.#altTextButton = null;\n    this.#altTextButtonLabel = null;\n    this.#altTextTooltip = null;\n    this.#badge?.remove();\n    this.#badge = null;\n  }\n\n  async #setState() {\n    const button = this.#altTextButton;\n    if (!button) {\n      return;\n    }\n\n    if (this.#useNewAltTextFlow) {\n      button.classList.toggle(\"done\", !!this.#altText);\n      button.setAttribute(\"data-l10n-id\", AltText.#l10nNewButton[this.#label]);\n\n      this.#altTextButtonLabel?.setAttribute(\n        \"data-l10n-id\",\n        AltText.#l10nNewButton[`${this.#label}-label`]\n      );\n      if (!this.#altText) {\n        this.#altTextTooltip?.remove();\n        return;\n      }\n    } else {\n      if (!this.#altText && !this.#altTextDecorative) {\n        button.classList.remove(\"done\");\n        this.#altTextTooltip?.remove();\n        return;\n      }\n      button.classList.add(\"done\");\n      button.setAttribute(\"data-l10n-id\", \"pdfjs-editor-alt-text-edit-button\");\n    }\n\n    let tooltip = this.#altTextTooltip;\n    if (!tooltip) {\n      this.#altTextTooltip = tooltip = document.createElement(\"span\");\n      tooltip.className = \"tooltip\";\n      tooltip.setAttribute(\"role\", \"tooltip\");\n      tooltip.id = `alt-text-tooltip-${this.#editor.id}`;\n\n      const DELAY_TO_SHOW_TOOLTIP = 100;\n      const signal = this.#editor._uiManager._signal;\n      signal.addEventListener(\n        \"abort\",\n        () => {\n          clearTimeout(this.#altTextTooltipTimeout);\n          this.#altTextTooltipTimeout = null;\n        },\n        { once: true }\n      );\n      button.addEventListener(\n        \"mouseenter\",\n        () => {\n          this.#altTextTooltipTimeout = setTimeout(() => {\n            this.#altTextTooltipTimeout = null;\n            this.#altTextTooltip.classList.add(\"show\");\n            this.#editor._reportTelemetry({\n              action: \"alt_text_tooltip\",\n            });\n          }, DELAY_TO_SHOW_TOOLTIP);\n        },\n        { signal }\n      );\n      button.addEventListener(\n        \"mouseleave\",\n        () => {\n          if (this.#altTextTooltipTimeout) {\n            clearTimeout(this.#altTextTooltipTimeout);\n            this.#altTextTooltipTimeout = null;\n          }\n          this.#altTextTooltip?.classList.remove(\"show\");\n        },\n        { signal }\n      );\n    }\n    if (this.#altTextDecorative) {\n      tooltip.setAttribute(\n        \"data-l10n-id\",\n        \"pdfjs-editor-alt-text-decorative-tooltip\"\n      );\n    } else {\n      tooltip.removeAttribute(\"data-l10n-id\");\n      tooltip.textContent = this.#altText;\n    }\n\n    if (!tooltip.parentNode) {\n      button.append(tooltip);\n    }\n\n    const element = this.#editor.getElementForAltText();\n    element?.setAttribute(\"aria-describedby\", tooltip.id);\n  }\n}\n\nexport { AltText };\n","/* Copyright 2024 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { OutputScale, stopEvent } from \"./display_utils.js\";\n\nclass TouchManager {\n  #container;\n\n  #isPinching = false;\n\n  #isPinchingStopped = null;\n\n  #isPinchingDisabled;\n\n  #onPinchStart;\n\n  #onPinching;\n\n  #onPinchEnd;\n\n  #pointerDownAC = null;\n\n  #signal;\n\n  #touchInfo = null;\n\n  #touchManagerAC;\n\n  #touchMoveAC = null;\n\n  constructor({\n    container,\n    isPinchingDisabled = null,\n    isPinchingStopped = null,\n    onPinchStart = null,\n    onPinching = null,\n    onPinchEnd = null,\n    signal,\n  }) {\n    this.#container = container;\n    this.#isPinchingStopped = isPinchingStopped;\n    this.#isPinchingDisabled = isPinchingDisabled;\n    this.#onPinchStart = onPinchStart;\n    this.#onPinching = onPinching;\n    this.#onPinchEnd = onPinchEnd;\n    this.#touchManagerAC = new AbortController();\n    this.#signal = AbortSignal.any([signal, this.#touchManagerAC.signal]);\n\n    container.addEventListener(\"touchstart\", this.#onTouchStart.bind(this), {\n      passive: false,\n      signal: this.#signal,\n    });\n  }\n\n  /**\n   * NOTE: Don't shadow this value since `devicePixelRatio` may change if the\n   * window resolution changes, e.g. if the viewer is moved to another monitor.\n   */\n  get MIN_TOUCH_DISTANCE_TO_PINCH() {\n    // The 35 is coming from:\n    //  https://searchfox.org/mozilla-central/source/gfx/layers/apz/src/GestureEventListener.cpp#36\n    //\n    // The properties TouchEvent::screenX/Y are in screen CSS pixels:\n    //  https://developer.mozilla.org/en-US/docs/Web/API/Touch/screenX#examples\n    // MIN_TOUCH_DISTANCE_TO_PINCH is in CSS pixels.\n    return 35 / OutputScale.pixelRatio;\n  }\n\n  #onTouchStart(evt) {\n    if (this.#isPinchingDisabled?.()) {\n      return;\n    }\n\n    if (evt.touches.length === 1) {\n      if (this.#pointerDownAC) {\n        return;\n      }\n      const pointerDownAC = (this.#pointerDownAC = new AbortController());\n      const signal = AbortSignal.any([this.#signal, pointerDownAC.signal]);\n      const container = this.#container;\n\n      // We want to have the events at the capture phase to make sure we can\n      // cancel them.\n      const opts = { capture: true, signal, passive: false };\n      const cancelPointerDown = e => {\n        if (e.pointerType === \"touch\") {\n          this.#pointerDownAC?.abort();\n          this.#pointerDownAC = null;\n        }\n      };\n      container.addEventListener(\n        \"pointerdown\",\n        e => {\n          if (e.pointerType === \"touch\") {\n            // This is the second finger so we don't want it select something\n            // or whatever.\n            stopEvent(e);\n            cancelPointerDown(e);\n          }\n        },\n        opts\n      );\n      container.addEventListener(\"pointerup\", cancelPointerDown, opts);\n      container.addEventListener(\"pointercancel\", cancelPointerDown, opts);\n      return;\n    }\n\n    if (!this.#touchMoveAC) {\n      this.#touchMoveAC = new AbortController();\n      const signal = AbortSignal.any([this.#signal, this.#touchMoveAC.signal]);\n      const container = this.#container;\n\n      const opt = { signal, capture: false, passive: false };\n      container.addEventListener(\n        \"touchmove\",\n        this.#onTouchMove.bind(this),\n        opt\n      );\n      const onTouchEnd = this.#onTouchEnd.bind(this);\n      container.addEventListener(\"touchend\", onTouchEnd, opt);\n      container.addEventListener(\"touchcancel\", onTouchEnd, opt);\n\n      opt.capture = true;\n      container.addEventListener(\"pointerdown\", stopEvent, opt);\n      container.addEventListener(\"pointermove\", stopEvent, opt);\n      container.addEventListener(\"pointercancel\", stopEvent, opt);\n      container.addEventListener(\"pointerup\", stopEvent, opt);\n      this.#onPinchStart?.();\n    }\n\n    stopEvent(evt);\n\n    if (evt.touches.length !== 2 || this.#isPinchingStopped?.()) {\n      this.#touchInfo = null;\n      return;\n    }\n\n    let [touch0, touch1] = evt.touches;\n    if (touch0.identifier > touch1.identifier) {\n      [touch0, touch1] = [touch1, touch0];\n    }\n    this.#touchInfo = {\n      touch0X: touch0.screenX,\n      touch0Y: touch0.screenY,\n      touch1X: touch1.screenX,\n      touch1Y: touch1.screenY,\n    };\n  }\n\n  #onTouchMove(evt) {\n    if (!this.#touchInfo || evt.touches.length !== 2) {\n      return;\n    }\n\n    stopEvent(evt);\n\n    let [touch0, touch1] = evt.touches;\n    if (touch0.identifier > touch1.identifier) {\n      [touch0, touch1] = [touch1, touch0];\n    }\n    const { screenX: screen0X, screenY: screen0Y } = touch0;\n    const { screenX: screen1X, screenY: screen1Y } = touch1;\n    const touchInfo = this.#touchInfo;\n    const {\n      touch0X: pTouch0X,\n      touch0Y: pTouch0Y,\n      touch1X: pTouch1X,\n      touch1Y: pTouch1Y,\n    } = touchInfo;\n\n    const prevGapX = pTouch1X - pTouch0X;\n    const prevGapY = pTouch1Y - pTouch0Y;\n    const currGapX = screen1X - screen0X;\n    const currGapY = screen1Y - screen0Y;\n\n    const distance = Math.hypot(currGapX, currGapY) || 1;\n    const pDistance = Math.hypot(prevGapX, prevGapY) || 1;\n    if (\n      !this.#isPinching &&\n      Math.abs(pDistance - distance) <= TouchManager.MIN_TOUCH_DISTANCE_TO_PINCH\n    ) {\n      return;\n    }\n\n    touchInfo.touch0X = screen0X;\n    touchInfo.touch0Y = screen0Y;\n    touchInfo.touch1X = screen1X;\n    touchInfo.touch1Y = screen1Y;\n\n    if (!this.#isPinching) {\n      // Start pinching.\n      this.#isPinching = true;\n\n      // We return here else the first pinch is a bit too much\n      return;\n    }\n\n    const origin = [(screen0X + screen1X) / 2, (screen0Y + screen1Y) / 2];\n    this.#onPinching?.(origin, pDistance, distance);\n  }\n\n  #onTouchEnd(evt) {\n    if (evt.touches.length >= 2) {\n      return;\n    }\n    // #touchMoveAC shouldn't be null but it seems that irl it can (see #19793).\n    if (this.#touchMoveAC) {\n      this.#touchMoveAC.abort();\n      this.#touchMoveAC = null;\n      this.#onPinchEnd?.();\n    }\n\n    if (!this.#touchInfo) {\n      return;\n    }\n    stopEvent(evt);\n    this.#touchInfo = null;\n    this.#isPinching = false;\n  }\n\n  destroy() {\n    this.#touchManagerAC?.abort();\n    this.#touchManagerAC = null;\n    this.#pointerDownAC?.abort();\n    this.#pointerDownAC = null;\n  }\n}\n\nexport { TouchManager };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_editor_layer.js\").AnnotationEditorLayer} AnnotationEditorLayer */\n\nimport {\n  AnnotationEditorUIManager,\n  bindEvents,\n  ColorManager,\n  KeyboardManager,\n} from \"./tools.js\";\nimport {\n  FeatureTest,\n  MathClamp,\n  shadow,\n  unreachable,\n} from \"../../shared/util.js\";\nimport { noContextMenu, stopEvent } from \"../display_utils.js\";\nimport { AltText } from \"./alt_text.js\";\nimport { EditorToolbar } from \"./toolbar.js\";\nimport { TouchManager } from \"../touch_manager.js\";\n\n/**\n * @typedef {Object} AnnotationEditorParameters\n * @property {AnnotationEditorUIManager} uiManager - the global manager\n * @property {AnnotationEditorLayer} parent - the layer containing this editor\n * @property {string} id - editor id\n * @property {number} x - x-coordinate\n * @property {number} y - y-coordinate\n */\n\n/**\n * Base class for editors.\n */\nclass AnnotationEditor {\n  #accessibilityData = null;\n\n  #allResizerDivs = null;\n\n  #altText = null;\n\n  #disabled = false;\n\n  #dragPointerId = null;\n\n  #dragPointerType = \"\";\n\n  #keepAspectRatio = false;\n\n  #resizersDiv = null;\n\n  #lastPointerCoords = null;\n\n  #savedDimensions = null;\n\n  #focusAC = null;\n\n  #focusedResizerName = \"\";\n\n  #hasBeenClicked = false;\n\n  #initialRect = null;\n\n  #isEditing = false;\n\n  #isInEditMode = false;\n\n  #isResizerEnabledForKeyboard = false;\n\n  #moveInDOMTimeout = null;\n\n  #prevDragX = 0;\n\n  #prevDragY = 0;\n\n  #telemetryTimeouts = null;\n\n  #touchManager = null;\n\n  isSelected = false;\n\n  _isCopy = false;\n\n  _editToolbar = null;\n\n  _initialOptions = Object.create(null);\n\n  _initialData = null;\n\n  _isVisible = true;\n\n  _uiManager = null;\n\n  _focusEventsAllowed = true;\n\n  static _l10n = null;\n\n  static _l10nResizer = null;\n\n  #isDraggable = false;\n\n  #zIndex = AnnotationEditor._zIndex++;\n\n  static _borderLineWidth = -1;\n\n  static _colorManager = new ColorManager();\n\n  static _zIndex = 1;\n\n  // Time to wait (in ms) before sending the telemetry data.\n  // We wait a bit to avoid sending too many requests when changing something\n  // like the thickness of a line.\n  static _telemetryTimeout = 1000;\n\n  static get _resizerKeyboardManager() {\n    const resize = AnnotationEditor.prototype._resizeWithKeyboard;\n    const small = AnnotationEditorUIManager.TRANSLATE_SMALL;\n    const big = AnnotationEditorUIManager.TRANSLATE_BIG;\n\n    return shadow(\n      this,\n      \"_resizerKeyboardManager\",\n      new KeyboardManager([\n        [[\"ArrowLeft\", \"mac+ArrowLeft\"], resize, { args: [-small, 0] }],\n        [\n          [\"ctrl+ArrowLeft\", \"mac+shift+ArrowLeft\"],\n          resize,\n          { args: [-big, 0] },\n        ],\n        [[\"ArrowRight\", \"mac+ArrowRight\"], resize, { args: [small, 0] }],\n        [\n          [\"ctrl+ArrowRight\", \"mac+shift+ArrowRight\"],\n          resize,\n          { args: [big, 0] },\n        ],\n        [[\"ArrowUp\", \"mac+ArrowUp\"], resize, { args: [0, -small] }],\n        [[\"ctrl+ArrowUp\", \"mac+shift+ArrowUp\"], resize, { args: [0, -big] }],\n        [[\"ArrowDown\", \"mac+ArrowDown\"], resize, { args: [0, small] }],\n        [[\"ctrl+ArrowDown\", \"mac+shift+ArrowDown\"], resize, { args: [0, big] }],\n        [\n          [\"Escape\", \"mac+Escape\"],\n          AnnotationEditor.prototype._stopResizingWithKeyboard,\n        ],\n      ])\n    );\n  }\n\n  /**\n   * @param {AnnotationEditorParameters} parameters\n   */\n  constructor(parameters) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === AnnotationEditor\n    ) {\n      unreachable(\"Cannot initialize AnnotationEditor.\");\n    }\n\n    this.parent = parameters.parent;\n    this.id = parameters.id;\n    this.width = this.height = null;\n    this.pageIndex = parameters.parent.pageIndex;\n    this.name = parameters.name;\n    this.div = null;\n    this._uiManager = parameters.uiManager;\n    this.annotationElementId = null;\n    this._willKeepAspectRatio = false;\n    this._initialOptions.isCentered = parameters.isCentered;\n    this._structTreeParentId = null;\n    this.annotationElementId = parameters.annotationElementId || null;\n\n    const {\n      rotation,\n      rawDims: { pageWidth, pageHeight, pageX, pageY },\n    } = this.parent.viewport;\n\n    this.rotation = rotation;\n    this.pageRotation =\n      (360 + rotation - this._uiManager.viewParameters.rotation) % 360;\n    this.pageDimensions = [pageWidth, pageHeight];\n    this.pageTranslation = [pageX, pageY];\n\n    const [width, height] = this.parentDimensions;\n    this.x = parameters.x / width;\n    this.y = parameters.y / height;\n\n    this.isAttachedToDOM = false;\n    this.deleted = false;\n  }\n\n  get editorType() {\n    return Object.getPrototypeOf(this).constructor._type;\n  }\n\n  get mode() {\n    return Object.getPrototypeOf(this).constructor._editorType;\n  }\n\n  static get isDrawer() {\n    return false;\n  }\n\n  static get _defaultLineColor() {\n    return shadow(\n      this,\n      \"_defaultLineColor\",\n      this._colorManager.getHexCode(\"CanvasText\")\n    );\n  }\n\n  static deleteAnnotationElement(editor) {\n    const fakeEditor = new FakeEditor({\n      id: editor.parent.getNextId(),\n      parent: editor.parent,\n      uiManager: editor._uiManager,\n    });\n    fakeEditor.annotationElementId = editor.annotationElementId;\n    fakeEditor.deleted = true;\n    fakeEditor._uiManager.addToAnnotationStorage(fakeEditor);\n  }\n\n  /**\n   * Initialize the l10n stuff for this type of editor.\n   * @param {Object} l10n\n   */\n  static initialize(l10n, _uiManager) {\n    AnnotationEditor._l10n ??= l10n;\n\n    AnnotationEditor._l10nResizer ||= Object.freeze({\n      topLeft: \"pdfjs-editor-resizer-top-left\",\n      topMiddle: \"pdfjs-editor-resizer-top-middle\",\n      topRight: \"pdfjs-editor-resizer-top-right\",\n      middleRight: \"pdfjs-editor-resizer-middle-right\",\n      bottomRight: \"pdfjs-editor-resizer-bottom-right\",\n      bottomMiddle: \"pdfjs-editor-resizer-bottom-middle\",\n      bottomLeft: \"pdfjs-editor-resizer-bottom-left\",\n      middleLeft: \"pdfjs-editor-resizer-middle-left\",\n    });\n\n    if (AnnotationEditor._borderLineWidth !== -1) {\n      return;\n    }\n    const style = getComputedStyle(document.documentElement);\n    AnnotationEditor._borderLineWidth =\n      parseFloat(style.getPropertyValue(\"--outline-width\")) || 0;\n  }\n\n  /**\n   * Update the default parameters for this type of editor.\n   * @param {number} _type\n   * @param {*} _value\n   */\n  static updateDefaultParams(_type, _value) {}\n\n  /**\n   * Get the default properties to set in the UI for this type of editor.\n   * @returns {Array}\n   */\n  static get defaultPropertiesToUpdate() {\n    return [];\n  }\n\n  /**\n   * Check if this kind of editor is able to handle the given mime type for\n   * pasting.\n   * @param {string} mime\n   * @returns {boolean}\n   */\n  static isHandlingMimeForPasting(mime) {\n    return false;\n  }\n\n  /**\n   * Extract the data from the clipboard item and delegate the creation of the\n   * editor to the parent.\n   * @param {DataTransferItem} item\n   * @param {AnnotationEditorLayer} parent\n   */\n  static paste(item, parent) {\n    unreachable(\"Not implemented\");\n  }\n\n  /**\n   * Get the properties to update in the UI for this editor.\n   * @returns {Array}\n   */\n  get propertiesToUpdate() {\n    return [];\n  }\n\n  get _isDraggable() {\n    return this.#isDraggable;\n  }\n\n  set _isDraggable(value) {\n    this.#isDraggable = value;\n    this.div?.classList.toggle(\"draggable\", value);\n  }\n\n  /**\n   * @returns {boolean} true if the editor handles the Enter key itself.\n   */\n  get isEnterHandled() {\n    return true;\n  }\n\n  center() {\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    switch (this.parentRotation) {\n      case 90:\n        this.x -= (this.height * pageHeight) / (pageWidth * 2);\n        this.y += (this.width * pageWidth) / (pageHeight * 2);\n        break;\n      case 180:\n        this.x += this.width / 2;\n        this.y += this.height / 2;\n        break;\n      case 270:\n        this.x += (this.height * pageHeight) / (pageWidth * 2);\n        this.y -= (this.width * pageWidth) / (pageHeight * 2);\n        break;\n      default:\n        this.x -= this.width / 2;\n        this.y -= this.height / 2;\n        break;\n    }\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Add some commands into the CommandManager (undo/redo stuff).\n   * @param {Object} params\n   */\n  addCommands(params) {\n    this._uiManager.addCommands(params);\n  }\n\n  get currentLayer() {\n    return this._uiManager.currentLayer;\n  }\n\n  /**\n   * This editor will be behind the others.\n   */\n  setInBackground() {\n    this.div.style.zIndex = 0;\n  }\n\n  /**\n   * This editor will be in the foreground.\n   */\n  setInForeground() {\n    this.div.style.zIndex = this.#zIndex;\n  }\n\n  setParent(parent) {\n    if (parent !== null) {\n      this.pageIndex = parent.pageIndex;\n      this.pageDimensions = parent.pageDimensions;\n    } else {\n      // The editor is being removed from the DOM, so we need to stop resizing.\n      this.#stopResizing();\n    }\n    this.parent = parent;\n  }\n\n  /**\n   * onfocus callback.\n   */\n  focusin(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n    if (!this.#hasBeenClicked) {\n      this.parent.setSelected(this);\n    } else {\n      this.#hasBeenClicked = false;\n    }\n  }\n\n  /**\n   * onblur callback.\n   * @param {FocusEvent} event\n   */\n  focusout(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n\n    if (!this.isAttachedToDOM) {\n      return;\n    }\n\n    // In case of focusout, the relatedTarget is the element which\n    // is grabbing the focus.\n    // So if the related target is an element under the div for this\n    // editor, then the editor isn't unactive.\n    const target = event.relatedTarget;\n    if (target?.closest(`#${this.id}`)) {\n      return;\n    }\n\n    event.preventDefault();\n\n    if (!this.parent?.isMultipleSelection) {\n      this.commitOrRemove();\n    }\n  }\n\n  commitOrRemove() {\n    if (this.isEmpty()) {\n      this.remove();\n    } else {\n      this.commit();\n    }\n  }\n\n  /**\n   * Commit the data contained in this editor.\n   */\n  commit() {\n    if (!this.isInEditMode()) {\n      return;\n    }\n    this.addToAnnotationStorage();\n  }\n\n  addToAnnotationStorage() {\n    this._uiManager.addToAnnotationStorage(this);\n  }\n\n  /**\n   * Set the editor position within its parent.\n   * @param {number} x\n   * @param {number} y\n   * @param {number} tx - x-translation in screen coordinates.\n   * @param {number} ty - y-translation in screen coordinates.\n   */\n  setAt(x, y, tx, ty) {\n    const [width, height] = this.parentDimensions;\n    [tx, ty] = this.screenToPageTranslation(tx, ty);\n\n    this.x = (x + tx) / width;\n    this.y = (y + ty) / height;\n\n    this.fixAndSetPosition();\n  }\n\n  _moveAfterPaste(baseX, baseY) {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.setAt(\n      baseX * parentWidth,\n      baseY * parentHeight,\n      this.width * parentWidth,\n      this.height * parentHeight\n    );\n    this._onTranslated();\n  }\n\n  #translate([width, height], x, y) {\n    [x, y] = this.screenToPageTranslation(x, y);\n\n    this.x += x / width;\n    this.y += y / height;\n\n    this._onTranslating(this.x, this.y);\n\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Translate the editor position within its parent.\n   * @param {number} x - x-translation in screen coordinates.\n   * @param {number} y - y-translation in screen coordinates.\n   */\n  translate(x, y) {\n    // We don't change the initial position because the move here hasn't been\n    // done by the user.\n    this.#translate(this.parentDimensions, x, y);\n  }\n\n  /**\n   * Translate the editor position within its page and adjust the scroll\n   * in order to have the editor in the view.\n   * @param {number} x - x-translation in page coordinates.\n   * @param {number} y - y-translation in page coordinates.\n   */\n  translateInPage(x, y) {\n    this.#initialRect ||= [this.x, this.y, this.width, this.height];\n    this.#translate(this.pageDimensions, x, y);\n    this.div.scrollIntoView({ block: \"nearest\" });\n  }\n\n  translationDone() {\n    this._onTranslated(this.x, this.y);\n  }\n\n  drag(tx, ty) {\n    this.#initialRect ||= [this.x, this.y, this.width, this.height];\n    const {\n      div,\n      parentDimensions: [parentWidth, parentHeight],\n    } = this;\n    this.x += tx / parentWidth;\n    this.y += ty / parentHeight;\n    if (this.parent && (this.x < 0 || this.x > 1 || this.y < 0 || this.y > 1)) {\n      // It's possible to not have a parent: for example, when the user is\n      // dragging all the selected editors but this one on a page which has been\n      // destroyed.\n      // It's why we need to check for it. In such a situation, it isn't really\n      // a problem to not find a new parent: it's something which is related to\n      // what the user is seeing, hence it depends on how pages are layed out.\n\n      // The element will be outside of its parent so change the parent.\n      const { x, y } = this.div.getBoundingClientRect();\n      if (this.parent.findNewParent(this, x, y)) {\n        this.x -= Math.floor(this.x);\n        this.y -= Math.floor(this.y);\n      }\n    }\n\n    // The editor can be moved wherever the user wants, so we don't need to fix\n    // the position: it'll be done when the user will release the mouse button.\n\n    let { x, y } = this;\n    const [bx, by] = this.getBaseTranslation();\n    x += bx;\n    y += by;\n\n    const { style } = div;\n    style.left = `${(100 * x).toFixed(2)}%`;\n    style.top = `${(100 * y).toFixed(2)}%`;\n\n    this._onTranslating(x, y);\n\n    div.scrollIntoView({ block: \"nearest\" });\n  }\n\n  /**\n   * Called when the editor is being translated.\n   * @param {number} x - in page coordinates.\n   * @param {number} y - in page coordinates.\n   */\n  _onTranslating(x, y) {}\n\n  /**\n   * Called when the editor has been translated.\n   * @param {number} x - in page coordinates.\n   * @param {number} y - in page coordinates.\n   */\n  _onTranslated(x, y) {}\n\n  get _hasBeenMoved() {\n    return (\n      !!this.#initialRect &&\n      (this.#initialRect[0] !== this.x || this.#initialRect[1] !== this.y)\n    );\n  }\n\n  get _hasBeenResized() {\n    return (\n      !!this.#initialRect &&\n      (this.#initialRect[2] !== this.width ||\n        this.#initialRect[3] !== this.height)\n    );\n  }\n\n  /**\n   * Get the translation to take into account the editor border.\n   * The CSS engine positions the element by taking the border into account so\n   * we must apply the opposite translation to have the editor in the right\n   * position.\n   * @returns {Array<number>}\n   */\n  getBaseTranslation() {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const { _borderLineWidth } = AnnotationEditor;\n    const x = _borderLineWidth / parentWidth;\n    const y = _borderLineWidth / parentHeight;\n    switch (this.rotation) {\n      case 90:\n        return [-x, y];\n      case 180:\n        return [x, y];\n      case 270:\n        return [x, -y];\n      default:\n        return [-x, -y];\n    }\n  }\n\n  /**\n   * @returns {boolean} true if position must be fixed (i.e. make the x and y\n   * living in the page).\n   */\n  get _mustFixPosition() {\n    return true;\n  }\n\n  /**\n   * Fix the position of the editor in order to keep it inside its parent page.\n   * @param {number} [rotation] - the rotation of the page.\n   */\n  fixAndSetPosition(rotation = this.rotation) {\n    const {\n      div: { style },\n      pageDimensions: [pageWidth, pageHeight],\n    } = this;\n    let { x, y, width, height } = this;\n    width *= pageWidth;\n    height *= pageHeight;\n    x *= pageWidth;\n    y *= pageHeight;\n\n    if (this._mustFixPosition) {\n      switch (rotation) {\n        case 0:\n          x = MathClamp(x, 0, pageWidth - width);\n          y = MathClamp(y, 0, pageHeight - height);\n          break;\n        case 90:\n          x = MathClamp(x, 0, pageWidth - height);\n          y = MathClamp(y, width, pageHeight);\n          break;\n        case 180:\n          x = MathClamp(x, width, pageWidth);\n          y = MathClamp(y, height, pageHeight);\n          break;\n        case 270:\n          x = MathClamp(x, height, pageWidth);\n          y = MathClamp(y, 0, pageHeight - width);\n          break;\n      }\n    }\n\n    this.x = x /= pageWidth;\n    this.y = y /= pageHeight;\n\n    const [bx, by] = this.getBaseTranslation();\n    x += bx;\n    y += by;\n\n    style.left = `${(100 * x).toFixed(2)}%`;\n    style.top = `${(100 * y).toFixed(2)}%`;\n\n    this.moveInDOM();\n  }\n\n  static #rotatePoint(x, y, angle) {\n    switch (angle) {\n      case 90:\n        return [y, -x];\n      case 180:\n        return [-x, -y];\n      case 270:\n        return [-y, x];\n      default:\n        return [x, y];\n    }\n  }\n\n  /**\n   * Convert a screen translation into a page one.\n   * @param {number} x\n   * @param {number} y\n   */\n  screenToPageTranslation(x, y) {\n    return AnnotationEditor.#rotatePoint(x, y, this.parentRotation);\n  }\n\n  /**\n   * Convert a page translation into a screen one.\n   * @param {number} x\n   * @param {number} y\n   */\n  pageTranslationToScreen(x, y) {\n    return AnnotationEditor.#rotatePoint(x, y, 360 - this.parentRotation);\n  }\n\n  #getRotationMatrix(rotation) {\n    switch (rotation) {\n      case 90: {\n        const [pageWidth, pageHeight] = this.pageDimensions;\n        return [0, -pageWidth / pageHeight, pageHeight / pageWidth, 0];\n      }\n      case 180:\n        return [-1, 0, 0, -1];\n      case 270: {\n        const [pageWidth, pageHeight] = this.pageDimensions;\n        return [0, pageWidth / pageHeight, -pageHeight / pageWidth, 0];\n      }\n      default:\n        return [1, 0, 0, 1];\n    }\n  }\n\n  get parentScale() {\n    return this._uiManager.viewParameters.realScale;\n  }\n\n  get parentRotation() {\n    return (this._uiManager.viewParameters.rotation + this.pageRotation) % 360;\n  }\n\n  get parentDimensions() {\n    const {\n      parentScale,\n      pageDimensions: [pageWidth, pageHeight],\n    } = this;\n    return [pageWidth * parentScale, pageHeight * parentScale];\n  }\n\n  /**\n   * Set the dimensions of this editor.\n   * @param {number} width\n   * @param {number} height\n   */\n  setDims(width, height) {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const { style } = this.div;\n    style.width = `${((100 * width) / parentWidth).toFixed(2)}%`;\n    if (!this.#keepAspectRatio) {\n      style.height = `${((100 * height) / parentHeight).toFixed(2)}%`;\n    }\n  }\n\n  fixDims() {\n    const { style } = this.div;\n    const { height, width } = style;\n    const widthPercent = width.endsWith(\"%\");\n    const heightPercent = !this.#keepAspectRatio && height.endsWith(\"%\");\n    if (widthPercent && heightPercent) {\n      return;\n    }\n\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    if (!widthPercent) {\n      style.width = `${((100 * parseFloat(width)) / parentWidth).toFixed(2)}%`;\n    }\n    if (!this.#keepAspectRatio && !heightPercent) {\n      style.height = `${((100 * parseFloat(height)) / parentHeight).toFixed(2)}%`;\n    }\n  }\n\n  /**\n   * Get the translation used to position this editor when it's created.\n   * @returns {Array<number>}\n   */\n  getInitialTranslation() {\n    return [0, 0];\n  }\n\n  #createResizers() {\n    if (this.#resizersDiv) {\n      return;\n    }\n    this.#resizersDiv = document.createElement(\"div\");\n    this.#resizersDiv.classList.add(\"resizers\");\n    // When the resizers are used with the keyboard, they're focusable, hence\n    // we want to have them in this order (top left, top middle, top right, ...)\n    // in the DOM to have the focus order correct.\n    const classes = this._willKeepAspectRatio\n      ? [\"topLeft\", \"topRight\", \"bottomRight\", \"bottomLeft\"]\n      : [\n          \"topLeft\",\n          \"topMiddle\",\n          \"topRight\",\n          \"middleRight\",\n          \"bottomRight\",\n          \"bottomMiddle\",\n          \"bottomLeft\",\n          \"middleLeft\",\n        ];\n    const signal = this._uiManager._signal;\n    for (const name of classes) {\n      const div = document.createElement(\"div\");\n      this.#resizersDiv.append(div);\n      div.classList.add(\"resizer\", name);\n      div.setAttribute(\"data-resizer-name\", name);\n      div.addEventListener(\n        \"pointerdown\",\n        this.#resizerPointerdown.bind(this, name),\n        { signal }\n      );\n      div.addEventListener(\"contextmenu\", noContextMenu, { signal });\n      div.tabIndex = -1;\n    }\n    this.div.prepend(this.#resizersDiv);\n  }\n\n  #resizerPointerdown(name, event) {\n    event.preventDefault();\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      return;\n    }\n\n    this.#altText?.toggle(false);\n\n    const savedDraggable = this._isDraggable;\n    this._isDraggable = false;\n    this.#lastPointerCoords = [event.screenX, event.screenY];\n\n    const ac = new AbortController();\n    const signal = this._uiManager.combinedSignal(ac);\n\n    this.parent.togglePointerEvents(false);\n    window.addEventListener(\n      \"pointermove\",\n      this.#resizerPointermove.bind(this, name),\n      { passive: true, capture: true, signal }\n    );\n    window.addEventListener(\n      \"touchmove\",\n      stopEvent /* Prevent the page from scrolling */,\n      { passive: false, signal }\n    );\n    window.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    this.#savedDimensions = {\n      savedX: this.x,\n      savedY: this.y,\n      savedWidth: this.width,\n      savedHeight: this.height,\n    };\n    const savedParentCursor = this.parent.div.style.cursor;\n    const savedCursor = this.div.style.cursor;\n    this.div.style.cursor = this.parent.div.style.cursor =\n      window.getComputedStyle(event.target).cursor;\n\n    const pointerUpCallback = () => {\n      ac.abort();\n      this.parent.togglePointerEvents(true);\n      this.#altText?.toggle(true);\n      this._isDraggable = savedDraggable;\n      this.parent.div.style.cursor = savedParentCursor;\n      this.div.style.cursor = savedCursor;\n\n      this.#addResizeToUndoStack();\n    };\n    window.addEventListener(\"pointerup\", pointerUpCallback, { signal });\n    // If the user switches to another window (with alt+tab), then we end the\n    // resize session.\n    window.addEventListener(\"blur\", pointerUpCallback, { signal });\n  }\n\n  #resize(x, y, width, height) {\n    this.width = width;\n    this.height = height;\n    this.x = x;\n    this.y = y;\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.setDims(parentWidth * width, parentHeight * height);\n    this.fixAndSetPosition();\n    this._onResized();\n  }\n\n  /**\n   * Called when the editor has been resized.\n   */\n  _onResized() {}\n\n  #addResizeToUndoStack() {\n    if (!this.#savedDimensions) {\n      return;\n    }\n    const { savedX, savedY, savedWidth, savedHeight } = this.#savedDimensions;\n    this.#savedDimensions = null;\n\n    const newX = this.x;\n    const newY = this.y;\n    const newWidth = this.width;\n    const newHeight = this.height;\n    if (\n      newX === savedX &&\n      newY === savedY &&\n      newWidth === savedWidth &&\n      newHeight === savedHeight\n    ) {\n      return;\n    }\n\n    this.addCommands({\n      cmd: this.#resize.bind(this, newX, newY, newWidth, newHeight),\n      undo: this.#resize.bind(this, savedX, savedY, savedWidth, savedHeight),\n      mustExec: true,\n    });\n  }\n\n  static _round(x) {\n    // 10000 because we multiply by 100 and use toFixed(2) in fixAndSetPosition.\n    // Without rounding, the positions of the corners other than the top left\n    // one can be slightly wrong.\n    return Math.round(x * 10000) / 10000;\n  }\n\n  #resizerPointermove(name, event) {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const savedX = this.x;\n    const savedY = this.y;\n    const savedWidth = this.width;\n    const savedHeight = this.height;\n    const minWidth = AnnotationEditor.MIN_SIZE / parentWidth;\n    const minHeight = AnnotationEditor.MIN_SIZE / parentHeight;\n\n    const rotationMatrix = this.#getRotationMatrix(this.rotation);\n    const transf = (x, y) => [\n      rotationMatrix[0] * x + rotationMatrix[2] * y,\n      rotationMatrix[1] * x + rotationMatrix[3] * y,\n    ];\n    const invRotationMatrix = this.#getRotationMatrix(360 - this.rotation);\n    const invTransf = (x, y) => [\n      invRotationMatrix[0] * x + invRotationMatrix[2] * y,\n      invRotationMatrix[1] * x + invRotationMatrix[3] * y,\n    ];\n    let getPoint;\n    let getOpposite;\n    let isDiagonal = false;\n    let isHorizontal = false;\n\n    switch (name) {\n      case \"topLeft\":\n        isDiagonal = true;\n        getPoint = (w, h) => [0, 0];\n        getOpposite = (w, h) => [w, h];\n        break;\n      case \"topMiddle\":\n        getPoint = (w, h) => [w / 2, 0];\n        getOpposite = (w, h) => [w / 2, h];\n        break;\n      case \"topRight\":\n        isDiagonal = true;\n        getPoint = (w, h) => [w, 0];\n        getOpposite = (w, h) => [0, h];\n        break;\n      case \"middleRight\":\n        isHorizontal = true;\n        getPoint = (w, h) => [w, h / 2];\n        getOpposite = (w, h) => [0, h / 2];\n        break;\n      case \"bottomRight\":\n        isDiagonal = true;\n        getPoint = (w, h) => [w, h];\n        getOpposite = (w, h) => [0, 0];\n        break;\n      case \"bottomMiddle\":\n        getPoint = (w, h) => [w / 2, h];\n        getOpposite = (w, h) => [w / 2, 0];\n        break;\n      case \"bottomLeft\":\n        isDiagonal = true;\n        getPoint = (w, h) => [0, h];\n        getOpposite = (w, h) => [w, 0];\n        break;\n      case \"middleLeft\":\n        isHorizontal = true;\n        getPoint = (w, h) => [0, h / 2];\n        getOpposite = (w, h) => [w, h / 2];\n        break;\n    }\n\n    const point = getPoint(savedWidth, savedHeight);\n    const oppositePoint = getOpposite(savedWidth, savedHeight);\n    let transfOppositePoint = transf(...oppositePoint);\n    const oppositeX = AnnotationEditor._round(savedX + transfOppositePoint[0]);\n    const oppositeY = AnnotationEditor._round(savedY + transfOppositePoint[1]);\n    let ratioX = 1;\n    let ratioY = 1;\n\n    let deltaX, deltaY;\n\n    if (!event.fromKeyboard) {\n      // We can't use event.movementX/Y because they're not reliable:\n      //  https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/movementX\n      // (it was buggy on a laptop with a touch screen).\n      const { screenX, screenY } = event;\n      const [lastScreenX, lastScreenY] = this.#lastPointerCoords;\n      [deltaX, deltaY] = this.screenToPageTranslation(\n        screenX - lastScreenX,\n        screenY - lastScreenY\n      );\n      this.#lastPointerCoords[0] = screenX;\n      this.#lastPointerCoords[1] = screenY;\n    } else {\n      ({ deltaX, deltaY } = event);\n    }\n    [deltaX, deltaY] = invTransf(deltaX / parentWidth, deltaY / parentHeight);\n\n    if (isDiagonal) {\n      const oldDiag = Math.hypot(savedWidth, savedHeight);\n      ratioX = ratioY = Math.max(\n        Math.min(\n          Math.hypot(\n            oppositePoint[0] - point[0] - deltaX,\n            oppositePoint[1] - point[1] - deltaY\n          ) / oldDiag,\n          // Avoid the editor to be larger than the page.\n          1 / savedWidth,\n          1 / savedHeight\n        ),\n        // Avoid the editor to be smaller than the minimum size.\n        minWidth / savedWidth,\n        minHeight / savedHeight\n      );\n    } else if (isHorizontal) {\n      ratioX =\n        MathClamp(Math.abs(oppositePoint[0] - point[0] - deltaX), minWidth, 1) /\n        savedWidth;\n    } else {\n      ratioY =\n        MathClamp(\n          Math.abs(oppositePoint[1] - point[1] - deltaY),\n          minHeight,\n          1\n        ) / savedHeight;\n    }\n\n    const newWidth = AnnotationEditor._round(savedWidth * ratioX);\n    const newHeight = AnnotationEditor._round(savedHeight * ratioY);\n    transfOppositePoint = transf(...getOpposite(newWidth, newHeight));\n    const newX = oppositeX - transfOppositePoint[0];\n    const newY = oppositeY - transfOppositePoint[1];\n\n    this.#initialRect ||= [this.x, this.y, this.width, this.height];\n    this.width = newWidth;\n    this.height = newHeight;\n    this.x = newX;\n    this.y = newY;\n\n    this.setDims(parentWidth * newWidth, parentHeight * newHeight);\n    this.fixAndSetPosition();\n\n    this._onResizing();\n  }\n\n  /**\n   * Called when the editor is being resized.\n   */\n  _onResizing() {}\n\n  /**\n   * Called when the alt text dialog is closed.\n   */\n  altTextFinish() {\n    this.#altText?.finish();\n  }\n\n  /**\n   * Get the toolbar buttons for this editor.\n   * @returns {Array<Array<string|object>>|null}\n   */\n  get toolbarButtons() {\n    return null;\n  }\n\n  /**\n   * Add a toolbar for this editor.\n   * @returns {Promise<EditorToolbar|null>}\n   */\n  async addEditToolbar() {\n    if (this._editToolbar || this.#isInEditMode) {\n      return this._editToolbar;\n    }\n    this._editToolbar = new EditorToolbar(this);\n    this.div.append(this._editToolbar.render());\n    const { toolbarButtons } = this;\n    if (toolbarButtons) {\n      for (const [name, tool] of toolbarButtons) {\n        await this._editToolbar.addButton(name, tool);\n      }\n    }\n    this._editToolbar.addButton(\"delete\");\n\n    return this._editToolbar;\n  }\n\n  removeEditToolbar() {\n    if (!this._editToolbar) {\n      return;\n    }\n    this._editToolbar.remove();\n    this._editToolbar = null;\n\n    // We destroy the alt text but we don't null it because we want to be able\n    // to restore it in case the user undoes the deletion.\n    this.#altText?.destroy();\n  }\n\n  addContainer(container) {\n    const editToolbarDiv = this._editToolbar?.div;\n    if (editToolbarDiv) {\n      editToolbarDiv.before(container);\n    } else {\n      this.div.append(container);\n    }\n  }\n\n  getClientDimensions() {\n    return this.div.getBoundingClientRect();\n  }\n\n  /**\n   * Create the alt text for this editor.\n   * @returns {object}\n   */\n  createAltText() {\n    if (!this.#altText) {\n      AltText.initialize(AnnotationEditor._l10n);\n      this.#altText = new AltText(this);\n      if (this.#accessibilityData) {\n        this.#altText.data = this.#accessibilityData;\n        this.#accessibilityData = null;\n      }\n    }\n    return this.#altText;\n  }\n\n  get altTextData() {\n    return this.#altText?.data;\n  }\n\n  /**\n   * Set the alt text data.\n   */\n  set altTextData(data) {\n    if (!this.#altText) {\n      return;\n    }\n    this.#altText.data = data;\n  }\n\n  get guessedAltText() {\n    return this.#altText?.guessedText;\n  }\n\n  async setGuessedAltText(text) {\n    await this.#altText?.setGuessedText(text);\n  }\n\n  serializeAltText(isForCopying) {\n    return this.#altText?.serialize(isForCopying);\n  }\n\n  hasAltText() {\n    return !!this.#altText && !this.#altText.isEmpty();\n  }\n\n  hasAltTextData() {\n    return this.#altText?.hasData() ?? false;\n  }\n\n  /**\n   * Render this editor in a div.\n   * @returns {HTMLDivElement | null}\n   */\n  render() {\n    const div = (this.div = document.createElement(\"div\"));\n    div.setAttribute(\"data-editor-rotation\", (360 - this.rotation) % 360);\n    div.className = this.name;\n    div.setAttribute(\"id\", this.id);\n    div.tabIndex = this.#disabled ? -1 : 0;\n    div.setAttribute(\"role\", \"application\");\n    if (this.defaultL10nId) {\n      div.setAttribute(\"data-l10n-id\", this.defaultL10nId);\n    }\n    if (!this._isVisible) {\n      div.classList.add(\"hidden\");\n    }\n\n    this.setInForeground();\n    this.#addFocusListeners();\n\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    if (this.parentRotation % 180 !== 0) {\n      div.style.maxWidth = `${((100 * parentHeight) / parentWidth).toFixed(\n        2\n      )}%`;\n      div.style.maxHeight = `${((100 * parentWidth) / parentHeight).toFixed(\n        2\n      )}%`;\n    }\n\n    const [tx, ty] = this.getInitialTranslation();\n    this.translate(tx, ty);\n\n    bindEvents(this, div, [\"keydown\", \"pointerdown\", \"dblclick\"]);\n\n    if (this.isResizable && this._uiManager._supportsPinchToZoom) {\n      this.#touchManager ||= new TouchManager({\n        container: div,\n        isPinchingDisabled: () => !this.isSelected,\n        onPinchStart: this.#touchPinchStartCallback.bind(this),\n        onPinching: this.#touchPinchCallback.bind(this),\n        onPinchEnd: this.#touchPinchEndCallback.bind(this),\n        signal: this._uiManager._signal,\n      });\n    }\n\n    this._uiManager._editorUndoBar?.hide();\n\n    return div;\n  }\n\n  #touchPinchStartCallback() {\n    this.#savedDimensions = {\n      savedX: this.x,\n      savedY: this.y,\n      savedWidth: this.width,\n      savedHeight: this.height,\n    };\n    this.#altText?.toggle(false);\n    this.parent.togglePointerEvents(false);\n  }\n\n  #touchPinchCallback(_origin, prevDistance, distance) {\n    // Slightly slow down the zooming because the editor could be small and the\n    // user could have difficulties to rescale it as they want.\n    const slowDownFactor = 0.7;\n    let factor =\n      slowDownFactor * (distance / prevDistance) + 1 - slowDownFactor;\n    if (factor === 1) {\n      return;\n    }\n\n    const rotationMatrix = this.#getRotationMatrix(this.rotation);\n    const transf = (x, y) => [\n      rotationMatrix[0] * x + rotationMatrix[2] * y,\n      rotationMatrix[1] * x + rotationMatrix[3] * y,\n    ];\n\n    // The center of the editor is the fixed point.\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const savedX = this.x;\n    const savedY = this.y;\n    const savedWidth = this.width;\n    const savedHeight = this.height;\n\n    const minWidth = AnnotationEditor.MIN_SIZE / parentWidth;\n    const minHeight = AnnotationEditor.MIN_SIZE / parentHeight;\n    factor = Math.max(\n      Math.min(factor, 1 / savedWidth, 1 / savedHeight),\n      minWidth / savedWidth,\n      minHeight / savedHeight\n    );\n    const newWidth = AnnotationEditor._round(savedWidth * factor);\n    const newHeight = AnnotationEditor._round(savedHeight * factor);\n    if (newWidth === savedWidth && newHeight === savedHeight) {\n      return;\n    }\n\n    this.#initialRect ||= [savedX, savedY, savedWidth, savedHeight];\n    const transfCenterPoint = transf(savedWidth / 2, savedHeight / 2);\n    const centerX = AnnotationEditor._round(savedX + transfCenterPoint[0]);\n    const centerY = AnnotationEditor._round(savedY + transfCenterPoint[1]);\n    const newTransfCenterPoint = transf(newWidth / 2, newHeight / 2);\n\n    this.x = centerX - newTransfCenterPoint[0];\n    this.y = centerY - newTransfCenterPoint[1];\n    this.width = newWidth;\n    this.height = newHeight;\n\n    this.setDims(parentWidth * newWidth, parentHeight * newHeight);\n    this.fixAndSetPosition();\n\n    this._onResizing();\n  }\n\n  #touchPinchEndCallback() {\n    this.#altText?.toggle(true);\n    this.parent.togglePointerEvents(true);\n    this.#addResizeToUndoStack();\n  }\n\n  /**\n   * Onpointerdown callback.\n   * @param {PointerEvent} event\n   */\n  pointerdown(event) {\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      // Avoid to focus this editor because of a non-left click.\n      event.preventDefault();\n      return;\n    }\n    this.#hasBeenClicked = true;\n\n    if (this._isDraggable) {\n      this.#setUpDragSession(event);\n      return;\n    }\n\n    this.#selectOnPointerEvent(event);\n  }\n\n  #selectOnPointerEvent(event) {\n    const { isMac } = FeatureTest.platform;\n    if (\n      (event.ctrlKey && !isMac) ||\n      event.shiftKey ||\n      (event.metaKey && isMac)\n    ) {\n      this.parent.toggleSelected(this);\n    } else {\n      this.parent.setSelected(this);\n    }\n  }\n\n  #setUpDragSession(event) {\n    const { isSelected } = this;\n    this._uiManager.setUpDragSession();\n    let hasDraggingStarted = false;\n\n    const ac = new AbortController();\n    const signal = this._uiManager.combinedSignal(ac);\n    const opts = { capture: true, passive: false, signal };\n    const cancelDrag = e => {\n      ac.abort();\n\n      this.#dragPointerId = null;\n      this.#hasBeenClicked = false;\n      if (!this._uiManager.endDragSession()) {\n        this.#selectOnPointerEvent(e);\n      }\n      if (hasDraggingStarted) {\n        this._onStopDragging();\n      }\n    };\n\n    if (isSelected) {\n      this.#prevDragX = event.clientX;\n      this.#prevDragY = event.clientY;\n      this.#dragPointerId = event.pointerId;\n      this.#dragPointerType = event.pointerType;\n      window.addEventListener(\n        \"pointermove\",\n        e => {\n          if (!hasDraggingStarted) {\n            hasDraggingStarted = true;\n            this._onStartDragging();\n          }\n          const { clientX: x, clientY: y, pointerId } = e;\n          if (pointerId !== this.#dragPointerId) {\n            stopEvent(e);\n            return;\n          }\n          const [tx, ty] = this.screenToPageTranslation(\n            x - this.#prevDragX,\n            y - this.#prevDragY\n          );\n          this.#prevDragX = x;\n          this.#prevDragY = y;\n          this._uiManager.dragSelectedEditors(tx, ty);\n        },\n        opts\n      );\n      window.addEventListener(\n        \"touchmove\",\n        stopEvent /* Prevent the page from scrolling */,\n        opts\n      );\n      window.addEventListener(\n        \"pointerdown\",\n        // If the user drags with one finger and then clicks with another.\n        e => {\n          if (e.pointerType === this.#dragPointerType) {\n            // We've a pinch to zoom session.\n            // We cannot have two primaries at the same time.\n            // It's possible to be in this state with Firefox and Gnome when\n            // trying to drag with three fingers (see bug 1933716).\n            if (this.#touchManager || e.isPrimary) {\n              cancelDrag(e);\n            }\n          }\n          stopEvent(e);\n        },\n        opts\n      );\n    }\n\n    const pointerUpCallback = e => {\n      if (!this.#dragPointerId || this.#dragPointerId === e.pointerId) {\n        cancelDrag(e);\n        return;\n      }\n      stopEvent(e);\n    };\n    window.addEventListener(\"pointerup\", pointerUpCallback, { signal });\n    // If the user is using alt+tab during the dragging session, the pointerup\n    // event could be not fired, but a blur event is fired so we can use it in\n    // order to interrupt the dragging session.\n    window.addEventListener(\"blur\", pointerUpCallback, { signal });\n  }\n\n  _onStartDragging() {}\n\n  _onStopDragging() {}\n\n  moveInDOM() {\n    // Moving the editor in the DOM can be expensive, so we wait a bit before.\n    // It's important to not block the UI (for example when changing the font\n    // size in a FreeText).\n    if (this.#moveInDOMTimeout) {\n      clearTimeout(this.#moveInDOMTimeout);\n    }\n    this.#moveInDOMTimeout = setTimeout(() => {\n      this.#moveInDOMTimeout = null;\n      this.parent?.moveEditorInDOM(this);\n      if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n        this._uiManager._eventBus.dispatch(\"editormovedindom\", {\n          source: this,\n        });\n      }\n    }, 0);\n  }\n\n  _setParentAndPosition(parent, x, y) {\n    parent.changeParent(this);\n    this.x = x;\n    this.y = y;\n    this.fixAndSetPosition();\n    this._onTranslated();\n  }\n\n  /**\n   * Convert the current rect into a page one.\n   * @param {number} tx - x-translation in screen coordinates.\n   * @param {number} ty - y-translation in screen coordinates.\n   * @param {number} [rotation] - the rotation of the page.\n   */\n  getRect(tx, ty, rotation = this.rotation) {\n    const scale = this.parentScale;\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    const [pageX, pageY] = this.pageTranslation;\n    const shiftX = tx / scale;\n    const shiftY = ty / scale;\n    const x = this.x * pageWidth;\n    const y = this.y * pageHeight;\n    const width = this.width * pageWidth;\n    const height = this.height * pageHeight;\n\n    switch (rotation) {\n      case 0:\n        return [\n          x + shiftX + pageX,\n          pageHeight - y - shiftY - height + pageY,\n          x + shiftX + width + pageX,\n          pageHeight - y - shiftY + pageY,\n        ];\n      case 90:\n        return [\n          x + shiftY + pageX,\n          pageHeight - y + shiftX + pageY,\n          x + shiftY + height + pageX,\n          pageHeight - y + shiftX + width + pageY,\n        ];\n      case 180:\n        return [\n          x - shiftX - width + pageX,\n          pageHeight - y + shiftY + pageY,\n          x - shiftX + pageX,\n          pageHeight - y + shiftY + height + pageY,\n        ];\n      case 270:\n        return [\n          x - shiftY - height + pageX,\n          pageHeight - y - shiftX - width + pageY,\n          x - shiftY + pageX,\n          pageHeight - y - shiftX + pageY,\n        ];\n      default:\n        throw new Error(\"Invalid rotation\");\n    }\n  }\n\n  getRectInCurrentCoords(rect, pageHeight) {\n    const [x1, y1, x2, y2] = rect;\n\n    const width = x2 - x1;\n    const height = y2 - y1;\n\n    switch (this.rotation) {\n      case 0:\n        return [x1, pageHeight - y2, width, height];\n      case 90:\n        return [x1, pageHeight - y1, height, width];\n      case 180:\n        return [x2, pageHeight - y1, width, height];\n      case 270:\n        return [x2, pageHeight - y2, height, width];\n      default:\n        throw new Error(\"Invalid rotation\");\n    }\n  }\n\n  /**\n   * Executed once this editor has been rendered.\n   * @param {boolean} focus - true if the editor should be focused.\n   */\n  onceAdded(focus) {}\n\n  /**\n   * Check if the editor contains something.\n   * @returns {boolean}\n   */\n  isEmpty() {\n    return false;\n  }\n\n  /**\n   * Enable edit mode.\n   * @returns {boolean} - true if the edit mode has been enabled.\n   */\n  enableEditMode() {\n    if (this.isInEditMode()) {\n      return false;\n    }\n    this.parent.setEditingState(false);\n    this.#isInEditMode = true;\n\n    return true;\n  }\n\n  /**\n   * Disable edit mode.\n   * @returns {boolean} - true if the edit mode has been disabled.\n   */\n  disableEditMode() {\n    if (!this.isInEditMode()) {\n      return false;\n    }\n    this.parent.setEditingState(true);\n    this.#isInEditMode = false;\n\n    return true;\n  }\n\n  /**\n   * Check if the editor is edited.\n   * @returns {boolean}\n   */\n  isInEditMode() {\n    return this.#isInEditMode;\n  }\n\n  /**\n   * If it returns true, then this editor handles the keyboard\n   * events itself.\n   * @returns {boolean}\n   */\n  shouldGetKeyboardEvents() {\n    return this.#isResizerEnabledForKeyboard;\n  }\n\n  /**\n   * Check if this editor needs to be rebuilt or not.\n   * @returns {boolean}\n   */\n  needsToBeRebuilt() {\n    return this.div && !this.isAttachedToDOM;\n  }\n\n  get isOnScreen() {\n    const { top, left, bottom, right } = this.getClientDimensions();\n    const { innerHeight, innerWidth } = window;\n    return left < innerWidth && right > 0 && top < innerHeight && bottom > 0;\n  }\n\n  #addFocusListeners() {\n    if (this.#focusAC || !this.div) {\n      return;\n    }\n    this.#focusAC = new AbortController();\n    const signal = this._uiManager.combinedSignal(this.#focusAC);\n\n    this.div.addEventListener(\"focusin\", this.focusin.bind(this), { signal });\n    this.div.addEventListener(\"focusout\", this.focusout.bind(this), { signal });\n  }\n\n  /**\n   * Rebuild the editor in case it has been removed on undo.\n   *\n   * To implement in subclasses.\n   */\n  rebuild() {\n    this.#addFocusListeners();\n  }\n\n  /**\n   * Rotate the editor when the page is rotated.\n   * @param {number} angle\n   */\n  rotate(_angle) {}\n\n  /**\n   * Resize the editor when the page is resized.\n   */\n  resize() {}\n\n  /**\n   * Serialize the editor when it has been deleted.\n   * @returns {Object}\n   */\n  serializeDeleted() {\n    return {\n      id: this.annotationElementId,\n      deleted: true,\n      pageIndex: this.pageIndex,\n      popupRef: this._initialData?.popupRef || \"\",\n    };\n  }\n\n  /**\n   * Serialize the editor.\n   * The result of the serialization will be used to construct a\n   * new annotation to add to the pdf document.\n   *\n   * To implement in subclasses.\n   * @param {boolean} [isForCopying]\n   * @param {Object | null} [context]\n   * @returns {Object | null}\n   */\n  serialize(isForCopying = false, context = null) {\n    unreachable(\"An editor must be serializable\");\n  }\n\n  /**\n   * Deserialize the editor.\n   * The result of the deserialization is a new editor.\n   *\n   * @param {Object} data\n   * @param {AnnotationEditorLayer} parent\n   * @param {AnnotationEditorUIManager} uiManager\n   * @returns {Promise<AnnotationEditor | null>}\n   */\n  static async deserialize(data, parent, uiManager) {\n    const editor = new this.prototype.constructor({\n      parent,\n      id: parent.getNextId(),\n      uiManager,\n      annotationElementId: data.annotationElementId,\n    });\n    editor.rotation = data.rotation;\n    editor.#accessibilityData = data.accessibilityData;\n    editor._isCopy = data.isCopy || false;\n\n    const [pageWidth, pageHeight] = editor.pageDimensions;\n    const [x, y, width, height] = editor.getRectInCurrentCoords(\n      data.rect,\n      pageHeight\n    );\n\n    editor.x = x / pageWidth;\n    editor.y = y / pageHeight;\n    editor.width = width / pageWidth;\n    editor.height = height / pageHeight;\n\n    return editor;\n  }\n\n  /**\n   * Check if an existing annotation associated with this editor has been\n   * modified.\n   * @returns {boolean}\n   */\n  get hasBeenModified() {\n    return (\n      !!this.annotationElementId && (this.deleted || this.serialize() !== null)\n    );\n  }\n\n  /**\n   * Remove this editor.\n   * It's used on ctrl+backspace action.\n   */\n  remove() {\n    this.#focusAC?.abort();\n    this.#focusAC = null;\n\n    if (!this.isEmpty()) {\n      // The editor is removed but it can be back at some point thanks to\n      // undo/redo so we must commit it before.\n      this.commit();\n    }\n    if (this.parent) {\n      this.parent.remove(this);\n    } else {\n      this._uiManager.removeEditor(this);\n    }\n\n    if (this.#moveInDOMTimeout) {\n      clearTimeout(this.#moveInDOMTimeout);\n      this.#moveInDOMTimeout = null;\n    }\n    this.#stopResizing();\n    this.removeEditToolbar();\n    if (this.#telemetryTimeouts) {\n      for (const timeout of this.#telemetryTimeouts.values()) {\n        clearTimeout(timeout);\n      }\n      this.#telemetryTimeouts = null;\n    }\n    this.parent = null;\n    this.#touchManager?.destroy();\n    this.#touchManager = null;\n  }\n\n  /**\n   * @returns {boolean} true if this editor can be resized.\n   */\n  get isResizable() {\n    return false;\n  }\n\n  /**\n   * Add the resizers to this editor.\n   */\n  makeResizable() {\n    if (this.isResizable) {\n      this.#createResizers();\n      this.#resizersDiv.classList.remove(\"hidden\");\n    }\n  }\n\n  get toolbarPosition() {\n    return null;\n  }\n\n  /**\n   * onkeydown callback.\n   * @param {KeyboardEvent} event\n   */\n  keydown(event) {\n    if (\n      !this.isResizable ||\n      event.target !== this.div ||\n      event.key !== \"Enter\"\n    ) {\n      return;\n    }\n    this._uiManager.setSelected(this);\n    this.#savedDimensions = {\n      savedX: this.x,\n      savedY: this.y,\n      savedWidth: this.width,\n      savedHeight: this.height,\n    };\n    const children = this.#resizersDiv.children;\n    if (!this.#allResizerDivs) {\n      this.#allResizerDivs = Array.from(children);\n      const boundResizerKeydown = this.#resizerKeydown.bind(this);\n      const boundResizerBlur = this.#resizerBlur.bind(this);\n      const signal = this._uiManager._signal;\n      for (const div of this.#allResizerDivs) {\n        const name = div.getAttribute(\"data-resizer-name\");\n        div.setAttribute(\"role\", \"spinbutton\");\n        div.addEventListener(\"keydown\", boundResizerKeydown, { signal });\n        div.addEventListener(\"blur\", boundResizerBlur, { signal });\n        div.addEventListener(\"focus\", this.#resizerFocus.bind(this, name), {\n          signal,\n        });\n        div.setAttribute(\"data-l10n-id\", AnnotationEditor._l10nResizer[name]);\n      }\n    }\n\n    // We want to have the resizers in the visual order, so we move the first\n    // (top-left) to the right place.\n    const first = this.#allResizerDivs[0];\n    let firstPosition = 0;\n    for (const div of children) {\n      if (div === first) {\n        break;\n      }\n      firstPosition++;\n    }\n    const nextFirstPosition =\n      (((360 - this.rotation + this.parentRotation) % 360) / 90) *\n      (this.#allResizerDivs.length / 4);\n\n    if (nextFirstPosition !== firstPosition) {\n      // We need to reorder the resizers in the DOM in order to have the focus\n      // on the top-left one.\n      if (nextFirstPosition < firstPosition) {\n        for (let i = 0; i < firstPosition - nextFirstPosition; i++) {\n          this.#resizersDiv.append(this.#resizersDiv.firstChild);\n        }\n      } else if (nextFirstPosition > firstPosition) {\n        for (let i = 0; i < nextFirstPosition - firstPosition; i++) {\n          this.#resizersDiv.firstChild.before(this.#resizersDiv.lastChild);\n        }\n      }\n\n      let i = 0;\n      for (const child of children) {\n        const div = this.#allResizerDivs[i++];\n        const name = div.getAttribute(\"data-resizer-name\");\n        child.setAttribute(\"data-l10n-id\", AnnotationEditor._l10nResizer[name]);\n      }\n    }\n\n    this.#setResizerTabIndex(0);\n    this.#isResizerEnabledForKeyboard = true;\n    this.#resizersDiv.firstChild.focus({ focusVisible: true });\n    event.preventDefault();\n    event.stopImmediatePropagation();\n  }\n\n  #resizerKeydown(event) {\n    AnnotationEditor._resizerKeyboardManager.exec(this, event);\n  }\n\n  #resizerBlur(event) {\n    if (\n      this.#isResizerEnabledForKeyboard &&\n      event.relatedTarget?.parentNode !== this.#resizersDiv\n    ) {\n      this.#stopResizing();\n    }\n  }\n\n  #resizerFocus(name) {\n    this.#focusedResizerName = this.#isResizerEnabledForKeyboard ? name : \"\";\n  }\n\n  #setResizerTabIndex(value) {\n    if (!this.#allResizerDivs) {\n      return;\n    }\n    for (const div of this.#allResizerDivs) {\n      div.tabIndex = value;\n    }\n  }\n\n  _resizeWithKeyboard(x, y) {\n    if (!this.#isResizerEnabledForKeyboard) {\n      return;\n    }\n    this.#resizerPointermove(this.#focusedResizerName, {\n      deltaX: x,\n      deltaY: y,\n      fromKeyboard: true,\n    });\n  }\n\n  #stopResizing() {\n    this.#isResizerEnabledForKeyboard = false;\n    this.#setResizerTabIndex(-1);\n    this.#addResizeToUndoStack();\n  }\n\n  _stopResizingWithKeyboard() {\n    this.#stopResizing();\n    this.div.focus();\n  }\n\n  /**\n   * Select this editor.\n   */\n  select() {\n    if (this.isSelected && this._editToolbar) {\n      return;\n    }\n    this.isSelected = true;\n    this.makeResizable();\n    this.div?.classList.add(\"selectedEditor\");\n    if (!this._editToolbar) {\n      this.addEditToolbar().then(() => {\n        if (this.div?.classList.contains(\"selectedEditor\")) {\n          // The editor can have been unselected while we were waiting for the\n          // edit toolbar to be created, hence we want to be sure that this\n          // editor is still selected.\n          this._editToolbar?.show();\n        }\n      });\n      return;\n    }\n    this._editToolbar?.show();\n    this.#altText?.toggleAltTextBadge(false);\n  }\n\n  /**\n   * Unselect this editor.\n   */\n  unselect() {\n    if (!this.isSelected) {\n      return;\n    }\n    this.isSelected = false;\n    this.#resizersDiv?.classList.add(\"hidden\");\n    this.div?.classList.remove(\"selectedEditor\");\n    if (this.div?.contains(document.activeElement)) {\n      // Don't use this.div.blur() because we don't know where the focus will\n      // go.\n      this._uiManager.currentLayer.div.focus({\n        preventScroll: true,\n      });\n    }\n    this._editToolbar?.hide();\n    this.#altText?.toggleAltTextBadge(true);\n  }\n\n  /**\n   * Update some parameters which have been changed through the UI.\n   * @param {number} type\n   * @param {*} value\n   */\n  updateParams(type, value) {}\n\n  /**\n   * When the user disables the editing mode some editors can change some of\n   * their properties.\n   */\n  disableEditing() {}\n\n  /**\n   * When the user enables the editing mode some editors can change some of\n   * their properties.\n   */\n  enableEditing() {}\n\n  /**\n   * Check if the content of this editor can be changed.\n   * For example, a FreeText editor can be changed (the user can change the\n   * text), but a Stamp editor cannot.\n   * @returns {boolean}\n   */\n  get canChangeContent() {\n    return false;\n  }\n\n  /**\n   * The editor is about to be edited.\n   */\n  enterInEditMode() {\n    if (!this.canChangeContent) {\n      return;\n    }\n    this.enableEditMode();\n    this.div.focus();\n  }\n\n  /**\n   * ondblclick callback.\n   * @param {MouseEvent} event\n   */\n  dblclick(event) {\n    this.enterInEditMode();\n    this.parent.updateToolbar({\n      mode: this.constructor._editorType,\n      editId: this.id,\n    });\n  }\n\n  /**\n   * @returns {HTMLElement | null} the element requiring an alt text.\n   */\n  getElementForAltText() {\n    return this.div;\n  }\n\n  /**\n   * Get the div which really contains the displayed content.\n   * @returns {HTMLDivElement | undefined}\n   */\n  get contentDiv() {\n    return this.div;\n  }\n\n  /**\n   * If true then the editor is currently edited.\n   * @type {boolean}\n   */\n  get isEditing() {\n    return this.#isEditing;\n  }\n\n  /**\n   * When set to true, it means that this editor is currently edited.\n   * @param {boolean} value\n   */\n  set isEditing(value) {\n    this.#isEditing = value;\n    if (!this.parent) {\n      return;\n    }\n    if (value) {\n      this.parent.setSelected(this);\n      this.parent.setActiveEditor(this);\n    } else {\n      this.parent.setActiveEditor(null);\n    }\n  }\n\n  /**\n   * Set the aspect ratio to use when resizing.\n   * @param {number} width\n   * @param {number} height\n   */\n  setAspectRatio(width, height) {\n    this.#keepAspectRatio = true;\n    const aspectRatio = width / height;\n    const { style } = this.div;\n    style.aspectRatio = aspectRatio;\n    style.height = \"auto\";\n  }\n\n  static get MIN_SIZE() {\n    return 16;\n  }\n\n  static canCreateNewEmptyEditor() {\n    return true;\n  }\n\n  /**\n   * Get the data to report to the telemetry when the editor is added.\n   * @returns {Object}\n   */\n  get telemetryInitialData() {\n    return { action: \"added\" };\n  }\n\n  /**\n   * The telemetry data to use when saving/printing.\n   * @returns {Object|null}\n   */\n  get telemetryFinalData() {\n    return null;\n  }\n\n  _reportTelemetry(data, mustWait = false) {\n    if (mustWait) {\n      this.#telemetryTimeouts ||= new Map();\n      const { action } = data;\n      let timeout = this.#telemetryTimeouts.get(action);\n      if (timeout) {\n        clearTimeout(timeout);\n      }\n      timeout = setTimeout(() => {\n        this._reportTelemetry(data);\n        this.#telemetryTimeouts.delete(action);\n        if (this.#telemetryTimeouts.size === 0) {\n          this.#telemetryTimeouts = null;\n        }\n      }, AnnotationEditor._telemetryTimeout);\n      this.#telemetryTimeouts.set(action, timeout);\n      return;\n    }\n    data.type ||= this.editorType;\n    this._uiManager._eventBus.dispatch(\"reporttelemetry\", {\n      source: this,\n      details: {\n        type: \"editing\",\n        data,\n      },\n    });\n  }\n\n  /**\n   * Show or hide this editor.\n   * @param {boolean|undefined} visible\n   */\n  show(visible = this._isVisible) {\n    this.div.classList.toggle(\"hidden\", !visible);\n    this._isVisible = visible;\n  }\n\n  enable() {\n    if (this.div) {\n      this.div.tabIndex = 0;\n    }\n    this.#disabled = false;\n  }\n\n  disable() {\n    if (this.div) {\n      this.div.tabIndex = -1;\n    }\n    this.#disabled = true;\n  }\n\n  /**\n   * Render an annotation in the annotation layer.\n   * @param {Object} annotation\n   * @returns {HTMLElement|null}\n   */\n  renderAnnotationElement(annotation) {\n    let content = annotation.container.querySelector(\".annotationContent\");\n    if (!content) {\n      content = document.createElement(\"div\");\n      content.classList.add(\"annotationContent\", this.editorType);\n      annotation.container.prepend(content);\n    } else if (content.nodeName === \"CANVAS\") {\n      const canvas = content;\n      content = document.createElement(\"div\");\n      content.classList.add(\"annotationContent\", this.editorType);\n      canvas.before(content);\n    }\n\n    return content;\n  }\n\n  resetAnnotationElement(annotation) {\n    const { firstChild } = annotation.container;\n    if (\n      firstChild?.nodeName === \"DIV\" &&\n      firstChild.classList.contains(\"annotationContent\")\n    ) {\n      firstChild.remove();\n    }\n  }\n}\n\n// This class is used to fake an editor which has been deleted.\nclass FakeEditor extends AnnotationEditor {\n  constructor(params) {\n    super(params);\n    this.annotationElementId = params.annotationElementId;\n    this.deleted = true;\n  }\n\n  serialize() {\n    return this.serializeDeleted();\n  }\n}\n\nexport { AnnotationEditor };\n","/* Copyright 2014 Opera Software ASA\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n *\n * Based on https://code.google.com/p/smhasher/wiki/MurmurHash3.\n * Hashes roughly 100 KB per millisecond on i7 3.4 GHz.\n */\n\nconst SEED = 0xc3d2e1f0;\n// Workaround for missing math precision in JS.\nconst MASK_HIGH = 0xffff0000;\nconst MASK_LOW = 0xffff;\n\nclass MurmurHash3_64 {\n  constructor(seed) {\n    this.h1 = seed ? seed & 0xffffffff : SEED;\n    this.h2 = seed ? seed & 0xffffffff : SEED;\n  }\n\n  update(input) {\n    let data, length;\n    if (typeof input === \"string\") {\n      data = new Uint8Array(input.length * 2);\n      length = 0;\n      for (let i = 0, ii = input.length; i < ii; i++) {\n        const code = input.charCodeAt(i);\n        if (code <= 0xff) {\n          data[length++] = code;\n        } else {\n          data[length++] = code >>> 8;\n          data[length++] = code & 0xff;\n        }\n      }\n    } else if (ArrayBuffer.isView(input)) {\n      data = input.slice();\n      length = data.byteLength;\n    } else {\n      throw new Error(\"Invalid data format, must be a string or TypedArray.\");\n    }\n\n    const blockCounts = length >> 2;\n    const tailLength = length - blockCounts * 4;\n    // We don't care about endianness here.\n    const dataUint32 = new Uint32Array(data.buffer, 0, blockCounts);\n    let k1 = 0,\n      k2 = 0;\n    let h1 = this.h1,\n      h2 = this.h2;\n    const C1 = 0xcc9e2d51,\n      C2 = 0x1b873593;\n    const C1_LOW = C1 & MASK_LOW,\n      C2_LOW = C2 & MASK_LOW;\n\n    for (let i = 0; i < blockCounts; i++) {\n      if (i & 1) {\n        k1 = dataUint32[i];\n        k1 = ((k1 * C1) & MASK_HIGH) | ((k1 * C1_LOW) & MASK_LOW);\n        k1 = (k1 << 15) | (k1 >>> 17);\n        k1 = ((k1 * C2) & MASK_HIGH) | ((k1 * C2_LOW) & MASK_LOW);\n        h1 ^= k1;\n        h1 = (h1 << 13) | (h1 >>> 19);\n        h1 = h1 * 5 + 0xe6546b64;\n      } else {\n        k2 = dataUint32[i];\n        k2 = ((k2 * C1) & MASK_HIGH) | ((k2 * C1_LOW) & MASK_LOW);\n        k2 = (k2 << 15) | (k2 >>> 17);\n        k2 = ((k2 * C2) & MASK_HIGH) | ((k2 * C2_LOW) & MASK_LOW);\n        h2 ^= k2;\n        h2 = (h2 << 13) | (h2 >>> 19);\n        h2 = h2 * 5 + 0xe6546b64;\n      }\n    }\n\n    k1 = 0;\n\n    switch (tailLength) {\n      case 3:\n        k1 ^= data[blockCounts * 4 + 2] << 16;\n      /* falls through */\n      case 2:\n        k1 ^= data[blockCounts * 4 + 1] << 8;\n      /* falls through */\n      case 1:\n        k1 ^= data[blockCounts * 4];\n        /* falls through */\n\n        k1 = ((k1 * C1) & MASK_HIGH) | ((k1 * C1_LOW) & MASK_LOW);\n        k1 = (k1 << 15) | (k1 >>> 17);\n        k1 = ((k1 * C2) & MASK_HIGH) | ((k1 * C2_LOW) & MASK_LOW);\n        if (blockCounts & 1) {\n          h1 ^= k1;\n        } else {\n          h2 ^= k1;\n        }\n    }\n\n    this.h1 = h1;\n    this.h2 = h2;\n  }\n\n  hexdigest() {\n    let h1 = this.h1,\n      h2 = this.h2;\n\n    h1 ^= h2 >>> 1;\n    h1 = ((h1 * 0xed558ccd) & MASK_HIGH) | ((h1 * 0x8ccd) & MASK_LOW);\n    h2 =\n      ((h2 * 0xff51afd7) & MASK_HIGH) |\n      (((((h2 << 16) | (h1 >>> 16)) * 0xafd7ed55) & MASK_HIGH) >>> 16);\n    h1 ^= h2 >>> 1;\n    h1 = ((h1 * 0x1a85ec53) & MASK_HIGH) | ((h1 * 0xec53) & MASK_LOW);\n    h2 =\n      ((h2 * 0xc4ceb9fe) & MASK_HIGH) |\n      (((((h2 << 16) | (h1 >>> 16)) * 0xb9fe1a85) & MASK_HIGH) >>> 16);\n    h1 ^= h2 >>> 1;\n\n    return (\n      (h1 >>> 0).toString(16).padStart(8, \"0\") +\n      (h2 >>> 0).toString(16).padStart(8, \"0\")\n    );\n  }\n}\n\nexport { MurmurHash3_64 };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { shadow, unreachable } from \"../shared/util.js\";\nimport { AnnotationEditor } from \"./editor/editor.js\";\nimport { MurmurHash3_64 } from \"../shared/murmurhash3.js\";\n\nconst SerializableEmpty = Object.freeze({\n  map: null,\n  hash: \"\",\n  transfer: undefined,\n});\n\n/**\n * Key/value storage for annotation data in forms.\n */\nclass AnnotationStorage {\n  #modified = false;\n\n  #modifiedIds = null;\n\n  #storage = new Map();\n\n  constructor() {\n    // Callbacks to signal when the modification state is set or reset.\n    // This is used by the viewer to only bind on `beforeunload` if forms\n    // are actually edited to prevent doing so unconditionally since that\n    // can have undesirable effects.\n    this.onSetModified = null;\n    this.onResetModified = null;\n    this.onAnnotationEditor = null;\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"_setValues\", {\n        value: obj => {\n          for (const [key, val] of Object.entries(obj)) {\n            this.setValue(key, val);\n          }\n        },\n      });\n    }\n  }\n\n  /**\n   * Get the value for a given key if it exists, or return the default value.\n   * @param {string} key\n   * @param {Object} defaultValue\n   * @returns {Object}\n   */\n  getValue(key, defaultValue) {\n    const value = this.#storage.get(key);\n    if (value === undefined) {\n      return defaultValue;\n    }\n\n    return Object.assign(defaultValue, value);\n  }\n\n  /**\n   * Get the value for a given key.\n   * @param {string} key\n   * @returns {Object}\n   */\n  getRawValue(key) {\n    return this.#storage.get(key);\n  }\n\n  /**\n   * Remove a value from the storage.\n   * @param {string} key\n   */\n  remove(key) {\n    this.#storage.delete(key);\n\n    if (this.#storage.size === 0) {\n      this.resetModified();\n    }\n\n    if (typeof this.onAnnotationEditor === \"function\") {\n      for (const value of this.#storage.values()) {\n        if (value instanceof AnnotationEditor) {\n          return;\n        }\n      }\n      this.onAnnotationEditor(null);\n    }\n  }\n\n  /**\n   * Set the value for a given key\n   * @param {string} key\n   * @param {Object} value\n   */\n  setValue(key, value) {\n    const obj = this.#storage.get(key);\n    let modified = false;\n    if (obj !== undefined) {\n      for (const [entry, val] of Object.entries(value)) {\n        if (obj[entry] !== val) {\n          modified = true;\n          obj[entry] = val;\n        }\n      }\n    } else {\n      modified = true;\n      this.#storage.set(key, value);\n    }\n    if (modified) {\n      this.#setModified();\n    }\n\n    if (\n      value instanceof AnnotationEditor &&\n      typeof this.onAnnotationEditor === \"function\"\n    ) {\n      this.onAnnotationEditor(value.constructor._type);\n    }\n  }\n\n  /**\n   * Check if the storage contains the given key.\n   * @param {string} key\n   * @returns {boolean}\n   */\n  has(key) {\n    return this.#storage.has(key);\n  }\n\n  get size() {\n    return this.#storage.size;\n  }\n\n  #setModified() {\n    if (!this.#modified) {\n      this.#modified = true;\n      if (typeof this.onSetModified === \"function\") {\n        this.onSetModified();\n      }\n    }\n  }\n\n  resetModified() {\n    if (this.#modified) {\n      this.#modified = false;\n      if (typeof this.onResetModified === \"function\") {\n        this.onResetModified();\n      }\n    }\n  }\n\n  /**\n   * @returns {PrintAnnotationStorage}\n   */\n  get print() {\n    return new PrintAnnotationStorage(this);\n  }\n\n  /**\n   * PLEASE NOTE: Only intended for usage within the API itself.\n   * @ignore\n   */\n  get serializable() {\n    if (this.#storage.size === 0) {\n      return SerializableEmpty;\n    }\n    const map = new Map(),\n      hash = new MurmurHash3_64(),\n      transfer = [];\n    const context = Object.create(null);\n    let hasBitmap = false;\n\n    for (const [key, val] of this.#storage) {\n      const serialized =\n        val instanceof AnnotationEditor\n          ? val.serialize(/* isForCopying = */ false, context)\n          : val;\n      if (serialized) {\n        map.set(key, serialized);\n\n        hash.update(`${key}:${JSON.stringify(serialized)}`);\n        hasBitmap ||= !!serialized.bitmap;\n      }\n    }\n\n    if (hasBitmap) {\n      // We must transfer the bitmap data separately, since it can be changed\n      // during serialization with SVG images.\n      for (const value of map.values()) {\n        if (value.bitmap) {\n          transfer.push(value.bitmap);\n        }\n      }\n    }\n\n    return map.size > 0\n      ? { map, hash: hash.hexdigest(), transfer }\n      : SerializableEmpty;\n  }\n\n  get editorStats() {\n    let stats = null;\n    const typeToEditor = new Map();\n    for (const value of this.#storage.values()) {\n      if (!(value instanceof AnnotationEditor)) {\n        continue;\n      }\n      const editorStats = value.telemetryFinalData;\n      if (!editorStats) {\n        continue;\n      }\n      const { type } = editorStats;\n      if (!typeToEditor.has(type)) {\n        typeToEditor.set(type, Object.getPrototypeOf(value).constructor);\n      }\n      stats ||= Object.create(null);\n      const map = (stats[type] ||= new Map());\n      for (const [key, val] of Object.entries(editorStats)) {\n        if (key === \"type\") {\n          continue;\n        }\n        let counters = map.get(key);\n        if (!counters) {\n          counters = new Map();\n          map.set(key, counters);\n        }\n        const count = counters.get(val) ?? 0;\n        counters.set(val, count + 1);\n      }\n    }\n    for (const [type, editor] of typeToEditor) {\n      stats[type] = editor.computeTelemetryFinalData(stats[type]);\n    }\n    return stats;\n  }\n\n  resetModifiedIds() {\n    this.#modifiedIds = null;\n  }\n\n  /**\n   * @returns {{ids: Set<string>, hash: string}}\n   */\n  get modifiedIds() {\n    if (this.#modifiedIds) {\n      return this.#modifiedIds;\n    }\n    const ids = [];\n    for (const value of this.#storage.values()) {\n      if (\n        !(value instanceof AnnotationEditor) ||\n        !value.annotationElementId ||\n        !value.serialize()\n      ) {\n        continue;\n      }\n      ids.push(value.annotationElementId);\n    }\n    return (this.#modifiedIds = {\n      ids: new Set(ids),\n      hash: ids.join(\",\"),\n    });\n  }\n\n  [Symbol.iterator]() {\n    return this.#storage.entries();\n  }\n}\n\n/**\n * A special `AnnotationStorage` for use during printing, where the serializable\n * data is *frozen* upon initialization, to prevent scripting from modifying its\n * contents. (Necessary since printing is triggered synchronously in browsers.)\n */\nclass PrintAnnotationStorage extends AnnotationStorage {\n  #serializable;\n\n  constructor(parent) {\n    super();\n    const { map, hash, transfer } = parent.serializable;\n    // Create a *copy* of the data, since Objects are passed by reference in JS.\n    const clone = structuredClone(map, transfer ? { transfer } : null);\n\n    this.#serializable = { map: clone, hash, transfer };\n  }\n\n  /**\n   * @returns {PrintAnnotationStorage}\n   */\n  // eslint-disable-next-line getter-return\n  get print() {\n    unreachable(\"Should not call PrintAnnotationStorage.print\");\n  }\n\n  /**\n   * PLEASE NOTE: Only intended for usage within the API itself.\n   * @ignore\n   */\n  get serializable() {\n    return this.#serializable;\n  }\n\n  get modifiedIds() {\n    return shadow(this, \"modifiedIds\", {\n      ids: new Set(),\n      hash: \"\",\n    });\n  }\n}\n\nexport { AnnotationStorage, PrintAnnotationStorage, SerializableEmpty };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  assert,\n  FeatureTest,\n  isNodeJS,\n  shadow,\n  string32,\n  toBase64Util,\n  unreachable,\n  warn,\n} from \"../shared/util.js\";\n\nclass FontLoader {\n  #systemFonts = new Set();\n\n  constructor({\n    ownerDocument = globalThis.document,\n    styleElement = null, // For testing only.\n  }) {\n    this._document = ownerDocument;\n\n    this.nativeFontFaces = new Set();\n    this.styleElement =\n      typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")\n        ? styleElement\n        : null;\n\n    if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"MOZCENTRAL\")) {\n      this.loadingRequests = [];\n      this.loadTestFontId = 0;\n    }\n  }\n\n  addNativeFontFace(nativeFontFace) {\n    this.nativeFontFaces.add(nativeFontFace);\n    this._document.fonts.add(nativeFontFace);\n  }\n\n  removeNativeFontFace(nativeFontFace) {\n    this.nativeFontFaces.delete(nativeFontFace);\n    this._document.fonts.delete(nativeFontFace);\n  }\n\n  insertRule(rule) {\n    if (!this.styleElement) {\n      this.styleElement = this._document.createElement(\"style\");\n      this._document.documentElement\n        .getElementsByTagName(\"head\")[0]\n        .append(this.styleElement);\n    }\n    const styleSheet = this.styleElement.sheet;\n    styleSheet.insertRule(rule, styleSheet.cssRules.length);\n  }\n\n  clear() {\n    for (const nativeFontFace of this.nativeFontFaces) {\n      this._document.fonts.delete(nativeFontFace);\n    }\n    this.nativeFontFaces.clear();\n    this.#systemFonts.clear();\n\n    if (this.styleElement) {\n      // Note: ChildNode.remove doesn't throw if the parentNode is undefined.\n      this.styleElement.remove();\n      this.styleElement = null;\n    }\n  }\n\n  async loadSystemFont({\n    systemFontInfo: info,\n    disableFontFace,\n    _inspectFont,\n  }) {\n    if (!info || this.#systemFonts.has(info.loadedName)) {\n      return;\n    }\n    assert(\n      !disableFontFace,\n      \"loadSystemFont shouldn't be called when `disableFontFace` is set.\"\n    );\n\n    if (this.isFontLoadingAPISupported) {\n      const { loadedName, src, style } = info;\n      const fontFace = new FontFace(loadedName, src, style);\n      this.addNativeFontFace(fontFace);\n      try {\n        await fontFace.load();\n        this.#systemFonts.add(loadedName);\n        _inspectFont?.(info);\n      } catch {\n        warn(\n          `Cannot load system font: ${info.baseFontName}, installing it could help to improve PDF rendering.`\n        );\n\n        this.removeNativeFontFace(fontFace);\n      }\n      return;\n    }\n\n    unreachable(\n      \"Not implemented: loadSystemFont without the Font Loading API.\"\n    );\n  }\n\n  async bind(font) {\n    // Add the font to the DOM only once; skip if the font is already loaded.\n    if (font.attached || (font.missingFile && !font.systemFontInfo)) {\n      return;\n    }\n    font.attached = true;\n\n    if (font.systemFontInfo) {\n      await this.loadSystemFont(font);\n      return;\n    }\n\n    if (this.isFontLoadingAPISupported) {\n      const nativeFontFace = font.createNativeFontFace();\n      if (nativeFontFace) {\n        this.addNativeFontFace(nativeFontFace);\n        try {\n          await nativeFontFace.loaded;\n        } catch (ex) {\n          warn(`Failed to load font '${nativeFontFace.family}': '${ex}'.`);\n\n          // When font loading failed, fall back to the built-in font renderer.\n          font.disableFontFace = true;\n          throw ex;\n        }\n      }\n      return; // The font was, asynchronously, loaded.\n    }\n\n    // !this.isFontLoadingAPISupported\n    const rule = font.createFontFaceRule();\n    if (rule) {\n      this.insertRule(rule);\n\n      if (this.isSyncFontLoadingSupported) {\n        return; // The font was, synchronously, loaded.\n      }\n      if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n        throw new Error(\"Not implemented: async font loading\");\n      }\n      await new Promise(resolve => {\n        const request = this._queueLoadingCallback(resolve);\n        this._prepareFontLoadEvent(font, request);\n      });\n      // The font was, asynchronously, loaded.\n    }\n  }\n\n  get isFontLoadingAPISupported() {\n    const hasFonts = !!this._document?.fonts;\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      return shadow(\n        this,\n        \"isFontLoadingAPISupported\",\n        hasFonts && !this.styleElement\n      );\n    }\n    return shadow(this, \"isFontLoadingAPISupported\", hasFonts);\n  }\n\n  get isSyncFontLoadingSupported() {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      return shadow(this, \"isSyncFontLoadingSupported\", true);\n    }\n\n    // Node.js - we can pretend that sync font loading is supported.\n    // Firefox, from version 14, supports synchronous font loading.\n    return shadow(\n      this,\n      \"isSyncFontLoadingSupported\",\n      (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"CHROME\")) &&\n        (isNodeJS || FeatureTest.platform.isFirefox)\n    );\n  }\n\n  _queueLoadingCallback(callback) {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _queueLoadingCallback\");\n    }\n\n    function completeRequest() {\n      assert(!request.done, \"completeRequest() cannot be called twice.\");\n      request.done = true;\n\n      // Sending all completed requests in order of how they were queued.\n      while (loadingRequests.length > 0 && loadingRequests[0].done) {\n        const otherRequest = loadingRequests.shift();\n        setTimeout(otherRequest.callback, 0);\n      }\n    }\n\n    const { loadingRequests } = this;\n    const request = {\n      done: false,\n      complete: completeRequest,\n      callback,\n    };\n    loadingRequests.push(request);\n    return request;\n  }\n\n  get _loadTestFont() {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _loadTestFont\");\n    }\n\n    // This is a CFF font with 1 glyph for '.' that fills its entire width\n    // and height.\n    const testFont = atob(\n      \"T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQA\" +\n        \"FQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAA\" +\n        \"ALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgA\" +\n        \"AAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1\" +\n        \"AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD\" +\n        \"6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACM\" +\n        \"AooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4D\" +\n        \"IP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAA\" +\n        \"AAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUA\" +\n        \"AQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgAB\" +\n        \"AAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABY\" +\n        \"AAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAA\" +\n        \"AC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" +\n        \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAA\" +\n        \"AAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQAC\" +\n        \"AQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3\" +\n        \"Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTj\" +\n        \"FQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==\"\n    );\n    return shadow(this, \"_loadTestFont\", testFont);\n  }\n\n  _prepareFontLoadEvent(font, request) {\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n      throw new Error(\"Not implemented: _prepareFontLoadEvent\");\n    }\n\n    /** Hack begin */\n    // There's currently no event when a font has finished downloading so the\n    // following code is a dirty hack to 'guess' when a font is ready.\n    // It's assumed fonts are loaded in order, so add a known test font after\n    // the desired fonts and then test for the loading of that test font.\n\n    function int32(data, offset) {\n      return (\n        (data.charCodeAt(offset) << 24) |\n        (data.charCodeAt(offset + 1) << 16) |\n        (data.charCodeAt(offset + 2) << 8) |\n        (data.charCodeAt(offset + 3) & 0xff)\n      );\n    }\n    function spliceString(s, offset, remove, insert) {\n      const chunk1 = s.substring(0, offset);\n      const chunk2 = s.substring(offset + remove);\n      return chunk1 + insert + chunk2;\n    }\n    let i, ii;\n\n    // The temporary canvas is used to determine if fonts are loaded.\n    const canvas = this._document.createElement(\"canvas\");\n    canvas.width = 1;\n    canvas.height = 1;\n    const ctx = canvas.getContext(\"2d\");\n\n    let called = 0;\n    function isFontReady(name, callback) {\n      // With setTimeout clamping this gives the font ~100ms to load.\n      if (++called > 30) {\n        warn(\"Load test font never loaded.\");\n        callback();\n        return;\n      }\n      ctx.font = \"30px \" + name;\n      ctx.fillText(\".\", 0, 20);\n      const imageData = ctx.getImageData(0, 0, 1, 1);\n      if (imageData.data[3] > 0) {\n        callback();\n        return;\n      }\n      setTimeout(isFontReady.bind(null, name, callback));\n    }\n\n    const loadTestFontId = `lt${Date.now()}${this.loadTestFontId++}`;\n    // Chromium seems to cache fonts based on a hash of the actual font data,\n    // so the font must be modified for each load test else it will appear to\n    // be loaded already.\n    // TODO: This could maybe be made faster by avoiding the btoa of the full\n    // font by splitting it in chunks before hand and padding the font id.\n    let data = this._loadTestFont;\n    const COMMENT_OFFSET = 976; // has to be on 4 byte boundary (for checksum)\n    data = spliceString(\n      data,\n      COMMENT_OFFSET,\n      loadTestFontId.length,\n      loadTestFontId\n    );\n    // CFF checksum is important for IE, adjusting it\n    const CFF_CHECKSUM_OFFSET = 16;\n    const XXXX_VALUE = 0x58585858; // the \"comment\" filled with 'X'\n    let checksum = int32(data, CFF_CHECKSUM_OFFSET);\n    for (i = 0, ii = loadTestFontId.length - 3; i < ii; i += 4) {\n      checksum = (checksum - XXXX_VALUE + int32(loadTestFontId, i)) | 0;\n    }\n    if (i < loadTestFontId.length) {\n      // align to 4 bytes boundary\n      checksum = (checksum - XXXX_VALUE + int32(loadTestFontId + \"XXX\", i)) | 0;\n    }\n    data = spliceString(data, CFF_CHECKSUM_OFFSET, 4, string32(checksum));\n\n    const url = `url(data:font/opentype;base64,${btoa(data)});`;\n    const rule = `@font-face {font-family:\"${loadTestFontId}\";src:${url}}`;\n    this.insertRule(rule);\n\n    const div = this._document.createElement(\"div\");\n    div.style.visibility = \"hidden\";\n    div.style.width = div.style.height = \"10px\";\n    div.style.position = \"absolute\";\n    div.style.top = div.style.left = \"0px\";\n\n    for (const name of [font.loadedName, loadTestFontId]) {\n      const span = this._document.createElement(\"span\");\n      span.textContent = \"Hi\";\n      span.style.fontFamily = name;\n      div.append(span);\n    }\n    this._document.body.append(div);\n\n    isFontReady(loadTestFontId, () => {\n      div.remove();\n      request.complete();\n    });\n    /** Hack end */\n  }\n}\n\nclass FontFaceObject {\n  constructor(translatedData, inspectFont = null) {\n    this.compiledGlyphs = Object.create(null);\n    // importing translated data\n    for (const i in translatedData) {\n      this[i] = translatedData[i];\n    }\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      if (typeof this.disableFontFace !== \"boolean\") {\n        unreachable(\"disableFontFace must be available.\");\n      }\n      if (typeof this.fontExtraProperties !== \"boolean\") {\n        unreachable(\"fontExtraProperties must be available.\");\n      }\n    }\n    this._inspectFont = inspectFont;\n  }\n\n  createNativeFontFace() {\n    if (!this.data || this.disableFontFace) {\n      return null;\n    }\n    let nativeFontFace;\n    if (!this.cssFontInfo) {\n      nativeFontFace = new FontFace(this.loadedName, this.data, {});\n    } else {\n      const css = {\n        weight: this.cssFontInfo.fontWeight,\n      };\n      if (this.cssFontInfo.italicAngle) {\n        css.style = `oblique ${this.cssFontInfo.italicAngle}deg`;\n      }\n      nativeFontFace = new FontFace(\n        this.cssFontInfo.fontFamily,\n        this.data,\n        css\n      );\n    }\n\n    this._inspectFont?.(this);\n    return nativeFontFace;\n  }\n\n  createFontFaceRule() {\n    if (!this.data || this.disableFontFace) {\n      return null;\n    }\n    // Add the @font-face rule to the document.\n    const url = `url(data:${this.mimetype};base64,${toBase64Util(this.data)});`;\n    let rule;\n    if (!this.cssFontInfo) {\n      rule = `@font-face {font-family:\"${this.loadedName}\";src:${url}}`;\n    } else {\n      let css = `font-weight: ${this.cssFontInfo.fontWeight};`;\n      if (this.cssFontInfo.italicAngle) {\n        css += `font-style: oblique ${this.cssFontInfo.italicAngle}deg;`;\n      }\n      rule = `@font-face {font-family:\"${this.cssFontInfo.fontFamily}\";${css}src:${url}}`;\n    }\n\n    this._inspectFont?.(this, url);\n    return rule;\n  }\n\n  getPathGenerator(objs, character) {\n    if (this.compiledGlyphs[character] !== undefined) {\n      return this.compiledGlyphs[character];\n    }\n\n    const objId = this.loadedName + \"_path_\" + character;\n    let cmds;\n    try {\n      cmds = objs.get(objId);\n    } catch (ex) {\n      warn(`getPathGenerator - ignoring character: \"${ex}\".`);\n    }\n    const path = new Path2D(cmds || \"\");\n\n    if (!this.fontExtraProperties) {\n      // Remove the raw path-string, since we don't need it anymore.\n      objs.delete(objId);\n    }\n    return (this.compiledGlyphs[character] = path);\n  }\n}\n\nexport { FontFaceObject, FontLoader };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  _isValidExplicitDest,\n  isNodeJS,\n  stringToBytes,\n  warn,\n} from \"../shared/util.js\";\n\nfunction getUrlProp(val) {\n  if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n    return null; // The 'url' is unused with `PDFDataRangeTransport`.\n  }\n  if (val instanceof URL) {\n    return val.href;\n  }\n  if (typeof val === \"string\") {\n    if (\n      typeof PDFJSDev !== \"undefined\" &&\n      PDFJSDev.test(\"GENERIC\") &&\n      isNodeJS\n    ) {\n      return val; // Use the url as-is in Node.js environments.\n    }\n\n    // The full path is required in the 'url' field.\n    const url = URL.parse(val, window.location);\n    if (url) {\n      return url.href;\n    }\n  }\n  throw new Error(\n    \"Invalid PDF url data: \" +\n      \"either string or URL-object is expected in the url property.\"\n  );\n}\n\nfunction getDataProp(val) {\n  // Converting string or array-like data to Uint8Array.\n  if (\n    typeof PDFJSDev !== \"undefined\" &&\n    PDFJSDev.test(\"GENERIC\") &&\n    isNodeJS &&\n    typeof Buffer !== \"undefined\" && // eslint-disable-line no-undef\n    val instanceof Buffer // eslint-disable-line no-undef\n  ) {\n    throw new Error(\n      \"Please provide binary data as `Uint8Array`, rather than `Buffer`.\"\n    );\n  }\n  if (val instanceof Uint8Array && val.byteLength === val.buffer.byteLength) {\n    // Use the data as-is when it's already a Uint8Array that completely\n    // \"utilizes\" its underlying ArrayBuffer, to prevent any possible\n    // issues when transferring it to the worker-thread.\n    return val;\n  }\n  if (typeof val === \"string\") {\n    return stringToBytes(val);\n  }\n  if (\n    val instanceof ArrayBuffer ||\n    ArrayBuffer.isView(val) ||\n    (typeof val === \"object\" && !isNaN(val?.length))\n  ) {\n    return new Uint8Array(val);\n  }\n  throw new Error(\n    \"Invalid PDF binary data: either TypedArray, \" +\n      \"string, or array-like object is expected in the data property.\"\n  );\n}\n\nfunction getFactoryUrlProp(val) {\n  if (typeof val !== \"string\") {\n    return null;\n  }\n  if (val.endsWith(\"/\")) {\n    return val;\n  }\n  throw new Error(`Invalid factory url: \"${val}\" must include trailing slash.`);\n}\n\nconst isRefProxy = v =>\n  typeof v === \"object\" &&\n  Number.isInteger(v?.num) &&\n  v.num >= 0 &&\n  Number.isInteger(v?.gen) &&\n  v.gen >= 0;\n\nconst isNameProxy = v => typeof v === \"object\" && typeof v?.name === \"string\";\n\nconst isValidExplicitDest = _isValidExplicitDest.bind(\n  null,\n  /* validRef = */ isRefProxy,\n  /* validName = */ isNameProxy\n);\n\nclass LoopbackPort {\n  #listeners = new Map();\n\n  #deferred = Promise.resolve();\n\n  postMessage(obj, transfer) {\n    const event = {\n      data: structuredClone(obj, transfer ? { transfer } : null),\n    };\n\n    this.#deferred.then(() => {\n      for (const [listener] of this.#listeners) {\n        listener.call(this, event);\n      }\n    });\n  }\n\n  addEventListener(name, listener, options = null) {\n    let rmAbort = null;\n    if (options?.signal instanceof AbortSignal) {\n      const { signal } = options;\n      if (signal.aborted) {\n        warn(\"LoopbackPort - cannot use an `aborted` signal.\");\n        return;\n      }\n      const onAbort = () => this.removeEventListener(name, listener);\n      rmAbort = () => signal.removeEventListener(\"abort\", onAbort);\n\n      signal.addEventListener(\"abort\", onAbort);\n    }\n    this.#listeners.set(listener, rmAbort);\n  }\n\n  removeEventListener(name, listener) {\n    const rmAbort = this.#listeners.get(listener);\n    rmAbort?.();\n\n    this.#listeners.delete(listener);\n  }\n\n  terminate() {\n    for (const [, rmAbort] of this.#listeners) {\n      rmAbort?.();\n    }\n    this.#listeners.clear();\n  }\n}\n\nexport {\n  getDataProp,\n  getFactoryUrlProp,\n  getUrlProp,\n  isNameProxy,\n  isRefProxy,\n  isValidExplicitDest,\n  LoopbackPort,\n};\n","/* Copyright 2018 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AbortException,\n  assert,\n  InvalidPDFException,\n  PasswordException,\n  ResponseException,\n  UnknownErrorException,\n  unreachable,\n} from \"./util.js\";\n\nconst CallbackKind = {\n  DATA: 1,\n  ERROR: 2,\n};\n\nconst StreamKind = {\n  CANCEL: 1,\n  CANCEL_COMPLETE: 2,\n  CLOSE: 3,\n  ENQUEUE: 4,\n  ERROR: 5,\n  PULL: 6,\n  PULL_COMPLETE: 7,\n  START_COMPLETE: 8,\n};\n\nfunction onFn() {}\n\nfunction wrapReason(ex) {\n  if (\n    ex instanceof AbortException ||\n    ex instanceof InvalidPDFException ||\n    ex instanceof PasswordException ||\n    ex instanceof ResponseException ||\n    ex instanceof UnknownErrorException\n  ) {\n    // Avoid re-creating the exception when its type is already correct.\n    return ex;\n  }\n\n  if (!(ex instanceof Error || (typeof ex === \"object\" && ex !== null))) {\n    unreachable(\n      'wrapReason: Expected \"reason\" to be a (possibly cloned) Error.'\n    );\n  }\n  switch (ex.name) {\n    case \"AbortException\":\n      return new AbortException(ex.message);\n    case \"InvalidPDFException\":\n      return new InvalidPDFException(ex.message);\n    case \"PasswordException\":\n      return new PasswordException(ex.message, ex.code);\n    case \"ResponseException\":\n      return new ResponseException(ex.message, ex.status, ex.missing);\n    case \"UnknownErrorException\":\n      return new UnknownErrorException(ex.message, ex.details);\n  }\n  return new UnknownErrorException(ex.message, ex.toString());\n}\n\nclass MessageHandler {\n  #messageAC = new AbortController();\n\n  constructor(sourceName, targetName, comObj) {\n    this.sourceName = sourceName;\n    this.targetName = targetName;\n    this.comObj = comObj;\n    this.callbackId = 1;\n    this.streamId = 1;\n    this.streamSinks = Object.create(null);\n    this.streamControllers = Object.create(null);\n    this.callbackCapabilities = Object.create(null);\n    this.actionHandler = Object.create(null);\n\n    comObj.addEventListener(\"message\", this.#onMessage.bind(this), {\n      signal: this.#messageAC.signal,\n    });\n  }\n\n  #onMessage({ data }) {\n    if (data.targetName !== this.sourceName) {\n      return;\n    }\n    if (data.stream) {\n      this.#processStreamMessage(data);\n      return;\n    }\n    if (data.callback) {\n      const callbackId = data.callbackId;\n      const capability = this.callbackCapabilities[callbackId];\n      if (!capability) {\n        throw new Error(`Cannot resolve callback ${callbackId}`);\n      }\n      delete this.callbackCapabilities[callbackId];\n\n      if (data.callback === CallbackKind.DATA) {\n        capability.resolve(data.data);\n      } else if (data.callback === CallbackKind.ERROR) {\n        capability.reject(wrapReason(data.reason));\n      } else {\n        throw new Error(\"Unexpected callback case\");\n      }\n      return;\n    }\n    const action = this.actionHandler[data.action];\n    if (!action) {\n      throw new Error(`Unknown action from worker: ${data.action}`);\n    }\n    if (data.callbackId) {\n      const sourceName = this.sourceName,\n        targetName = data.sourceName,\n        comObj = this.comObj;\n\n      Promise.try(action, data.data).then(\n        function (result) {\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            callback: CallbackKind.DATA,\n            callbackId: data.callbackId,\n            data: result,\n          });\n        },\n        function (reason) {\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            callback: CallbackKind.ERROR,\n            callbackId: data.callbackId,\n            reason: wrapReason(reason),\n          });\n        }\n      );\n      return;\n    }\n    if (data.streamId) {\n      this.#createStreamSink(data);\n      return;\n    }\n    action(data.data);\n  }\n\n  on(actionName, handler) {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        typeof handler === \"function\",\n        'MessageHandler.on: Expected \"handler\" to be a function.'\n      );\n    }\n    const ah = this.actionHandler;\n    if (ah[actionName]) {\n      throw new Error(`There is already an actionName called \"${actionName}\"`);\n    }\n    ah[actionName] = handler;\n  }\n\n  /**\n   * Sends a message to the comObj to invoke the action with the supplied data.\n   * @param {string} actionName - Action to call.\n   * @param {JSON} data - JSON data to send.\n   * @param {Array} [transfers] - List of transfers/ArrayBuffers.\n   */\n  send(actionName, data, transfers) {\n    this.comObj.postMessage(\n      {\n        sourceName: this.sourceName,\n        targetName: this.targetName,\n        action: actionName,\n        data,\n      },\n      transfers\n    );\n  }\n\n  /**\n   * Sends a message to the comObj to invoke the action with the supplied data.\n   * Expects that the other side will callback with the response.\n   * @param {string} actionName - Action to call.\n   * @param {JSON} data - JSON data to send.\n   * @param {Array} [transfers] - List of transfers/ArrayBuffers.\n   * @returns {Promise} Promise to be resolved with response data.\n   */\n  sendWithPromise(actionName, data, transfers) {\n    const callbackId = this.callbackId++;\n    const capability = Promise.withResolvers();\n    this.callbackCapabilities[callbackId] = capability;\n    try {\n      this.comObj.postMessage(\n        {\n          sourceName: this.sourceName,\n          targetName: this.targetName,\n          action: actionName,\n          callbackId,\n          data,\n        },\n        transfers\n      );\n    } catch (ex) {\n      capability.reject(ex);\n    }\n    return capability.promise;\n  }\n\n  /**\n   * Sends a message to the comObj to invoke the action with the supplied data.\n   * Expect that the other side will callback to signal 'start_complete'.\n   * @param {string} actionName - Action to call.\n   * @param {JSON} data - JSON data to send.\n   * @param {Object} queueingStrategy - Strategy to signal backpressure based on\n   *                 internal queue.\n   * @param {Array} [transfers] - List of transfers/ArrayBuffers.\n   * @returns {ReadableStream} ReadableStream to read data in chunks.\n   */\n  sendWithStream(actionName, data, queueingStrategy, transfers) {\n    const streamId = this.streamId++,\n      sourceName = this.sourceName,\n      targetName = this.targetName,\n      comObj = this.comObj;\n\n    return new ReadableStream(\n      {\n        start: controller => {\n          const startCapability = Promise.withResolvers();\n          this.streamControllers[streamId] = {\n            controller,\n            startCall: startCapability,\n            pullCall: null,\n            cancelCall: null,\n            isClosed: false,\n          };\n          comObj.postMessage(\n            {\n              sourceName,\n              targetName,\n              action: actionName,\n              streamId,\n              data,\n              desiredSize: controller.desiredSize,\n            },\n            transfers\n          );\n          // Return Promise for Async process, to signal success/failure.\n          return startCapability.promise;\n        },\n\n        pull: controller => {\n          const pullCapability = Promise.withResolvers();\n          this.streamControllers[streamId].pullCall = pullCapability;\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            stream: StreamKind.PULL,\n            streamId,\n            desiredSize: controller.desiredSize,\n          });\n          // Returning Promise will not call \"pull\"\n          // again until current pull is resolved.\n          return pullCapability.promise;\n        },\n\n        cancel: reason => {\n          assert(reason instanceof Error, \"cancel must have a valid reason\");\n          const cancelCapability = Promise.withResolvers();\n          this.streamControllers[streamId].cancelCall = cancelCapability;\n          this.streamControllers[streamId].isClosed = true;\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            stream: StreamKind.CANCEL,\n            streamId,\n            reason: wrapReason(reason),\n          });\n          // Return Promise to signal success or failure.\n          return cancelCapability.promise;\n        },\n      },\n      queueingStrategy\n    );\n  }\n\n  #createStreamSink(data) {\n    const streamId = data.streamId,\n      sourceName = this.sourceName,\n      targetName = data.sourceName,\n      comObj = this.comObj;\n    const self = this,\n      action = this.actionHandler[data.action];\n\n    const streamSink = {\n      enqueue(chunk, size = 1, transfers) {\n        if (this.isCancelled) {\n          return;\n        }\n        const lastDesiredSize = this.desiredSize;\n        this.desiredSize -= size;\n        // Enqueue decreases the desiredSize property of sink,\n        // so when it changes from positive to negative,\n        // set ready as unresolved promise.\n        if (lastDesiredSize > 0 && this.desiredSize <= 0) {\n          this.sinkCapability = Promise.withResolvers();\n          this.ready = this.sinkCapability.promise;\n        }\n        comObj.postMessage(\n          {\n            sourceName,\n            targetName,\n            stream: StreamKind.ENQUEUE,\n            streamId,\n            chunk,\n          },\n          transfers\n        );\n      },\n\n      close() {\n        if (this.isCancelled) {\n          return;\n        }\n        this.isCancelled = true;\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.CLOSE,\n          streamId,\n        });\n        delete self.streamSinks[streamId];\n      },\n\n      error(reason) {\n        assert(reason instanceof Error, \"error must have a valid reason\");\n        if (this.isCancelled) {\n          return;\n        }\n        this.isCancelled = true;\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.ERROR,\n          streamId,\n          reason: wrapReason(reason),\n        });\n      },\n\n      sinkCapability: Promise.withResolvers(),\n      onPull: null,\n      onCancel: null,\n      isCancelled: false,\n      desiredSize: data.desiredSize,\n      ready: null,\n    };\n\n    streamSink.sinkCapability.resolve();\n    streamSink.ready = streamSink.sinkCapability.promise;\n    this.streamSinks[streamId] = streamSink;\n\n    Promise.try(action, data.data, streamSink).then(\n      function () {\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.START_COMPLETE,\n          streamId,\n          success: true,\n        });\n      },\n      function (reason) {\n        comObj.postMessage({\n          sourceName,\n          targetName,\n          stream: StreamKind.START_COMPLETE,\n          streamId,\n          reason: wrapReason(reason),\n        });\n      }\n    );\n  }\n\n  #processStreamMessage(data) {\n    const streamId = data.streamId,\n      sourceName = this.sourceName,\n      targetName = data.sourceName,\n      comObj = this.comObj;\n    const streamController = this.streamControllers[streamId],\n      streamSink = this.streamSinks[streamId];\n\n    switch (data.stream) {\n      case StreamKind.START_COMPLETE:\n        if (data.success) {\n          streamController.startCall.resolve();\n        } else {\n          streamController.startCall.reject(wrapReason(data.reason));\n        }\n        break;\n      case StreamKind.PULL_COMPLETE:\n        if (data.success) {\n          streamController.pullCall.resolve();\n        } else {\n          streamController.pullCall.reject(wrapReason(data.reason));\n        }\n        break;\n      case StreamKind.PULL:\n        // Ignore any pull after close is called.\n        if (!streamSink) {\n          comObj.postMessage({\n            sourceName,\n            targetName,\n            stream: StreamKind.PULL_COMPLETE,\n            streamId,\n            success: true,\n          });\n          break;\n        }\n        // Pull increases the desiredSize property of sink, so when it changes\n        // from negative to positive, set ready property as resolved promise.\n        if (streamSink.desiredSize <= 0 && data.desiredSize > 0) {\n          streamSink.sinkCapability.resolve();\n        }\n        // Reset desiredSize property of sink on every pull.\n        streamSink.desiredSize = data.desiredSize;\n\n        Promise.try(streamSink.onPull || onFn).then(\n          function () {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.PULL_COMPLETE,\n              streamId,\n              success: true,\n            });\n          },\n          function (reason) {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.PULL_COMPLETE,\n              streamId,\n              reason: wrapReason(reason),\n            });\n          }\n        );\n        break;\n      case StreamKind.ENQUEUE:\n        assert(streamController, \"enqueue should have stream controller\");\n        if (streamController.isClosed) {\n          break;\n        }\n        streamController.controller.enqueue(data.chunk);\n        break;\n      case StreamKind.CLOSE:\n        assert(streamController, \"close should have stream controller\");\n        if (streamController.isClosed) {\n          break;\n        }\n        streamController.isClosed = true;\n        streamController.controller.close();\n        this.#deleteStreamController(streamController, streamId);\n        break;\n      case StreamKind.ERROR:\n        assert(streamController, \"error should have stream controller\");\n        streamController.controller.error(wrapReason(data.reason));\n        this.#deleteStreamController(streamController, streamId);\n        break;\n      case StreamKind.CANCEL_COMPLETE:\n        if (data.success) {\n          streamController.cancelCall.resolve();\n        } else {\n          streamController.cancelCall.reject(wrapReason(data.reason));\n        }\n        this.#deleteStreamController(streamController, streamId);\n        break;\n      case StreamKind.CANCEL:\n        if (!streamSink) {\n          break;\n        }\n        const dataReason = wrapReason(data.reason);\n\n        Promise.try(streamSink.onCancel || onFn, dataReason).then(\n          function () {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.CANCEL_COMPLETE,\n              streamId,\n              success: true,\n            });\n          },\n          function (reason) {\n            comObj.postMessage({\n              sourceName,\n              targetName,\n              stream: StreamKind.CANCEL_COMPLETE,\n              streamId,\n              reason: wrapReason(reason),\n            });\n          }\n        );\n        streamSink.sinkCapability.reject(dataReason);\n        streamSink.isCancelled = true;\n        delete this.streamSinks[streamId];\n        break;\n      default:\n        throw new Error(\"Unexpected stream case\");\n    }\n  }\n\n  async #deleteStreamController(streamController, streamId) {\n    // Delete the `streamController` only when the start, pull, and cancel\n    // capabilities have settled, to prevent `TypeError`s.\n    await Promise.allSettled([\n      streamController.startCall?.promise,\n      streamController.pullCall?.promise,\n      streamController.cancelCall?.promise,\n    ]);\n    delete this.streamControllers[streamId];\n  }\n\n  destroy() {\n    this.#messageAC?.abort();\n    this.#messageAC = null;\n  }\n}\n\nexport { MessageHandler, wrapReason };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { unreachable } from \"../shared/util.js\";\n\nclass BaseCanvasFactory {\n  #enableHWA = false;\n\n  constructor({ enableHWA = false }) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseCanvasFactory\n    ) {\n      unreachable(\"Cannot initialize BaseCanvasFactory.\");\n    }\n    this.#enableHWA = enableHWA;\n  }\n\n  create(width, height) {\n    if (width <= 0 || height <= 0) {\n      throw new Error(\"Invalid canvas size\");\n    }\n    const canvas = this._createCanvas(width, height);\n    return {\n      canvas,\n      context: canvas.getContext(\"2d\", {\n        willReadFrequently: !this.#enableHWA,\n      }),\n    };\n  }\n\n  reset(canvasAndContext, width, height) {\n    if (!canvasAndContext.canvas) {\n      throw new Error(\"Canvas is not specified\");\n    }\n    if (width <= 0 || height <= 0) {\n      throw new Error(\"Invalid canvas size\");\n    }\n    canvasAndContext.canvas.width = width;\n    canvasAndContext.canvas.height = height;\n  }\n\n  destroy(canvasAndContext) {\n    if (!canvasAndContext.canvas) {\n      throw new Error(\"Canvas is not specified\");\n    }\n    // Zeroing the width and height cause Firefox to release graphics\n    // resources immediately, which can greatly reduce memory consumption.\n    canvasAndContext.canvas.width = 0;\n    canvasAndContext.canvas.height = 0;\n    canvasAndContext.canvas = null;\n    canvasAndContext.context = null;\n  }\n\n  /**\n   * @ignore\n   */\n  _createCanvas(width, height) {\n    unreachable(\"Abstract method `_createCanvas` called.\");\n  }\n}\n\nclass DOMCanvasFactory extends BaseCanvasFactory {\n  constructor({ ownerDocument = globalThis.document, enableHWA = false }) {\n    super({ enableHWA });\n    this._document = ownerDocument;\n  }\n\n  /**\n   * @ignore\n   */\n  _createCanvas(width, height) {\n    const canvas = this._document.createElement(\"canvas\");\n    canvas.width = width;\n    canvas.height = height;\n    return canvas;\n  }\n}\n\nexport { BaseCanvasFactory, DOMCanvasFactory };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { stringToBytes, unreachable } from \"../shared/util.js\";\nimport { fetchData } from \"./display_utils.js\";\n\nclass BaseCMapReaderFactory {\n  constructor({ baseUrl = null, isCompressed = true }) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseCMapReaderFactory\n    ) {\n      unreachable(\"Cannot initialize BaseCMapReaderFactory.\");\n    }\n    this.baseUrl = baseUrl;\n    this.isCompressed = isCompressed;\n  }\n\n  async fetch({ name }) {\n    if (!this.baseUrl) {\n      throw new Error(\n        \"Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.\"\n      );\n    }\n    if (!name) {\n      throw new Error(\"CMap name must be specified.\");\n    }\n    const url = this.baseUrl + name + (this.isCompressed ? \".bcmap\" : \"\");\n\n    return this._fetch(url)\n      .then(cMapData => ({ cMapData, isCompressed: this.isCompressed }))\n      .catch(reason => {\n        throw new Error(\n          `Unable to load ${this.isCompressed ? \"binary \" : \"\"}CMap at: ${url}`\n        );\n      });\n  }\n\n  /**\n   * @ignore\n   * @returns {Promise<Uint8Array>}\n   */\n  async _fetch(url) {\n    unreachable(\"Abstract method `_fetch` called.\");\n  }\n}\n\nclass DOMCMapReaderFactory extends BaseCMapReaderFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    const data = await fetchData(\n      url,\n      /* type = */ this.isCompressed ? \"arraybuffer\" : \"text\"\n    );\n    return data instanceof ArrayBuffer\n      ? new Uint8Array(data)\n      : stringToBytes(data);\n  }\n}\n\nexport { BaseCMapReaderFactory, DOMCMapReaderFactory };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { getRGB, isDataScheme, SVG_NS } from \"./display_utils.js\";\nimport { unreachable, updateUrlHash, Util, warn } from \"../shared/util.js\";\n\nclass BaseFilterFactory {\n  constructor() {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseFilterFactory\n    ) {\n      unreachable(\"Cannot initialize BaseFilterFactory.\");\n    }\n  }\n\n  addFilter(maps) {\n    return \"none\";\n  }\n\n  addHCMFilter(fgColor, bgColor) {\n    return \"none\";\n  }\n\n  addAlphaFilter(map) {\n    return \"none\";\n  }\n\n  addLuminosityFilter(map) {\n    return \"none\";\n  }\n\n  addHighlightHCMFilter(filterName, fgColor, bgColor, newFgColor, newBgColor) {\n    return \"none\";\n  }\n\n  destroy(keepHCM = false) {}\n}\n\n/**\n * FilterFactory aims to create some SVG filters we can use when drawing an\n * image (or whatever) on a canvas.\n * Filters aren't applied with ctx.putImageData because it just overwrites the\n * underlying pixels.\n * With these filters, it's possible for example to apply some transfer maps on\n * an image without the need to apply them on the pixel arrays: the renderer\n * does the magic for us.\n */\nclass DOMFilterFactory extends BaseFilterFactory {\n  #baseUrl;\n\n  #_cache;\n\n  #_defs;\n\n  #docId;\n\n  #document;\n\n  #_hcmCache;\n\n  #id = 0;\n\n  constructor({ docId, ownerDocument = globalThis.document }) {\n    super();\n    this.#docId = docId;\n    this.#document = ownerDocument;\n  }\n\n  get #cache() {\n    return (this.#_cache ||= new Map());\n  }\n\n  get #hcmCache() {\n    return (this.#_hcmCache ||= new Map());\n  }\n\n  get #defs() {\n    if (!this.#_defs) {\n      const div = this.#document.createElement(\"div\");\n      const { style } = div;\n      style.visibility = \"hidden\";\n      style.contain = \"strict\";\n      style.width = style.height = 0;\n      style.position = \"absolute\";\n      style.top = style.left = 0;\n      style.zIndex = -1;\n\n      const svg = this.#document.createElementNS(SVG_NS, \"svg\");\n      svg.setAttribute(\"width\", 0);\n      svg.setAttribute(\"height\", 0);\n      this.#_defs = this.#document.createElementNS(SVG_NS, \"defs\");\n      div.append(svg);\n      svg.append(this.#_defs);\n      this.#document.body.append(div);\n    }\n    return this.#_defs;\n  }\n\n  #createTables(maps) {\n    if (maps.length === 1) {\n      const mapR = maps[0];\n      const buffer = new Array(256);\n      for (let i = 0; i < 256; i++) {\n        buffer[i] = mapR[i] / 255;\n      }\n\n      const table = buffer.join(\",\");\n      return [table, table, table];\n    }\n\n    const [mapR, mapG, mapB] = maps;\n    const bufferR = new Array(256);\n    const bufferG = new Array(256);\n    const bufferB = new Array(256);\n    for (let i = 0; i < 256; i++) {\n      bufferR[i] = mapR[i] / 255;\n      bufferG[i] = mapG[i] / 255;\n      bufferB[i] = mapB[i] / 255;\n    }\n    return [bufferR.join(\",\"), bufferG.join(\",\"), bufferB.join(\",\")];\n  }\n\n  #createUrl(id) {\n    if (this.#baseUrl === undefined) {\n      // Unless a `<base>`-element is present a relative URL should work.\n      this.#baseUrl = \"\";\n\n      const url = this.#document.URL;\n      if (url !== this.#document.baseURI) {\n        if (isDataScheme(url)) {\n          warn('#createUrl: ignore \"data:\"-URL for performance reasons.');\n        } else {\n          this.#baseUrl = updateUrlHash(url, \"\");\n        }\n      }\n    }\n    return `url(${this.#baseUrl}#${id})`;\n  }\n\n  addFilter(maps) {\n    if (!maps) {\n      return \"none\";\n    }\n\n    // When a page is zoomed the page is re-drawn but the maps are likely\n    // the same.\n    let value = this.#cache.get(maps);\n    if (value) {\n      return value;\n    }\n\n    const [tableR, tableG, tableB] = this.#createTables(maps);\n    const key = maps.length === 1 ? tableR : `${tableR}${tableG}${tableB}`;\n\n    value = this.#cache.get(key);\n    if (value) {\n      this.#cache.set(maps, value);\n      return value;\n    }\n\n    // We create a SVG filter: feComponentTransferElement\n    //  https://www.w3.org/TR/SVG11/filters.html#feComponentTransferElement\n\n    const id = `g_${this.#docId}_transfer_map_${this.#id++}`;\n    const url = this.#createUrl(id);\n    this.#cache.set(maps, url);\n    this.#cache.set(key, url);\n\n    const filter = this.#createFilter(id);\n    this.#addTransferMapConversion(tableR, tableG, tableB, filter);\n\n    return url;\n  }\n\n  addHCMFilter(fgColor, bgColor) {\n    const key = `${fgColor}-${bgColor}`;\n    const filterName = \"base\";\n    let info = this.#hcmCache.get(filterName);\n    if (info?.key === key) {\n      return info.url;\n    }\n\n    if (info) {\n      info.filter?.remove();\n      info.key = key;\n      info.url = \"none\";\n      info.filter = null;\n    } else {\n      info = {\n        key,\n        url: \"none\",\n        filter: null,\n      };\n      this.#hcmCache.set(filterName, info);\n    }\n\n    if (!fgColor || !bgColor) {\n      return info.url;\n    }\n\n    const fgRGB = this.#getRGB(fgColor);\n    fgColor = Util.makeHexColor(...fgRGB);\n    const bgRGB = this.#getRGB(bgColor);\n    bgColor = Util.makeHexColor(...bgRGB);\n    this.#defs.style.color = \"\";\n\n    if (\n      (fgColor === \"#000000\" && bgColor === \"#ffffff\") ||\n      fgColor === bgColor\n    ) {\n      return info.url;\n    }\n\n    // https://developer.mozilla.org/en-US/docs/Web/Accessibility/Understanding_Colors_and_Luminance\n    //\n    // Relative luminance:\n    // https://www.w3.org/TR/WCAG20/#relativeluminancedef\n    //\n    // We compute the rounded luminance of the default background color.\n    // Then for every color in the pdf, if its rounded luminance is the\n    // same as the background one then it's replaced by the new\n    // background color else by the foreground one.\n    const map = new Array(256);\n    for (let i = 0; i <= 255; i++) {\n      const x = i / 255;\n      map[i] = x <= 0.03928 ? x / 12.92 : ((x + 0.055) / 1.055) ** 2.4;\n    }\n    const table = map.join(\",\");\n\n    const id = `g_${this.#docId}_hcm_filter`;\n    const filter = (info.filter = this.#createFilter(id));\n    this.#addTransferMapConversion(table, table, table, filter);\n    this.#addGrayConversion(filter);\n\n    const getSteps = (c, n) => {\n      const start = fgRGB[c] / 255;\n      const end = bgRGB[c] / 255;\n      const arr = new Array(n + 1);\n      for (let i = 0; i <= n; i++) {\n        arr[i] = start + (i / n) * (end - start);\n      }\n      return arr.join(\",\");\n    };\n    this.#addTransferMapConversion(\n      getSteps(0, 5),\n      getSteps(1, 5),\n      getSteps(2, 5),\n      filter\n    );\n\n    info.url = this.#createUrl(id);\n    return info.url;\n  }\n\n  addAlphaFilter(map) {\n    // When a page is zoomed the page is re-drawn but the maps are likely\n    // the same.\n    let value = this.#cache.get(map);\n    if (value) {\n      return value;\n    }\n\n    const [tableA] = this.#createTables([map]);\n    const key = `alpha_${tableA}`;\n\n    value = this.#cache.get(key);\n    if (value) {\n      this.#cache.set(map, value);\n      return value;\n    }\n\n    const id = `g_${this.#docId}_alpha_map_${this.#id++}`;\n    const url = this.#createUrl(id);\n    this.#cache.set(map, url);\n    this.#cache.set(key, url);\n\n    const filter = this.#createFilter(id);\n    this.#addTransferMapAlphaConversion(tableA, filter);\n\n    return url;\n  }\n\n  addLuminosityFilter(map) {\n    // When a page is zoomed the page is re-drawn but the maps are likely\n    // the same.\n    let value = this.#cache.get(map || \"luminosity\");\n    if (value) {\n      return value;\n    }\n\n    let tableA, key;\n    if (map) {\n      [tableA] = this.#createTables([map]);\n      key = `luminosity_${tableA}`;\n    } else {\n      key = \"luminosity\";\n    }\n\n    value = this.#cache.get(key);\n    if (value) {\n      this.#cache.set(map, value);\n      return value;\n    }\n\n    const id = `g_${this.#docId}_luminosity_map_${this.#id++}`;\n    const url = this.#createUrl(id);\n    this.#cache.set(map, url);\n    this.#cache.set(key, url);\n\n    const filter = this.#createFilter(id);\n    this.#addLuminosityConversion(filter);\n    if (map) {\n      this.#addTransferMapAlphaConversion(tableA, filter);\n    }\n\n    return url;\n  }\n\n  addHighlightHCMFilter(filterName, fgColor, bgColor, newFgColor, newBgColor) {\n    const key = `${fgColor}-${bgColor}-${newFgColor}-${newBgColor}`;\n    let info = this.#hcmCache.get(filterName);\n    if (info?.key === key) {\n      return info.url;\n    }\n\n    if (info) {\n      info.filter?.remove();\n      info.key = key;\n      info.url = \"none\";\n      info.filter = null;\n    } else {\n      info = {\n        key,\n        url: \"none\",\n        filter: null,\n      };\n      this.#hcmCache.set(filterName, info);\n    }\n\n    if (!fgColor || !bgColor) {\n      return info.url;\n    }\n\n    const [fgRGB, bgRGB] = [fgColor, bgColor].map(this.#getRGB.bind(this));\n    let fgGray = Math.round(\n      0.2126 * fgRGB[0] + 0.7152 * fgRGB[1] + 0.0722 * fgRGB[2]\n    );\n    let bgGray = Math.round(\n      0.2126 * bgRGB[0] + 0.7152 * bgRGB[1] + 0.0722 * bgRGB[2]\n    );\n    let [newFgRGB, newBgRGB] = [newFgColor, newBgColor].map(\n      this.#getRGB.bind(this)\n    );\n    if (bgGray < fgGray) {\n      [fgGray, bgGray, newFgRGB, newBgRGB] = [\n        bgGray,\n        fgGray,\n        newBgRGB,\n        newFgRGB,\n      ];\n    }\n    this.#defs.style.color = \"\";\n\n    // Now we can create the filters to highlight some canvas parts.\n    // The colors in the pdf will almost be Canvas and CanvasText, hence we\n    // want to filter them to finally get Highlight and HighlightText.\n    // Since we're in HCM the background color and the foreground color should\n    // be really different when converted to grayscale (if they're not then it\n    // means that we've a poor contrast). Once the canvas colors are converted\n    // to grayscale we can easily map them on their new colors.\n    // The grayscale step is important because if we've something like:\n    //   fgColor = #FF....\n    //   bgColor = #FF....\n    //   then we are enable to map the red component on the new red components\n    //   which can be different.\n\n    const getSteps = (fg, bg, n) => {\n      const arr = new Array(256);\n      const step = (bgGray - fgGray) / n;\n      const newStart = fg / 255;\n      const newStep = (bg - fg) / (255 * n);\n      let prev = 0;\n      for (let i = 0; i <= n; i++) {\n        const k = Math.round(fgGray + i * step);\n        const value = newStart + i * newStep;\n        for (let j = prev; j <= k; j++) {\n          arr[j] = value;\n        }\n        prev = k + 1;\n      }\n      for (let i = prev; i < 256; i++) {\n        arr[i] = arr[prev - 1];\n      }\n      return arr.join(\",\");\n    };\n\n    const id = `g_${this.#docId}_hcm_${filterName}_filter`;\n    const filter = (info.filter = this.#createFilter(id));\n\n    this.#addGrayConversion(filter);\n    this.#addTransferMapConversion(\n      getSteps(newFgRGB[0], newBgRGB[0], 5),\n      getSteps(newFgRGB[1], newBgRGB[1], 5),\n      getSteps(newFgRGB[2], newBgRGB[2], 5),\n      filter\n    );\n\n    info.url = this.#createUrl(id);\n    return info.url;\n  }\n\n  destroy(keepHCM = false) {\n    if (keepHCM && this.#_hcmCache?.size) {\n      return;\n    }\n    this.#_defs?.parentNode.parentNode.remove();\n    this.#_defs = null;\n\n    this.#_cache?.clear();\n    this.#_cache = null;\n\n    this.#_hcmCache?.clear();\n    this.#_hcmCache = null;\n\n    this.#id = 0;\n  }\n\n  #addLuminosityConversion(filter) {\n    const feColorMatrix = this.#document.createElementNS(\n      SVG_NS,\n      \"feColorMatrix\"\n    );\n    feColorMatrix.setAttribute(\"type\", \"matrix\");\n    feColorMatrix.setAttribute(\n      \"values\",\n      \"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0\"\n    );\n    filter.append(feColorMatrix);\n  }\n\n  #addGrayConversion(filter) {\n    const feColorMatrix = this.#document.createElementNS(\n      SVG_NS,\n      \"feColorMatrix\"\n    );\n    feColorMatrix.setAttribute(\"type\", \"matrix\");\n    feColorMatrix.setAttribute(\n      \"values\",\n      \"0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0\"\n    );\n    filter.append(feColorMatrix);\n  }\n\n  #createFilter(id) {\n    const filter = this.#document.createElementNS(SVG_NS, \"filter\");\n    filter.setAttribute(\"color-interpolation-filters\", \"sRGB\");\n    filter.setAttribute(\"id\", id);\n    this.#defs.append(filter);\n\n    return filter;\n  }\n\n  #appendFeFunc(feComponentTransfer, func, table) {\n    const feFunc = this.#document.createElementNS(SVG_NS, func);\n    feFunc.setAttribute(\"type\", \"discrete\");\n    feFunc.setAttribute(\"tableValues\", table);\n    feComponentTransfer.append(feFunc);\n  }\n\n  #addTransferMapConversion(rTable, gTable, bTable, filter) {\n    const feComponentTransfer = this.#document.createElementNS(\n      SVG_NS,\n      \"feComponentTransfer\"\n    );\n    filter.append(feComponentTransfer);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncR\", rTable);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncG\", gTable);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncB\", bTable);\n  }\n\n  #addTransferMapAlphaConversion(aTable, filter) {\n    const feComponentTransfer = this.#document.createElementNS(\n      SVG_NS,\n      \"feComponentTransfer\"\n    );\n    filter.append(feComponentTransfer);\n    this.#appendFeFunc(feComponentTransfer, \"feFuncA\", aTable);\n  }\n\n  #getRGB(color) {\n    this.#defs.style.color = color;\n    return getRGB(getComputedStyle(this.#defs).getPropertyValue(\"color\"));\n  }\n}\n\nexport { BaseFilterFactory, DOMFilterFactory };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { fetchData } from \"./display_utils.js\";\nimport { unreachable } from \"../shared/util.js\";\n\nclass BaseStandardFontDataFactory {\n  constructor({ baseUrl = null }) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseStandardFontDataFactory\n    ) {\n      unreachable(\"Cannot initialize BaseStandardFontDataFactory.\");\n    }\n    this.baseUrl = baseUrl;\n  }\n\n  async fetch({ filename }) {\n    if (!this.baseUrl) {\n      throw new Error(\n        \"Ensure that the `standardFontDataUrl` API parameter is provided.\"\n      );\n    }\n    if (!filename) {\n      throw new Error(\"Font filename must be specified.\");\n    }\n    const url = `${this.baseUrl}${filename}`;\n\n    return this._fetch(url).catch(reason => {\n      throw new Error(`Unable to load font data at: ${url}`);\n    });\n  }\n\n  /**\n   * @ignore\n   * @returns {Promise<Uint8Array>}\n   */\n  async _fetch(url) {\n    unreachable(\"Abstract method `_fetch` called.\");\n  }\n}\n\nclass DOMStandardFontDataFactory extends BaseStandardFontDataFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    const data = await fetchData(url, /* type = */ \"arraybuffer\");\n    return new Uint8Array(data);\n  }\n}\n\nexport { BaseStandardFontDataFactory, DOMStandardFontDataFactory };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { fetchData } from \"./display_utils.js\";\nimport { unreachable } from \"../shared/util.js\";\n\nclass BaseWasmFactory {\n  constructor({ baseUrl = null }) {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseWasmFactory\n    ) {\n      unreachable(\"Cannot initialize BaseWasmFactory.\");\n    }\n    this.baseUrl = baseUrl;\n  }\n\n  async fetch({ filename }) {\n    if (!this.baseUrl) {\n      throw new Error(\"Ensure that the `wasmUrl` API parameter is provided.\");\n    }\n    if (!filename) {\n      throw new Error(\"Wasm filename must be specified.\");\n    }\n    const url = `${this.baseUrl}${filename}`;\n\n    return this._fetch(url).catch(reason => {\n      throw new Error(`Unable to load wasm data at: ${url}`);\n    });\n  }\n\n  /**\n   * @ignore\n   * @returns {Promise<Uint8Array>}\n   */\n  async _fetch(url) {\n    unreachable(\"Abstract method `_fetch` called.\");\n  }\n}\n\nclass DOMWasmFactory extends BaseWasmFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    const data = await fetchData(url, /* type = */ \"arraybuffer\");\n    return new Uint8Array(data);\n  }\n}\n\nexport { BaseWasmFactory, DOMWasmFactory };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* globals process */\n\nimport { isNodeJS, warn } from \"../shared/util.js\";\nimport { BaseCanvasFactory } from \"./canvas_factory.js\";\nimport { BaseCMapReaderFactory } from \"./cmap_reader_factory.js\";\nimport { BaseFilterFactory } from \"./filter_factory.js\";\nimport { BaseStandardFontDataFactory } from \"./standard_fontdata_factory.js\";\nimport { BaseWasmFactory } from \"./wasm_factory.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./node_utils.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nif (isNodeJS) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"SKIP_BABEL\")) {\n    warn(\"Please use the `legacy` build in Node.js environments.\");\n  } else {\n    let canvas;\n    try {\n      const require = process\n        .getBuiltinModule(\"module\")\n        .createRequire(import.meta.url);\n\n      try {\n        canvas = require(\"@napi-rs/canvas\");\n      } catch (ex) {\n        warn(`Cannot load \"@napi-rs/canvas\" package: \"${ex}\".`);\n      }\n    } catch (ex) {\n      warn(`Cannot access the \\`require\\` function: \"${ex}\".`);\n    }\n\n    if (!globalThis.DOMMatrix) {\n      if (canvas?.DOMMatrix) {\n        globalThis.DOMMatrix = canvas.DOMMatrix;\n      } else {\n        warn(\"Cannot polyfill `DOMMatrix`, rendering may be broken.\");\n      }\n    }\n    if (!globalThis.ImageData) {\n      if (canvas?.ImageData) {\n        globalThis.ImageData = canvas.ImageData;\n      } else {\n        warn(\"Cannot polyfill `ImageData`, rendering may be broken.\");\n      }\n    }\n    if (!globalThis.Path2D) {\n      if (canvas?.Path2D) {\n        globalThis.Path2D = canvas.Path2D;\n      } else {\n        warn(\"Cannot polyfill `Path2D`, rendering may be broken.\");\n      }\n    }\n    if (!globalThis.navigator?.language) {\n      globalThis.navigator = {\n        language: \"en-US\",\n        platform: \"\",\n        userAgent: \"\",\n      };\n    }\n  }\n}\n\nasync function fetchData(url) {\n  const fs = process.getBuiltinModule(\"fs\");\n  const data = await fs.promises.readFile(url);\n  return new Uint8Array(data);\n}\n\nclass NodeFilterFactory extends BaseFilterFactory {}\n\nclass NodeCanvasFactory extends BaseCanvasFactory {\n  /**\n   * @ignore\n   */\n  _createCanvas(width, height) {\n    const require = process\n      .getBuiltinModule(\"module\")\n      .createRequire(import.meta.url);\n    const canvas = require(\"@napi-rs/canvas\");\n    return canvas.createCanvas(width, height);\n  }\n}\n\nclass NodeCMapReaderFactory extends BaseCMapReaderFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    return fetchData(url);\n  }\n}\n\nclass NodeStandardFontDataFactory extends BaseStandardFontDataFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    return fetchData(url);\n  }\n}\n\nclass NodeWasmFactory extends BaseWasmFactory {\n  /**\n   * @ignore\n   */\n  async _fetch(url) {\n    return fetchData(url);\n  }\n}\n\nexport {\n  fetchData,\n  NodeCanvasFactory,\n  NodeCMapReaderFactory,\n  NodeFilterFactory,\n  NodeStandardFontDataFactory,\n  NodeWasmFactory,\n};\n","/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FormatError, info, unreachable, Util } from \"../shared/util.js\";\nimport { getCurrentTransform } from \"./display_utils.js\";\n\nconst PathType = {\n  FILL: \"Fill\",\n  STROKE: \"Stroke\",\n  SHADING: \"Shading\",\n};\n\nfunction applyBoundingBox(ctx, bbox) {\n  if (!bbox) {\n    return;\n  }\n  const width = bbox[2] - bbox[0];\n  const height = bbox[3] - bbox[1];\n  const region = new Path2D();\n  region.rect(bbox[0], bbox[1], width, height);\n  ctx.clip(region);\n}\n\nclass BaseShadingPattern {\n  constructor() {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseShadingPattern\n    ) {\n      unreachable(\"Cannot initialize BaseShadingPattern.\");\n    }\n  }\n\n  isModifyingCurrentTransform() {\n    return false;\n  }\n\n  getPattern() {\n    unreachable(\"Abstract method `getPattern` called.\");\n  }\n}\n\nclass RadialAxialShadingPattern extends BaseShadingPattern {\n  constructor(IR) {\n    super();\n    this._type = IR[1];\n    this._bbox = IR[2];\n    this._colorStops = IR[3];\n    this._p0 = IR[4];\n    this._p1 = IR[5];\n    this._r0 = IR[6];\n    this._r1 = IR[7];\n    this.matrix = null;\n  }\n\n  _createGradient(ctx) {\n    let grad;\n    if (this._type === \"axial\") {\n      grad = ctx.createLinearGradient(\n        this._p0[0],\n        this._p0[1],\n        this._p1[0],\n        this._p1[1]\n      );\n    } else if (this._type === \"radial\") {\n      grad = ctx.createRadialGradient(\n        this._p0[0],\n        this._p0[1],\n        this._r0,\n        this._p1[0],\n        this._p1[1],\n        this._r1\n      );\n    }\n\n    for (const colorStop of this._colorStops) {\n      grad.addColorStop(colorStop[0], colorStop[1]);\n    }\n    return grad;\n  }\n\n  getPattern(ctx, owner, inverse, pathType) {\n    let pattern;\n    if (pathType === PathType.STROKE || pathType === PathType.FILL) {\n      const ownerBBox = owner.current.getClippedPathBoundingBox(\n        pathType,\n        getCurrentTransform(ctx)\n      ) || [0, 0, 0, 0];\n      // Create a canvas that is only as big as the current path. This doesn't\n      // allow us to cache the pattern, but it generally creates much smaller\n      // canvases and saves memory use. See bug 1722807 for an example.\n      const width = Math.ceil(ownerBBox[2] - ownerBBox[0]) || 1;\n      const height = Math.ceil(ownerBBox[3] - ownerBBox[1]) || 1;\n\n      const tmpCanvas = owner.cachedCanvases.getCanvas(\n        \"pattern\",\n        width,\n        height\n      );\n\n      const tmpCtx = tmpCanvas.context;\n      tmpCtx.clearRect(0, 0, tmpCtx.canvas.width, tmpCtx.canvas.height);\n      tmpCtx.beginPath();\n      tmpCtx.rect(0, 0, tmpCtx.canvas.width, tmpCtx.canvas.height);\n      // Non shading fill patterns are positioned relative to the base transform\n      // (usually the page's initial transform), but we may have created a\n      // smaller canvas based on the path, so we must account for the shift.\n      tmpCtx.translate(-ownerBBox[0], -ownerBBox[1]);\n      inverse = Util.transform(inverse, [\n        1,\n        0,\n        0,\n        1,\n        ownerBBox[0],\n        ownerBBox[1],\n      ]);\n\n      tmpCtx.transform(...owner.baseTransform);\n      if (this.matrix) {\n        tmpCtx.transform(...this.matrix);\n      }\n      applyBoundingBox(tmpCtx, this._bbox);\n\n      tmpCtx.fillStyle = this._createGradient(tmpCtx);\n      tmpCtx.fill();\n\n      pattern = ctx.createPattern(tmpCanvas.canvas, \"no-repeat\");\n      const domMatrix = new DOMMatrix(inverse);\n      pattern.setTransform(domMatrix);\n    } else {\n      // Shading fills are applied relative to the current matrix which is also\n      // how canvas gradients work, so there's no need to do anything special\n      // here.\n      applyBoundingBox(ctx, this._bbox);\n      pattern = this._createGradient(ctx);\n    }\n    return pattern;\n  }\n}\n\nfunction drawTriangle(data, context, p1, p2, p3, c1, c2, c3) {\n  // Very basic Gouraud-shaded triangle rasterization algorithm.\n  const coords = context.coords,\n    colors = context.colors;\n  const bytes = data.data,\n    rowSize = data.width * 4;\n  let tmp;\n  if (coords[p1 + 1] > coords[p2 + 1]) {\n    tmp = p1;\n    p1 = p2;\n    p2 = tmp;\n    tmp = c1;\n    c1 = c2;\n    c2 = tmp;\n  }\n  if (coords[p2 + 1] > coords[p3 + 1]) {\n    tmp = p2;\n    p2 = p3;\n    p3 = tmp;\n    tmp = c2;\n    c2 = c3;\n    c3 = tmp;\n  }\n  if (coords[p1 + 1] > coords[p2 + 1]) {\n    tmp = p1;\n    p1 = p2;\n    p2 = tmp;\n    tmp = c1;\n    c1 = c2;\n    c2 = tmp;\n  }\n  const x1 = (coords[p1] + context.offsetX) * context.scaleX;\n  const y1 = (coords[p1 + 1] + context.offsetY) * context.scaleY;\n  const x2 = (coords[p2] + context.offsetX) * context.scaleX;\n  const y2 = (coords[p2 + 1] + context.offsetY) * context.scaleY;\n  const x3 = (coords[p3] + context.offsetX) * context.scaleX;\n  const y3 = (coords[p3 + 1] + context.offsetY) * context.scaleY;\n  if (y1 >= y3) {\n    return;\n  }\n  const c1r = colors[c1],\n    c1g = colors[c1 + 1],\n    c1b = colors[c1 + 2];\n  const c2r = colors[c2],\n    c2g = colors[c2 + 1],\n    c2b = colors[c2 + 2];\n  const c3r = colors[c3],\n    c3g = colors[c3 + 1],\n    c3b = colors[c3 + 2];\n\n  const minY = Math.round(y1),\n    maxY = Math.round(y3);\n  let xa, car, cag, cab;\n  let xb, cbr, cbg, cbb;\n  for (let y = minY; y <= maxY; y++) {\n    if (y < y2) {\n      const k = y < y1 ? 0 : (y1 - y) / (y1 - y2);\n      xa = x1 - (x1 - x2) * k;\n      car = c1r - (c1r - c2r) * k;\n      cag = c1g - (c1g - c2g) * k;\n      cab = c1b - (c1b - c2b) * k;\n    } else {\n      let k;\n      if (y > y3) {\n        k = 1;\n      } else if (y2 === y3) {\n        k = 0;\n      } else {\n        k = (y2 - y) / (y2 - y3);\n      }\n      xa = x2 - (x2 - x3) * k;\n      car = c2r - (c2r - c3r) * k;\n      cag = c2g - (c2g - c3g) * k;\n      cab = c2b - (c2b - c3b) * k;\n    }\n\n    let k;\n    if (y < y1) {\n      k = 0;\n    } else if (y > y3) {\n      k = 1;\n    } else {\n      k = (y1 - y) / (y1 - y3);\n    }\n    xb = x1 - (x1 - x3) * k;\n    cbr = c1r - (c1r - c3r) * k;\n    cbg = c1g - (c1g - c3g) * k;\n    cbb = c1b - (c1b - c3b) * k;\n    const x1_ = Math.round(Math.min(xa, xb));\n    const x2_ = Math.round(Math.max(xa, xb));\n    let j = rowSize * y + x1_ * 4;\n    for (let x = x1_; x <= x2_; x++) {\n      k = (xa - x) / (xa - xb);\n      if (k < 0) {\n        k = 0;\n      } else if (k > 1) {\n        k = 1;\n      }\n      bytes[j++] = (car - (car - cbr) * k) | 0;\n      bytes[j++] = (cag - (cag - cbg) * k) | 0;\n      bytes[j++] = (cab - (cab - cbb) * k) | 0;\n      bytes[j++] = 255;\n    }\n  }\n}\n\nfunction drawFigure(data, figure, context) {\n  const ps = figure.coords;\n  const cs = figure.colors;\n  let i, ii;\n  switch (figure.type) {\n    case \"lattice\":\n      const verticesPerRow = figure.verticesPerRow;\n      const rows = Math.floor(ps.length / verticesPerRow) - 1;\n      const cols = verticesPerRow - 1;\n      for (i = 0; i < rows; i++) {\n        let q = i * verticesPerRow;\n        for (let j = 0; j < cols; j++, q++) {\n          drawTriangle(\n            data,\n            context,\n            ps[q],\n            ps[q + 1],\n            ps[q + verticesPerRow],\n            cs[q],\n            cs[q + 1],\n            cs[q + verticesPerRow]\n          );\n          drawTriangle(\n            data,\n            context,\n            ps[q + verticesPerRow + 1],\n            ps[q + 1],\n            ps[q + verticesPerRow],\n            cs[q + verticesPerRow + 1],\n            cs[q + 1],\n            cs[q + verticesPerRow]\n          );\n        }\n      }\n      break;\n    case \"triangles\":\n      for (i = 0, ii = ps.length; i < ii; i += 3) {\n        drawTriangle(\n          data,\n          context,\n          ps[i],\n          ps[i + 1],\n          ps[i + 2],\n          cs[i],\n          cs[i + 1],\n          cs[i + 2]\n        );\n      }\n      break;\n    default:\n      throw new Error(\"illegal figure\");\n  }\n}\n\nclass MeshShadingPattern extends BaseShadingPattern {\n  constructor(IR) {\n    super();\n    this._coords = IR[2];\n    this._colors = IR[3];\n    this._figures = IR[4];\n    this._bounds = IR[5];\n    this._bbox = IR[6];\n    this._background = IR[7];\n    this.matrix = null;\n  }\n\n  _createMeshCanvas(combinedScale, backgroundColor, cachedCanvases) {\n    // we will increase scale on some weird factor to let antialiasing take\n    // care of \"rough\" edges\n    const EXPECTED_SCALE = 1.1;\n    // MAX_PATTERN_SIZE is used to avoid OOM situation.\n    const MAX_PATTERN_SIZE = 3000; // 10in @ 300dpi shall be enough\n    // We need to keep transparent border around our pattern for fill():\n    // createPattern with 'no-repeat' will bleed edges across entire area.\n    const BORDER_SIZE = 2;\n\n    const offsetX = Math.floor(this._bounds[0]);\n    const offsetY = Math.floor(this._bounds[1]);\n    const boundsWidth = Math.ceil(this._bounds[2]) - offsetX;\n    const boundsHeight = Math.ceil(this._bounds[3]) - offsetY;\n\n    const width = Math.min(\n      Math.ceil(Math.abs(boundsWidth * combinedScale[0] * EXPECTED_SCALE)),\n      MAX_PATTERN_SIZE\n    );\n    const height = Math.min(\n      Math.ceil(Math.abs(boundsHeight * combinedScale[1] * EXPECTED_SCALE)),\n      MAX_PATTERN_SIZE\n    );\n    const scaleX = boundsWidth / width;\n    const scaleY = boundsHeight / height;\n\n    const context = {\n      coords: this._coords,\n      colors: this._colors,\n      offsetX: -offsetX,\n      offsetY: -offsetY,\n      scaleX: 1 / scaleX,\n      scaleY: 1 / scaleY,\n    };\n\n    const paddedWidth = width + BORDER_SIZE * 2;\n    const paddedHeight = height + BORDER_SIZE * 2;\n\n    const tmpCanvas = cachedCanvases.getCanvas(\n      \"mesh\",\n      paddedWidth,\n      paddedHeight\n    );\n    const tmpCtx = tmpCanvas.context;\n\n    const data = tmpCtx.createImageData(width, height);\n    if (backgroundColor) {\n      const bytes = data.data;\n      for (let i = 0, ii = bytes.length; i < ii; i += 4) {\n        bytes[i] = backgroundColor[0];\n        bytes[i + 1] = backgroundColor[1];\n        bytes[i + 2] = backgroundColor[2];\n        bytes[i + 3] = 255;\n      }\n    }\n    for (const figure of this._figures) {\n      drawFigure(data, figure, context);\n    }\n    tmpCtx.putImageData(data, BORDER_SIZE, BORDER_SIZE);\n    const canvas = tmpCanvas.canvas;\n\n    return {\n      canvas,\n      offsetX: offsetX - BORDER_SIZE * scaleX,\n      offsetY: offsetY - BORDER_SIZE * scaleY,\n      scaleX,\n      scaleY,\n    };\n  }\n\n  isModifyingCurrentTransform() {\n    return true;\n  }\n\n  getPattern(ctx, owner, inverse, pathType) {\n    applyBoundingBox(ctx, this._bbox);\n    const scale = new Float32Array(2);\n    if (pathType === PathType.SHADING) {\n      Util.singularValueDecompose2dScale(getCurrentTransform(ctx), scale);\n    } else if (this.matrix) {\n      // Obtain scale from matrix and current transformation matrix.\n      Util.singularValueDecompose2dScale(this.matrix, scale);\n      const [matrixScaleX, matrixScaleY] = scale;\n      Util.singularValueDecompose2dScale(owner.baseTransform, scale);\n      scale[0] *= matrixScaleX;\n      scale[1] *= matrixScaleY;\n    } else {\n      Util.singularValueDecompose2dScale(owner.baseTransform, scale);\n    }\n\n    // Rasterizing on the main thread since sending/queue large canvases\n    // might cause OOM.\n    const temporaryPatternCanvas = this._createMeshCanvas(\n      scale,\n      pathType === PathType.SHADING ? null : this._background,\n      owner.cachedCanvases\n    );\n\n    if (pathType !== PathType.SHADING) {\n      ctx.setTransform(...owner.baseTransform);\n      if (this.matrix) {\n        ctx.transform(...this.matrix);\n      }\n    }\n\n    ctx.translate(\n      temporaryPatternCanvas.offsetX,\n      temporaryPatternCanvas.offsetY\n    );\n    ctx.scale(temporaryPatternCanvas.scaleX, temporaryPatternCanvas.scaleY);\n\n    return ctx.createPattern(temporaryPatternCanvas.canvas, \"no-repeat\");\n  }\n}\n\nclass DummyShadingPattern extends BaseShadingPattern {\n  getPattern() {\n    return \"hotpink\";\n  }\n}\n\nfunction getShadingPattern(IR) {\n  switch (IR[0]) {\n    case \"RadialAxial\":\n      return new RadialAxialShadingPattern(IR);\n    case \"Mesh\":\n      return new MeshShadingPattern(IR);\n    case \"Dummy\":\n      return new DummyShadingPattern();\n  }\n  throw new Error(`Unknown IR type: ${IR[0]}`);\n}\n\nconst PaintType = {\n  COLORED: 1,\n  UNCOLORED: 2,\n};\n\nclass TilingPattern {\n  // 10in @ 300dpi shall be enough.\n  static MAX_PATTERN_SIZE = 3000;\n\n  constructor(IR, ctx, canvasGraphicsFactory, baseTransform) {\n    this.color = IR[1];\n    this.operatorList = IR[2];\n    this.matrix = IR[3];\n    this.bbox = IR[4];\n    this.xstep = IR[5];\n    this.ystep = IR[6];\n    this.paintType = IR[7];\n    this.tilingType = IR[8];\n    this.ctx = ctx;\n    this.canvasGraphicsFactory = canvasGraphicsFactory;\n    this.baseTransform = baseTransform;\n  }\n\n  createPatternCanvas(owner) {\n    const {\n      bbox,\n      operatorList,\n      paintType,\n      tilingType,\n      color,\n      canvasGraphicsFactory,\n    } = this;\n    let { xstep, ystep } = this;\n    xstep = Math.abs(xstep);\n    ystep = Math.abs(ystep);\n\n    info(\"TilingType: \" + tilingType);\n\n    // A tiling pattern as defined by PDF spec 8.7.2 is a cell whose size is\n    // described by bbox, and may repeat regularly by shifting the cell by\n    // xstep and ystep.\n    // Because the HTML5 canvas API does not support pattern repetition with\n    // gaps in between, we use the xstep/ystep instead of the bbox's size.\n    //\n    // This has the following consequences (similarly for ystep):\n    //\n    // - If xstep is the same as bbox, then there is no observable difference.\n    //\n    // - If xstep is larger than bbox, then the pattern canvas is partially\n    //   empty: the area bounded by bbox is painted, the outside area is void.\n    //\n    // - If xstep is smaller than bbox, then the pixels between xstep and the\n    //   bbox boundary will be missing. This is INCORRECT behavior.\n    //   \"Figures on adjacent tiles should not overlap\" (PDF spec 8.7.3.1),\n    //   but overlapping cells without common pixels are still valid.\n\n    const x0 = bbox[0],\n      y0 = bbox[1],\n      x1 = bbox[2],\n      y1 = bbox[3];\n    const width = x1 - x0;\n    const height = y1 - y0;\n\n    // Obtain scale from matrix and current transformation matrix.\n    const scale = new Float32Array(2);\n    Util.singularValueDecompose2dScale(this.matrix, scale);\n    const [matrixScaleX, matrixScaleY] = scale;\n    Util.singularValueDecompose2dScale(this.baseTransform, scale);\n    const combinedScaleX = matrixScaleX * scale[0];\n    const combinedScaleY = matrixScaleY * scale[1];\n\n    let canvasWidth = width,\n      canvasHeight = height,\n      redrawHorizontally = false,\n      redrawVertically = false;\n\n    const xScaledStep = Math.ceil(xstep * combinedScaleX);\n    const yScaledStep = Math.ceil(ystep * combinedScaleY);\n    const xScaledWidth = Math.ceil(width * combinedScaleX);\n    const yScaledHeight = Math.ceil(height * combinedScaleY);\n\n    if (xScaledStep >= xScaledWidth) {\n      canvasWidth = xstep;\n    } else {\n      redrawHorizontally = true;\n    }\n    if (yScaledStep >= yScaledHeight) {\n      canvasHeight = ystep;\n    } else {\n      redrawVertically = true;\n    }\n\n    // Use width and height values that are as close as possible to the end\n    // result when the pattern is used. Too low value makes the pattern look\n    // blurry. Too large value makes it look too crispy.\n    const dimx = this.getSizeAndScale(\n      canvasWidth,\n      this.ctx.canvas.width,\n      combinedScaleX\n    );\n    const dimy = this.getSizeAndScale(\n      canvasHeight,\n      this.ctx.canvas.height,\n      combinedScaleY\n    );\n\n    const tmpCanvas = owner.cachedCanvases.getCanvas(\n      \"pattern\",\n      dimx.size,\n      dimy.size\n    );\n    const tmpCtx = tmpCanvas.context;\n    const graphics = canvasGraphicsFactory.createCanvasGraphics(tmpCtx);\n    graphics.groupLevel = owner.groupLevel;\n\n    this.setFillAndStrokeStyleToContext(graphics, paintType, color);\n\n    tmpCtx.translate(-dimx.scale * x0, -dimy.scale * y0);\n    graphics.transform(dimx.scale, 0, 0, dimy.scale, 0, 0);\n\n    // To match CanvasGraphics beginDrawing we must save the context here or\n    // else we end up with unbalanced save/restores.\n    tmpCtx.save();\n\n    this.clipBbox(graphics, x0, y0, x1, y1);\n\n    graphics.baseTransform = getCurrentTransform(graphics.ctx);\n\n    graphics.executeOperatorList(operatorList);\n\n    graphics.endDrawing();\n\n    tmpCtx.restore();\n\n    if (redrawHorizontally || redrawVertically) {\n      // The tile is overlapping itself, so we create a new tile with\n      // dimensions xstep * ystep.\n      // Then we draw the overlapping parts of the original tile on the new\n      // tile.\n      // Just as a side note, the code here works correctly even if we don't\n      // have to redraw the tile horizontally or vertically. In that case, the\n      // original tile is drawn on the new tile only once, but it's useless.\n      const image = tmpCanvas.canvas;\n      if (redrawHorizontally) {\n        canvasWidth = xstep;\n      }\n      if (redrawVertically) {\n        canvasHeight = ystep;\n      }\n\n      const dimx2 = this.getSizeAndScale(\n        canvasWidth,\n        this.ctx.canvas.width,\n        combinedScaleX\n      );\n      const dimy2 = this.getSizeAndScale(\n        canvasHeight,\n        this.ctx.canvas.height,\n        combinedScaleY\n      );\n\n      const xSize = dimx2.size;\n      const ySize = dimy2.size;\n      const tmpCanvas2 = owner.cachedCanvases.getCanvas(\n        \"pattern-workaround\",\n        xSize,\n        ySize\n      );\n      const tmpCtx2 = tmpCanvas2.context;\n      const ii = redrawHorizontally ? Math.floor(width / xstep) : 0;\n      const jj = redrawVertically ? Math.floor(height / ystep) : 0;\n\n      // Draw the overlapping parts of the original tile on the new tile.\n      for (let i = 0; i <= ii; i++) {\n        for (let j = 0; j <= jj; j++) {\n          tmpCtx2.drawImage(\n            image,\n            xSize * i,\n            ySize * j,\n            xSize,\n            ySize,\n            0,\n            0,\n            xSize,\n            ySize\n          );\n        }\n      }\n      return {\n        canvas: tmpCanvas2.canvas,\n        scaleX: dimx2.scale,\n        scaleY: dimy2.scale,\n        offsetX: x0,\n        offsetY: y0,\n      };\n    }\n\n    return {\n      canvas: tmpCanvas.canvas,\n      scaleX: dimx.scale,\n      scaleY: dimy.scale,\n      offsetX: x0,\n      offsetY: y0,\n    };\n  }\n\n  getSizeAndScale(step, realOutputSize, scale) {\n    // MAX_PATTERN_SIZE is used to avoid OOM situation.\n    // Use the destination canvas's size if it is bigger than the hard-coded\n    // limit of MAX_PATTERN_SIZE to avoid clipping patterns that cover the\n    // whole canvas.\n    const maxSize = Math.max(TilingPattern.MAX_PATTERN_SIZE, realOutputSize);\n    let size = Math.ceil(step * scale);\n    if (size >= maxSize) {\n      size = maxSize;\n    } else {\n      scale = size / step;\n    }\n    return { scale, size };\n  }\n\n  clipBbox(graphics, x0, y0, x1, y1) {\n    const bboxWidth = x1 - x0;\n    const bboxHeight = y1 - y0;\n    graphics.ctx.rect(x0, y0, bboxWidth, bboxHeight);\n    Util.axialAlignedBoundingBox(\n      [x0, y0, x1, y1],\n      getCurrentTransform(graphics.ctx),\n      graphics.current.minMax\n    );\n    graphics.clip();\n    graphics.endPath();\n  }\n\n  setFillAndStrokeStyleToContext(graphics, paintType, color) {\n    const context = graphics.ctx,\n      current = graphics.current;\n    switch (paintType) {\n      case PaintType.COLORED:\n        const { fillStyle, strokeStyle } = this.ctx;\n        context.fillStyle = current.fillColor = fillStyle;\n        context.strokeStyle = current.strokeColor = strokeStyle;\n        break;\n      case PaintType.UNCOLORED:\n        context.fillStyle = context.strokeStyle = color;\n        // Set color needed by image masks (fixes issues 3226 and 8741).\n        current.fillColor = current.strokeColor = color;\n        break;\n      default:\n        throw new FormatError(`Unsupported paint type: ${paintType}`);\n    }\n  }\n\n  isModifyingCurrentTransform() {\n    return false;\n  }\n\n  getPattern(ctx, owner, inverse, pathType) {\n    // PDF spec 8.7.2 NOTE 1: pattern's matrix is relative to initial matrix.\n    let matrix = inverse;\n    if (pathType !== PathType.SHADING) {\n      matrix = Util.transform(matrix, owner.baseTransform);\n      if (this.matrix) {\n        matrix = Util.transform(matrix, this.matrix);\n      }\n    }\n\n    const temporaryPatternCanvas = this.createPatternCanvas(owner);\n\n    let domMatrix = new DOMMatrix(matrix);\n    // Rescale and so that the ctx.createPattern call generates a pattern with\n    // the desired size.\n    domMatrix = domMatrix.translate(\n      temporaryPatternCanvas.offsetX,\n      temporaryPatternCanvas.offsetY\n    );\n    domMatrix = domMatrix.scale(\n      1 / temporaryPatternCanvas.scaleX,\n      1 / temporaryPatternCanvas.scaleY\n    );\n\n    const pattern = ctx.createPattern(temporaryPatternCanvas.canvas, \"repeat\");\n    pattern.setTransform(domMatrix);\n\n    return pattern;\n  }\n}\n\nexport { getShadingPattern, PathType, TilingPattern };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FeatureTest, ImageKind } from \"./util.js\";\n\nfunction convertToRGBA(params) {\n  switch (params.kind) {\n    case ImageKind.GRAYSCALE_1BPP:\n      return convertBlackAndWhiteToRGBA(params);\n    case ImageKind.RGB_24BPP:\n      return convertRGBToRGBA(params);\n  }\n\n  return null;\n}\n\nfunction convertBlackAndWhiteToRGBA({\n  src,\n  srcPos = 0,\n  dest,\n  width,\n  height,\n  nonBlackColor = 0xffffffff,\n  inverseDecode = false,\n}) {\n  const black = FeatureTest.isLittleEndian ? 0xff000000 : 0x000000ff;\n  const [zeroMapping, oneMapping] = inverseDecode\n    ? [nonBlackColor, black]\n    : [black, nonBlackColor];\n  const widthInSource = width >> 3;\n  const widthRemainder = width & 7;\n  const srcLength = src.length;\n  dest = new Uint32Array(dest.buffer);\n  let destPos = 0;\n\n  for (let i = 0; i < height; i++) {\n    for (const max = srcPos + widthInSource; srcPos < max; srcPos++) {\n      const elem = srcPos < srcLength ? src[srcPos] : 255;\n      dest[destPos++] = elem & 0b10000000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b1000000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b100000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b10000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b1000 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b100 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b10 ? oneMapping : zeroMapping;\n      dest[destPos++] = elem & 0b1 ? oneMapping : zeroMapping;\n    }\n    if (widthRemainder === 0) {\n      continue;\n    }\n    const elem = srcPos < srcLength ? src[srcPos++] : 255;\n    for (let j = 0; j < widthRemainder; j++) {\n      dest[destPos++] = elem & (1 << (7 - j)) ? oneMapping : zeroMapping;\n    }\n  }\n  return { srcPos, destPos };\n}\n\nfunction convertRGBToRGBA({\n  src,\n  srcPos = 0,\n  dest,\n  destPos = 0,\n  width,\n  height,\n}) {\n  let i = 0;\n  const len = width * height * 3;\n  const len32 = len >> 2;\n  const src32 = new Uint32Array(src.buffer, srcPos, len32);\n\n  if (FeatureTest.isLittleEndian) {\n    // It's a way faster to do the shuffle manually instead of working\n    // component by component with some Uint8 arrays.\n    for (; i < len32 - 2; i += 3, destPos += 4) {\n      const s1 = src32[i]; // R2B1G1R1\n      const s2 = src32[i + 1]; // G3R3B2G2\n      const s3 = src32[i + 2]; // B4G4R4B3\n\n      dest[destPos] = s1 | 0xff000000;\n      dest[destPos + 1] = (s1 >>> 24) | (s2 << 8) | 0xff000000;\n      dest[destPos + 2] = (s2 >>> 16) | (s3 << 16) | 0xff000000;\n      dest[destPos + 3] = (s3 >>> 8) | 0xff000000;\n    }\n\n    for (let j = i * 4, jj = srcPos + len; j < jj; j += 3) {\n      dest[destPos++] =\n        src[j] | (src[j + 1] << 8) | (src[j + 2] << 16) | 0xff000000;\n    }\n  } else {\n    for (; i < len32 - 2; i += 3, destPos += 4) {\n      const s1 = src32[i]; // R1G1B1R2\n      const s2 = src32[i + 1]; // G2B2R3G3\n      const s3 = src32[i + 2]; // B3R4G4B4\n\n      dest[destPos] = s1 | 0xff;\n      dest[destPos + 1] = (s1 << 24) | (s2 >>> 8) | 0xff;\n      dest[destPos + 2] = (s2 << 16) | (s3 >>> 16) | 0xff;\n      dest[destPos + 3] = (s3 << 8) | 0xff;\n    }\n\n    for (let j = i * 4, jj = srcPos + len; j < jj; j += 3) {\n      dest[destPos++] =\n        (src[j] << 24) | (src[j + 1] << 16) | (src[j + 2] << 8) | 0xff;\n    }\n  }\n\n  return { srcPos: srcPos + len, destPos };\n}\n\nfunction grayToRGBA(src, dest) {\n  if (FeatureTest.isLittleEndian) {\n    for (let i = 0, ii = src.length; i < ii; i++) {\n      dest[i] = (src[i] * 0x10101) | 0xff000000;\n    }\n  } else {\n    for (let i = 0, ii = src.length; i < ii; i++) {\n      dest[i] = (src[i] * 0x1010100) | 0x000000ff;\n    }\n  }\n}\n\nexport { convertBlackAndWhiteToRGBA, convertToRGBA, grayToRGBA };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  DrawOPS,\n  FeatureTest,\n  FONT_IDENTITY_MATRIX,\n  ImageKind,\n  info,\n  OPS,\n  shadow,\n  TextRenderingMode,\n  unreachable,\n  Util,\n  warn,\n} from \"../shared/util.js\";\nimport {\n  getCurrentTransform,\n  getCurrentTransformInverse,\n  OutputScale,\n  PixelsPerInch,\n} from \"./display_utils.js\";\nimport {\n  getShadingPattern,\n  PathType,\n  TilingPattern,\n} from \"./pattern_helper.js\";\nimport { convertBlackAndWhiteToRGBA } from \"../shared/image_utils.js\";\n\n// <canvas> contexts store most of the state we need natively.\n// However, PDF needs a bit more state, which we store here.\n// Minimal font size that would be used during canvas fillText operations.\nconst MIN_FONT_SIZE = 16;\n// Maximum font size that would be used during canvas fillText operations.\nconst MAX_FONT_SIZE = 100;\n\n// Defines the time the `executeOperatorList`-method is going to be executing\n// before it stops and schedules a continue of execution.\nconst EXECUTION_TIME = 15; // ms\n// Defines the number of steps before checking the execution time.\nconst EXECUTION_STEPS = 10;\n\nconst FULL_CHUNK_HEIGHT = 16;\n\n// Only used in rescaleAndStroke. The goal is to avoid\n// creating a new DOMMatrix object each time we need it.\nconst SCALE_MATRIX = new DOMMatrix();\n\n// Used to get some coordinates.\nconst XY = new Float32Array(2);\n\n// Initial rectangle values for the minMax array.\nconst MIN_MAX_INIT = new Float32Array([\n  Infinity,\n  Infinity,\n  -Infinity,\n  -Infinity,\n]);\n\n/**\n * Overrides certain methods on a 2d ctx so that when they are called they\n * will also call the same method on the destCtx. The methods that are\n * overridden are all the transformation state modifiers, path creation, and\n * save/restore. We only forward these specific methods because they are the\n * only state modifiers that we cannot copy over when we switch contexts.\n *\n * To remove mirroring call `ctx._removeMirroring()`.\n *\n * @param {Object} ctx - The 2d canvas context that will duplicate its calls on\n *   the destCtx.\n * @param {Object} destCtx - The 2d canvas context that will receive the\n *   forwarded calls.\n */\nfunction mirrorContextOperations(ctx, destCtx) {\n  if (ctx._removeMirroring) {\n    throw new Error(\"Context is already forwarding operations.\");\n  }\n  ctx.__originalSave = ctx.save;\n  ctx.__originalRestore = ctx.restore;\n  ctx.__originalRotate = ctx.rotate;\n  ctx.__originalScale = ctx.scale;\n  ctx.__originalTranslate = ctx.translate;\n  ctx.__originalTransform = ctx.transform;\n  ctx.__originalSetTransform = ctx.setTransform;\n  ctx.__originalResetTransform = ctx.resetTransform;\n  ctx.__originalClip = ctx.clip;\n  ctx.__originalMoveTo = ctx.moveTo;\n  ctx.__originalLineTo = ctx.lineTo;\n  ctx.__originalBezierCurveTo = ctx.bezierCurveTo;\n  ctx.__originalRect = ctx.rect;\n  ctx.__originalClosePath = ctx.closePath;\n  ctx.__originalBeginPath = ctx.beginPath;\n\n  ctx._removeMirroring = () => {\n    ctx.save = ctx.__originalSave;\n    ctx.restore = ctx.__originalRestore;\n    ctx.rotate = ctx.__originalRotate;\n    ctx.scale = ctx.__originalScale;\n    ctx.translate = ctx.__originalTranslate;\n    ctx.transform = ctx.__originalTransform;\n    ctx.setTransform = ctx.__originalSetTransform;\n    ctx.resetTransform = ctx.__originalResetTransform;\n\n    ctx.clip = ctx.__originalClip;\n    ctx.moveTo = ctx.__originalMoveTo;\n    ctx.lineTo = ctx.__originalLineTo;\n    ctx.bezierCurveTo = ctx.__originalBezierCurveTo;\n    ctx.rect = ctx.__originalRect;\n    ctx.closePath = ctx.__originalClosePath;\n    ctx.beginPath = ctx.__originalBeginPath;\n    delete ctx._removeMirroring;\n  };\n\n  ctx.save = function () {\n    destCtx.save();\n    this.__originalSave();\n  };\n\n  ctx.restore = function () {\n    destCtx.restore();\n    this.__originalRestore();\n  };\n\n  ctx.translate = function (x, y) {\n    destCtx.translate(x, y);\n    this.__originalTranslate(x, y);\n  };\n\n  ctx.scale = function (x, y) {\n    destCtx.scale(x, y);\n    this.__originalScale(x, y);\n  };\n\n  ctx.transform = function (a, b, c, d, e, f) {\n    destCtx.transform(a, b, c, d, e, f);\n    this.__originalTransform(a, b, c, d, e, f);\n  };\n\n  ctx.setTransform = function (a, b, c, d, e, f) {\n    destCtx.setTransform(a, b, c, d, e, f);\n    this.__originalSetTransform(a, b, c, d, e, f);\n  };\n\n  ctx.resetTransform = function () {\n    destCtx.resetTransform();\n    this.__originalResetTransform();\n  };\n\n  ctx.rotate = function (angle) {\n    destCtx.rotate(angle);\n    this.__originalRotate(angle);\n  };\n\n  ctx.clip = function (rule) {\n    destCtx.clip(rule);\n    this.__originalClip(rule);\n  };\n\n  ctx.moveTo = function (x, y) {\n    destCtx.moveTo(x, y);\n    this.__originalMoveTo(x, y);\n  };\n\n  ctx.lineTo = function (x, y) {\n    destCtx.lineTo(x, y);\n    this.__originalLineTo(x, y);\n  };\n\n  ctx.bezierCurveTo = function (cp1x, cp1y, cp2x, cp2y, x, y) {\n    destCtx.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);\n    this.__originalBezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);\n  };\n\n  ctx.rect = function (x, y, width, height) {\n    destCtx.rect(x, y, width, height);\n    this.__originalRect(x, y, width, height);\n  };\n\n  ctx.closePath = function () {\n    destCtx.closePath();\n    this.__originalClosePath();\n  };\n\n  ctx.beginPath = function () {\n    destCtx.beginPath();\n    this.__originalBeginPath();\n  };\n}\n\nclass CachedCanvases {\n  constructor(canvasFactory) {\n    this.canvasFactory = canvasFactory;\n    this.cache = Object.create(null);\n  }\n\n  getCanvas(id, width, height) {\n    let canvasEntry;\n    if (this.cache[id] !== undefined) {\n      canvasEntry = this.cache[id];\n      this.canvasFactory.reset(canvasEntry, width, height);\n    } else {\n      canvasEntry = this.canvasFactory.create(width, height);\n      this.cache[id] = canvasEntry;\n    }\n    return canvasEntry;\n  }\n\n  delete(id) {\n    delete this.cache[id];\n  }\n\n  clear() {\n    for (const id in this.cache) {\n      const canvasEntry = this.cache[id];\n      this.canvasFactory.destroy(canvasEntry);\n      delete this.cache[id];\n    }\n  }\n}\n\nfunction drawImageAtIntegerCoords(\n  ctx,\n  srcImg,\n  srcX,\n  srcY,\n  srcW,\n  srcH,\n  destX,\n  destY,\n  destW,\n  destH\n) {\n  const [a, b, c, d, tx, ty] = getCurrentTransform(ctx);\n  if (b === 0 && c === 0) {\n    // top-left corner is at (X, Y) and\n    // bottom-right one is at (X + width, Y + height).\n\n    // If leftX is 4.321 then it's rounded to 4.\n    // If width is 10.432 then it's rounded to 11 because\n    // rightX = leftX + width = 14.753 which is rounded to 15\n    // so after rounding the total width is 11 (15 - 4).\n    // It's why we can't just floor/ceil uniformly, it just depends\n    // on the values we've.\n\n    const tlX = destX * a + tx;\n    const rTlX = Math.round(tlX);\n    const tlY = destY * d + ty;\n    const rTlY = Math.round(tlY);\n    const brX = (destX + destW) * a + tx;\n\n    // Some pdf contains images with 1x1 images so in case of 0-width after\n    // scaling we must fallback on 1 to be sure there is something.\n    const rWidth = Math.abs(Math.round(brX) - rTlX) || 1;\n    const brY = (destY + destH) * d + ty;\n    const rHeight = Math.abs(Math.round(brY) - rTlY) || 1;\n\n    // We must apply a transformation in order to apply it on the image itself.\n    // For example if a == 1 && d == -1, it means that the image itself is\n    // mirrored w.r.t. the x-axis.\n    ctx.setTransform(Math.sign(a), 0, 0, Math.sign(d), rTlX, rTlY);\n    ctx.drawImage(srcImg, srcX, srcY, srcW, srcH, 0, 0, rWidth, rHeight);\n    ctx.setTransform(a, b, c, d, tx, ty);\n\n    return [rWidth, rHeight];\n  }\n\n  if (a === 0 && d === 0) {\n    // This path is taken in issue9462.pdf (page 3).\n    const tlX = destY * c + tx;\n    const rTlX = Math.round(tlX);\n    const tlY = destX * b + ty;\n    const rTlY = Math.round(tlY);\n    const brX = (destY + destH) * c + tx;\n    const rWidth = Math.abs(Math.round(brX) - rTlX) || 1;\n    const brY = (destX + destW) * b + ty;\n    const rHeight = Math.abs(Math.round(brY) - rTlY) || 1;\n\n    ctx.setTransform(0, Math.sign(b), Math.sign(c), 0, rTlX, rTlY);\n    ctx.drawImage(srcImg, srcX, srcY, srcW, srcH, 0, 0, rHeight, rWidth);\n    ctx.setTransform(a, b, c, d, tx, ty);\n\n    return [rHeight, rWidth];\n  }\n\n  // Not a scale matrix so let the render handle the case without rounding.\n  ctx.drawImage(srcImg, srcX, srcY, srcW, srcH, destX, destY, destW, destH);\n\n  const scaleX = Math.hypot(a, b);\n  const scaleY = Math.hypot(c, d);\n  return [scaleX * destW, scaleY * destH];\n}\n\nclass CanvasExtraState {\n  // Are soft masks and alpha values shapes or opacities?\n  alphaIsShape = false;\n\n  fontSize = 0;\n\n  fontSizeScale = 1;\n\n  textMatrix = null;\n\n  textMatrixScale = 1;\n\n  fontMatrix = FONT_IDENTITY_MATRIX;\n\n  leading = 0;\n\n  // Current point (in user coordinates)\n  x = 0;\n\n  y = 0;\n\n  // Start of text line (in text coordinates)\n  lineX = 0;\n\n  lineY = 0;\n\n  // Character and word spacing\n  charSpacing = 0;\n\n  wordSpacing = 0;\n\n  textHScale = 1;\n\n  textRenderingMode = TextRenderingMode.FILL;\n\n  textRise = 0;\n\n  // Default fore and background colors\n  fillColor = \"#000000\";\n\n  strokeColor = \"#000000\";\n\n  patternFill = false;\n\n  patternStroke = false;\n\n  // Note: fill alpha applies to all non-stroking operations\n  fillAlpha = 1;\n\n  strokeAlpha = 1;\n\n  lineWidth = 1;\n\n  activeSMask = null;\n\n  transferMaps = \"none\";\n\n  constructor(width, height) {\n    this.clipBox = new Float32Array([0, 0, width, height]);\n    this.minMax = MIN_MAX_INIT.slice();\n  }\n\n  clone() {\n    const clone = Object.create(this);\n    clone.clipBox = this.clipBox.slice();\n    clone.minMax = this.minMax.slice();\n    return clone;\n  }\n\n  getPathBoundingBox(pathType = PathType.FILL, transform = null) {\n    const box = this.minMax.slice();\n    if (pathType === PathType.STROKE) {\n      if (!transform) {\n        unreachable(\"Stroke bounding box must include transform.\");\n      }\n      // Stroked paths can be outside of the path bounding box by 1/2 the line\n      // width.\n      Util.singularValueDecompose2dScale(transform, XY);\n      const xStrokePad = (XY[0] * this.lineWidth) / 2;\n      const yStrokePad = (XY[1] * this.lineWidth) / 2;\n      box[0] -= xStrokePad;\n      box[1] -= yStrokePad;\n      box[2] += xStrokePad;\n      box[3] += yStrokePad;\n    }\n    return box;\n  }\n\n  updateClipFromPath() {\n    const intersect = Util.intersect(this.clipBox, this.getPathBoundingBox());\n    this.startNewPathAndClipBox(intersect || [0, 0, 0, 0]);\n  }\n\n  isEmptyClip() {\n    return this.minMax[0] === Infinity;\n  }\n\n  startNewPathAndClipBox(box) {\n    this.clipBox.set(box, 0);\n    this.minMax.set(MIN_MAX_INIT, 0);\n  }\n\n  getClippedPathBoundingBox(pathType = PathType.FILL, transform = null) {\n    return Util.intersect(\n      this.clipBox,\n      this.getPathBoundingBox(pathType, transform)\n    );\n  }\n}\n\nfunction putBinaryImageData(ctx, imgData) {\n  if (imgData instanceof ImageData) {\n    ctx.putImageData(imgData, 0, 0);\n    return;\n  }\n\n  // Put the image data to the canvas in chunks, rather than putting the\n  // whole image at once.  This saves JS memory, because the ImageData object\n  // is smaller. It also possibly saves C++ memory within the implementation\n  // of putImageData(). (E.g. in Firefox we make two short-lived copies of\n  // the data passed to putImageData()). |n| shouldn't be too small, however,\n  // because too many putImageData() calls will slow things down.\n  //\n  // Note: as written, if the last chunk is partial, the putImageData() call\n  // will (conceptually) put pixels past the bounds of the canvas.  But\n  // that's ok; any such pixels are ignored.\n\n  const height = imgData.height,\n    width = imgData.width;\n  const partialChunkHeight = height % FULL_CHUNK_HEIGHT;\n  const fullChunks = (height - partialChunkHeight) / FULL_CHUNK_HEIGHT;\n  const totalChunks = partialChunkHeight === 0 ? fullChunks : fullChunks + 1;\n\n  const chunkImgData = ctx.createImageData(width, FULL_CHUNK_HEIGHT);\n  let srcPos = 0,\n    destPos;\n  const src = imgData.data;\n  const dest = chunkImgData.data;\n  let i, j, thisChunkHeight, elemsInThisChunk;\n\n  // There are multiple forms in which the pixel data can be passed, and\n  // imgData.kind tells us which one this is.\n  if (imgData.kind === ImageKind.GRAYSCALE_1BPP) {\n    // Grayscale, 1 bit per pixel (i.e. black-and-white).\n    const srcLength = src.byteLength;\n    const dest32 = new Uint32Array(dest.buffer, 0, dest.byteLength >> 2);\n    const dest32DataLength = dest32.length;\n    const fullSrcDiff = (width + 7) >> 3;\n    const white = 0xffffffff;\n    const black = FeatureTest.isLittleEndian ? 0xff000000 : 0x000000ff;\n\n    for (i = 0; i < totalChunks; i++) {\n      thisChunkHeight = i < fullChunks ? FULL_CHUNK_HEIGHT : partialChunkHeight;\n      destPos = 0;\n      for (j = 0; j < thisChunkHeight; j++) {\n        const srcDiff = srcLength - srcPos;\n        let k = 0;\n        const kEnd = srcDiff > fullSrcDiff ? width : srcDiff * 8 - 7;\n        const kEndUnrolled = kEnd & ~7;\n        let mask = 0;\n        let srcByte = 0;\n        for (; k < kEndUnrolled; k += 8) {\n          srcByte = src[srcPos++];\n          dest32[destPos++] = srcByte & 128 ? white : black;\n          dest32[destPos++] = srcByte & 64 ? white : black;\n          dest32[destPos++] = srcByte & 32 ? white : black;\n          dest32[destPos++] = srcByte & 16 ? white : black;\n          dest32[destPos++] = srcByte & 8 ? white : black;\n          dest32[destPos++] = srcByte & 4 ? white : black;\n          dest32[destPos++] = srcByte & 2 ? white : black;\n          dest32[destPos++] = srcByte & 1 ? white : black;\n        }\n        for (; k < kEnd; k++) {\n          if (mask === 0) {\n            srcByte = src[srcPos++];\n            mask = 128;\n          }\n\n          dest32[destPos++] = srcByte & mask ? white : black;\n          mask >>= 1;\n        }\n      }\n      // We ran out of input. Make all remaining pixels transparent.\n      while (destPos < dest32DataLength) {\n        dest32[destPos++] = 0;\n      }\n\n      ctx.putImageData(chunkImgData, 0, i * FULL_CHUNK_HEIGHT);\n    }\n  } else if (imgData.kind === ImageKind.RGBA_32BPP) {\n    // RGBA, 32-bits per pixel.\n    j = 0;\n    elemsInThisChunk = width * FULL_CHUNK_HEIGHT * 4;\n    for (i = 0; i < fullChunks; i++) {\n      dest.set(src.subarray(srcPos, srcPos + elemsInThisChunk));\n      srcPos += elemsInThisChunk;\n\n      ctx.putImageData(chunkImgData, 0, j);\n      j += FULL_CHUNK_HEIGHT;\n    }\n    if (i < totalChunks) {\n      elemsInThisChunk = width * partialChunkHeight * 4;\n      dest.set(src.subarray(srcPos, srcPos + elemsInThisChunk));\n\n      ctx.putImageData(chunkImgData, 0, j);\n    }\n  } else if (imgData.kind === ImageKind.RGB_24BPP) {\n    // RGB, 24-bits per pixel.\n    thisChunkHeight = FULL_CHUNK_HEIGHT;\n    elemsInThisChunk = width * thisChunkHeight;\n    for (i = 0; i < totalChunks; i++) {\n      if (i >= fullChunks) {\n        thisChunkHeight = partialChunkHeight;\n        elemsInThisChunk = width * thisChunkHeight;\n      }\n\n      destPos = 0;\n      for (j = elemsInThisChunk; j--; ) {\n        dest[destPos++] = src[srcPos++];\n        dest[destPos++] = src[srcPos++];\n        dest[destPos++] = src[srcPos++];\n        dest[destPos++] = 255;\n      }\n\n      ctx.putImageData(chunkImgData, 0, i * FULL_CHUNK_HEIGHT);\n    }\n  } else {\n    throw new Error(`bad image kind: ${imgData.kind}`);\n  }\n}\n\nfunction putBinaryImageMask(ctx, imgData) {\n  if (imgData.bitmap) {\n    // The bitmap has been created in the worker.\n    ctx.drawImage(imgData.bitmap, 0, 0);\n    return;\n  }\n\n  // Slow path: OffscreenCanvas isn't available in the worker.\n  const height = imgData.height,\n    width = imgData.width;\n  const partialChunkHeight = height % FULL_CHUNK_HEIGHT;\n  const fullChunks = (height - partialChunkHeight) / FULL_CHUNK_HEIGHT;\n  const totalChunks = partialChunkHeight === 0 ? fullChunks : fullChunks + 1;\n\n  const chunkImgData = ctx.createImageData(width, FULL_CHUNK_HEIGHT);\n  let srcPos = 0;\n  const src = imgData.data;\n  const dest = chunkImgData.data;\n\n  for (let i = 0; i < totalChunks; i++) {\n    const thisChunkHeight =\n      i < fullChunks ? FULL_CHUNK_HEIGHT : partialChunkHeight;\n\n    // Expand the mask so it can be used by the canvas.  Any required\n    // inversion has already been handled.\n\n    ({ srcPos } = convertBlackAndWhiteToRGBA({\n      src,\n      srcPos,\n      dest,\n      width,\n      height: thisChunkHeight,\n      nonBlackColor: 0,\n    }));\n\n    ctx.putImageData(chunkImgData, 0, i * FULL_CHUNK_HEIGHT);\n  }\n}\n\nfunction copyCtxState(sourceCtx, destCtx) {\n  const properties = [\n    \"strokeStyle\",\n    \"fillStyle\",\n    \"fillRule\",\n    \"globalAlpha\",\n    \"lineWidth\",\n    \"lineCap\",\n    \"lineJoin\",\n    \"miterLimit\",\n    \"globalCompositeOperation\",\n    \"font\",\n    \"filter\",\n  ];\n  for (const property of properties) {\n    if (sourceCtx[property] !== undefined) {\n      destCtx[property] = sourceCtx[property];\n    }\n  }\n  if (sourceCtx.setLineDash !== undefined) {\n    destCtx.setLineDash(sourceCtx.getLineDash());\n    destCtx.lineDashOffset = sourceCtx.lineDashOffset;\n  }\n}\n\nfunction resetCtxToDefault(ctx) {\n  ctx.strokeStyle = ctx.fillStyle = \"#000000\";\n  ctx.fillRule = \"nonzero\";\n  ctx.globalAlpha = 1;\n  ctx.lineWidth = 1;\n  ctx.lineCap = \"butt\";\n  ctx.lineJoin = \"miter\";\n  ctx.miterLimit = 10;\n  ctx.globalCompositeOperation = \"source-over\";\n  ctx.font = \"10px sans-serif\";\n  if (ctx.setLineDash !== undefined) {\n    ctx.setLineDash([]);\n    ctx.lineDashOffset = 0;\n  }\n  const { filter } = ctx;\n  if (filter !== \"none\" && filter !== \"\") {\n    ctx.filter = \"none\";\n  }\n}\n\nfunction getImageSmoothingEnabled(transform, interpolate) {\n  // In section 8.9.5.3 of the PDF spec, it's mentioned that the interpolate\n  // flag should be used when the image is upscaled.\n  // In Firefox, smoothing is always used when downscaling images (bug 1360415).\n\n  if (interpolate) {\n    return true;\n  }\n\n  Util.singularValueDecompose2dScale(transform, XY);\n  // Round to a 32bit float so that `<=` check below will pass for numbers that\n  // are very close, but not exactly the same 64bit floats.\n  const actualScale = Math.fround(\n    OutputScale.pixelRatio * PixelsPerInch.PDF_TO_CSS_UNITS\n  );\n  // `XY` is a Float32Array.\n  return XY[0] <= actualScale && XY[1] <= actualScale;\n}\n\nconst LINE_CAP_STYLES = [\"butt\", \"round\", \"square\"];\nconst LINE_JOIN_STYLES = [\"miter\", \"round\", \"bevel\"];\nconst NORMAL_CLIP = {};\nconst EO_CLIP = {};\n\nclass CanvasGraphics {\n  constructor(\n    canvasCtx,\n    commonObjs,\n    objs,\n    canvasFactory,\n    filterFactory,\n    { optionalContentConfig, markedContentStack = null },\n    annotationCanvasMap,\n    pageColors\n  ) {\n    this.ctx = canvasCtx;\n    this.current = new CanvasExtraState(\n      this.ctx.canvas.width,\n      this.ctx.canvas.height\n    );\n    this.stateStack = [];\n    this.pendingClip = null;\n    this.pendingEOFill = false;\n    this.res = null;\n    this.xobjs = null;\n    this.commonObjs = commonObjs;\n    this.objs = objs;\n    this.canvasFactory = canvasFactory;\n    this.filterFactory = filterFactory;\n    this.groupStack = [];\n    // Patterns are painted relative to the initial page/form transform, see\n    // PDF spec 8.7.2 NOTE 1.\n    this.baseTransform = null;\n    this.baseTransformStack = [];\n    this.groupLevel = 0;\n    this.smaskStack = [];\n    this.smaskCounter = 0;\n    this.tempSMask = null;\n    this.suspendedCtx = null;\n    this.contentVisible = true;\n    this.markedContentStack = markedContentStack || [];\n    this.optionalContentConfig = optionalContentConfig;\n    this.cachedCanvases = new CachedCanvases(this.canvasFactory);\n    this.cachedPatterns = new Map();\n    this.annotationCanvasMap = annotationCanvasMap;\n    this.viewportScale = 1;\n    this.outputScaleX = 1;\n    this.outputScaleY = 1;\n    this.pageColors = pageColors;\n\n    this._cachedScaleForStroking = [-1, 0];\n    this._cachedGetSinglePixelWidth = null;\n    this._cachedBitmapsMap = new Map();\n  }\n\n  getObject(data, fallback = null) {\n    if (typeof data === \"string\") {\n      return data.startsWith(\"g_\")\n        ? this.commonObjs.get(data)\n        : this.objs.get(data);\n    }\n    return fallback;\n  }\n\n  beginDrawing({\n    transform,\n    viewport,\n    transparency = false,\n    background = null,\n  }) {\n    // For pdfs that use blend modes we have to clear the canvas else certain\n    // blend modes can look wrong since we'd be blending with a white\n    // backdrop. The problem with a transparent backdrop though is we then\n    // don't get sub pixel anti aliasing on text, creating temporary\n    // transparent canvas when we have blend modes.\n    const width = this.ctx.canvas.width;\n    const height = this.ctx.canvas.height;\n\n    const savedFillStyle = this.ctx.fillStyle;\n    this.ctx.fillStyle = background || \"#ffffff\";\n    this.ctx.fillRect(0, 0, width, height);\n    this.ctx.fillStyle = savedFillStyle;\n\n    if (transparency) {\n      const transparentCanvas = this.cachedCanvases.getCanvas(\n        \"transparent\",\n        width,\n        height\n      );\n      this.compositeCtx = this.ctx;\n      this.transparentCanvas = transparentCanvas.canvas;\n      this.ctx = transparentCanvas.context;\n      this.ctx.save();\n      // The transform can be applied before rendering, transferring it to\n      // the new canvas.\n      this.ctx.transform(...getCurrentTransform(this.compositeCtx));\n    }\n\n    this.ctx.save();\n    resetCtxToDefault(this.ctx);\n    if (transform) {\n      this.ctx.transform(...transform);\n      this.outputScaleX = transform[0];\n      this.outputScaleY = transform[0];\n    }\n    this.ctx.transform(...viewport.transform);\n    this.viewportScale = viewport.scale;\n\n    this.baseTransform = getCurrentTransform(this.ctx);\n  }\n\n  executeOperatorList(\n    operatorList,\n    executionStartIdx,\n    continueCallback,\n    stepper\n  ) {\n    const argsArray = operatorList.argsArray;\n    const fnArray = operatorList.fnArray;\n    let i = executionStartIdx || 0;\n    const argsArrayLen = argsArray.length;\n\n    // Sometimes the OperatorList to execute is empty.\n    if (argsArrayLen === i) {\n      return i;\n    }\n\n    const chunkOperations =\n      argsArrayLen - i > EXECUTION_STEPS &&\n      typeof continueCallback === \"function\";\n    const endTime = chunkOperations ? Date.now() + EXECUTION_TIME : 0;\n    let steps = 0;\n\n    const commonObjs = this.commonObjs;\n    const objs = this.objs;\n    let fnId;\n\n    while (true) {\n      if (stepper !== undefined && i === stepper.nextBreakPoint) {\n        stepper.breakIt(i, continueCallback);\n        return i;\n      }\n\n      fnId = fnArray[i];\n\n      if (fnId !== OPS.dependency) {\n        // eslint-disable-next-line prefer-spread\n        this[fnId].apply(this, argsArray[i]);\n      } else {\n        for (const depObjId of argsArray[i]) {\n          const objsPool = depObjId.startsWith(\"g_\") ? commonObjs : objs;\n\n          // If the promise isn't resolved yet, add the continueCallback\n          // to the promise and bail out.\n          if (!objsPool.has(depObjId)) {\n            objsPool.get(depObjId, continueCallback);\n            return i;\n          }\n        }\n      }\n\n      i++;\n\n      // If the entire operatorList was executed, stop as were done.\n      if (i === argsArrayLen) {\n        return i;\n      }\n\n      // If the execution took longer then a certain amount of time and\n      // `continueCallback` is specified, interrupt the execution.\n      if (chunkOperations && ++steps > EXECUTION_STEPS) {\n        if (Date.now() > endTime) {\n          continueCallback();\n          return i;\n        }\n        steps = 0;\n      }\n\n      // If the operatorList isn't executed completely yet OR the execution\n      // time was short enough, do another execution round.\n    }\n  }\n\n  #restoreInitialState() {\n    // Finishing all opened operations such as SMask group painting.\n    while (this.stateStack.length || this.inSMaskMode) {\n      this.restore();\n    }\n\n    this.current.activeSMask = null;\n    this.ctx.restore();\n\n    if (this.transparentCanvas) {\n      this.ctx = this.compositeCtx;\n      this.ctx.save();\n      this.ctx.setTransform(1, 0, 0, 1, 0, 0); // Avoid apply transform twice\n      this.ctx.drawImage(this.transparentCanvas, 0, 0);\n      this.ctx.restore();\n      this.transparentCanvas = null;\n    }\n  }\n\n  endDrawing() {\n    this.#restoreInitialState();\n\n    this.cachedCanvases.clear();\n    this.cachedPatterns.clear();\n\n    for (const cache of this._cachedBitmapsMap.values()) {\n      for (const canvas of cache.values()) {\n        if (\n          typeof HTMLCanvasElement !== \"undefined\" &&\n          canvas instanceof HTMLCanvasElement\n        ) {\n          canvas.width = canvas.height = 0;\n        }\n      }\n      cache.clear();\n    }\n    this._cachedBitmapsMap.clear();\n    this.#drawFilter();\n  }\n\n  #drawFilter() {\n    if (this.pageColors) {\n      const hcmFilterId = this.filterFactory.addHCMFilter(\n        this.pageColors.foreground,\n        this.pageColors.background\n      );\n      if (hcmFilterId !== \"none\") {\n        const savedFilter = this.ctx.filter;\n        this.ctx.filter = hcmFilterId;\n        this.ctx.drawImage(this.ctx.canvas, 0, 0);\n        this.ctx.filter = savedFilter;\n      }\n    }\n  }\n\n  _scaleImage(img, inverseTransform) {\n    // Vertical or horizontal scaling shall not be more than 2 to not lose the\n    // pixels during drawImage operation, painting on the temporary canvas(es)\n    // that are twice smaller in size.\n\n    // displayWidth and displayHeight are used for VideoFrame.\n    const width = img.width ?? img.displayWidth;\n    const height = img.height ?? img.displayHeight;\n    let widthScale = Math.max(\n      Math.hypot(inverseTransform[0], inverseTransform[1]),\n      1\n    );\n    let heightScale = Math.max(\n      Math.hypot(inverseTransform[2], inverseTransform[3]),\n      1\n    );\n\n    let paintWidth = width,\n      paintHeight = height;\n    let tmpCanvasId = \"prescale1\";\n    let tmpCanvas, tmpCtx;\n    while (\n      (widthScale > 2 && paintWidth > 1) ||\n      (heightScale > 2 && paintHeight > 1)\n    ) {\n      let newWidth = paintWidth,\n        newHeight = paintHeight;\n      if (widthScale > 2 && paintWidth > 1) {\n        // See bug 1820511 (Windows specific bug).\n        // TODO: once the above bug is fixed we could revert to:\n        // newWidth = Math.ceil(paintWidth / 2);\n        newWidth =\n          paintWidth >= 16384\n            ? Math.floor(paintWidth / 2) - 1 || 1\n            : Math.ceil(paintWidth / 2);\n        widthScale /= paintWidth / newWidth;\n      }\n      if (heightScale > 2 && paintHeight > 1) {\n        // TODO: see the comment above.\n        newHeight =\n          paintHeight >= 16384\n            ? Math.floor(paintHeight / 2) - 1 || 1\n            : Math.ceil(paintHeight) / 2;\n        heightScale /= paintHeight / newHeight;\n      }\n      tmpCanvas = this.cachedCanvases.getCanvas(\n        tmpCanvasId,\n        newWidth,\n        newHeight\n      );\n      tmpCtx = tmpCanvas.context;\n      tmpCtx.clearRect(0, 0, newWidth, newHeight);\n      tmpCtx.drawImage(\n        img,\n        0,\n        0,\n        paintWidth,\n        paintHeight,\n        0,\n        0,\n        newWidth,\n        newHeight\n      );\n      img = tmpCanvas.canvas;\n      paintWidth = newWidth;\n      paintHeight = newHeight;\n      tmpCanvasId = tmpCanvasId === \"prescale1\" ? \"prescale2\" : \"prescale1\";\n    }\n    return {\n      img,\n      paintWidth,\n      paintHeight,\n    };\n  }\n\n  _createMaskCanvas(img) {\n    const ctx = this.ctx;\n    const { width, height } = img;\n    const fillColor = this.current.fillColor;\n    const isPatternFill = this.current.patternFill;\n    const currentTransform = getCurrentTransform(ctx);\n\n    let cache, cacheKey, scaled, maskCanvas;\n    if ((img.bitmap || img.data) && img.count > 1) {\n      const mainKey = img.bitmap || img.data.buffer;\n      // We're reusing the same image several times, so we can cache it.\n      // In case we've a pattern fill we just keep the scaled version of\n      // the image.\n      // Only the scaling part matters, the translation part is just used\n      // to compute offsets (but not when filling patterns see #15573).\n      // TODO: handle the case of a pattern fill if it's possible.\n      cacheKey = JSON.stringify(\n        isPatternFill\n          ? currentTransform\n          : [currentTransform.slice(0, 4), fillColor]\n      );\n\n      cache = this._cachedBitmapsMap.get(mainKey);\n      if (!cache) {\n        cache = new Map();\n        this._cachedBitmapsMap.set(mainKey, cache);\n      }\n      const cachedImage = cache.get(cacheKey);\n      if (cachedImage && !isPatternFill) {\n        const offsetX = Math.round(\n          Math.min(currentTransform[0], currentTransform[2]) +\n            currentTransform[4]\n        );\n        const offsetY = Math.round(\n          Math.min(currentTransform[1], currentTransform[3]) +\n            currentTransform[5]\n        );\n        return {\n          canvas: cachedImage,\n          offsetX,\n          offsetY,\n        };\n      }\n      scaled = cachedImage;\n    }\n\n    if (!scaled) {\n      maskCanvas = this.cachedCanvases.getCanvas(\"maskCanvas\", width, height);\n      putBinaryImageMask(maskCanvas.context, img);\n    }\n\n    // Create the mask canvas at the size it will be drawn at and also set\n    // its transform to match the current transform so if there are any\n    // patterns applied they will be applied relative to the correct\n    // transform.\n\n    let maskToCanvas = Util.transform(currentTransform, [\n      1 / width,\n      0,\n      0,\n      -1 / height,\n      0,\n      0,\n    ]);\n    maskToCanvas = Util.transform(maskToCanvas, [1, 0, 0, 1, 0, -height]);\n    const minMax = MIN_MAX_INIT.slice();\n    Util.axialAlignedBoundingBox([0, 0, width, height], maskToCanvas, minMax);\n    const [minX, minY, maxX, maxY] = minMax;\n    const drawnWidth = Math.round(maxX - minX) || 1;\n    const drawnHeight = Math.round(maxY - minY) || 1;\n    const fillCanvas = this.cachedCanvases.getCanvas(\n      \"fillCanvas\",\n      drawnWidth,\n      drawnHeight\n    );\n    const fillCtx = fillCanvas.context;\n\n    // The offset will be the top-left cordinate mask.\n    // If objToCanvas is [a,b,c,d,e,f] then:\n    //   - offsetX = min(a, c) + e\n    //   - offsetY = min(b, d) + f\n    const offsetX = minX;\n    const offsetY = minY;\n    fillCtx.translate(-offsetX, -offsetY);\n    fillCtx.transform(...maskToCanvas);\n\n    if (!scaled) {\n      // Pre-scale if needed to improve image smoothing.\n      scaled = this._scaleImage(\n        maskCanvas.canvas,\n        getCurrentTransformInverse(fillCtx)\n      );\n      scaled = scaled.img;\n      if (cache && isPatternFill) {\n        cache.set(cacheKey, scaled);\n      }\n    }\n\n    fillCtx.imageSmoothingEnabled = getImageSmoothingEnabled(\n      getCurrentTransform(fillCtx),\n      img.interpolate\n    );\n\n    drawImageAtIntegerCoords(\n      fillCtx,\n      scaled,\n      0,\n      0,\n      scaled.width,\n      scaled.height,\n      0,\n      0,\n      width,\n      height\n    );\n    fillCtx.globalCompositeOperation = \"source-in\";\n\n    const inverse = Util.transform(getCurrentTransformInverse(fillCtx), [\n      1,\n      0,\n      0,\n      1,\n      -offsetX,\n      -offsetY,\n    ]);\n    fillCtx.fillStyle = isPatternFill\n      ? fillColor.getPattern(ctx, this, inverse, PathType.FILL)\n      : fillColor;\n\n    fillCtx.fillRect(0, 0, width, height);\n\n    if (cache && !isPatternFill) {\n      // The fill canvas is put in the cache associated to the mask image\n      // so we must remove from the cached canvas: it mustn't be used again.\n      this.cachedCanvases.delete(\"fillCanvas\");\n      cache.set(cacheKey, fillCanvas.canvas);\n    }\n\n    // Round the offsets to avoid drawing fractional pixels.\n    return {\n      canvas: fillCanvas.canvas,\n      offsetX: Math.round(offsetX),\n      offsetY: Math.round(offsetY),\n    };\n  }\n\n  // Graphics state\n  setLineWidth(width) {\n    if (width !== this.current.lineWidth) {\n      this._cachedScaleForStroking[0] = -1;\n    }\n    this.current.lineWidth = width;\n    this.ctx.lineWidth = width;\n  }\n\n  setLineCap(style) {\n    this.ctx.lineCap = LINE_CAP_STYLES[style];\n  }\n\n  setLineJoin(style) {\n    this.ctx.lineJoin = LINE_JOIN_STYLES[style];\n  }\n\n  setMiterLimit(limit) {\n    this.ctx.miterLimit = limit;\n  }\n\n  setDash(dashArray, dashPhase) {\n    const ctx = this.ctx;\n    if (ctx.setLineDash !== undefined) {\n      ctx.setLineDash(dashArray);\n      ctx.lineDashOffset = dashPhase;\n    }\n  }\n\n  setRenderingIntent(intent) {\n    // This operation is ignored since we haven't found a use case for it yet.\n  }\n\n  setFlatness(flatness) {\n    // This operation is ignored since we haven't found a use case for it yet.\n  }\n\n  setGState(states) {\n    for (const [key, value] of states) {\n      switch (key) {\n        case \"LW\":\n          this.setLineWidth(value);\n          break;\n        case \"LC\":\n          this.setLineCap(value);\n          break;\n        case \"LJ\":\n          this.setLineJoin(value);\n          break;\n        case \"ML\":\n          this.setMiterLimit(value);\n          break;\n        case \"D\":\n          this.setDash(value[0], value[1]);\n          break;\n        case \"RI\":\n          this.setRenderingIntent(value);\n          break;\n        case \"FL\":\n          this.setFlatness(value);\n          break;\n        case \"Font\":\n          this.setFont(value[0], value[1]);\n          break;\n        case \"CA\":\n          this.current.strokeAlpha = value;\n          break;\n        case \"ca\":\n          this.ctx.globalAlpha = this.current.fillAlpha = value;\n          break;\n        case \"BM\":\n          this.ctx.globalCompositeOperation = value;\n          break;\n        case \"SMask\":\n          this.current.activeSMask = value ? this.tempSMask : null;\n          this.tempSMask = null;\n          this.checkSMaskState();\n          break;\n        case \"TR\":\n          this.ctx.filter = this.current.transferMaps =\n            this.filterFactory.addFilter(value);\n          break;\n      }\n    }\n  }\n\n  get inSMaskMode() {\n    return !!this.suspendedCtx;\n  }\n\n  checkSMaskState() {\n    const inSMaskMode = this.inSMaskMode;\n    if (this.current.activeSMask && !inSMaskMode) {\n      this.beginSMaskMode();\n    } else if (!this.current.activeSMask && inSMaskMode) {\n      this.endSMaskMode();\n    }\n    // Else, the state is okay and nothing needs to be done.\n  }\n\n  /**\n   * Soft mask mode takes the current main drawing canvas and replaces it with\n   * a temporary canvas. Any drawing operations that happen on the temporary\n   * canvas need to be composed with the main canvas that was suspended (see\n   * `compose()`). The temporary canvas also duplicates many of its operations\n   * on the suspended canvas to keep them in sync, so that when the soft mask\n   * mode ends any clipping paths or transformations will still be active and in\n   * the right order on the canvas' graphics state stack.\n   */\n  beginSMaskMode() {\n    if (this.inSMaskMode) {\n      throw new Error(\"beginSMaskMode called while already in smask mode\");\n    }\n    const drawnWidth = this.ctx.canvas.width;\n    const drawnHeight = this.ctx.canvas.height;\n    const cacheId = \"smaskGroupAt\" + this.groupLevel;\n    const scratchCanvas = this.cachedCanvases.getCanvas(\n      cacheId,\n      drawnWidth,\n      drawnHeight\n    );\n    this.suspendedCtx = this.ctx;\n    const ctx = (this.ctx = scratchCanvas.context);\n    ctx.setTransform(this.suspendedCtx.getTransform());\n    copyCtxState(this.suspendedCtx, ctx);\n    mirrorContextOperations(ctx, this.suspendedCtx);\n\n    this.setGState([[\"BM\", \"source-over\"]]);\n  }\n\n  endSMaskMode() {\n    if (!this.inSMaskMode) {\n      throw new Error(\"endSMaskMode called while not in smask mode\");\n    }\n    // The soft mask is done, now restore the suspended canvas as the main\n    // drawing canvas.\n    this.ctx._removeMirroring();\n    copyCtxState(this.ctx, this.suspendedCtx);\n    this.ctx = this.suspendedCtx;\n\n    this.suspendedCtx = null;\n  }\n\n  compose(dirtyBox) {\n    if (!this.current.activeSMask) {\n      return;\n    }\n\n    if (!dirtyBox) {\n      dirtyBox = [0, 0, this.ctx.canvas.width, this.ctx.canvas.height];\n    } else {\n      dirtyBox[0] = Math.floor(dirtyBox[0]);\n      dirtyBox[1] = Math.floor(dirtyBox[1]);\n      dirtyBox[2] = Math.ceil(dirtyBox[2]);\n      dirtyBox[3] = Math.ceil(dirtyBox[3]);\n    }\n    const smask = this.current.activeSMask;\n    const suspendedCtx = this.suspendedCtx;\n\n    this.composeSMask(suspendedCtx, smask, this.ctx, dirtyBox);\n    // Whatever was drawn has been moved to the suspended canvas, now clear it\n    // out of the current canvas.\n    this.ctx.save();\n    this.ctx.setTransform(1, 0, 0, 1, 0, 0);\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n    this.ctx.restore();\n  }\n\n  composeSMask(ctx, smask, layerCtx, layerBox) {\n    const layerOffsetX = layerBox[0];\n    const layerOffsetY = layerBox[1];\n    const layerWidth = layerBox[2] - layerOffsetX;\n    const layerHeight = layerBox[3] - layerOffsetY;\n    if (layerWidth === 0 || layerHeight === 0) {\n      return;\n    }\n    this.genericComposeSMask(\n      smask.context,\n      layerCtx,\n      layerWidth,\n      layerHeight,\n      smask.subtype,\n      smask.backdrop,\n      smask.transferMap,\n      layerOffsetX,\n      layerOffsetY,\n      smask.offsetX,\n      smask.offsetY\n    );\n    ctx.save();\n    ctx.globalAlpha = 1;\n    ctx.globalCompositeOperation = \"source-over\";\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.drawImage(layerCtx.canvas, 0, 0);\n    ctx.restore();\n  }\n\n  genericComposeSMask(\n    maskCtx,\n    layerCtx,\n    width,\n    height,\n    subtype,\n    backdrop,\n    transferMap,\n    layerOffsetX,\n    layerOffsetY,\n    maskOffsetX,\n    maskOffsetY\n  ) {\n    let maskCanvas = maskCtx.canvas;\n    let maskX = layerOffsetX - maskOffsetX;\n    let maskY = layerOffsetY - maskOffsetY;\n\n    if (backdrop) {\n      if (\n        maskX < 0 ||\n        maskY < 0 ||\n        maskX + width > maskCanvas.width ||\n        maskY + height > maskCanvas.height\n      ) {\n        const canvas = this.cachedCanvases.getCanvas(\n          \"maskExtension\",\n          width,\n          height\n        );\n        const ctx = canvas.context;\n        ctx.drawImage(maskCanvas, -maskX, -maskY);\n        ctx.globalCompositeOperation = \"destination-atop\";\n        ctx.fillStyle = backdrop;\n        ctx.fillRect(0, 0, width, height);\n        ctx.globalCompositeOperation = \"source-over\";\n\n        maskCanvas = canvas.canvas;\n        maskX = maskY = 0;\n      } else {\n        maskCtx.save();\n        maskCtx.globalAlpha = 1;\n        maskCtx.setTransform(1, 0, 0, 1, 0, 0);\n        const clip = new Path2D();\n        clip.rect(maskX, maskY, width, height);\n        maskCtx.clip(clip);\n        maskCtx.globalCompositeOperation = \"destination-atop\";\n        maskCtx.fillStyle = backdrop;\n        maskCtx.fillRect(maskX, maskY, width, height);\n        maskCtx.restore();\n      }\n    }\n\n    layerCtx.save();\n    layerCtx.globalAlpha = 1;\n    layerCtx.setTransform(1, 0, 0, 1, 0, 0);\n\n    if (subtype === \"Alpha\" && transferMap) {\n      layerCtx.filter = this.filterFactory.addAlphaFilter(transferMap);\n    } else if (subtype === \"Luminosity\") {\n      layerCtx.filter = this.filterFactory.addLuminosityFilter(transferMap);\n    }\n\n    const clip = new Path2D();\n    clip.rect(layerOffsetX, layerOffsetY, width, height);\n    layerCtx.clip(clip);\n    layerCtx.globalCompositeOperation = \"destination-in\";\n    layerCtx.drawImage(\n      maskCanvas,\n      maskX,\n      maskY,\n      width,\n      height,\n      layerOffsetX,\n      layerOffsetY,\n      width,\n      height\n    );\n    layerCtx.restore();\n  }\n\n  save() {\n    if (this.inSMaskMode) {\n      // SMask mode may be turned on/off causing us to lose graphics state.\n      // Copy the temporary canvas state to the main(suspended) canvas to keep\n      // it in sync.\n      copyCtxState(this.ctx, this.suspendedCtx);\n    }\n    this.ctx.save();\n    const old = this.current;\n    this.stateStack.push(old);\n    this.current = old.clone();\n  }\n\n  restore() {\n    if (this.stateStack.length === 0) {\n      if (this.inSMaskMode) {\n        this.endSMaskMode();\n      }\n      return;\n    }\n\n    this.current = this.stateStack.pop();\n    this.ctx.restore();\n    if (this.inSMaskMode) {\n      // Graphics state is stored on the main(suspended) canvas. Restore its\n      // state then copy it over to the temporary canvas.\n      copyCtxState(this.suspendedCtx, this.ctx);\n    }\n    this.checkSMaskState();\n\n    // Ensure that the clipping path is reset (fixes issue6413.pdf).\n    this.pendingClip = null;\n\n    this._cachedScaleForStroking[0] = -1;\n    this._cachedGetSinglePixelWidth = null;\n  }\n\n  transform(a, b, c, d, e, f) {\n    this.ctx.transform(a, b, c, d, e, f);\n\n    this._cachedScaleForStroking[0] = -1;\n    this._cachedGetSinglePixelWidth = null;\n  }\n\n  // Path\n  constructPath(op, data, minMax) {\n    let [path] = data;\n    if (!minMax) {\n      // The path is empty, so no need to update the current minMax.\n      path ||= data[0] = new Path2D();\n      this[op](path);\n      return;\n    }\n    if (!(path instanceof Path2D)) {\n      // Using a SVG string is slightly slower than using the following loop.\n      const path2d = (data[0] = new Path2D());\n      for (let i = 0, ii = path.length; i < ii; ) {\n        switch (path[i++]) {\n          case DrawOPS.moveTo:\n            path2d.moveTo(path[i++], path[i++]);\n            break;\n          case DrawOPS.lineTo:\n            path2d.lineTo(path[i++], path[i++]);\n            break;\n          case DrawOPS.curveTo:\n            path2d.bezierCurveTo(\n              path[i++],\n              path[i++],\n              path[i++],\n              path[i++],\n              path[i++],\n              path[i++]\n            );\n            break;\n          case DrawOPS.closePath:\n            path2d.closePath();\n            break;\n          default:\n            warn(`Unrecognized drawing path operator: ${path[i - 1]}`);\n            break;\n        }\n      }\n      path = path2d;\n    }\n    Util.axialAlignedBoundingBox(\n      minMax,\n      getCurrentTransform(this.ctx),\n      this.current.minMax\n    );\n    this[op](path);\n  }\n\n  closePath() {\n    this.ctx.closePath();\n  }\n\n  stroke(path, consumePath = true) {\n    const ctx = this.ctx;\n    const strokeColor = this.current.strokeColor;\n    // For stroke we want to temporarily change the global alpha to the\n    // stroking alpha.\n    ctx.globalAlpha = this.current.strokeAlpha;\n    if (this.contentVisible) {\n      if (typeof strokeColor === \"object\" && strokeColor?.getPattern) {\n        const baseTransform = strokeColor.isModifyingCurrentTransform()\n          ? ctx.getTransform()\n          : null;\n        ctx.save();\n        ctx.strokeStyle = strokeColor.getPattern(\n          ctx,\n          this,\n          getCurrentTransformInverse(ctx),\n          PathType.STROKE\n        );\n        if (baseTransform) {\n          const newPath = new Path2D();\n          newPath.addPath(\n            path,\n            ctx.getTransform().invertSelf().multiplySelf(baseTransform)\n          );\n          path = newPath;\n        }\n        this.rescaleAndStroke(path, /* saveRestore */ false);\n        ctx.restore();\n      } else {\n        this.rescaleAndStroke(path, /* saveRestore */ true);\n      }\n    }\n    if (consumePath) {\n      this.consumePath(\n        path,\n        this.current.getClippedPathBoundingBox(\n          PathType.STROKE,\n          getCurrentTransform(this.ctx)\n        )\n      );\n    }\n    // Restore the global alpha to the fill alpha\n    ctx.globalAlpha = this.current.fillAlpha;\n  }\n\n  closeStroke(path) {\n    this.stroke(path);\n  }\n\n  fill(path, consumePath = true) {\n    const ctx = this.ctx;\n    const fillColor = this.current.fillColor;\n    const isPatternFill = this.current.patternFill;\n    let needRestore = false;\n\n    if (isPatternFill) {\n      const baseTransform = fillColor.isModifyingCurrentTransform()\n        ? ctx.getTransform()\n        : null;\n      ctx.save();\n      ctx.fillStyle = fillColor.getPattern(\n        ctx,\n        this,\n        getCurrentTransformInverse(ctx),\n        PathType.FILL\n      );\n      if (baseTransform) {\n        const newPath = new Path2D();\n        newPath.addPath(\n          path,\n          ctx.getTransform().invertSelf().multiplySelf(baseTransform)\n        );\n        path = newPath;\n      }\n      needRestore = true;\n    }\n\n    const intersect = this.current.getClippedPathBoundingBox();\n    if (this.contentVisible && intersect !== null) {\n      if (this.pendingEOFill) {\n        ctx.fill(path, \"evenodd\");\n        this.pendingEOFill = false;\n      } else {\n        ctx.fill(path);\n      }\n    }\n\n    if (needRestore) {\n      ctx.restore();\n    }\n    if (consumePath) {\n      this.consumePath(path, intersect);\n    }\n  }\n\n  eoFill(path) {\n    this.pendingEOFill = true;\n    this.fill(path);\n  }\n\n  fillStroke(path) {\n    this.fill(path, false);\n    this.stroke(path, false);\n\n    this.consumePath(path);\n  }\n\n  eoFillStroke(path) {\n    this.pendingEOFill = true;\n    this.fillStroke(path);\n  }\n\n  closeFillStroke(path) {\n    this.fillStroke(path);\n  }\n\n  closeEOFillStroke(path) {\n    this.pendingEOFill = true;\n    this.fillStroke(path);\n  }\n\n  endPath(path) {\n    this.consumePath(path);\n  }\n\n  rawFillPath(path) {\n    this.ctx.fill(path);\n  }\n\n  // Clipping\n  clip() {\n    this.pendingClip = NORMAL_CLIP;\n  }\n\n  eoClip() {\n    this.pendingClip = EO_CLIP;\n  }\n\n  // Text\n  beginText() {\n    this.current.textMatrix = null;\n    this.current.textMatrixScale = 1;\n    this.current.x = this.current.lineX = 0;\n    this.current.y = this.current.lineY = 0;\n  }\n\n  endText() {\n    const paths = this.pendingTextPaths;\n    const ctx = this.ctx;\n    if (paths === undefined) {\n      return;\n    }\n\n    const newPath = new Path2D();\n    const invTransf = ctx.getTransform().invertSelf();\n    for (const { transform, x, y, fontSize, path } of paths) {\n      newPath.addPath(\n        path,\n        new DOMMatrix(transform)\n          .preMultiplySelf(invTransf)\n          .translate(x, y)\n          .scale(fontSize, -fontSize)\n      );\n    }\n\n    ctx.clip(newPath);\n    delete this.pendingTextPaths;\n  }\n\n  setCharSpacing(spacing) {\n    this.current.charSpacing = spacing;\n  }\n\n  setWordSpacing(spacing) {\n    this.current.wordSpacing = spacing;\n  }\n\n  setHScale(scale) {\n    this.current.textHScale = scale / 100;\n  }\n\n  setLeading(leading) {\n    this.current.leading = -leading;\n  }\n\n  setFont(fontRefName, size) {\n    const fontObj = this.commonObjs.get(fontRefName);\n    const current = this.current;\n\n    if (!fontObj) {\n      throw new Error(`Can't find font for ${fontRefName}`);\n    }\n    current.fontMatrix = fontObj.fontMatrix || FONT_IDENTITY_MATRIX;\n\n    // A valid matrix needs all main diagonal elements to be non-zero\n    // This also ensures we bypass FF bugzilla bug #719844.\n    if (current.fontMatrix[0] === 0 || current.fontMatrix[3] === 0) {\n      warn(\"Invalid font matrix for font \" + fontRefName);\n    }\n\n    // The spec for Tf (setFont) says that 'size' specifies the font 'scale',\n    // and in some docs this can be negative (inverted x-y axes).\n    if (size < 0) {\n      size = -size;\n      current.fontDirection = -1;\n    } else {\n      current.fontDirection = 1;\n    }\n\n    this.current.font = fontObj;\n    this.current.fontSize = size;\n\n    if (fontObj.isType3Font) {\n      return; // we don't need ctx.font for Type3 fonts\n    }\n\n    const name = fontObj.loadedName || \"sans-serif\";\n    const typeface =\n      fontObj.systemFontInfo?.css || `\"${name}\", ${fontObj.fallbackName}`;\n\n    let bold = \"normal\";\n    if (fontObj.black) {\n      bold = \"900\";\n    } else if (fontObj.bold) {\n      bold = \"bold\";\n    }\n    const italic = fontObj.italic ? \"italic\" : \"normal\";\n\n    // Some font backends cannot handle fonts below certain size.\n    // Keeping the font at minimal size and using the fontSizeScale to change\n    // the current transformation matrix before the fillText/strokeText.\n    // See https://bugzilla.mozilla.org/show_bug.cgi?id=726227\n    let browserFontSize = size;\n    if (size < MIN_FONT_SIZE) {\n      browserFontSize = MIN_FONT_SIZE;\n    } else if (size > MAX_FONT_SIZE) {\n      browserFontSize = MAX_FONT_SIZE;\n    }\n    this.current.fontSizeScale = size / browserFontSize;\n\n    this.ctx.font = `${italic} ${bold} ${browserFontSize}px ${typeface}`;\n  }\n\n  setTextRenderingMode(mode) {\n    this.current.textRenderingMode = mode;\n  }\n\n  setTextRise(rise) {\n    this.current.textRise = rise;\n  }\n\n  moveText(x, y) {\n    this.current.x = this.current.lineX += x;\n    this.current.y = this.current.lineY += y;\n  }\n\n  setLeadingMoveText(x, y) {\n    this.setLeading(-y);\n    this.moveText(x, y);\n  }\n\n  setTextMatrix(matrix) {\n    const { current } = this;\n    current.textMatrix = matrix;\n    current.textMatrixScale = Math.hypot(matrix[0], matrix[1]);\n\n    current.x = current.lineX = 0;\n    current.y = current.lineY = 0;\n  }\n\n  nextLine() {\n    this.moveText(0, this.current.leading);\n  }\n\n  #getScaledPath(path, currentTransform, transform) {\n    const newPath = new Path2D();\n    newPath.addPath(\n      path,\n      new DOMMatrix(transform).invertSelf().multiplySelf(currentTransform)\n    );\n    return newPath;\n  }\n\n  paintChar(character, x, y, patternFillTransform, patternStrokeTransform) {\n    const ctx = this.ctx;\n    const current = this.current;\n    const font = current.font;\n    const textRenderingMode = current.textRenderingMode;\n    const fontSize = current.fontSize / current.fontSizeScale;\n    const fillStrokeMode =\n      textRenderingMode & TextRenderingMode.FILL_STROKE_MASK;\n    const isAddToPathSet = !!(\n      textRenderingMode & TextRenderingMode.ADD_TO_PATH_FLAG\n    );\n    const patternFill = current.patternFill && !font.missingFile;\n    const patternStroke = current.patternStroke && !font.missingFile;\n\n    let path;\n    if (\n      font.disableFontFace ||\n      isAddToPathSet ||\n      patternFill ||\n      patternStroke\n    ) {\n      path = font.getPathGenerator(this.commonObjs, character);\n    }\n\n    if (font.disableFontFace || patternFill || patternStroke) {\n      ctx.save();\n      ctx.translate(x, y);\n      ctx.scale(fontSize, -fontSize);\n      let currentTransform;\n      if (\n        fillStrokeMode === TextRenderingMode.FILL ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        if (patternFillTransform) {\n          currentTransform = ctx.getTransform();\n          ctx.setTransform(...patternFillTransform);\n          ctx.fill(\n            this.#getScaledPath(path, currentTransform, patternFillTransform)\n          );\n        } else {\n          ctx.fill(path);\n        }\n      }\n      if (\n        fillStrokeMode === TextRenderingMode.STROKE ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        if (patternStrokeTransform) {\n          currentTransform ||= ctx.getTransform();\n          ctx.setTransform(...patternStrokeTransform);\n          const { a, b, c, d } = currentTransform;\n          const invPatternTransform = Util.inverseTransform(\n            patternStrokeTransform\n          );\n          const transf = Util.transform(\n            [a, b, c, d, 0, 0],\n            invPatternTransform\n          );\n          Util.singularValueDecompose2dScale(transf, XY);\n\n          // Cancel the pattern scaling of the line width.\n          // If sx and sy are different, unfortunately we can't do anything and\n          // we'll have a rendering bug.\n          ctx.lineWidth *= Math.max(XY[0], XY[1]) / fontSize;\n          ctx.stroke(\n            this.#getScaledPath(path, currentTransform, patternStrokeTransform)\n          );\n        } else {\n          ctx.lineWidth /= fontSize;\n          ctx.stroke(path);\n        }\n      }\n      ctx.restore();\n    } else {\n      if (\n        fillStrokeMode === TextRenderingMode.FILL ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        ctx.fillText(character, x, y);\n      }\n      if (\n        fillStrokeMode === TextRenderingMode.STROKE ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        ctx.strokeText(character, x, y);\n      }\n    }\n\n    if (isAddToPathSet) {\n      const paths = (this.pendingTextPaths ||= []);\n      paths.push({\n        transform: getCurrentTransform(ctx),\n        x,\n        y,\n        fontSize,\n        path,\n      });\n    }\n  }\n\n  get isFontSubpixelAAEnabled() {\n    // Checks if anti-aliasing is enabled when scaled text is painted.\n    // On Windows GDI scaled fonts looks bad.\n    const { context: ctx } = this.cachedCanvases.getCanvas(\n      \"isFontSubpixelAAEnabled\",\n      10,\n      10\n    );\n    ctx.scale(1.5, 1);\n    ctx.fillText(\"I\", 0, 10);\n    const data = ctx.getImageData(0, 0, 10, 10).data;\n    let enabled = false;\n    for (let i = 3; i < data.length; i += 4) {\n      if (data[i] > 0 && data[i] < 255) {\n        enabled = true;\n        break;\n      }\n    }\n    return shadow(this, \"isFontSubpixelAAEnabled\", enabled);\n  }\n\n  showText(glyphs) {\n    const current = this.current;\n    const font = current.font;\n    if (font.isType3Font) {\n      return this.showType3Text(glyphs);\n    }\n\n    const fontSize = current.fontSize;\n    if (fontSize === 0) {\n      return undefined;\n    }\n\n    const ctx = this.ctx;\n    const fontSizeScale = current.fontSizeScale;\n    const charSpacing = current.charSpacing;\n    const wordSpacing = current.wordSpacing;\n    const fontDirection = current.fontDirection;\n    const textHScale = current.textHScale * fontDirection;\n    const glyphsLength = glyphs.length;\n    const vertical = font.vertical;\n    const spacingDir = vertical ? 1 : -1;\n    const defaultVMetrics = font.defaultVMetrics;\n    const widthAdvanceScale = fontSize * current.fontMatrix[0];\n\n    const simpleFillText =\n      current.textRenderingMode === TextRenderingMode.FILL &&\n      !font.disableFontFace &&\n      !current.patternFill;\n\n    ctx.save();\n    if (current.textMatrix) {\n      ctx.transform(...current.textMatrix);\n    }\n    ctx.translate(current.x, current.y + current.textRise);\n\n    if (fontDirection > 0) {\n      ctx.scale(textHScale, -1);\n    } else {\n      ctx.scale(textHScale, 1);\n    }\n\n    let patternFillTransform, patternStrokeTransform;\n    if (current.patternFill) {\n      ctx.save();\n      const pattern = current.fillColor.getPattern(\n        ctx,\n        this,\n        getCurrentTransformInverse(ctx),\n        PathType.FILL\n      );\n      patternFillTransform = getCurrentTransform(ctx);\n      ctx.restore();\n      ctx.fillStyle = pattern;\n    }\n\n    if (current.patternStroke) {\n      ctx.save();\n      const pattern = current.strokeColor.getPattern(\n        ctx,\n        this,\n        getCurrentTransformInverse(ctx),\n        PathType.STROKE\n      );\n      patternStrokeTransform = getCurrentTransform(ctx);\n      ctx.restore();\n      ctx.strokeStyle = pattern;\n    }\n\n    let lineWidth = current.lineWidth;\n    const scale = current.textMatrixScale;\n    if (scale === 0 || lineWidth === 0) {\n      const fillStrokeMode =\n        current.textRenderingMode & TextRenderingMode.FILL_STROKE_MASK;\n      if (\n        fillStrokeMode === TextRenderingMode.STROKE ||\n        fillStrokeMode === TextRenderingMode.FILL_STROKE\n      ) {\n        lineWidth = this.getSinglePixelWidth();\n      }\n    } else {\n      lineWidth /= scale;\n    }\n\n    if (fontSizeScale !== 1.0) {\n      ctx.scale(fontSizeScale, fontSizeScale);\n      lineWidth /= fontSizeScale;\n    }\n\n    ctx.lineWidth = lineWidth;\n\n    if (font.isInvalidPDFjsFont) {\n      const chars = [];\n      let width = 0;\n      for (const glyph of glyphs) {\n        chars.push(glyph.unicode);\n        width += glyph.width;\n      }\n      ctx.fillText(chars.join(\"\"), 0, 0);\n      current.x += width * widthAdvanceScale * textHScale;\n      ctx.restore();\n      this.compose();\n\n      return undefined;\n    }\n\n    let x = 0,\n      i;\n    for (i = 0; i < glyphsLength; ++i) {\n      const glyph = glyphs[i];\n      if (typeof glyph === \"number\") {\n        x += (spacingDir * glyph * fontSize) / 1000;\n        continue;\n      }\n\n      let restoreNeeded = false;\n      const spacing = (glyph.isSpace ? wordSpacing : 0) + charSpacing;\n      const character = glyph.fontChar;\n      const accent = glyph.accent;\n      let scaledX, scaledY;\n      let width = glyph.width;\n      if (vertical) {\n        const vmetric = glyph.vmetric || defaultVMetrics;\n        const vx =\n          -(glyph.vmetric ? vmetric[1] : width * 0.5) * widthAdvanceScale;\n        const vy = vmetric[2] * widthAdvanceScale;\n\n        width = vmetric ? -vmetric[0] : width;\n        scaledX = vx / fontSizeScale;\n        scaledY = (x + vy) / fontSizeScale;\n      } else {\n        scaledX = x / fontSizeScale;\n        scaledY = 0;\n      }\n\n      if (font.remeasure && width > 0) {\n        // Some standard fonts may not have the exact width: rescale per\n        // character if measured width is greater than expected glyph width\n        // and subpixel-aa is enabled, otherwise just center the glyph.\n        const measuredWidth =\n          ((ctx.measureText(character).width * 1000) / fontSize) *\n          fontSizeScale;\n        if (width < measuredWidth && this.isFontSubpixelAAEnabled) {\n          const characterScaleX = width / measuredWidth;\n          restoreNeeded = true;\n          ctx.save();\n          ctx.scale(characterScaleX, 1);\n          scaledX /= characterScaleX;\n        } else if (width !== measuredWidth) {\n          scaledX +=\n            (((width - measuredWidth) / 2000) * fontSize) / fontSizeScale;\n        }\n      }\n\n      // Only attempt to draw the glyph if it is actually in the embedded font\n      // file or if there isn't a font file so the fallback font is shown.\n      if (this.contentVisible && (glyph.isInFont || font.missingFile)) {\n        if (simpleFillText && !accent) {\n          // common case\n          ctx.fillText(character, scaledX, scaledY);\n        } else {\n          this.paintChar(\n            character,\n            scaledX,\n            scaledY,\n            patternFillTransform,\n            patternStrokeTransform\n          );\n          if (accent) {\n            const scaledAccentX =\n              scaledX + (fontSize * accent.offset.x) / fontSizeScale;\n            const scaledAccentY =\n              scaledY - (fontSize * accent.offset.y) / fontSizeScale;\n            this.paintChar(\n              accent.fontChar,\n              scaledAccentX,\n              scaledAccentY,\n              patternFillTransform,\n              patternStrokeTransform\n            );\n          }\n        }\n      }\n\n      const charWidth = vertical\n        ? width * widthAdvanceScale - spacing * fontDirection\n        : width * widthAdvanceScale + spacing * fontDirection;\n      x += charWidth;\n\n      if (restoreNeeded) {\n        ctx.restore();\n      }\n    }\n    if (vertical) {\n      current.y -= x;\n    } else {\n      current.x += x * textHScale;\n    }\n    ctx.restore();\n    this.compose();\n\n    return undefined;\n  }\n\n  showType3Text(glyphs) {\n    // Type3 fonts - each glyph is a \"mini-PDF\"\n    const ctx = this.ctx;\n    const current = this.current;\n    const font = current.font;\n    const fontSize = current.fontSize;\n    const fontDirection = current.fontDirection;\n    const spacingDir = font.vertical ? 1 : -1;\n    const charSpacing = current.charSpacing;\n    const wordSpacing = current.wordSpacing;\n    const textHScale = current.textHScale * fontDirection;\n    const fontMatrix = current.fontMatrix || FONT_IDENTITY_MATRIX;\n    const glyphsLength = glyphs.length;\n    const isTextInvisible =\n      current.textRenderingMode === TextRenderingMode.INVISIBLE;\n    let i, glyph, width, spacingLength;\n\n    if (isTextInvisible || fontSize === 0) {\n      return;\n    }\n    this._cachedScaleForStroking[0] = -1;\n    this._cachedGetSinglePixelWidth = null;\n\n    ctx.save();\n    if (current.textMatrix) {\n      ctx.transform(...current.textMatrix);\n    }\n    ctx.translate(current.x, current.y + current.textRise);\n\n    ctx.scale(textHScale, fontDirection);\n\n    for (i = 0; i < glyphsLength; ++i) {\n      glyph = glyphs[i];\n      if (typeof glyph === \"number\") {\n        spacingLength = (spacingDir * glyph * fontSize) / 1000;\n        this.ctx.translate(spacingLength, 0);\n        current.x += spacingLength * textHScale;\n        continue;\n      }\n\n      const spacing = (glyph.isSpace ? wordSpacing : 0) + charSpacing;\n      const operatorList = font.charProcOperatorList[glyph.operatorListId];\n      if (!operatorList) {\n        warn(`Type3 character \"${glyph.operatorListId}\" is not available.`);\n      } else if (this.contentVisible) {\n        this.save();\n        ctx.scale(fontSize, fontSize);\n        ctx.transform(...fontMatrix);\n        this.executeOperatorList(operatorList);\n        this.restore();\n      }\n\n      const p = [glyph.width, 0];\n      Util.applyTransform(p, fontMatrix);\n      width = p[0] * fontSize + spacing;\n\n      ctx.translate(width, 0);\n      current.x += width * textHScale;\n    }\n    ctx.restore();\n  }\n\n  // Type3 fonts\n  setCharWidth(xWidth, yWidth) {\n    // We can safely ignore this since the width should be the same\n    // as the width in the Widths array.\n  }\n\n  setCharWidthAndBounds(xWidth, yWidth, llx, lly, urx, ury) {\n    const clip = new Path2D();\n    clip.rect(llx, lly, urx - llx, ury - lly);\n    this.ctx.clip(clip);\n    this.endPath();\n  }\n\n  // Color\n  getColorN_Pattern(IR) {\n    let pattern;\n    if (IR[0] === \"TilingPattern\") {\n      const baseTransform = this.baseTransform || getCurrentTransform(this.ctx);\n      const canvasGraphicsFactory = {\n        createCanvasGraphics: ctx =>\n          new CanvasGraphics(\n            ctx,\n            this.commonObjs,\n            this.objs,\n            this.canvasFactory,\n            this.filterFactory,\n            {\n              optionalContentConfig: this.optionalContentConfig,\n              markedContentStack: this.markedContentStack,\n            }\n          ),\n      };\n      pattern = new TilingPattern(\n        IR,\n        this.ctx,\n        canvasGraphicsFactory,\n        baseTransform\n      );\n    } else {\n      pattern = this._getPattern(IR[1], IR[2]);\n    }\n    return pattern;\n  }\n\n  setStrokeColorN() {\n    this.current.strokeColor = this.getColorN_Pattern(arguments);\n    this.current.patternStroke = true;\n  }\n\n  setFillColorN() {\n    this.current.fillColor = this.getColorN_Pattern(arguments);\n    this.current.patternFill = true;\n  }\n\n  setStrokeRGBColor(color) {\n    this.ctx.strokeStyle = this.current.strokeColor = color;\n    this.current.patternStroke = false;\n  }\n\n  setStrokeTransparent() {\n    this.ctx.strokeStyle = this.current.strokeColor = \"transparent\";\n    this.current.patternStroke = false;\n  }\n\n  setFillRGBColor(color) {\n    this.ctx.fillStyle = this.current.fillColor = color;\n    this.current.patternFill = false;\n  }\n\n  setFillTransparent() {\n    this.ctx.fillStyle = this.current.fillColor = \"transparent\";\n    this.current.patternFill = false;\n  }\n\n  _getPattern(objId, matrix = null) {\n    let pattern;\n    if (this.cachedPatterns.has(objId)) {\n      pattern = this.cachedPatterns.get(objId);\n    } else {\n      pattern = getShadingPattern(this.getObject(objId));\n      this.cachedPatterns.set(objId, pattern);\n    }\n    if (matrix) {\n      pattern.matrix = matrix;\n    }\n    return pattern;\n  }\n\n  shadingFill(objId) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const ctx = this.ctx;\n\n    this.save();\n    const pattern = this._getPattern(objId);\n    ctx.fillStyle = pattern.getPattern(\n      ctx,\n      this,\n      getCurrentTransformInverse(ctx),\n      PathType.SHADING\n    );\n\n    const inv = getCurrentTransformInverse(ctx);\n    if (inv) {\n      const { width, height } = ctx.canvas;\n      const minMax = MIN_MAX_INIT.slice();\n      Util.axialAlignedBoundingBox([0, 0, width, height], inv, minMax);\n      const [x0, y0, x1, y1] = minMax;\n\n      this.ctx.fillRect(x0, y0, x1 - x0, y1 - y0);\n    } else {\n      // HACK to draw the gradient onto an infinite rectangle.\n      // PDF gradients are drawn across the entire image while\n      // Canvas only allows gradients to be drawn in a rectangle\n      // The following bug should allow us to remove this.\n      // https://bugzilla.mozilla.org/show_bug.cgi?id=664884\n\n      this.ctx.fillRect(-1e10, -1e10, 2e10, 2e10);\n    }\n\n    this.compose(this.current.getClippedPathBoundingBox());\n    this.restore();\n  }\n\n  // Images\n  beginInlineImage() {\n    unreachable(\"Should not call beginInlineImage\");\n  }\n\n  beginImageData() {\n    unreachable(\"Should not call beginImageData\");\n  }\n\n  paintFormXObjectBegin(matrix, bbox) {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.save();\n    this.baseTransformStack.push(this.baseTransform);\n\n    if (matrix) {\n      this.transform(...matrix);\n    }\n    this.baseTransform = getCurrentTransform(this.ctx);\n\n    if (bbox) {\n      Util.axialAlignedBoundingBox(\n        bbox,\n        this.baseTransform,\n        this.current.minMax\n      );\n      const [x0, y0, x1, y1] = bbox;\n      const clip = new Path2D();\n      clip.rect(x0, y0, x1 - x0, y1 - y0);\n      this.ctx.clip(clip);\n      this.endPath();\n    }\n  }\n\n  paintFormXObjectEnd() {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.restore();\n    this.baseTransform = this.baseTransformStack.pop();\n  }\n\n  beginGroup(group) {\n    if (!this.contentVisible) {\n      return;\n    }\n\n    this.save();\n    // If there's an active soft mask we don't want it enabled for the group, so\n    // clear it out. The mask and suspended canvas will be restored in endGroup.\n    if (this.inSMaskMode) {\n      this.endSMaskMode();\n      this.current.activeSMask = null;\n    }\n\n    const currentCtx = this.ctx;\n    // TODO non-isolated groups - according to Rik at adobe non-isolated\n    // group results aren't usually that different and they even have tools\n    // that ignore this setting. Notes from Rik on implementing:\n    // - When you encounter an transparency group, create a new canvas with\n    // the dimensions of the bbox\n    // - copy the content from the previous canvas to the new canvas\n    // - draw as usual\n    // - remove the backdrop alpha:\n    // alphaNew = 1 - (1 - alpha)/(1 - alphaBackdrop) with 'alpha' the alpha\n    // value of your transparency group and 'alphaBackdrop' the alpha of the\n    // backdrop\n    // - remove background color:\n    // colorNew = color - alphaNew *colorBackdrop /(1 - alphaNew)\n    if (!group.isolated) {\n      info(\"TODO: Support non-isolated groups.\");\n    }\n\n    // TODO knockout - supposedly possible with the clever use of compositing\n    // modes.\n    if (group.knockout) {\n      warn(\"Knockout groups not supported.\");\n    }\n\n    const currentTransform = getCurrentTransform(currentCtx);\n    if (group.matrix) {\n      currentCtx.transform(...group.matrix);\n    }\n    if (!group.bbox) {\n      throw new Error(\"Bounding box is required.\");\n    }\n\n    // Based on the current transform figure out how big the bounding box\n    // will actually be.\n    let bounds = MIN_MAX_INIT.slice();\n    Util.axialAlignedBoundingBox(\n      group.bbox,\n      getCurrentTransform(currentCtx),\n      bounds\n    );\n\n    // Clip the bounding box to the current canvas.\n    const canvasBounds = [\n      0,\n      0,\n      currentCtx.canvas.width,\n      currentCtx.canvas.height,\n    ];\n    bounds = Util.intersect(bounds, canvasBounds) || [0, 0, 0, 0];\n    // Use ceil in case we're between sizes so we don't create canvas that is\n    // too small and make the canvas at least 1x1 pixels.\n    const offsetX = Math.floor(bounds[0]);\n    const offsetY = Math.floor(bounds[1]);\n    const drawnWidth = Math.max(Math.ceil(bounds[2]) - offsetX, 1);\n    const drawnHeight = Math.max(Math.ceil(bounds[3]) - offsetY, 1);\n\n    this.current.startNewPathAndClipBox([0, 0, drawnWidth, drawnHeight]);\n\n    let cacheId = \"groupAt\" + this.groupLevel;\n    if (group.smask) {\n      // Using two cache entries is case if masks are used one after another.\n      cacheId += \"_smask_\" + (this.smaskCounter++ % 2);\n    }\n    const scratchCanvas = this.cachedCanvases.getCanvas(\n      cacheId,\n      drawnWidth,\n      drawnHeight\n    );\n    const groupCtx = scratchCanvas.context;\n\n    // Since we created a new canvas that is just the size of the bounding box\n    // we have to translate the group ctx.\n    groupCtx.translate(-offsetX, -offsetY);\n    groupCtx.transform(...currentTransform);\n\n    // Apply the bbox to the group context.\n    let clip = new Path2D();\n    const [x0, y0, x1, y1] = group.bbox;\n    clip.rect(x0, y0, x1 - x0, y1 - y0);\n    if (group.matrix) {\n      const path = new Path2D();\n      path.addPath(clip, new DOMMatrix(group.matrix));\n      clip = path;\n    }\n    groupCtx.clip(clip);\n\n    if (group.smask) {\n      // Saving state and cached mask to be used in setGState.\n      this.smaskStack.push({\n        canvas: scratchCanvas.canvas,\n        context: groupCtx,\n        offsetX,\n        offsetY,\n        subtype: group.smask.subtype,\n        backdrop: group.smask.backdrop,\n        transferMap: group.smask.transferMap || null,\n        startTransformInverse: null, // used during suspend operation\n      });\n    } else {\n      // Setup the current ctx so when the group is popped we draw it at the\n      // right location.\n      currentCtx.setTransform(1, 0, 0, 1, 0, 0);\n      currentCtx.translate(offsetX, offsetY);\n      currentCtx.save();\n    }\n    // The transparency group inherits all off the current graphics state\n    // except the blend mode, soft mask, and alpha constants.\n    copyCtxState(currentCtx, groupCtx);\n    this.ctx = groupCtx;\n    this.setGState([\n      [\"BM\", \"source-over\"],\n      [\"ca\", 1],\n      [\"CA\", 1],\n    ]);\n    this.groupStack.push(currentCtx);\n    this.groupLevel++;\n  }\n\n  endGroup(group) {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.groupLevel--;\n    const groupCtx = this.ctx;\n    const ctx = this.groupStack.pop();\n    this.ctx = ctx;\n    // Turn off image smoothing to avoid sub pixel interpolation which can\n    // look kind of blurry for some pdfs.\n    this.ctx.imageSmoothingEnabled = false;\n\n    if (group.smask) {\n      this.tempSMask = this.smaskStack.pop();\n      this.restore();\n    } else {\n      this.ctx.restore();\n      const currentMtx = getCurrentTransform(this.ctx);\n      this.restore();\n      this.ctx.save();\n      this.ctx.setTransform(...currentMtx);\n      const dirtyBox = MIN_MAX_INIT.slice();\n      Util.axialAlignedBoundingBox(\n        [0, 0, groupCtx.canvas.width, groupCtx.canvas.height],\n        currentMtx,\n        dirtyBox\n      );\n      this.ctx.drawImage(groupCtx.canvas, 0, 0);\n      this.ctx.restore();\n      this.compose(dirtyBox);\n    }\n  }\n\n  beginAnnotation(id, rect, transform, matrix, hasOwnCanvas) {\n    // The annotations are drawn just after the page content.\n    // The page content drawing can potentially have set a transform,\n    // a clipping path, whatever...\n    // So in order to have something clean, we restore the initial state.\n    this.#restoreInitialState();\n    resetCtxToDefault(this.ctx);\n\n    this.ctx.save();\n    this.save();\n\n    if (this.baseTransform) {\n      this.ctx.setTransform(...this.baseTransform);\n    }\n\n    if (rect) {\n      const width = rect[2] - rect[0];\n      const height = rect[3] - rect[1];\n\n      if (hasOwnCanvas && this.annotationCanvasMap) {\n        transform = transform.slice();\n        transform[4] -= rect[0];\n        transform[5] -= rect[1];\n\n        rect = rect.slice();\n        rect[0] = rect[1] = 0;\n        rect[2] = width;\n        rect[3] = height;\n\n        Util.singularValueDecompose2dScale(getCurrentTransform(this.ctx), XY);\n        const { viewportScale } = this;\n        const canvasWidth = Math.ceil(\n          width * this.outputScaleX * viewportScale\n        );\n        const canvasHeight = Math.ceil(\n          height * this.outputScaleY * viewportScale\n        );\n\n        this.annotationCanvas = this.canvasFactory.create(\n          canvasWidth,\n          canvasHeight\n        );\n        const { canvas, context } = this.annotationCanvas;\n        this.annotationCanvasMap.set(id, canvas);\n        this.annotationCanvas.savedCtx = this.ctx;\n        this.ctx = context;\n        this.ctx.save();\n        this.ctx.setTransform(XY[0], 0, 0, -XY[1], 0, height * XY[1]);\n\n        resetCtxToDefault(this.ctx);\n      } else {\n        resetCtxToDefault(this.ctx);\n\n        // Consume a potential path before clipping.\n        this.endPath();\n\n        const clip = new Path2D();\n        clip.rect(rect[0], rect[1], width, height);\n        this.ctx.clip(clip);\n      }\n    }\n\n    this.current = new CanvasExtraState(\n      this.ctx.canvas.width,\n      this.ctx.canvas.height\n    );\n\n    this.transform(...transform);\n    this.transform(...matrix);\n  }\n\n  endAnnotation() {\n    if (this.annotationCanvas) {\n      this.ctx.restore();\n      this.#drawFilter();\n\n      this.ctx = this.annotationCanvas.savedCtx;\n      delete this.annotationCanvas.savedCtx;\n      delete this.annotationCanvas;\n    }\n  }\n\n  paintImageMaskXObject(img) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const count = img.count;\n    img = this.getObject(img.data, img);\n    img.count = count;\n\n    const ctx = this.ctx;\n    const mask = this._createMaskCanvas(img);\n    const maskCanvas = mask.canvas;\n\n    ctx.save();\n    // The mask is drawn with the transform applied. Reset the current\n    // transform to draw to the identity.\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.drawImage(maskCanvas, mask.offsetX, mask.offsetY);\n    ctx.restore();\n    this.compose();\n  }\n\n  paintImageMaskXObjectRepeat(\n    img,\n    scaleX,\n    skewX = 0,\n    skewY = 0,\n    scaleY,\n    positions\n  ) {\n    if (!this.contentVisible) {\n      return;\n    }\n\n    img = this.getObject(img.data, img);\n\n    const ctx = this.ctx;\n    ctx.save();\n    const currentTransform = getCurrentTransform(ctx);\n    ctx.transform(scaleX, skewX, skewY, scaleY, 0, 0);\n    const mask = this._createMaskCanvas(img);\n\n    ctx.setTransform(\n      1,\n      0,\n      0,\n      1,\n      mask.offsetX - currentTransform[4],\n      mask.offsetY - currentTransform[5]\n    );\n    for (let i = 0, ii = positions.length; i < ii; i += 2) {\n      const trans = Util.transform(currentTransform, [\n        scaleX,\n        skewX,\n        skewY,\n        scaleY,\n        positions[i],\n        positions[i + 1],\n      ]);\n\n      // Here we want to apply the transform at the origin,\n      // hence no additional computation is necessary.\n      ctx.drawImage(mask.canvas, trans[4], trans[5]);\n    }\n    ctx.restore();\n    this.compose();\n  }\n\n  paintImageMaskXObjectGroup(images) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const ctx = this.ctx;\n\n    const fillColor = this.current.fillColor;\n    const isPatternFill = this.current.patternFill;\n\n    for (const image of images) {\n      const { data, width, height, transform } = image;\n\n      const maskCanvas = this.cachedCanvases.getCanvas(\n        \"maskCanvas\",\n        width,\n        height\n      );\n      const maskCtx = maskCanvas.context;\n      maskCtx.save();\n\n      const img = this.getObject(data, image);\n      putBinaryImageMask(maskCtx, img);\n\n      maskCtx.globalCompositeOperation = \"source-in\";\n\n      maskCtx.fillStyle = isPatternFill\n        ? fillColor.getPattern(\n            maskCtx,\n            this,\n            getCurrentTransformInverse(ctx),\n            PathType.FILL\n          )\n        : fillColor;\n      maskCtx.fillRect(0, 0, width, height);\n\n      maskCtx.restore();\n\n      ctx.save();\n      ctx.transform(...transform);\n      ctx.scale(1, -1);\n      drawImageAtIntegerCoords(\n        ctx,\n        maskCanvas.canvas,\n        0,\n        0,\n        width,\n        height,\n        0,\n        -1,\n        1,\n        1\n      );\n      ctx.restore();\n    }\n    this.compose();\n  }\n\n  paintImageXObject(objId) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const imgData = this.getObject(objId);\n    if (!imgData) {\n      warn(\"Dependent image isn't ready yet\");\n      return;\n    }\n\n    this.paintInlineImageXObject(imgData);\n  }\n\n  paintImageXObjectRepeat(objId, scaleX, scaleY, positions) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const imgData = this.getObject(objId);\n    if (!imgData) {\n      warn(\"Dependent image isn't ready yet\");\n      return;\n    }\n\n    const width = imgData.width;\n    const height = imgData.height;\n    const map = [];\n    for (let i = 0, ii = positions.length; i < ii; i += 2) {\n      map.push({\n        transform: [scaleX, 0, 0, scaleY, positions[i], positions[i + 1]],\n        x: 0,\n        y: 0,\n        w: width,\n        h: height,\n      });\n    }\n    this.paintInlineImageXObjectGroup(imgData, map);\n  }\n\n  applyTransferMapsToCanvas(ctx) {\n    if (this.current.transferMaps !== \"none\") {\n      ctx.filter = this.current.transferMaps;\n      ctx.drawImage(ctx.canvas, 0, 0);\n      ctx.filter = \"none\";\n    }\n    return ctx.canvas;\n  }\n\n  applyTransferMapsToBitmap(imgData) {\n    if (this.current.transferMaps === \"none\") {\n      return imgData.bitmap;\n    }\n    const { bitmap, width, height } = imgData;\n    const tmpCanvas = this.cachedCanvases.getCanvas(\n      \"inlineImage\",\n      width,\n      height\n    );\n    const tmpCtx = tmpCanvas.context;\n    tmpCtx.filter = this.current.transferMaps;\n    tmpCtx.drawImage(bitmap, 0, 0);\n    tmpCtx.filter = \"none\";\n\n    return tmpCanvas.canvas;\n  }\n\n  paintInlineImageXObject(imgData) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const width = imgData.width;\n    const height = imgData.height;\n    const ctx = this.ctx;\n\n    this.save();\n\n    // The filter, if any, will be applied in applyTransferMapsToBitmap.\n    // It must be applied to the image before rescaling else some artifacts\n    // could appear.\n    // The final restore will reset it to its value.\n    const { filter } = ctx;\n    if (filter !== \"none\" && filter !== \"\") {\n      ctx.filter = \"none\";\n    }\n\n    // scale the image to the unit square\n    ctx.scale(1 / width, -1 / height);\n\n    let imgToPaint;\n    if (imgData.bitmap) {\n      imgToPaint = this.applyTransferMapsToBitmap(imgData);\n    } else if (\n      (typeof HTMLElement === \"function\" && imgData instanceof HTMLElement) ||\n      !imgData.data\n    ) {\n      // typeof check is needed due to node.js support, see issue #8489\n      imgToPaint = imgData;\n    } else {\n      const tmpCanvas = this.cachedCanvases.getCanvas(\n        \"inlineImage\",\n        width,\n        height\n      );\n      const tmpCtx = tmpCanvas.context;\n      putBinaryImageData(tmpCtx, imgData);\n      imgToPaint = this.applyTransferMapsToCanvas(tmpCtx);\n    }\n\n    const scaled = this._scaleImage(\n      imgToPaint,\n      getCurrentTransformInverse(ctx)\n    );\n    ctx.imageSmoothingEnabled = getImageSmoothingEnabled(\n      getCurrentTransform(ctx),\n      imgData.interpolate\n    );\n\n    drawImageAtIntegerCoords(\n      ctx,\n      scaled.img,\n      0,\n      0,\n      scaled.paintWidth,\n      scaled.paintHeight,\n      0,\n      -height,\n      width,\n      height\n    );\n    this.compose();\n    this.restore();\n  }\n\n  paintInlineImageXObjectGroup(imgData, map) {\n    if (!this.contentVisible) {\n      return;\n    }\n    const ctx = this.ctx;\n    let imgToPaint;\n    if (imgData.bitmap) {\n      imgToPaint = imgData.bitmap;\n    } else {\n      const w = imgData.width;\n      const h = imgData.height;\n\n      const tmpCanvas = this.cachedCanvases.getCanvas(\"inlineImage\", w, h);\n      const tmpCtx = tmpCanvas.context;\n      putBinaryImageData(tmpCtx, imgData);\n      imgToPaint = this.applyTransferMapsToCanvas(tmpCtx);\n    }\n\n    for (const entry of map) {\n      ctx.save();\n      ctx.transform(...entry.transform);\n      ctx.scale(1, -1);\n      drawImageAtIntegerCoords(\n        ctx,\n        imgToPaint,\n        entry.x,\n        entry.y,\n        entry.w,\n        entry.h,\n        0,\n        -1,\n        1,\n        1\n      );\n      ctx.restore();\n    }\n    this.compose();\n  }\n\n  paintSolidColorImageMask() {\n    if (!this.contentVisible) {\n      return;\n    }\n    this.ctx.fillRect(0, 0, 1, 1);\n    this.compose();\n  }\n\n  // Marked content\n\n  markPoint(tag) {\n    // TODO Marked content.\n  }\n\n  markPointProps(tag, properties) {\n    // TODO Marked content.\n  }\n\n  beginMarkedContent(tag) {\n    this.markedContentStack.push({\n      visible: true,\n    });\n  }\n\n  beginMarkedContentProps(tag, properties) {\n    if (tag === \"OC\") {\n      this.markedContentStack.push({\n        visible: this.optionalContentConfig.isVisible(properties),\n      });\n    } else {\n      this.markedContentStack.push({\n        visible: true,\n      });\n    }\n    this.contentVisible = this.isContentVisible();\n  }\n\n  endMarkedContent() {\n    this.markedContentStack.pop();\n    this.contentVisible = this.isContentVisible();\n  }\n\n  // Compatibility\n\n  beginCompat() {\n    // TODO ignore undefined operators (should we do that anyway?)\n  }\n\n  endCompat() {\n    // TODO stop ignoring undefined operators\n  }\n\n  // Helper functions\n\n  consumePath(path, clipBox) {\n    const isEmpty = this.current.isEmptyClip();\n    if (this.pendingClip) {\n      this.current.updateClipFromPath();\n    }\n    if (!this.pendingClip) {\n      this.compose(clipBox);\n    }\n    const ctx = this.ctx;\n    if (this.pendingClip) {\n      if (!isEmpty) {\n        if (this.pendingClip === EO_CLIP) {\n          ctx.clip(path, \"evenodd\");\n        } else {\n          ctx.clip(path);\n        }\n      }\n      this.pendingClip = null;\n    }\n    this.current.startNewPathAndClipBox(this.current.clipBox);\n  }\n\n  getSinglePixelWidth() {\n    if (!this._cachedGetSinglePixelWidth) {\n      const m = getCurrentTransform(this.ctx);\n      if (m[1] === 0 && m[2] === 0) {\n        // Fast path\n        this._cachedGetSinglePixelWidth =\n          1 / Math.min(Math.abs(m[0]), Math.abs(m[3]));\n      } else {\n        const absDet = Math.abs(m[0] * m[3] - m[2] * m[1]);\n        const normX = Math.hypot(m[0], m[2]);\n        const normY = Math.hypot(m[1], m[3]);\n        this._cachedGetSinglePixelWidth = Math.max(normX, normY) / absDet;\n      }\n    }\n    return this._cachedGetSinglePixelWidth;\n  }\n\n  getScaleForStroking() {\n    // A pixel has thicknessX = thicknessY = 1;\n    // A transformed pixel is a parallelogram and the thicknesses\n    // corresponds to the heights.\n    // The goal of this function is to rescale before setting the\n    // lineWidth in order to have both thicknesses greater or equal\n    // to 1 after transform.\n    if (this._cachedScaleForStroking[0] === -1) {\n      const { lineWidth } = this.current;\n      const { a, b, c, d } = this.ctx.getTransform();\n      let scaleX, scaleY;\n\n      if (b === 0 && c === 0) {\n        // Fast path\n        const normX = Math.abs(a);\n        const normY = Math.abs(d);\n        if (normX === normY) {\n          if (lineWidth === 0) {\n            scaleX = scaleY = 1 / normX;\n          } else {\n            const scaledLineWidth = normX * lineWidth;\n            scaleX = scaleY = scaledLineWidth < 1 ? 1 / scaledLineWidth : 1;\n          }\n        } else if (lineWidth === 0) {\n          scaleX = 1 / normX;\n          scaleY = 1 / normY;\n        } else {\n          const scaledXLineWidth = normX * lineWidth;\n          const scaledYLineWidth = normY * lineWidth;\n          scaleX = scaledXLineWidth < 1 ? 1 / scaledXLineWidth : 1;\n          scaleY = scaledYLineWidth < 1 ? 1 / scaledYLineWidth : 1;\n        }\n      } else {\n        // A pixel (base (x, y)) is transformed by M into a parallelogram:\n        //  - its area is |det(M)|;\n        //  - heightY (orthogonal to Mx) has a length: |det(M)| / norm(Mx);\n        //  - heightX (orthogonal to My) has a length: |det(M)| / norm(My).\n        // heightX and heightY are the thicknesses of the transformed pixel\n        // and they must be both greater or equal to 1.\n        const absDet = Math.abs(a * d - b * c);\n        const normX = Math.hypot(a, b);\n        const normY = Math.hypot(c, d);\n        if (lineWidth === 0) {\n          scaleX = normY / absDet;\n          scaleY = normX / absDet;\n        } else {\n          const baseArea = lineWidth * absDet;\n          scaleX = normY > baseArea ? normY / baseArea : 1;\n          scaleY = normX > baseArea ? normX / baseArea : 1;\n        }\n      }\n      this._cachedScaleForStroking[0] = scaleX;\n      this._cachedScaleForStroking[1] = scaleY;\n    }\n    return this._cachedScaleForStroking;\n  }\n\n  // Rescale before stroking in order to have a final lineWidth\n  // with both thicknesses greater or equal to 1.\n  rescaleAndStroke(path, saveRestore) {\n    const {\n      ctx,\n      current: { lineWidth },\n    } = this;\n    const [scaleX, scaleY] = this.getScaleForStroking();\n\n    if (scaleX === scaleY) {\n      ctx.lineWidth = (lineWidth || 1) * scaleX;\n      ctx.stroke(path);\n      return;\n    }\n\n    const dashes = ctx.getLineDash();\n    if (saveRestore) {\n      ctx.save();\n    }\n\n    ctx.scale(scaleX, scaleY);\n    SCALE_MATRIX.a = 1 / scaleX;\n    SCALE_MATRIX.d = 1 / scaleY;\n    const newPath = new Path2D();\n    newPath.addPath(path, SCALE_MATRIX);\n\n    // How the dashed line is rendered depends on the current transform...\n    // so we added a rescale to handle too thin lines and consequently\n    // the way the line is dashed will be modified.\n    // If scaleX === scaleY, the dashed lines will be rendered correctly\n    // else we'll have some bugs (but only with too thin lines).\n    // Here we take the max... why not taking the min... or something else.\n    // Anyway, as said it's buggy when scaleX !== scaleY.\n    if (dashes.length > 0) {\n      const scale = Math.max(scaleX, scaleY);\n      ctx.setLineDash(dashes.map(x => x / scale));\n      ctx.lineDashOffset /= scale;\n    }\n\n    ctx.lineWidth = lineWidth || 1;\n    ctx.stroke(newPath);\n\n    if (saveRestore) {\n      ctx.restore();\n    }\n  }\n\n  isContentVisible() {\n    for (let i = this.markedContentStack.length - 1; i >= 0; i--) {\n      if (!this.markedContentStack[i].visible) {\n        return false;\n      }\n    }\n    return true;\n  }\n}\n\nfor (const op in OPS) {\n  if (CanvasGraphics.prototype[op] !== undefined) {\n    CanvasGraphics.prototype[OPS[op]] = CanvasGraphics.prototype[op];\n  }\n}\n\nexport { CanvasGraphics };\n","/* Copyright 2018 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nclass GlobalWorkerOptions {\n  static #port = null;\n\n  static #src = \"\";\n\n  /**\n   * @type {Worker | null}\n   */\n  static get workerPort() {\n    return this.#port;\n  }\n\n  /**\n   * @param {Worker | null} workerPort - Defines global port for worker process.\n   *   Overrides the `workerSrc` option.\n   */\n  static set workerPort(val) {\n    if (\n      !(typeof Worker !== \"undefined\" && val instanceof Worker) &&\n      val !== null\n    ) {\n      throw new Error(\"Invalid `workerPort` type.\");\n    }\n    this.#port = val;\n  }\n\n  /**\n   * @type {string}\n   */\n  static get workerSrc() {\n    return this.#src;\n  }\n\n  /**\n   * @param {string} workerSrc - A string containing the path and filename of\n   *   the worker file.\n   *\n   *   NOTE: The `workerSrc` option should always be set, in order to prevent\n   *         any issues when using the PDF.js library.\n   */\n  static set workerSrc(val) {\n    if (typeof val !== \"string\") {\n      throw new Error(\"Invalid `workerSrc` type.\");\n    }\n    this.#src = val;\n  }\n}\n\nexport { GlobalWorkerOptions };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nclass Metadata {\n  #map;\n\n  #data;\n\n  constructor({ parsedData, rawData }) {\n    this.#map = parsedData;\n    this.#data = rawData;\n  }\n\n  getRaw() {\n    return this.#data;\n  }\n\n  get(name) {\n    return this.#map.get(name) ?? null;\n  }\n\n  [Symbol.iterator]() {\n    return this.#map.entries();\n  }\n}\n\nexport { Metadata };\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  info,\n  RenderingIntentFlag,\n  unreachable,\n  warn,\n} from \"../shared/util.js\";\nimport { MurmurHash3_64 } from \"../shared/murmurhash3.js\";\n\nconst INTERNAL = Symbol(\"INTERNAL\");\n\nclass OptionalContentGroup {\n  #isDisplay = false;\n\n  #isPrint = false;\n\n  #userSet = false;\n\n  #visible = true;\n\n  constructor(renderingIntent, { name, intent, usage, rbGroups }) {\n    this.#isDisplay = !!(renderingIntent & RenderingIntentFlag.DISPLAY);\n    this.#isPrint = !!(renderingIntent & RenderingIntentFlag.PRINT);\n\n    this.name = name;\n    this.intent = intent;\n    this.usage = usage;\n    this.rbGroups = rbGroups;\n  }\n\n  /**\n   * @type {boolean}\n   */\n  get visible() {\n    if (this.#userSet) {\n      return this.#visible;\n    }\n    if (!this.#visible) {\n      return false;\n    }\n    const { print, view } = this.usage;\n\n    if (this.#isDisplay) {\n      return view?.viewState !== \"OFF\";\n    } else if (this.#isPrint) {\n      return print?.printState !== \"OFF\";\n    }\n    return true;\n  }\n\n  /**\n   * @ignore\n   */\n  _setVisible(internal, visible, userSet = false) {\n    if (internal !== INTERNAL) {\n      unreachable(\"Internal method `_setVisible` called.\");\n    }\n    this.#userSet = userSet;\n    this.#visible = visible;\n  }\n}\n\nclass OptionalContentConfig {\n  #cachedGetHash = null;\n\n  #groups = new Map();\n\n  #initialHash = null;\n\n  #order = null;\n\n  constructor(data, renderingIntent = RenderingIntentFlag.DISPLAY) {\n    this.renderingIntent = renderingIntent;\n\n    this.name = null;\n    this.creator = null;\n\n    if (data === null) {\n      return;\n    }\n    this.name = data.name;\n    this.creator = data.creator;\n    this.#order = data.order;\n    for (const group of data.groups) {\n      this.#groups.set(\n        group.id,\n        new OptionalContentGroup(renderingIntent, group)\n      );\n    }\n\n    if (data.baseState === \"OFF\") {\n      for (const group of this.#groups.values()) {\n        group._setVisible(INTERNAL, false);\n      }\n    }\n\n    for (const on of data.on) {\n      this.#groups.get(on)._setVisible(INTERNAL, true);\n    }\n\n    for (const off of data.off) {\n      this.#groups.get(off)._setVisible(INTERNAL, false);\n    }\n\n    // The following code must always run *last* in the constructor.\n    this.#initialHash = this.getHash();\n  }\n\n  #evaluateVisibilityExpression(array) {\n    const length = array.length;\n    if (length < 2) {\n      return true;\n    }\n    const operator = array[0];\n    for (let i = 1; i < length; i++) {\n      const element = array[i];\n      let state;\n      if (Array.isArray(element)) {\n        state = this.#evaluateVisibilityExpression(element);\n      } else if (this.#groups.has(element)) {\n        state = this.#groups.get(element).visible;\n      } else {\n        warn(`Optional content group not found: ${element}`);\n        return true;\n      }\n      switch (operator) {\n        case \"And\":\n          if (!state) {\n            return false;\n          }\n          break;\n        case \"Or\":\n          if (state) {\n            return true;\n          }\n          break;\n        case \"Not\":\n          return !state;\n        default:\n          return true;\n      }\n    }\n    return operator === \"And\";\n  }\n\n  isVisible(group) {\n    if (this.#groups.size === 0) {\n      return true;\n    }\n    if (!group) {\n      info(\"Optional content group not defined.\");\n      return true;\n    }\n    if (group.type === \"OCG\") {\n      if (!this.#groups.has(group.id)) {\n        warn(`Optional content group not found: ${group.id}`);\n        return true;\n      }\n      return this.#groups.get(group.id).visible;\n    } else if (group.type === \"OCMD\") {\n      // Per the spec, the expression should be preferred if available.\n      if (group.expression) {\n        return this.#evaluateVisibilityExpression(group.expression);\n      }\n      if (!group.policy || group.policy === \"AnyOn\") {\n        // Default\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (this.#groups.get(id).visible) {\n            return true;\n          }\n        }\n        return false;\n      } else if (group.policy === \"AllOn\") {\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (!this.#groups.get(id).visible) {\n            return false;\n          }\n        }\n        return true;\n      } else if (group.policy === \"AnyOff\") {\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (!this.#groups.get(id).visible) {\n            return true;\n          }\n        }\n        return false;\n      } else if (group.policy === \"AllOff\") {\n        for (const id of group.ids) {\n          if (!this.#groups.has(id)) {\n            warn(`Optional content group not found: ${id}`);\n            return true;\n          }\n          if (this.#groups.get(id).visible) {\n            return false;\n          }\n        }\n        return true;\n      }\n      warn(`Unknown optional content policy ${group.policy}.`);\n      return true;\n    }\n    warn(`Unknown group type ${group.type}.`);\n    return true;\n  }\n\n  setVisibility(id, visible = true, preserveRB = true) {\n    const group = this.#groups.get(id);\n    if (!group) {\n      warn(`Optional content group not found: ${id}`);\n      return;\n    }\n\n    // If the visibility is about to be set to `true` and the group belongs to\n    // any radiobutton groups, hide all other OCGs in these radiobutton groups,\n    // provided that radiobutton state relationships are to be preserved.\n    if (preserveRB && visible && group.rbGroups.length) {\n      for (const rbGroup of group.rbGroups) {\n        for (const otherId of rbGroup) {\n          if (otherId !== id) {\n            this.#groups.get(otherId)?._setVisible(INTERNAL, false, true);\n          }\n        }\n      }\n    }\n\n    group._setVisible(INTERNAL, !!visible, /* userSet = */ true);\n\n    this.#cachedGetHash = null;\n  }\n\n  setOCGState({ state, preserveRB }) {\n    let operator;\n\n    for (const elem of state) {\n      switch (elem) {\n        case \"ON\":\n        case \"OFF\":\n        case \"Toggle\":\n          operator = elem;\n          continue;\n      }\n\n      const group = this.#groups.get(elem);\n      if (!group) {\n        continue;\n      }\n      switch (operator) {\n        case \"ON\":\n          this.setVisibility(elem, true, preserveRB);\n          break;\n        case \"OFF\":\n          this.setVisibility(elem, false, preserveRB);\n          break;\n        case \"Toggle\":\n          this.setVisibility(elem, !group.visible, preserveRB);\n          break;\n      }\n    }\n\n    this.#cachedGetHash = null;\n  }\n\n  get hasInitialVisibility() {\n    return this.#initialHash === null || this.getHash() === this.#initialHash;\n  }\n\n  getOrder() {\n    if (!this.#groups.size) {\n      return null;\n    }\n    if (this.#order) {\n      return this.#order.slice();\n    }\n    return [...this.#groups.keys()];\n  }\n\n  getGroup(id) {\n    return this.#groups.get(id) || null;\n  }\n\n  getHash() {\n    if (this.#cachedGetHash !== null) {\n      return this.#cachedGetHash;\n    }\n    const hash = new MurmurHash3_64();\n\n    for (const [id, group] of this.#groups) {\n      hash.update(`${id}:${group.visible}`);\n    }\n    return (this.#cachedGetHash = hash.hexdigest());\n  }\n\n  [Symbol.iterator]() {\n    return this.#groups.entries();\n  }\n}\n\nexport { OptionalContentConfig };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"../interfaces\").IPDFStream} IPDFStream */\n/** @typedef {import(\"../interfaces\").IPDFStreamReader} IPDFStreamReader */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../interfaces\").IPDFStreamRangeReader} IPDFStreamRangeReader */\n\nimport { assert } from \"../shared/util.js\";\nimport { isPdfFile } from \"./display_utils.js\";\n\n/** @implements {IPDFStream} */\nclass PDFDataTransportStream {\n  constructor(\n    pdfDataRangeTransport,\n    { disableRange = false, disableStream = false }\n  ) {\n    assert(\n      pdfDataRangeTransport,\n      'PDFDataTransportStream - missing required \"pdfDataRangeTransport\" argument.'\n    );\n    const { length, initialData, progressiveDone, contentDispositionFilename } =\n      pdfDataRangeTransport;\n\n    this._queuedChunks = [];\n    this._progressiveDone = progressiveDone;\n    this._contentDispositionFilename = contentDispositionFilename;\n\n    if (initialData?.length > 0) {\n      // Prevent any possible issues by only transferring a Uint8Array that\n      // completely \"utilizes\" its underlying ArrayBuffer.\n      const buffer =\n        initialData instanceof Uint8Array &&\n        initialData.byteLength === initialData.buffer.byteLength\n          ? initialData.buffer\n          : new Uint8Array(initialData).buffer;\n      this._queuedChunks.push(buffer);\n    }\n\n    this._pdfDataRangeTransport = pdfDataRangeTransport;\n    this._isStreamingSupported = !disableStream;\n    this._isRangeSupported = !disableRange;\n    this._contentLength = length;\n\n    this._fullRequestReader = null;\n    this._rangeReaders = [];\n\n    pdfDataRangeTransport.addRangeListener((begin, chunk) => {\n      this._onReceiveData({ begin, chunk });\n    });\n\n    pdfDataRangeTransport.addProgressListener((loaded, total) => {\n      this._onProgress({ loaded, total });\n    });\n\n    pdfDataRangeTransport.addProgressiveReadListener(chunk => {\n      this._onReceiveData({ chunk });\n    });\n\n    pdfDataRangeTransport.addProgressiveDoneListener(() => {\n      this._onProgressiveDone();\n    });\n\n    pdfDataRangeTransport.transportReady();\n  }\n\n  _onReceiveData({ begin, chunk }) {\n    // Prevent any possible issues by only transferring a Uint8Array that\n    // completely \"utilizes\" its underlying ArrayBuffer.\n    const buffer =\n      chunk instanceof Uint8Array &&\n      chunk.byteLength === chunk.buffer.byteLength\n        ? chunk.buffer\n        : new Uint8Array(chunk).buffer;\n\n    if (begin === undefined) {\n      if (this._fullRequestReader) {\n        this._fullRequestReader._enqueue(buffer);\n      } else {\n        this._queuedChunks.push(buffer);\n      }\n    } else {\n      const found = this._rangeReaders.some(function (rangeReader) {\n        if (rangeReader._begin !== begin) {\n          return false;\n        }\n        rangeReader._enqueue(buffer);\n        return true;\n      });\n      assert(\n        found,\n        \"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.\"\n      );\n    }\n  }\n\n  get _progressiveDataLength() {\n    return this._fullRequestReader?._loaded ?? 0;\n  }\n\n  _onProgress(evt) {\n    if (evt.total === undefined) {\n      // Reporting to first range reader, if it exists.\n      this._rangeReaders[0]?.onProgress?.({ loaded: evt.loaded });\n    } else {\n      this._fullRequestReader?.onProgress?.({\n        loaded: evt.loaded,\n        total: evt.total,\n      });\n    }\n  }\n\n  _onProgressiveDone() {\n    this._fullRequestReader?.progressiveDone();\n    this._progressiveDone = true;\n  }\n\n  _removeRangeReader(reader) {\n    const i = this._rangeReaders.indexOf(reader);\n    if (i >= 0) {\n      this._rangeReaders.splice(i, 1);\n    }\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFDataTransportStream.getFullReader can only be called once.\"\n    );\n    const queuedChunks = this._queuedChunks;\n    this._queuedChunks = null;\n    return new PDFDataTransportStreamReader(\n      this,\n      queuedChunks,\n      this._progressiveDone,\n      this._contentDispositionFilename\n    );\n  }\n\n  getRangeReader(begin, end) {\n    if (end <= this._progressiveDataLength) {\n      return null;\n    }\n    const reader = new PDFDataTransportStreamRangeReader(this, begin, end);\n    this._pdfDataRangeTransport.requestDataRange(begin, end);\n    this._rangeReaders.push(reader);\n    return reader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n    this._pdfDataRangeTransport.abort();\n  }\n}\n\n/** @implements {IPDFStreamReader} */\nclass PDFDataTransportStreamReader {\n  constructor(\n    stream,\n    queuedChunks,\n    progressiveDone = false,\n    contentDispositionFilename = null\n  ) {\n    this._stream = stream;\n    this._done = progressiveDone || false;\n    this._filename = isPdfFile(contentDispositionFilename)\n      ? contentDispositionFilename\n      : null;\n    this._queuedChunks = queuedChunks || [];\n    this._loaded = 0;\n    for (const chunk of this._queuedChunks) {\n      this._loaded += chunk.byteLength;\n    }\n    this._requests = [];\n    this._headersReady = Promise.resolve();\n    stream._fullRequestReader = this;\n\n    this.onProgress = null;\n  }\n\n  _enqueue(chunk) {\n    if (this._done) {\n      return; // Ignore new data.\n    }\n    if (this._requests.length > 0) {\n      const requestCapability = this._requests.shift();\n      requestCapability.resolve({ value: chunk, done: false });\n    } else {\n      this._queuedChunks.push(chunk);\n    }\n    this._loaded += chunk.byteLength;\n  }\n\n  get headersReady() {\n    return this._headersReady;\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get isRangeSupported() {\n    return this._stream._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._stream._isStreamingSupported;\n  }\n\n  get contentLength() {\n    return this._stream._contentLength;\n  }\n\n  async read() {\n    if (this._queuedChunks.length > 0) {\n      const chunk = this._queuedChunks.shift();\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = Promise.withResolvers();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n  }\n\n  progressiveDone() {\n    if (this._done) {\n      return;\n    }\n    this._done = true;\n  }\n}\n\n/** @implements {IPDFStreamRangeReader} */\nclass PDFDataTransportStreamRangeReader {\n  constructor(stream, begin, end) {\n    this._stream = stream;\n    this._begin = begin;\n    this._end = end;\n    this._queuedChunk = null;\n    this._requests = [];\n    this._done = false;\n\n    this.onProgress = null;\n  }\n\n  _enqueue(chunk) {\n    if (this._done) {\n      return; // ignore new data\n    }\n    if (this._requests.length === 0) {\n      this._queuedChunk = chunk;\n    } else {\n      const requestsCapability = this._requests.shift();\n      requestsCapability.resolve({ value: chunk, done: false });\n      for (const requestCapability of this._requests) {\n        requestCapability.resolve({ value: undefined, done: true });\n      }\n      this._requests.length = 0;\n    }\n    this._done = true;\n    this._stream._removeRangeReader(this);\n  }\n\n  get isStreamingSupported() {\n    return false;\n  }\n\n  async read() {\n    if (this._queuedChunk) {\n      const chunk = this._queuedChunk;\n      this._queuedChunk = null;\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = Promise.withResolvers();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    this._stream._removeRangeReader(this);\n  }\n}\n\nexport { PDFDataTransportStream };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert, ResponseException } from \"../shared/util.js\";\nimport { getFilenameFromContentDispositionHeader } from \"./content_disposition.js\";\nimport { isPdfFile } from \"./display_utils.js\";\n\nfunction createHeaders(isHttp, httpHeaders) {\n  const headers = new Headers();\n\n  if (!isHttp || !httpHeaders || typeof httpHeaders !== \"object\") {\n    return headers;\n  }\n  for (const key in httpHeaders) {\n    const val = httpHeaders[key];\n    if (val !== undefined) {\n      headers.append(key, val);\n    }\n  }\n  return headers;\n}\n\nfunction getResponseOrigin(url) {\n  // Notably, null is distinct from \"null\" string (e.g. from file:-URLs).\n  return URL.parse(url)?.origin ?? null;\n}\n\nfunction validateRangeRequestCapabilities({\n  responseHeaders,\n  isHttp,\n  rangeChunkSize,\n  disableRange,\n}) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n    assert(\n      Number.isInteger(rangeChunkSize) && rangeChunkSize > 0,\n      \"rangeChunkSize must be an integer larger than zero.\"\n    );\n  }\n  const returnValues = {\n    allowRangeRequests: false,\n    suggestedLength: undefined,\n  };\n\n  const length = parseInt(responseHeaders.get(\"Content-Length\"), 10);\n  if (!Number.isInteger(length)) {\n    return returnValues;\n  }\n\n  returnValues.suggestedLength = length;\n\n  if (length <= 2 * rangeChunkSize) {\n    // The file size is smaller than the size of two chunks, so it does not\n    // make any sense to abort the request and retry with a range request.\n    return returnValues;\n  }\n\n  if (disableRange || !isHttp) {\n    return returnValues;\n  }\n  if (responseHeaders.get(\"Accept-Ranges\") !== \"bytes\") {\n    return returnValues;\n  }\n\n  const contentEncoding = responseHeaders.get(\"Content-Encoding\") || \"identity\";\n  if (contentEncoding !== \"identity\") {\n    return returnValues;\n  }\n\n  returnValues.allowRangeRequests = true;\n  return returnValues;\n}\n\nfunction extractFilenameFromHeader(responseHeaders) {\n  const contentDisposition = responseHeaders.get(\"Content-Disposition\");\n  if (contentDisposition) {\n    let filename = getFilenameFromContentDispositionHeader(contentDisposition);\n    if (filename.includes(\"%\")) {\n      try {\n        filename = decodeURIComponent(filename);\n      } catch {}\n    }\n    if (isPdfFile(filename)) {\n      return filename;\n    }\n  }\n  return null;\n}\n\nfunction createResponseError(status, url) {\n  return new ResponseException(\n    `Unexpected server response (${status}) while retrieving PDF \"${url}\".`,\n    status,\n    /* missing = */ status === 404 || (status === 0 && url.startsWith(\"file:\"))\n  );\n}\n\nfunction validateResponseStatus(status) {\n  return status === 200 || status === 206;\n}\n\nexport {\n  createHeaders,\n  createResponseError,\n  extractFilenameFromHeader,\n  getResponseOrigin,\n  validateRangeRequestCapabilities,\n  validateResponseStatus,\n};\n","/* Copyright 2017 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { stringToBytes } from \"../shared/util.js\";\n\n// This getFilenameFromContentDispositionHeader function is adapted from\n// https://github.com/Rob--W/open-in-browser/blob/7e2e35a38b8b4e981b11da7b2f01df0149049e92/extension/content-disposition.js\n// with the following changes:\n// - Modified to conform to PDF.js's coding style.\n// - Move return to the end of the function to prevent Babel from dropping the\n//   function declarations.\n\n/**\n * Extract file name from the Content-Disposition HTTP response header.\n *\n * @param {string} contentDisposition\n * @returns {string} Filename, if found in the Content-Disposition header.\n */\nfunction getFilenameFromContentDispositionHeader(contentDisposition) {\n  let needsEncodingFixup = true;\n\n  // filename*=ext-value (\"ext-value\" from RFC 5987, referenced by RFC 6266).\n  let tmp = toParamRegExp(\"filename\\\\*\", \"i\").exec(contentDisposition);\n  if (tmp) {\n    tmp = tmp[1];\n    let filename = rfc2616unquote(tmp);\n    filename = unescape(filename);\n    filename = rfc5987decode(filename);\n    filename = rfc2047decode(filename);\n    return fixupEncoding(filename);\n  }\n\n  // Continuations (RFC 2231 section 3, referenced by RFC 5987 section 3.1).\n  // filename*n*=part\n  // filename*n=part\n  tmp = rfc2231getparam(contentDisposition);\n  if (tmp) {\n    // RFC 2047, section\n    const filename = rfc2047decode(tmp);\n    return fixupEncoding(filename);\n  }\n\n  // filename=value (RFC 5987, section 4.1).\n  tmp = toParamRegExp(\"filename\", \"i\").exec(contentDisposition);\n  if (tmp) {\n    tmp = tmp[1];\n    let filename = rfc2616unquote(tmp);\n    filename = rfc2047decode(filename);\n    return fixupEncoding(filename);\n  }\n\n  // After this line there are only function declarations. We cannot put\n  // \"return\" here for readability because babel would then drop the function\n  // declarations...\n  function toParamRegExp(attributePattern, flags) {\n    return new RegExp(\n      \"(?:^|;)\\\\s*\" +\n        attributePattern +\n        \"\\\\s*=\\\\s*\" +\n        // Captures: value = token | quoted-string\n        // (RFC 2616, section 3.6 and referenced by RFC 6266 4.1)\n        \"(\" +\n        '[^\";\\\\s][^;\\\\s]*' +\n        \"|\" +\n        '\"(?:[^\"\\\\\\\\]|\\\\\\\\\"?)+\"?' +\n        \")\",\n      flags\n    );\n  }\n  function textdecode(encoding, value) {\n    if (encoding) {\n      if (!/^[\\x00-\\xFF]+$/.test(value)) {\n        return value;\n      }\n      try {\n        const decoder = new TextDecoder(encoding, { fatal: true });\n        const buffer = stringToBytes(value);\n        value = decoder.decode(buffer);\n        needsEncodingFixup = false;\n      } catch {\n        // TextDecoder constructor threw - unrecognized encoding.\n      }\n    }\n    return value;\n  }\n  function fixupEncoding(value) {\n    if (needsEncodingFixup && /[\\x80-\\xff]/.test(value)) {\n      // Maybe multi-byte UTF-8.\n      value = textdecode(\"utf-8\", value);\n      if (needsEncodingFixup) {\n        // Try iso-8859-1 encoding.\n        value = textdecode(\"iso-8859-1\", value);\n      }\n    }\n    return value;\n  }\n  function rfc2231getparam(contentDispositionStr) {\n    const matches = [];\n    let match;\n    // Iterate over all filename*n= and filename*n*= with n being an integer\n    // of at least zero. Any non-zero number must not start with '0'.\n    const iter = toParamRegExp(\"filename\\\\*((?!0\\\\d)\\\\d+)(\\\\*?)\", \"ig\");\n    while ((match = iter.exec(contentDispositionStr)) !== null) {\n      let [, n, quot, part] = match; // eslint-disable-line prefer-const\n      n = parseInt(n, 10);\n      if (n in matches) {\n        // Ignore anything after the invalid second filename*0.\n        if (n === 0) {\n          break;\n        }\n        continue;\n      }\n      matches[n] = [quot, part];\n    }\n    const parts = [];\n    for (let n = 0; n < matches.length; ++n) {\n      if (!(n in matches)) {\n        // Numbers must be consecutive. Truncate when there is a hole.\n        break;\n      }\n      let [quot, part] = matches[n]; // eslint-disable-line prefer-const\n      part = rfc2616unquote(part);\n      if (quot) {\n        part = unescape(part);\n        if (n === 0) {\n          part = rfc5987decode(part);\n        }\n      }\n      parts.push(part);\n    }\n    return parts.join(\"\");\n  }\n  function rfc2616unquote(value) {\n    if (value.startsWith('\"')) {\n      const parts = value.slice(1).split('\\\\\"');\n      // Find the first unescaped \" and terminate there.\n      for (let i = 0; i < parts.length; ++i) {\n        const quotindex = parts[i].indexOf('\"');\n        if (quotindex !== -1) {\n          parts[i] = parts[i].slice(0, quotindex);\n          parts.length = i + 1; // Truncates and stop the iteration.\n        }\n        parts[i] = parts[i].replaceAll(/\\\\(.)/g, \"$1\");\n      }\n      value = parts.join('\"');\n    }\n    return value;\n  }\n  function rfc5987decode(extvalue) {\n    // Decodes \"ext-value\" from RFC 5987.\n    const encodingend = extvalue.indexOf(\"'\");\n    if (encodingend === -1) {\n      // Some servers send \"filename*=\" without encoding 'language' prefix,\n      // e.g. in https://github.com/Rob--W/open-in-browser/issues/26\n      // Let's accept the value like Firefox (57) (Chrome 62 rejects it).\n      return extvalue;\n    }\n    const encoding = extvalue.slice(0, encodingend);\n    const langvalue = extvalue.slice(encodingend + 1);\n    // Ignore language (RFC 5987 section 3.2.1, and RFC 6266 section 4.1 ).\n    const value = langvalue.replace(/^[^']*'/, \"\");\n    return textdecode(encoding, value);\n  }\n  function rfc2047decode(value) {\n    // RFC 2047-decode the result. Firefox tried to drop support for it, but\n    // backed out because some servers use it - https://bugzil.la/875615\n    // Firefox's condition for decoding is here: https://searchfox.org/mozilla-central/rev/4a590a5a15e35d88a3b23dd6ac3c471cf85b04a8/netwerk/mime/nsMIMEHeaderParamImpl.cpp#742-748\n\n    // We are more strict and only recognize RFC 2047-encoding if the value\n    // starts with \"=?\", since then it is likely that the full value is\n    // RFC 2047-encoded.\n\n    // Firefox also decodes words even where RFC 2047 section 5 states:\n    // \"An 'encoded-word' MUST NOT appear within a 'quoted-string'.\"\n    if (!value.startsWith(\"=?\") || /[\\x00-\\x19\\x80-\\xff]/.test(value)) {\n      return value;\n    }\n    // RFC 2047, section 2.4\n    // encoded-word = \"=?\" charset \"?\" encoding \"?\" encoded-text \"?=\"\n    // charset = token (but let's restrict to characters that denote a\n    //       possibly valid encoding).\n    // encoding = q or b\n    // encoded-text = any printable ASCII character other than ? or space.\n    //        ... but Firefox permits ? and space.\n    return value.replaceAll(\n      /=\\?([\\w-]*)\\?([QqBb])\\?((?:[^?]|\\?(?!=))*)\\?=/g,\n      function (matches, charset, encoding, text) {\n        if (encoding === \"q\" || encoding === \"Q\") {\n          // RFC 2047 section 4.2.\n          text = text.replaceAll(\"_\", \" \");\n          text = text.replaceAll(/=([0-9a-fA-F]{2})/g, function (match, hex) {\n            return String.fromCharCode(parseInt(hex, 16));\n          });\n          return textdecode(charset, text);\n        } // else encoding is b or B - base64 (RFC 2047 section 4.1)\n        try {\n          text = atob(text);\n        } catch {}\n        return textdecode(charset, text);\n      }\n    );\n  }\n\n  return \"\";\n}\n\nexport { getFilenameFromContentDispositionHeader };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AbortException, assert, warn } from \"../shared/util.js\";\nimport {\n  createHeaders,\n  createResponseError,\n  extractFilenameFromHeader,\n  getResponseOrigin,\n  validateRangeRequestCapabilities,\n  validateResponseStatus,\n} from \"./network_utils.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./fetch_stream.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nfunction createFetchOptions(headers, withCredentials, abortController) {\n  return {\n    method: \"GET\",\n    headers,\n    signal: abortController.signal,\n    mode: \"cors\",\n    credentials: withCredentials ? \"include\" : \"same-origin\",\n    redirect: \"follow\",\n  };\n}\n\nfunction getArrayBuffer(val) {\n  if (val instanceof Uint8Array) {\n    return val.buffer;\n  }\n  if (val instanceof ArrayBuffer) {\n    return val;\n  }\n  warn(`getArrayBuffer - unexpected data format: ${val}`);\n  return new Uint8Array(val).buffer;\n}\n\n/** @implements {IPDFStream} */\nclass PDFFetchStream {\n  _responseOrigin = null;\n\n  constructor(source) {\n    this.source = source;\n    this.isHttp = /^https?:/i.test(source.url);\n    this.headers = createHeaders(this.isHttp, source.httpHeaders);\n\n    this._fullRequestReader = null;\n    this._rangeRequestReaders = [];\n  }\n\n  get _progressiveDataLength() {\n    return this._fullRequestReader?._loaded ?? 0;\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFFetchStream.getFullReader can only be called once.\"\n    );\n    this._fullRequestReader = new PDFFetchStreamReader(this);\n    return this._fullRequestReader;\n  }\n\n  getRangeReader(begin, end) {\n    if (end <= this._progressiveDataLength) {\n      return null;\n    }\n    const reader = new PDFFetchStreamRangeReader(this, begin, end);\n    this._rangeRequestReaders.push(reader);\n    return reader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeRequestReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n  }\n}\n\n/** @implements {IPDFStreamReader} */\nclass PDFFetchStreamReader {\n  constructor(stream) {\n    this._stream = stream;\n    this._reader = null;\n    this._loaded = 0;\n    this._filename = null;\n    const source = stream.source;\n    this._withCredentials = source.withCredentials || false;\n    this._contentLength = source.length;\n    this._headersCapability = Promise.withResolvers();\n    this._disableRange = source.disableRange || false;\n    this._rangeChunkSize = source.rangeChunkSize;\n    if (!this._rangeChunkSize && !this._disableRange) {\n      this._disableRange = true;\n    }\n\n    this._abortController = new AbortController();\n    this._isStreamingSupported = !source.disableStream;\n    this._isRangeSupported = !source.disableRange;\n    // Always create a copy of the headers.\n    const headers = new Headers(stream.headers);\n\n    const url = source.url;\n    fetch(\n      url,\n      createFetchOptions(headers, this._withCredentials, this._abortController)\n    )\n      .then(response => {\n        stream._responseOrigin = getResponseOrigin(response.url);\n\n        if (!validateResponseStatus(response.status)) {\n          throw createResponseError(response.status, url);\n        }\n        this._reader = response.body.getReader();\n        this._headersCapability.resolve();\n\n        const responseHeaders = response.headers;\n\n        const { allowRangeRequests, suggestedLength } =\n          validateRangeRequestCapabilities({\n            responseHeaders,\n            isHttp: stream.isHttp,\n            rangeChunkSize: this._rangeChunkSize,\n            disableRange: this._disableRange,\n          });\n\n        this._isRangeSupported = allowRangeRequests;\n        // Setting right content length.\n        this._contentLength = suggestedLength || this._contentLength;\n\n        this._filename = extractFilenameFromHeader(responseHeaders);\n\n        // We need to stop reading when range is supported and streaming is\n        // disabled.\n        if (!this._isStreamingSupported && this._isRangeSupported) {\n          this.cancel(new AbortException(\"Streaming is disabled.\"));\n        }\n      })\n      .catch(this._headersCapability.reject);\n\n    this.onProgress = null;\n  }\n\n  get headersReady() {\n    return this._headersCapability.promise;\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get contentLength() {\n    return this._contentLength;\n  }\n\n  get isRangeSupported() {\n    return this._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._headersCapability.promise;\n    const { value, done } = await this._reader.read();\n    if (done) {\n      return { value, done };\n    }\n    this._loaded += value.byteLength;\n    this.onProgress?.({\n      loaded: this._loaded,\n      total: this._contentLength,\n    });\n\n    return { value: getArrayBuffer(value), done: false };\n  }\n\n  cancel(reason) {\n    this._reader?.cancel(reason);\n    this._abortController.abort();\n  }\n}\n\n/** @implements {IPDFStreamRangeReader} */\nclass PDFFetchStreamRangeReader {\n  constructor(stream, begin, end) {\n    this._stream = stream;\n    this._reader = null;\n    this._loaded = 0;\n    const source = stream.source;\n    this._withCredentials = source.withCredentials || false;\n    this._readCapability = Promise.withResolvers();\n    this._isStreamingSupported = !source.disableStream;\n\n    this._abortController = new AbortController();\n    // Always create a copy of the headers.\n    const headers = new Headers(stream.headers);\n    headers.append(\"Range\", `bytes=${begin}-${end - 1}`);\n\n    const url = source.url;\n    fetch(\n      url,\n      createFetchOptions(headers, this._withCredentials, this._abortController)\n    )\n      .then(response => {\n        const responseOrigin = getResponseOrigin(response.url);\n\n        if (responseOrigin !== stream._responseOrigin) {\n          throw new Error(\n            `Expected range response-origin \"${responseOrigin}\" to match \"${stream._responseOrigin}\".`\n          );\n        }\n        if (!validateResponseStatus(response.status)) {\n          throw createResponseError(response.status, url);\n        }\n        this._readCapability.resolve();\n        this._reader = response.body.getReader();\n      })\n      .catch(this._readCapability.reject);\n\n    this.onProgress = null;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._readCapability.promise;\n    const { value, done } = await this._reader.read();\n    if (done) {\n      return { value, done };\n    }\n    this._loaded += value.byteLength;\n    this.onProgress?.({ loaded: this._loaded });\n\n    return { value: getArrayBuffer(value), done: false };\n  }\n\n  cancel(reason) {\n    this._reader?.cancel(reason);\n    this._abortController.abort();\n  }\n}\n\nexport { PDFFetchStream };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert, stringToBytes, warn } from \"../shared/util.js\";\nimport {\n  createHeaders,\n  createResponseError,\n  extractFilenameFromHeader,\n  getResponseOrigin,\n  validateRangeRequestCapabilities,\n} from \"./network_utils.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./network.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nconst OK_RESPONSE = 200;\nconst PARTIAL_CONTENT_RESPONSE = 206;\n\nfunction getArrayBuffer(xhr) {\n  const data = xhr.response;\n  if (typeof data !== \"string\") {\n    return data;\n  }\n  return stringToBytes(data).buffer;\n}\n\nclass NetworkManager {\n  _responseOrigin = null;\n\n  constructor({ url, httpHeaders, withCredentials }) {\n    this.url = url;\n    this.isHttp = /^https?:/i.test(url);\n    this.headers = createHeaders(this.isHttp, httpHeaders);\n    this.withCredentials = withCredentials || false;\n\n    this.currXhrId = 0;\n    this.pendingRequests = Object.create(null);\n  }\n\n  request(args) {\n    const xhr = new XMLHttpRequest();\n    const xhrId = this.currXhrId++;\n    const pendingRequest = (this.pendingRequests[xhrId] = { xhr });\n\n    xhr.open(\"GET\", this.url);\n    xhr.withCredentials = this.withCredentials;\n    for (const [key, val] of this.headers) {\n      xhr.setRequestHeader(key, val);\n    }\n    if (this.isHttp && \"begin\" in args && \"end\" in args) {\n      xhr.setRequestHeader(\"Range\", `bytes=${args.begin}-${args.end - 1}`);\n      pendingRequest.expectedStatus = PARTIAL_CONTENT_RESPONSE;\n    } else {\n      pendingRequest.expectedStatus = OK_RESPONSE;\n    }\n    xhr.responseType = \"arraybuffer\";\n\n    assert(args.onError, \"Expected `onError` callback to be provided.\");\n    xhr.onerror = () => {\n      args.onError(xhr.status);\n    };\n    xhr.onreadystatechange = this.onStateChange.bind(this, xhrId);\n    xhr.onprogress = this.onProgress.bind(this, xhrId);\n\n    pendingRequest.onHeadersReceived = args.onHeadersReceived;\n    pendingRequest.onDone = args.onDone;\n    pendingRequest.onError = args.onError;\n    pendingRequest.onProgress = args.onProgress;\n\n    xhr.send(null);\n\n    return xhrId;\n  }\n\n  onProgress(xhrId, evt) {\n    const pendingRequest = this.pendingRequests[xhrId];\n    if (!pendingRequest) {\n      return; // Maybe abortRequest was called...\n    }\n    pendingRequest.onProgress?.(evt);\n  }\n\n  onStateChange(xhrId, evt) {\n    const pendingRequest = this.pendingRequests[xhrId];\n    if (!pendingRequest) {\n      return; // Maybe abortRequest was called...\n    }\n\n    const xhr = pendingRequest.xhr;\n    if (xhr.readyState >= 2 && pendingRequest.onHeadersReceived) {\n      pendingRequest.onHeadersReceived();\n      delete pendingRequest.onHeadersReceived;\n    }\n\n    if (xhr.readyState !== 4) {\n      return;\n    }\n\n    if (!(xhrId in this.pendingRequests)) {\n      // The XHR request might have been aborted in onHeadersReceived()\n      // callback, in which case we should abort request.\n      return;\n    }\n\n    delete this.pendingRequests[xhrId];\n\n    // Success status == 0 can be on ftp, file and other protocols.\n    if (xhr.status === 0 && this.isHttp) {\n      pendingRequest.onError(xhr.status);\n      return;\n    }\n    const xhrStatus = xhr.status || OK_RESPONSE;\n\n    // From http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.35.2:\n    // \"A server MAY ignore the Range header\". This means it's possible to\n    // get a 200 rather than a 206 response from a range request.\n    const ok_response_on_range_request =\n      xhrStatus === OK_RESPONSE &&\n      pendingRequest.expectedStatus === PARTIAL_CONTENT_RESPONSE;\n\n    if (\n      !ok_response_on_range_request &&\n      xhrStatus !== pendingRequest.expectedStatus\n    ) {\n      pendingRequest.onError(xhr.status);\n      return;\n    }\n\n    const chunk = getArrayBuffer(xhr);\n    if (xhrStatus === PARTIAL_CONTENT_RESPONSE) {\n      const rangeHeader = xhr.getResponseHeader(\"Content-Range\");\n      const matches = /bytes (\\d+)-(\\d+)\\/(\\d+)/.exec(rangeHeader);\n      if (matches) {\n        pendingRequest.onDone({\n          begin: parseInt(matches[1], 10),\n          chunk,\n        });\n      } else {\n        warn(`Missing or invalid \"Content-Range\" header.`);\n        pendingRequest.onError(0);\n      }\n    } else if (chunk) {\n      pendingRequest.onDone({\n        begin: 0,\n        chunk,\n      });\n    } else {\n      pendingRequest.onError(xhr.status);\n    }\n  }\n\n  getRequestXhr(xhrId) {\n    return this.pendingRequests[xhrId].xhr;\n  }\n\n  isPendingRequest(xhrId) {\n    return xhrId in this.pendingRequests;\n  }\n\n  abortRequest(xhrId) {\n    const xhr = this.pendingRequests[xhrId].xhr;\n    delete this.pendingRequests[xhrId];\n    xhr.abort();\n  }\n}\n\n/** @implements {IPDFStream} */\nclass PDFNetworkStream {\n  constructor(source) {\n    this._source = source;\n    this._manager = new NetworkManager(source);\n    this._rangeChunkSize = source.rangeChunkSize;\n    this._fullRequestReader = null;\n    this._rangeRequestReaders = [];\n  }\n\n  _onRangeRequestReaderClosed(reader) {\n    const i = this._rangeRequestReaders.indexOf(reader);\n    if (i >= 0) {\n      this._rangeRequestReaders.splice(i, 1);\n    }\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFNetworkStream.getFullReader can only be called once.\"\n    );\n    this._fullRequestReader = new PDFNetworkStreamFullRequestReader(\n      this._manager,\n      this._source\n    );\n    return this._fullRequestReader;\n  }\n\n  getRangeReader(begin, end) {\n    const reader = new PDFNetworkStreamRangeRequestReader(\n      this._manager,\n      begin,\n      end\n    );\n    reader.onClosed = this._onRangeRequestReaderClosed.bind(this);\n    this._rangeRequestReaders.push(reader);\n    return reader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeRequestReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n  }\n}\n\n/** @implements {IPDFStreamReader} */\nclass PDFNetworkStreamFullRequestReader {\n  constructor(manager, source) {\n    this._manager = manager;\n\n    this._url = source.url;\n    this._fullRequestId = manager.request({\n      onHeadersReceived: this._onHeadersReceived.bind(this),\n      onDone: this._onDone.bind(this),\n      onError: this._onError.bind(this),\n      onProgress: this._onProgress.bind(this),\n    });\n    this._headersCapability = Promise.withResolvers();\n    this._disableRange = source.disableRange || false;\n    this._contentLength = source.length; // Optional\n    this._rangeChunkSize = source.rangeChunkSize;\n    if (!this._rangeChunkSize && !this._disableRange) {\n      this._disableRange = true;\n    }\n\n    this._isStreamingSupported = false;\n    this._isRangeSupported = false;\n\n    this._cachedChunks = [];\n    this._requests = [];\n    this._done = false;\n    this._storedError = undefined;\n    this._filename = null;\n\n    this.onProgress = null;\n  }\n\n  _onHeadersReceived() {\n    const fullRequestXhrId = this._fullRequestId;\n    const fullRequestXhr = this._manager.getRequestXhr(fullRequestXhrId);\n\n    this._manager._responseOrigin = getResponseOrigin(\n      fullRequestXhr.responseURL\n    );\n\n    const rawResponseHeaders = fullRequestXhr.getAllResponseHeaders();\n    const responseHeaders = new Headers(\n      rawResponseHeaders\n        ? rawResponseHeaders\n            .trimStart()\n            .replace(/[^\\S ]+$/, \"\") // Not `trimEnd`, to keep regular spaces.\n            .split(/[\\r\\n]+/)\n            .map(x => {\n              const [key, ...val] = x.split(\": \");\n              return [key, val.join(\": \")];\n            })\n        : []\n    );\n\n    const { allowRangeRequests, suggestedLength } =\n      validateRangeRequestCapabilities({\n        responseHeaders,\n        isHttp: this._manager.isHttp,\n        rangeChunkSize: this._rangeChunkSize,\n        disableRange: this._disableRange,\n      });\n\n    if (allowRangeRequests) {\n      this._isRangeSupported = true;\n    }\n    // Setting right content length.\n    this._contentLength = suggestedLength || this._contentLength;\n\n    this._filename = extractFilenameFromHeader(responseHeaders);\n\n    if (this._isRangeSupported) {\n      // NOTE: by cancelling the full request, and then issuing range\n      // requests, there will be an issue for sites where you can only\n      // request the pdf once. However, if this is the case, then the\n      // server should not be returning that it can support range requests.\n      this._manager.abortRequest(fullRequestXhrId);\n    }\n\n    this._headersCapability.resolve();\n  }\n\n  _onDone(data) {\n    if (data) {\n      if (this._requests.length > 0) {\n        const requestCapability = this._requests.shift();\n        requestCapability.resolve({ value: data.chunk, done: false });\n      } else {\n        this._cachedChunks.push(data.chunk);\n      }\n    }\n    this._done = true;\n    if (this._cachedChunks.length > 0) {\n      return;\n    }\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n  }\n\n  _onError(status) {\n    this._storedError = createResponseError(status, this._url);\n    this._headersCapability.reject(this._storedError);\n    for (const requestCapability of this._requests) {\n      requestCapability.reject(this._storedError);\n    }\n    this._requests.length = 0;\n    this._cachedChunks.length = 0;\n  }\n\n  _onProgress(evt) {\n    this.onProgress?.({\n      loaded: evt.loaded,\n      total: evt.lengthComputable ? evt.total : this._contentLength,\n    });\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get isRangeSupported() {\n    return this._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  get contentLength() {\n    return this._contentLength;\n  }\n\n  get headersReady() {\n    return this._headersCapability.promise;\n  }\n\n  async read() {\n    await this._headersCapability.promise;\n\n    if (this._storedError) {\n      throw this._storedError;\n    }\n    if (this._cachedChunks.length > 0) {\n      const chunk = this._cachedChunks.shift();\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = Promise.withResolvers();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    this._headersCapability.reject(reason);\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    if (this._manager.isPendingRequest(this._fullRequestId)) {\n      this._manager.abortRequest(this._fullRequestId);\n    }\n    this._fullRequestReader = null;\n  }\n}\n\n/** @implements {IPDFStreamRangeReader} */\nclass PDFNetworkStreamRangeRequestReader {\n  constructor(manager, begin, end) {\n    this._manager = manager;\n\n    this._url = manager.url;\n    this._requestId = manager.request({\n      begin,\n      end,\n      onHeadersReceived: this._onHeadersReceived.bind(this),\n      onDone: this._onDone.bind(this),\n      onError: this._onError.bind(this),\n      onProgress: this._onProgress.bind(this),\n    });\n    this._requests = [];\n    this._queuedChunk = null;\n    this._done = false;\n    this._storedError = undefined;\n\n    this.onProgress = null;\n    this.onClosed = null;\n  }\n\n  _onHeadersReceived() {\n    const responseOrigin = getResponseOrigin(\n      this._manager.getRequestXhr(this._requestId)?.responseURL\n    );\n\n    if (responseOrigin !== this._manager._responseOrigin) {\n      this._storedError = new Error(\n        `Expected range response-origin \"${responseOrigin}\" to match \"${this._manager._responseOrigin}\".`\n      );\n      this._onError(0);\n    }\n  }\n\n  _close() {\n    this.onClosed?.(this);\n  }\n\n  _onDone(data) {\n    const chunk = data.chunk;\n    if (this._requests.length > 0) {\n      const requestCapability = this._requests.shift();\n      requestCapability.resolve({ value: chunk, done: false });\n    } else {\n      this._queuedChunk = chunk;\n    }\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    this._close();\n  }\n\n  _onError(status) {\n    this._storedError ??= createResponseError(status, this._url);\n    for (const requestCapability of this._requests) {\n      requestCapability.reject(this._storedError);\n    }\n    this._requests.length = 0;\n    this._queuedChunk = null;\n  }\n\n  _onProgress(evt) {\n    if (!this.isStreamingSupported) {\n      this.onProgress?.({ loaded: evt.loaded });\n    }\n  }\n\n  get isStreamingSupported() {\n    return false;\n  }\n\n  async read() {\n    if (this._storedError) {\n      throw this._storedError;\n    }\n    if (this._queuedChunk !== null) {\n      const chunk = this._queuedChunk;\n      this._queuedChunk = null;\n      return { value: chunk, done: false };\n    }\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    const requestCapability = Promise.withResolvers();\n    this._requests.push(requestCapability);\n    return requestCapability.promise;\n  }\n\n  cancel(reason) {\n    this._done = true;\n    for (const requestCapability of this._requests) {\n      requestCapability.resolve({ value: undefined, done: true });\n    }\n    this._requests.length = 0;\n    if (this._manager.isPendingRequest(this._requestId)) {\n      this._manager.abortRequest(this._requestId);\n    }\n    this._close();\n  }\n}\n\nexport { PDFNetworkStream };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/* globals process */\n\nimport { AbortException, assert } from \"../shared/util.js\";\nimport { createResponseError } from \"./network_utils.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n  throw new Error(\n    'Module \"./node_stream.js\" shall not be used with MOZCENTRAL builds.'\n  );\n}\n\nconst urlRegex = /^[a-z][a-z0-9\\-+.]+:/i;\n\nfunction parseUrlOrPath(sourceUrl) {\n  if (urlRegex.test(sourceUrl)) {\n    return new URL(sourceUrl);\n  }\n  const url = process.getBuiltinModule(\"url\");\n  return new URL(url.pathToFileURL(sourceUrl));\n}\n\nclass PDFNodeStream {\n  constructor(source) {\n    this.source = source;\n    this.url = parseUrlOrPath(source.url);\n    assert(\n      this.url.protocol === \"file:\",\n      \"PDFNodeStream only supports file:// URLs.\"\n    );\n\n    this._fullRequestReader = null;\n    this._rangeRequestReaders = [];\n  }\n\n  get _progressiveDataLength() {\n    return this._fullRequestReader?._loaded ?? 0;\n  }\n\n  getFullReader() {\n    assert(\n      !this._fullRequestReader,\n      \"PDFNodeStream.getFullReader can only be called once.\"\n    );\n    this._fullRequestReader = new PDFNodeStreamFsFullReader(this);\n    return this._fullRequestReader;\n  }\n\n  getRangeReader(start, end) {\n    if (end <= this._progressiveDataLength) {\n      return null;\n    }\n    const rangeReader = new PDFNodeStreamFsRangeReader(this, start, end);\n    this._rangeRequestReaders.push(rangeReader);\n    return rangeReader;\n  }\n\n  cancelAllRequests(reason) {\n    this._fullRequestReader?.cancel(reason);\n\n    for (const reader of this._rangeRequestReaders.slice(0)) {\n      reader.cancel(reason);\n    }\n  }\n}\n\nclass PDFNodeStreamFsFullReader {\n  constructor(stream) {\n    this._url = stream.url;\n    this._done = false;\n    this._storedError = null;\n    this.onProgress = null;\n    const source = stream.source;\n    this._contentLength = source.length; // optional\n    this._loaded = 0;\n    this._filename = null;\n\n    this._disableRange = source.disableRange || false;\n    this._rangeChunkSize = source.rangeChunkSize;\n    if (!this._rangeChunkSize && !this._disableRange) {\n      this._disableRange = true;\n    }\n\n    this._isStreamingSupported = !source.disableStream;\n    this._isRangeSupported = !source.disableRange;\n\n    this._readableStream = null;\n    this._readCapability = Promise.withResolvers();\n    this._headersCapability = Promise.withResolvers();\n\n    const fs = process.getBuiltinModule(\"fs\");\n    fs.promises.lstat(this._url).then(\n      stat => {\n        // Setting right content length.\n        this._contentLength = stat.size;\n\n        this._setReadableStream(fs.createReadStream(this._url));\n        this._headersCapability.resolve();\n      },\n      error => {\n        if (error.code === \"ENOENT\") {\n          error = createResponseError(/* status = */ 0, this._url.href);\n        }\n        this._storedError = error;\n        this._headersCapability.reject(error);\n      }\n    );\n  }\n\n  get headersReady() {\n    return this._headersCapability.promise;\n  }\n\n  get filename() {\n    return this._filename;\n  }\n\n  get contentLength() {\n    return this._contentLength;\n  }\n\n  get isRangeSupported() {\n    return this._isRangeSupported;\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._readCapability.promise;\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    if (this._storedError) {\n      throw this._storedError;\n    }\n\n    const chunk = this._readableStream.read();\n    if (chunk === null) {\n      this._readCapability = Promise.withResolvers();\n      return this.read();\n    }\n    this._loaded += chunk.length;\n    this.onProgress?.({\n      loaded: this._loaded,\n      total: this._contentLength,\n    });\n\n    // Ensure that `read()` method returns ArrayBuffer.\n    const buffer = new Uint8Array(chunk).buffer;\n    return { value: buffer, done: false };\n  }\n\n  cancel(reason) {\n    // Call `this._error()` method when cancel is called\n    // before _readableStream is set.\n    if (!this._readableStream) {\n      this._error(reason);\n      return;\n    }\n    this._readableStream.destroy(reason);\n  }\n\n  _error(reason) {\n    this._storedError = reason;\n    this._readCapability.resolve();\n  }\n\n  _setReadableStream(readableStream) {\n    this._readableStream = readableStream;\n    readableStream.on(\"readable\", () => {\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"end\", () => {\n      // Destroy readable to minimize resource usage.\n      readableStream.destroy();\n      this._done = true;\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"error\", reason => {\n      this._error(reason);\n    });\n\n    // We need to stop reading when range is supported and streaming is\n    // disabled.\n    if (!this._isStreamingSupported && this._isRangeSupported) {\n      this._error(new AbortException(\"streaming is disabled\"));\n    }\n\n    // Destroy ReadableStream if already in errored state.\n    if (this._storedError) {\n      this._readableStream.destroy(this._storedError);\n    }\n  }\n}\n\nclass PDFNodeStreamFsRangeReader {\n  constructor(stream, start, end) {\n    this._url = stream.url;\n    this._done = false;\n    this._storedError = null;\n    this.onProgress = null;\n    this._loaded = 0;\n    this._readableStream = null;\n    this._readCapability = Promise.withResolvers();\n    const source = stream.source;\n    this._isStreamingSupported = !source.disableStream;\n\n    const fs = process.getBuiltinModule(\"fs\");\n    this._setReadableStream(\n      fs.createReadStream(this._url, { start, end: end - 1 })\n    );\n  }\n\n  get isStreamingSupported() {\n    return this._isStreamingSupported;\n  }\n\n  async read() {\n    await this._readCapability.promise;\n    if (this._done) {\n      return { value: undefined, done: true };\n    }\n    if (this._storedError) {\n      throw this._storedError;\n    }\n\n    const chunk = this._readableStream.read();\n    if (chunk === null) {\n      this._readCapability = Promise.withResolvers();\n      return this.read();\n    }\n    this._loaded += chunk.length;\n    this.onProgress?.({ loaded: this._loaded });\n\n    // Ensure that `read()` method returns ArrayBuffer.\n    const buffer = new Uint8Array(chunk).buffer;\n    return { value: buffer, done: false };\n  }\n\n  cancel(reason) {\n    // Call `this._error()` method when cancel is called\n    // before _readableStream is set.\n    if (!this._readableStream) {\n      this._error(reason);\n      return;\n    }\n    this._readableStream.destroy(reason);\n  }\n\n  _error(reason) {\n    this._storedError = reason;\n    this._readCapability.resolve();\n  }\n\n  _setReadableStream(readableStream) {\n    this._readableStream = readableStream;\n    readableStream.on(\"readable\", () => {\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"end\", () => {\n      // Destroy readableStream to minimize resource usage.\n      readableStream.destroy();\n      this._done = true;\n      this._readCapability.resolve();\n    });\n\n    readableStream.on(\"error\", reason => {\n      this._error(reason);\n    });\n\n    // Destroy readableStream if already in errored state.\n    if (this._storedError) {\n      this._readableStream.destroy(this._storedError);\n    }\n  }\n}\n\nexport { PDFNodeStream };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst INITIAL_DATA = Symbol(\"INITIAL_DATA\");\n\n/**\n * A PDF document and page is built of many objects. E.g. there are objects for\n * fonts, images, rendering code, etc. These objects may get processed inside of\n * a worker. This class implements some basic methods to manage these objects.\n */\nclass PDFObjects {\n  #objs = Object.create(null);\n\n  /**\n   * Ensures there is an object defined for `objId`.\n   *\n   * @param {string} objId\n   * @returns {Object}\n   */\n  #ensureObj(objId) {\n    return (this.#objs[objId] ||= {\n      ...Promise.withResolvers(),\n      data: INITIAL_DATA,\n    });\n  }\n\n  /**\n   * If called *without* callback, this returns the data of `objId` but the\n   * object needs to be resolved. If it isn't, this method throws.\n   *\n   * If called *with* a callback, the callback is called with the data of the\n   * object once the object is resolved. That means, if you call this method\n   * and the object is already resolved, the callback gets called right away.\n   *\n   * @param {string} objId\n   * @param {function} [callback]\n   * @returns {any}\n   */\n  get(objId, callback = null) {\n    // If there is a callback, then the get can be async and the object is\n    // not required to be resolved right now.\n    if (callback) {\n      const obj = this.#ensureObj(objId);\n      obj.promise.then(() => callback(obj.data));\n      return null;\n    }\n    // If there isn't a callback, the user expects to get the resolved data\n    // directly.\n    const obj = this.#objs[objId];\n    // If there isn't an object yet or the object isn't resolved, then the\n    // data isn't ready yet!\n    if (!obj || obj.data === INITIAL_DATA) {\n      throw new Error(`Requesting object that isn't resolved yet ${objId}.`);\n    }\n    return obj.data;\n  }\n\n  /**\n   * @param {string} objId\n   * @returns {boolean}\n   */\n  has(objId) {\n    const obj = this.#objs[objId];\n    return !!obj && obj.data !== INITIAL_DATA;\n  }\n\n  /**\n   * @param {string} objId\n   * @returns {boolean}\n   */\n  delete(objId) {\n    const obj = this.#objs[objId];\n    if (!obj || obj.data === INITIAL_DATA) {\n      // Only allow removing the object *after* it's been resolved.\n      return false;\n    }\n    delete this.#objs[objId];\n    return true;\n  }\n\n  /**\n   * Resolves the object `objId` with optional `data`.\n   *\n   * @param {string} objId\n   * @param {any} [data]\n   */\n  resolve(objId, data = null) {\n    const obj = this.#ensureObj(objId);\n    obj.data = data;\n    obj.resolve();\n  }\n\n  clear() {\n    for (const objId in this.#objs) {\n      const { data } = this.#objs[objId];\n      data?.bitmap?.close(); // Release any `ImageBitmap` data.\n    }\n    this.#objs = Object.create(null);\n  }\n\n  *[Symbol.iterator]() {\n    for (const objId in this.#objs) {\n      const { data } = this.#objs[objId];\n\n      if (data === INITIAL_DATA) {\n        continue;\n      }\n      yield [objId, data];\n    }\n  }\n}\n\nexport { PDFObjects };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./display_utils\").PageViewport} PageViewport */\n/** @typedef {import(\"./api\").TextContent} TextContent */\n\nimport {\n  AbortException,\n  FeatureTest,\n  shadow,\n  Util,\n  warn,\n} from \"../shared/util.js\";\nimport { OutputScale, setLayerDimensions } from \"./display_utils.js\";\n\n/**\n * @typedef {Object} TextLayerParameters\n * @property {ReadableStream | TextContent} textContentSource - Text content to\n *   render, i.e. the value returned by the page's `streamTextContent` or\n *   `getTextContent` method.\n * @property {HTMLElement} container - The DOM node that will contain the text\n *   runs.\n * @property {PageViewport} viewport - The target viewport to properly layout\n *   the text runs.\n */\n\n/**\n * @typedef {Object} TextLayerUpdateParameters\n * @property {PageViewport} viewport - The target viewport to properly layout\n *   the text runs.\n * @property {function} [onBefore] - Callback invoked before the textLayer is\n *   updated in the DOM.\n */\n\nconst MAX_TEXT_DIVS_TO_RENDER = 100000;\nconst DEFAULT_FONT_SIZE = 30;\n\nclass TextLayer {\n  #capability = Promise.withResolvers();\n\n  #container = null;\n\n  #disableProcessItems = false;\n\n  #fontInspectorEnabled = !!globalThis.FontInspector?.enabled;\n\n  #lang = null;\n\n  #layoutTextParams = null;\n\n  #pageHeight = 0;\n\n  #pageWidth = 0;\n\n  #reader = null;\n\n  #rootContainer = null;\n\n  #rotation = 0;\n\n  #scale = 0;\n\n  #styleCache = Object.create(null);\n\n  #textContentItemsStr = [];\n\n  #textContentSource = null;\n\n  #textDivs = [];\n\n  #textDivProperties = new WeakMap();\n\n  #transform = null;\n\n  static #ascentCache = new Map();\n\n  static #canvasContexts = new Map();\n\n  static #canvasCtxFonts = new WeakMap();\n\n  static #minFontSize = null;\n\n  static #pendingTextLayers = new Set();\n\n  /**\n   * @param {TextLayerParameters} options\n   */\n  constructor({ textContentSource, container, viewport }) {\n    if (textContentSource instanceof ReadableStream) {\n      this.#textContentSource = textContentSource;\n    } else if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) &&\n      typeof textContentSource === \"object\"\n    ) {\n      this.#textContentSource = new ReadableStream({\n        start(controller) {\n          controller.enqueue(textContentSource);\n          controller.close();\n        },\n      });\n    } else {\n      throw new Error('No \"textContentSource\" parameter specified.');\n    }\n    this.#container = this.#rootContainer = container;\n\n    this.#scale = viewport.scale * OutputScale.pixelRatio;\n    this.#rotation = viewport.rotation;\n    this.#layoutTextParams = {\n      div: null,\n      properties: null,\n      ctx: null,\n    };\n    const { pageWidth, pageHeight, pageX, pageY } = viewport.rawDims;\n    this.#transform = [1, 0, 0, -1, -pageX, pageY + pageHeight];\n    this.#pageWidth = pageWidth;\n    this.#pageHeight = pageHeight;\n\n    TextLayer.#ensureMinFontSizeComputed();\n\n    setLayerDimensions(container, viewport);\n\n    // Always clean-up the temporary canvas once rendering is no longer pending.\n    this.#capability.promise\n      .finally(() => {\n        TextLayer.#pendingTextLayers.delete(this);\n        this.#layoutTextParams = null;\n        this.#styleCache = null;\n      })\n      .catch(() => {\n        // Avoid \"Uncaught promise\" messages in the console.\n      });\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"pageWidth\", {\n        get() {\n          return this.#pageWidth;\n        },\n      });\n      Object.defineProperty(this, \"pageHeight\", {\n        get() {\n          return this.#pageHeight;\n        },\n      });\n    }\n  }\n\n  static get fontFamilyMap() {\n    const { isWindows, isFirefox } = FeatureTest.platform;\n    return shadow(\n      this,\n      \"fontFamilyMap\",\n      new Map([\n        [\n          \"sans-serif\",\n          `${isWindows && isFirefox ? \"Calibri, \" : \"\"}sans-serif`,\n        ],\n        [\n          \"monospace\",\n          `${isWindows && isFirefox ? \"Lucida Console, \" : \"\"}monospace`,\n        ],\n      ])\n    );\n  }\n\n  /**\n   * Render the textLayer.\n   * @returns {Promise}\n   */\n  render() {\n    const pump = () => {\n      this.#reader.read().then(({ value, done }) => {\n        if (done) {\n          this.#capability.resolve();\n          return;\n        }\n        this.#lang ??= value.lang;\n        Object.assign(this.#styleCache, value.styles);\n        this.#processItems(value.items);\n        pump();\n      }, this.#capability.reject);\n    };\n    this.#reader = this.#textContentSource.getReader();\n    TextLayer.#pendingTextLayers.add(this);\n    pump();\n\n    return this.#capability.promise;\n  }\n\n  /**\n   * Update a previously rendered textLayer, if necessary.\n   * @param {TextLayerUpdateParameters} options\n   * @returns {undefined}\n   */\n  update({ viewport, onBefore = null }) {\n    const scale = viewport.scale * OutputScale.pixelRatio;\n    const rotation = viewport.rotation;\n\n    if (rotation !== this.#rotation) {\n      onBefore?.();\n      this.#rotation = rotation;\n      setLayerDimensions(this.#rootContainer, { rotation });\n    }\n\n    if (scale !== this.#scale) {\n      onBefore?.();\n      this.#scale = scale;\n      const params = {\n        div: null,\n        properties: null,\n        ctx: TextLayer.#getCtx(this.#lang),\n      };\n      for (const div of this.#textDivs) {\n        params.properties = this.#textDivProperties.get(div);\n        params.div = div;\n        this.#layout(params);\n      }\n    }\n  }\n\n  /**\n   * Cancel rendering of the textLayer.\n   * @returns {undefined}\n   */\n  cancel() {\n    const abortEx = new AbortException(\"TextLayer task cancelled.\");\n\n    this.#reader?.cancel(abortEx).catch(() => {\n      // Avoid \"Uncaught promise\" messages in the console.\n    });\n    this.#reader = null;\n\n    this.#capability.reject(abortEx);\n  }\n\n  /**\n   * @type {Array<HTMLElement>} HTML elements that correspond to the text items\n   *   of the textContent input.\n   *   This is output and will initially be set to an empty array.\n   */\n  get textDivs() {\n    return this.#textDivs;\n  }\n\n  /**\n   * @type {Array<string>} Strings that correspond to the `str` property of\n   *   the text items of the textContent input.\n   *   This is output and will initially be set to an empty array\n   */\n  get textContentItemsStr() {\n    return this.#textContentItemsStr;\n  }\n\n  #processItems(items) {\n    if (this.#disableProcessItems) {\n      return;\n    }\n    this.#layoutTextParams.ctx ??= TextLayer.#getCtx(this.#lang);\n\n    const textDivs = this.#textDivs,\n      textContentItemsStr = this.#textContentItemsStr;\n\n    for (const item of items) {\n      // No point in rendering many divs as it would make the browser\n      // unusable even after the divs are rendered.\n      if (textDivs.length > MAX_TEXT_DIVS_TO_RENDER) {\n        warn(\"Ignoring additional textDivs for performance reasons.\");\n\n        this.#disableProcessItems = true; // Avoid multiple warnings for one page.\n        return;\n      }\n\n      if (item.str === undefined) {\n        if (\n          item.type === \"beginMarkedContentProps\" ||\n          item.type === \"beginMarkedContent\"\n        ) {\n          const parent = this.#container;\n          this.#container = document.createElement(\"span\");\n          this.#container.classList.add(\"markedContent\");\n          if (item.id !== null) {\n            this.#container.setAttribute(\"id\", `${item.id}`);\n          }\n          parent.append(this.#container);\n        } else if (item.type === \"endMarkedContent\") {\n          this.#container = this.#container.parentNode;\n        }\n        continue;\n      }\n      textContentItemsStr.push(item.str);\n      this.#appendText(item);\n    }\n  }\n\n  #appendText(geom) {\n    // Initialize all used properties to keep the caches monomorphic.\n    const textDiv = document.createElement(\"span\");\n    const textDivProperties = {\n      angle: 0,\n      canvasWidth: 0,\n      hasText: geom.str !== \"\",\n      hasEOL: geom.hasEOL,\n      fontSize: 0,\n    };\n    this.#textDivs.push(textDiv);\n\n    const tx = Util.transform(this.#transform, geom.transform);\n    let angle = Math.atan2(tx[1], tx[0]);\n    const style = this.#styleCache[geom.fontName];\n    if (style.vertical) {\n      angle += Math.PI / 2;\n    }\n\n    let fontFamily =\n      (this.#fontInspectorEnabled && style.fontSubstitution) ||\n      style.fontFamily;\n\n    // Workaround for bug 1922063.\n    fontFamily = TextLayer.fontFamilyMap.get(fontFamily) || fontFamily;\n    const fontHeight = Math.hypot(tx[2], tx[3]);\n    const fontAscent =\n      fontHeight * TextLayer.#getAscent(fontFamily, style, this.#lang);\n\n    let left, top;\n    if (angle === 0) {\n      left = tx[4];\n      top = tx[5] - fontAscent;\n    } else {\n      left = tx[4] + fontAscent * Math.sin(angle);\n      top = tx[5] - fontAscent * Math.cos(angle);\n    }\n\n    const scaleFactorStr = \"calc(var(--total-scale-factor) *\";\n    const divStyle = textDiv.style;\n    // Setting the style properties individually, rather than all at once,\n    // should be OK since the `textDiv` isn't appended to the document yet.\n    if (this.#container === this.#rootContainer) {\n      divStyle.left = `${((100 * left) / this.#pageWidth).toFixed(2)}%`;\n      divStyle.top = `${((100 * top) / this.#pageHeight).toFixed(2)}%`;\n    } else {\n      // We're in a marked content span, hence we can't use percents.\n      divStyle.left = `${scaleFactorStr}${left.toFixed(2)}px)`;\n      divStyle.top = `${scaleFactorStr}${top.toFixed(2)}px)`;\n    }\n    // We multiply the font size by #minFontSize, and then #layout will\n    // scale the element by 1/#minFontSize. This allows us to effectively\n    // ignore the minimum font size enforced by the browser, so that the text\n    // layer <span>s can always match the size of the text in the canvas.\n    divStyle.fontSize = `${scaleFactorStr}${(TextLayer.#minFontSize * fontHeight).toFixed(2)}px)`;\n    divStyle.fontFamily = fontFamily;\n\n    textDivProperties.fontSize = fontHeight;\n\n    // Keeps screen readers from pausing on every new text span.\n    textDiv.setAttribute(\"role\", \"presentation\");\n\n    textDiv.textContent = geom.str;\n    // geom.dir may be 'ttb' for vertical texts.\n    textDiv.dir = geom.dir;\n\n    // `fontName` is only used by the FontInspector, and we only use `dataset`\n    // here to make the font name available in the debugger.\n    if (this.#fontInspectorEnabled) {\n      textDiv.dataset.fontName =\n        style.fontSubstitutionLoadedName || geom.fontName;\n    }\n    if (angle !== 0) {\n      textDivProperties.angle = angle * (180 / Math.PI);\n    }\n    // We don't bother scaling single-char text divs, because it has very\n    // little effect on text highlighting. This makes scrolling on docs with\n    // lots of such divs a lot faster.\n    let shouldScaleText = false;\n    if (geom.str.length > 1) {\n      shouldScaleText = true;\n    } else if (geom.str !== \" \" && geom.transform[0] !== geom.transform[3]) {\n      const absScaleX = Math.abs(geom.transform[0]),\n        absScaleY = Math.abs(geom.transform[3]);\n      // When the horizontal/vertical scaling differs significantly, also scale\n      // even single-char text to improve highlighting (fixes issue11713.pdf).\n      if (\n        absScaleX !== absScaleY &&\n        Math.max(absScaleX, absScaleY) / Math.min(absScaleX, absScaleY) > 1.5\n      ) {\n        shouldScaleText = true;\n      }\n    }\n    if (shouldScaleText) {\n      textDivProperties.canvasWidth = style.vertical ? geom.height : geom.width;\n    }\n    this.#textDivProperties.set(textDiv, textDivProperties);\n\n    // Finally, layout and append the text to the DOM.\n    this.#layoutTextParams.div = textDiv;\n    this.#layoutTextParams.properties = textDivProperties;\n    this.#layout(this.#layoutTextParams);\n\n    if (textDivProperties.hasText) {\n      this.#container.append(textDiv);\n    }\n    if (textDivProperties.hasEOL) {\n      const br = document.createElement(\"br\");\n      br.setAttribute(\"role\", \"presentation\");\n      this.#container.append(br);\n    }\n  }\n\n  #layout(params) {\n    const { div, properties, ctx } = params;\n    const { style } = div;\n\n    let transform = \"\";\n    if (TextLayer.#minFontSize > 1) {\n      transform = `scale(${1 / TextLayer.#minFontSize})`;\n    }\n\n    if (properties.canvasWidth !== 0 && properties.hasText) {\n      const { fontFamily } = style;\n      const { canvasWidth, fontSize } = properties;\n\n      TextLayer.#ensureCtxFont(ctx, fontSize * this.#scale, fontFamily);\n      // Only measure the width for multi-char text divs, see `appendText`.\n      const { width } = ctx.measureText(div.textContent);\n\n      if (width > 0) {\n        transform = `scaleX(${(canvasWidth * this.#scale) / width}) ${transform}`;\n      }\n    }\n    if (properties.angle !== 0) {\n      transform = `rotate(${properties.angle}deg) ${transform}`;\n    }\n    if (transform.length > 0) {\n      style.transform = transform;\n    }\n  }\n\n  /**\n   * Clean-up global textLayer data.\n   * @returns {undefined}\n   */\n  static cleanup() {\n    if (this.#pendingTextLayers.size > 0) {\n      return;\n    }\n    this.#ascentCache.clear();\n\n    for (const { canvas } of this.#canvasContexts.values()) {\n      canvas.remove();\n    }\n    this.#canvasContexts.clear();\n  }\n\n  static #getCtx(lang = null) {\n    let ctx = this.#canvasContexts.get((lang ||= \"\"));\n    if (!ctx) {\n      // We don't use an OffscreenCanvas here because we use serif/sans serif\n      // fonts with it and they depends on the locale.\n      // In Firefox, the <html> element get a lang attribute that depends on\n      // what Fluent returns for the locale and the OffscreenCanvas uses\n      // the OS locale.\n      // Those two locales can be different and consequently the used fonts will\n      // be different (see bug 1869001).\n      // Ideally, we should use in the text layer the fonts we've in the pdf (or\n      // their replacements when they aren't embedded) and then we can use an\n      // OffscreenCanvas.\n      const canvas = document.createElement(\"canvas\");\n      canvas.className = \"hiddenCanvasElement\";\n      canvas.lang = lang;\n      document.body.append(canvas);\n      ctx = canvas.getContext(\"2d\", {\n        alpha: false,\n        willReadFrequently: true,\n      });\n      this.#canvasContexts.set(lang, ctx);\n\n      // Also, initialize state for the `#ensureCtxFont` method.\n      this.#canvasCtxFonts.set(ctx, { size: 0, family: \"\" });\n    }\n    return ctx;\n  }\n\n  static #ensureCtxFont(ctx, size, family) {\n    const cached = this.#canvasCtxFonts.get(ctx);\n    if (size === cached.size && family === cached.family) {\n      return; // The font is already set.\n    }\n    ctx.font = `${size}px ${family}`;\n    cached.size = size;\n    cached.family = family;\n  }\n\n  /**\n   * Compute the minimum font size enforced by the browser.\n   */\n  static #ensureMinFontSizeComputed() {\n    if (this.#minFontSize !== null) {\n      return;\n    }\n    const div = document.createElement(\"div\");\n    div.style.opacity = 0;\n    div.style.lineHeight = 1;\n    div.style.fontSize = \"1px\";\n    div.style.position = \"absolute\";\n    div.textContent = \"X\";\n    document.body.append(div);\n    // In `display:block` elements contain a single line of text,\n    // the height matches the line height (which, when set to 1,\n    // matches the actual font size).\n    this.#minFontSize = div.getBoundingClientRect().height;\n    div.remove();\n  }\n\n  static #getAscent(fontFamily, style, lang) {\n    const cachedAscent = this.#ascentCache.get(fontFamily);\n    if (cachedAscent) {\n      return cachedAscent;\n    }\n    const ctx = this.#getCtx(lang);\n\n    ctx.canvas.width = ctx.canvas.height = DEFAULT_FONT_SIZE;\n    this.#ensureCtxFont(ctx, DEFAULT_FONT_SIZE, fontFamily);\n    const metrics = ctx.measureText(\"\");\n\n    const ascent = metrics.fontBoundingBoxAscent;\n    const descent = Math.abs(metrics.fontBoundingBoxDescent);\n\n    ctx.canvas.width = ctx.canvas.height = 0;\n    let ratio = 0.8; // DEFAULT_FONT_ASCENT\n\n    if (ascent) {\n      ratio = ascent / (ascent + descent);\n    } else {\n      if (\n        (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n        FeatureTest.platform.isFirefox\n      ) {\n        warn(\n          \"Enable the `dom.textMetrics.fontBoundingBox.enabled` preference \" +\n            \"in `about:config` to improve TextLayer rendering.\"\n        );\n      }\n      if (style.ascent) {\n        ratio = style.ascent;\n      } else if (style.descent) {\n        ratio = 1 + style.descent;\n      }\n    }\n\n    this.#ascentCache.set(fontFamily, ratio);\n    return ratio;\n  }\n}\n\nexport { TextLayer };\n","/* Copyright 2021 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./api\").TextContent} TextContent */\n\nclass XfaText {\n  /**\n   * Walk an XFA tree and create an array of text nodes that is compatible\n   * with a regular PDFs TextContent. Currently, only TextItem.str is supported,\n   * all other fields and styles haven't been implemented.\n   *\n   * @param {Object} xfa - An XFA fake DOM object.\n   *\n   * @returns {TextContent}\n   */\n  static textContent(xfa) {\n    const items = [];\n    const output = {\n      items,\n      styles: Object.create(null),\n    };\n    function walk(node) {\n      if (!node) {\n        return;\n      }\n      let str = null;\n      const name = node.name;\n      if (name === \"#text\") {\n        str = node.value;\n      } else if (!XfaText.shouldBuildText(name)) {\n        return;\n      } else if (node?.attributes?.textContent) {\n        str = node.attributes.textContent;\n      } else if (node.value) {\n        str = node.value;\n      }\n      if (str !== null) {\n        items.push({\n          str,\n        });\n      }\n      if (!node.children) {\n        return;\n      }\n      for (const child of node.children) {\n        walk(child);\n      }\n    }\n    walk(xfa);\n    return output;\n  }\n\n  /**\n   * @param {string} name - DOM node name. (lower case)\n   *\n   * @returns {boolean} true if the DOM node should have a corresponding text\n   * node.\n   */\n  static shouldBuildText(name) {\n    return !(\n      name === \"textarea\" ||\n      name === \"input\" ||\n      name === \"option\" ||\n      name === \"select\"\n    );\n  }\n}\n\nexport { XfaText };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @module pdfjsLib\n */\n\nimport {\n  AbortException,\n  AnnotationMode,\n  assert,\n  FeatureTest,\n  getVerbosityLevel,\n  info,\n  isNodeJS,\n  RenderingIntentFlag,\n  setVerbosityLevel,\n  shadow,\n  unreachable,\n  warn,\n} from \"../shared/util.js\";\nimport {\n  AnnotationStorage,\n  PrintAnnotationStorage,\n  SerializableEmpty,\n} from \"./annotation_storage.js\";\nimport {\n  deprecated,\n  isDataScheme,\n  isValidFetchUrl,\n  PageViewport,\n  RenderingCancelledException,\n  StatTimer,\n} from \"./display_utils.js\";\nimport { FontFaceObject, FontLoader } from \"./font_loader.js\";\nimport {\n  getDataProp,\n  getFactoryUrlProp,\n  getUrlProp,\n  isRefProxy,\n  LoopbackPort,\n} from \"./api_utils.js\";\nimport { MessageHandler, wrapReason } from \"../shared/message_handler.js\";\nimport {\n  NodeCanvasFactory,\n  NodeCMapReaderFactory,\n  NodeFilterFactory,\n  NodeStandardFontDataFactory,\n  NodeWasmFactory,\n} from \"display-node_utils\";\nimport { CanvasGraphics } from \"./canvas.js\";\nimport { DOMCanvasFactory } from \"./canvas_factory.js\";\nimport { DOMCMapReaderFactory } from \"display-cmap_reader_factory\";\nimport { DOMFilterFactory } from \"./filter_factory.js\";\nimport { DOMStandardFontDataFactory } from \"display-standard_fontdata_factory\";\nimport { DOMWasmFactory } from \"display-wasm_factory\";\nimport { GlobalWorkerOptions } from \"./worker_options.js\";\nimport { Metadata } from \"./metadata.js\";\nimport { OptionalContentConfig } from \"./optional_content_config.js\";\nimport { PDFDataTransportStream } from \"./transport_stream.js\";\nimport { PDFFetchStream } from \"display-fetch_stream\";\nimport { PDFNetworkStream } from \"display-network\";\nimport { PDFNodeStream } from \"display-node_stream\";\nimport { PDFObjects } from \"./pdf_objects.js\";\nimport { TextLayer } from \"./text_layer.js\";\nimport { XfaText } from \"./xfa_text.js\";\n\nconst RENDERING_CANCELLED_TIMEOUT = 100; // ms\n\n/**\n * @typedef { Int8Array | Uint8Array | Uint8ClampedArray |\n *            Int16Array | Uint16Array |\n *            Int32Array | Uint32Array | Float32Array |\n *            Float64Array\n * } TypedArray\n */\n\n/**\n * @typedef {Object} RefProxy\n * @property {number} num\n * @property {number} gen\n */\n\n/**\n * Document initialization / loading parameters object.\n *\n * @typedef {Object} DocumentInitParameters\n * @property {string | URL} [url] - The URL of the PDF.\n * @property {TypedArray | ArrayBuffer | Array<number> | string} [data] -\n *   Binary PDF data.\n *   Use TypedArrays (Uint8Array) to improve the memory usage. If PDF data is\n *   BASE64-encoded, use `atob()` to convert it to a binary string first.\n *\n *   NOTE: If TypedArrays are used they will generally be transferred to the\n *   worker-thread. This will help reduce main-thread memory usage, however\n *   it will take ownership of the TypedArrays.\n * @property {Object} [httpHeaders] - Basic authentication headers.\n * @property {boolean} [withCredentials] - Indicates whether or not\n *   cross-site Access-Control requests should be made using credentials such\n *   as cookies or authorization headers. The default is `false`.\n * @property {string} [password] - For decrypting password-protected PDFs.\n * @property {number} [length] - The PDF file length. It's used for progress\n *   reports and range requests operations.\n * @property {PDFDataRangeTransport} [range] - Allows for using a custom range\n *   transport implementation.\n * @property {number} [rangeChunkSize] - Specify maximum number of bytes fetched\n *   per range request. The default value is 65536 (= 2^16).\n * @property {PDFWorker} [worker] - The worker that will be used for loading and\n *   parsing the PDF data.\n * @property {number} [verbosity] - Controls the logging level; the constants\n *   from {@link VerbosityLevel} should be used.\n * @property {string} [docBaseUrl] - The base URL of the document, used when\n *   attempting to recover valid absolute URLs for annotations, and outline\n *   items, that (incorrectly) only specify relative URLs.\n * @property {string} [cMapUrl] - The URL where the predefined Adobe CMaps are\n *   located. Include the trailing slash.\n * @property {boolean} [cMapPacked] - Specifies if the Adobe CMaps are binary\n *   packed or not. The default value is `true`.\n * @property {Object} [CMapReaderFactory] - The factory that will be used when\n *   reading built-in CMap files.\n *   The default value is {DOMCMapReaderFactory}.\n * @property {string} [iccUrl] - The URL where the predefined ICC profiles are\n *   located. Include the trailing slash.\n * @property {boolean} [useSystemFonts] - When `true`, fonts that aren't\n *   embedded in the PDF document will fallback to a system font.\n *   The default value is `true` in web environments and `false` in Node.js;\n *   unless `disableFontFace === true` in which case this defaults to `false`\n *   regardless of the environment (to prevent completely broken fonts).\n * @property {string} [standardFontDataUrl] - The URL where the standard font\n *   files are located. Include the trailing slash.\n * @property {Object} [StandardFontDataFactory] - The factory that will be used\n *   when reading the standard font files.\n *   The default value is {DOMStandardFontDataFactory}.\n * @property {string} [wasmUrl] - The URL where the wasm files are located.\n *   Include the trailing slash.\n * @property {Object} [WasmFactory] - The factory that will be used\n *   when reading the wasm files.\n *   The default value is {DOMWasmFactory}.\n * @property {boolean} [useWorkerFetch] - Enable using the Fetch API in the\n *   worker-thread when reading CMap and standard font files. When `true`,\n *   the `CMapReaderFactory`, `StandardFontDataFactory`, and `WasmFactory`\n *   options are ignored.\n *   The default value is `true` in web environments and `false` in Node.js.\n * @property {boolean} [useWasm] - Attempt to use WebAssembly in order to\n *    improve e.g. image decoding performance.\n *    The default value is `true`.\n * @property {boolean} [stopAtErrors] - Reject certain promises, e.g.\n *   `getOperatorList`, `getTextContent`, and `RenderTask`, when the associated\n *   PDF data cannot be successfully parsed, instead of attempting to recover\n *   whatever possible of the data. The default value is `false`.\n * @property {number} [maxImageSize] - The maximum allowed image size in total\n *   pixels, i.e. width * height. Images above this value will not be rendered.\n *   Use -1 for no limit, which is also the default value.\n * @property {boolean} [isEvalSupported] - Determines if we can evaluate strings\n *   as JavaScript. Primarily used to improve performance of PDF functions.\n *   The default value is `true`.\n * @property {boolean} [isOffscreenCanvasSupported] - Determines if we can use\n *   `OffscreenCanvas` in the worker. Primarily used to improve performance of\n *   image conversion/rendering.\n *   The default value is `true` in web environments and `false` in Node.js.\n * @property {boolean} [isImageDecoderSupported] - Determines if we can use\n *   `ImageDecoder` in the worker. Primarily used to improve performance of\n *   image conversion/rendering.\n *   The default value is `true` in web environments and `false` in Node.js.\n *\n *   NOTE: Also temporarily disabled in Chromium browsers, until we no longer\n *   support the affected browser versions, because of various bugs:\n *\n *    - Crashes when using the BMP decoder with huge images, e.g. issue6741.pdf;\n *      see https://issues.chromium.org/issues/374807001\n *\n *    - Broken images when using the JPEG decoder with images that have custom\n *      colour profiles, e.g. GitHub discussion 19030;\n *      see https://issues.chromium.org/issues/378869810\n *\n * @property {number} [canvasMaxAreaInBytes] - The integer value is used to\n *   know when an image must be resized (uses `OffscreenCanvas` in the worker).\n *   If it's -1 then a possibly slow algorithm is used to guess the max value.\n * @property {boolean} [disableFontFace] - By default fonts are converted to\n *   OpenType fonts and loaded via the Font Loading API or `@font-face` rules.\n *   If disabled, fonts will be rendered using a built-in font renderer that\n *   constructs the glyphs with primitive path commands.\n *   The default value is `false` in web environments and `true` in Node.js.\n * @property {boolean} [fontExtraProperties] - Include additional properties,\n *   which are unused during rendering of PDF documents, when exporting the\n *   parsed font data from the worker-thread. This may be useful for debugging\n *   purposes (and backwards compatibility), but note that it will lead to\n *   increased memory usage. The default value is `false`.\n * @property {boolean} [enableXfa] - Render Xfa forms if any.\n *   The default value is `false`.\n * @property {HTMLDocument} [ownerDocument] - Specify an explicit document\n *   context to create elements with and to load resources, such as fonts,\n *   into. Defaults to the current document.\n * @property {boolean} [disableRange] - Disable range request loading of PDF\n *   files. When enabled, and if the server supports partial content requests,\n *   then the PDF will be fetched in chunks. The default value is `false`.\n * @property {boolean} [disableStream] - Disable streaming of PDF file data.\n *   By default PDF.js attempts to load PDF files in chunks. The default value\n *   is `false`.\n * @property {boolean} [disableAutoFetch] - Disable pre-fetching of PDF file\n *   data. When range requests are enabled PDF.js will automatically keep\n *   fetching more data even if it isn't needed to display the current page.\n *   The default value is `false`.\n *\n *   NOTE: It is also necessary to disable streaming, see above, in order for\n *   disabling of pre-fetching to work correctly.\n * @property {boolean} [pdfBug] - Enables special hooks for debugging PDF.js\n *   (see `web/debugger.js`). The default value is `false`.\n * @property {Object} [CanvasFactory] - The factory that will be used when\n *    creating canvases. The default value is {DOMCanvasFactory}.\n * @property {Object} [FilterFactory] - The factory that will be used to\n *    create SVG filters when rendering some images on the main canvas.\n *    The default value is {DOMFilterFactory}.\n * @property {boolean} [enableHWA] - Enables hardware acceleration for\n *   rendering. The default value is `false`.\n */\n\n/**\n * This is the main entry point for loading a PDF and interacting with it.\n *\n * NOTE: If a URL is used to fetch the PDF data a standard Fetch API call (or\n * XHR as fallback) is used, which means it must follow same origin rules,\n * e.g. no cross-domain requests without CORS.\n *\n * @param {string | URL | TypedArray | ArrayBuffer | DocumentInitParameters}\n *   src - Can be a URL where a PDF file is located, a typed array (Uint8Array)\n *         already populated with data, or a parameter object.\n * @returns {PDFDocumentLoadingTask}\n */\nfunction getDocument(src = {}) {\n  if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n    if (typeof src === \"string\" || src instanceof URL) {\n      src = { url: src };\n    } else if (src instanceof ArrayBuffer || ArrayBuffer.isView(src)) {\n      src = { data: src };\n    }\n  }\n  const task = new PDFDocumentLoadingTask();\n  const { docId } = task;\n\n  const url = src.url ? getUrlProp(src.url) : null;\n  const data = src.data ? getDataProp(src.data) : null;\n  const httpHeaders = src.httpHeaders || null;\n  const withCredentials = src.withCredentials === true;\n  const password = src.password ?? null;\n  const rangeTransport =\n    src.range instanceof PDFDataRangeTransport ? src.range : null;\n  const rangeChunkSize =\n    Number.isInteger(src.rangeChunkSize) && src.rangeChunkSize > 0\n      ? src.rangeChunkSize\n      : 2 ** 16;\n  let worker = src.worker instanceof PDFWorker ? src.worker : null;\n  const verbosity = src.verbosity;\n  // Ignore \"data:\"-URLs, since they can't be used to recover valid absolute\n  // URLs anyway. We want to avoid sending them to the worker-thread, since\n  // they contain the *entire* PDF document and can thus be arbitrarily long.\n  const docBaseUrl =\n    typeof src.docBaseUrl === \"string\" && !isDataScheme(src.docBaseUrl)\n      ? src.docBaseUrl\n      : null;\n  const cMapUrl = getFactoryUrlProp(src.cMapUrl);\n  const cMapPacked = src.cMapPacked !== false;\n  const CMapReaderFactory =\n    src.CMapReaderFactory ||\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n      ? NodeCMapReaderFactory\n      : DOMCMapReaderFactory);\n  const iccUrl = getFactoryUrlProp(src.iccUrl);\n  const standardFontDataUrl = getFactoryUrlProp(src.standardFontDataUrl);\n  const StandardFontDataFactory =\n    src.StandardFontDataFactory ||\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n      ? NodeStandardFontDataFactory\n      : DOMStandardFontDataFactory);\n  const wasmUrl = getFactoryUrlProp(src.wasmUrl);\n  const WasmFactory =\n    src.WasmFactory ||\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n      ? NodeWasmFactory\n      : DOMWasmFactory);\n  const ignoreErrors = src.stopAtErrors !== true;\n  const maxImageSize =\n    Number.isInteger(src.maxImageSize) && src.maxImageSize > -1\n      ? src.maxImageSize\n      : -1;\n  const isEvalSupported = src.isEvalSupported !== false;\n  const isOffscreenCanvasSupported =\n    typeof src.isOffscreenCanvasSupported === \"boolean\"\n      ? src.isOffscreenCanvasSupported\n      : !isNodeJS;\n  const isImageDecoderSupported =\n    // eslint-disable-next-line no-nested-ternary\n    typeof src.isImageDecoderSupported === \"boolean\"\n      ? src.isImageDecoderSupported\n      : // eslint-disable-next-line no-nested-ternary\n        typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")\n        ? true\n        : typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"CHROME\")\n          ? false\n          : !isNodeJS && (FeatureTest.platform.isFirefox || !globalThis.chrome);\n  const canvasMaxAreaInBytes = Number.isInteger(src.canvasMaxAreaInBytes)\n    ? src.canvasMaxAreaInBytes\n    : -1;\n  const disableFontFace =\n    typeof src.disableFontFace === \"boolean\" ? src.disableFontFace : isNodeJS;\n  const fontExtraProperties = src.fontExtraProperties === true;\n  const enableXfa = src.enableXfa === true;\n  const ownerDocument = src.ownerDocument || globalThis.document;\n  const disableRange = src.disableRange === true;\n  const disableStream = src.disableStream === true;\n  const disableAutoFetch = src.disableAutoFetch === true;\n  const pdfBug = src.pdfBug === true;\n  const CanvasFactory =\n    src.CanvasFactory ||\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n      ? NodeCanvasFactory\n      : DOMCanvasFactory);\n  const FilterFactory =\n    src.FilterFactory ||\n    (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"GENERIC\") && isNodeJS\n      ? NodeFilterFactory\n      : DOMFilterFactory);\n  const enableHWA = src.enableHWA === true;\n  const useWasm = src.useWasm !== false;\n\n  // Parameters whose default values depend on other parameters.\n  const length = rangeTransport ? rangeTransport.length : (src.length ?? NaN);\n  const useSystemFonts =\n    typeof src.useSystemFonts === \"boolean\"\n      ? src.useSystemFonts\n      : !isNodeJS && !disableFontFace;\n  const useWorkerFetch =\n    typeof src.useWorkerFetch === \"boolean\"\n      ? src.useWorkerFetch\n      : (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n        !!(\n          CMapReaderFactory === DOMCMapReaderFactory &&\n          StandardFontDataFactory === DOMStandardFontDataFactory &&\n          WasmFactory === DOMWasmFactory &&\n          cMapUrl &&\n          standardFontDataUrl &&\n          wasmUrl &&\n          isValidFetchUrl(cMapUrl, document.baseURI) &&\n          isValidFetchUrl(standardFontDataUrl, document.baseURI) &&\n          isValidFetchUrl(wasmUrl, document.baseURI)\n        );\n\n  // Parameters only intended for development/testing purposes.\n  const styleElement =\n    typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")\n      ? src.styleElement\n      : null;\n\n  // Set the main-thread verbosity level.\n  setVerbosityLevel(verbosity);\n\n  // Ensure that the various factories can be initialized, when necessary,\n  // since the user may provide *custom* ones.\n  const transportFactory = {\n    canvasFactory: new CanvasFactory({ ownerDocument, enableHWA }),\n    filterFactory: new FilterFactory({ docId, ownerDocument }),\n    cMapReaderFactory:\n      (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n      useWorkerFetch\n        ? null\n        : new CMapReaderFactory({ baseUrl: cMapUrl, isCompressed: cMapPacked }),\n    standardFontDataFactory:\n      (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n      useWorkerFetch\n        ? null\n        : new StandardFontDataFactory({ baseUrl: standardFontDataUrl }),\n    wasmFactory:\n      (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) ||\n      useWorkerFetch\n        ? null\n        : new WasmFactory({ baseUrl: wasmUrl }),\n  };\n\n  if (!worker) {\n    // Worker was not provided -- creating and owning our own. If message port\n    // is specified in global worker options, using it.\n    worker = PDFWorker.create({\n      verbosity,\n      port: GlobalWorkerOptions.workerPort,\n    });\n    task._worker = worker;\n  }\n\n  const docParams = {\n    docId,\n    apiVersion:\n      typeof PDFJSDev !== \"undefined\" && !PDFJSDev.test(\"TESTING\")\n        ? PDFJSDev.eval(\"BUNDLE_VERSION\")\n        : null,\n    data,\n    password,\n    disableAutoFetch,\n    rangeChunkSize,\n    length,\n    docBaseUrl,\n    enableXfa,\n    evaluatorOptions: {\n      maxImageSize,\n      disableFontFace,\n      ignoreErrors,\n      isEvalSupported,\n      isOffscreenCanvasSupported,\n      isImageDecoderSupported,\n      canvasMaxAreaInBytes,\n      fontExtraProperties,\n      useSystemFonts,\n      useWasm,\n      useWorkerFetch,\n      cMapUrl,\n      iccUrl,\n      standardFontDataUrl,\n      wasmUrl,\n    },\n  };\n  const transportParams = {\n    ownerDocument,\n    pdfBug,\n    styleElement,\n    loadingParams: {\n      disableAutoFetch,\n      enableXfa,\n    },\n  };\n\n  worker.promise\n    .then(function () {\n      if (task.destroyed) {\n        throw new Error(\"Loading aborted\");\n      }\n      if (worker.destroyed) {\n        throw new Error(\"Worker was destroyed\");\n      }\n\n      const workerIdPromise = worker.messageHandler.sendWithPromise(\n        \"GetDocRequest\",\n        docParams,\n        data ? [data.buffer] : null\n      );\n\n      let networkStream;\n      if (rangeTransport) {\n        networkStream = new PDFDataTransportStream(rangeTransport, {\n          disableRange,\n          disableStream,\n        });\n      } else if (!data) {\n        if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n          throw new Error(\"Not implemented: NetworkStream\");\n        }\n        if (!url) {\n          throw new Error(\"getDocument - no `url` parameter provided.\");\n        }\n        // eslint-disable-next-line no-nested-ternary\n        const NetworkStream = isValidFetchUrl(url)\n          ? PDFFetchStream\n          : typeof PDFJSDev !== \"undefined\" &&\n              PDFJSDev.test(\"GENERIC\") &&\n              isNodeJS\n            ? PDFNodeStream\n            : PDFNetworkStream;\n\n        networkStream = new NetworkStream({\n          url,\n          length,\n          httpHeaders,\n          withCredentials,\n          rangeChunkSize,\n          disableRange,\n          disableStream,\n        });\n      }\n\n      return workerIdPromise.then(workerId => {\n        if (task.destroyed) {\n          throw new Error(\"Loading aborted\");\n        }\n        if (worker.destroyed) {\n          throw new Error(\"Worker was destroyed\");\n        }\n\n        const messageHandler = new MessageHandler(docId, workerId, worker.port);\n        const transport = new WorkerTransport(\n          messageHandler,\n          task,\n          networkStream,\n          transportParams,\n          transportFactory\n        );\n        task._transport = transport;\n        messageHandler.send(\"Ready\", null);\n      });\n    })\n    .catch(task._capability.reject);\n\n  return task;\n}\n\n/**\n * @typedef {Object} OnProgressParameters\n * @property {number} loaded - Currently loaded number of bytes.\n * @property {number} total - Total number of bytes in the PDF file.\n */\n\n/**\n * The loading task controls the operations required to load a PDF document\n * (such as network requests) and provides a way to listen for completion,\n * after which individual pages can be rendered.\n */\nclass PDFDocumentLoadingTask {\n  static #docId = 0;\n\n  /**\n   * @private\n   */\n  _capability = Promise.withResolvers();\n\n  /**\n   * @private\n   */\n  _transport = null;\n\n  /**\n   * @private\n   */\n  _worker = null;\n\n  /**\n   * Unique identifier for the document loading task.\n   * @type {string}\n   */\n  docId = `d${PDFDocumentLoadingTask.#docId++}`;\n\n  /**\n   * Whether the loading task is destroyed or not.\n   * @type {boolean}\n   */\n  destroyed = false;\n\n  /**\n   * Callback to request a password if a wrong or no password was provided.\n   * The callback receives two parameters: a function that should be called\n   * with the new password, and a reason (see {@link PasswordResponses}).\n   * @type {function}\n   */\n  onPassword = null;\n\n  /**\n   * Callback to be able to monitor the loading progress of the PDF file\n   * (necessary to implement e.g. a loading bar).\n   * The callback receives an {@link OnProgressParameters} argument.\n   * @type {function}\n   */\n  onProgress = null;\n\n  /**\n   * Promise for document loading task completion.\n   * @type {Promise<PDFDocumentProxy>}\n   */\n  get promise() {\n    return this._capability.promise;\n  }\n\n  /**\n   * Abort all network requests and destroy the worker.\n   * @returns {Promise<void>} A promise that is resolved when destruction is\n   *   completed.\n   */\n  async destroy() {\n    this.destroyed = true;\n\n    try {\n      if (this._worker?.port) {\n        this._worker._pendingDestroy = true;\n      }\n      await this._transport?.destroy();\n    } catch (ex) {\n      if (this._worker?.port) {\n        delete this._worker._pendingDestroy;\n      }\n      throw ex;\n    }\n    this._transport = null;\n\n    this._worker?.destroy();\n    this._worker = null;\n  }\n\n  /**\n   * Attempt to fetch the raw data of the PDF document, when e.g.\n   *  - An exception was thrown during document initialization.\n   *  - An `onPassword` callback is delaying initialization.\n   * @returns {Promise<Uint8Array>}\n   */\n  async getData() {\n    return this._transport.getData();\n  }\n}\n\n/**\n * Abstract class to support range requests file loading.\n *\n * NOTE: The TypedArrays passed to the constructor and relevant methods below\n * will generally be transferred to the worker-thread. This will help reduce\n * main-thread memory usage, however it will take ownership of the TypedArrays.\n */\nclass PDFDataRangeTransport {\n  #capability = Promise.withResolvers();\n\n  #progressiveDoneListeners = [];\n\n  #progressiveReadListeners = [];\n\n  #progressListeners = [];\n\n  #rangeListeners = [];\n\n  /**\n   * @param {number} length\n   * @param {Uint8Array|null} initialData\n   * @param {boolean} [progressiveDone]\n   * @param {string} [contentDispositionFilename]\n   */\n  constructor(\n    length,\n    initialData,\n    progressiveDone = false,\n    contentDispositionFilename = null\n  ) {\n    this.length = length;\n    this.initialData = initialData;\n    this.progressiveDone = progressiveDone;\n    this.contentDispositionFilename = contentDispositionFilename;\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addRangeListener(listener) {\n    this.#rangeListeners.push(listener);\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addProgressListener(listener) {\n    this.#progressListeners.push(listener);\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addProgressiveReadListener(listener) {\n    this.#progressiveReadListeners.push(listener);\n  }\n\n  /**\n   * @param {function} listener\n   */\n  addProgressiveDoneListener(listener) {\n    this.#progressiveDoneListeners.push(listener);\n  }\n\n  /**\n   * @param {number} begin\n   * @param {Uint8Array|null} chunk\n   */\n  onDataRange(begin, chunk) {\n    for (const listener of this.#rangeListeners) {\n      listener(begin, chunk);\n    }\n  }\n\n  /**\n   * @param {number} loaded\n   * @param {number|undefined} total\n   */\n  onDataProgress(loaded, total) {\n    this.#capability.promise.then(() => {\n      for (const listener of this.#progressListeners) {\n        listener(loaded, total);\n      }\n    });\n  }\n\n  /**\n   * @param {Uint8Array|null} chunk\n   */\n  onDataProgressiveRead(chunk) {\n    this.#capability.promise.then(() => {\n      for (const listener of this.#progressiveReadListeners) {\n        listener(chunk);\n      }\n    });\n  }\n\n  onDataProgressiveDone() {\n    this.#capability.promise.then(() => {\n      for (const listener of this.#progressiveDoneListeners) {\n        listener();\n      }\n    });\n  }\n\n  transportReady() {\n    this.#capability.resolve();\n  }\n\n  /**\n   * @param {number} begin\n   * @param {number} end\n   */\n  requestDataRange(begin, end) {\n    unreachable(\"Abstract method PDFDataRangeTransport.requestDataRange\");\n  }\n\n  abort() {}\n}\n\n/**\n * Proxy to a `PDFDocument` in the worker thread.\n */\nclass PDFDocumentProxy {\n  constructor(pdfInfo, transport) {\n    this._pdfInfo = pdfInfo;\n    this._transport = transport;\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"getNetworkStreamName\", {\n        value: () => this._transport.getNetworkStreamName(),\n      });\n      Object.defineProperty(this, \"getXFADatasets\", {\n        value: () => this._transport.getXFADatasets(),\n      });\n      Object.defineProperty(this, \"getXRefPrevValue\", {\n        value: () => this._transport.getXRefPrevValue(),\n      });\n      Object.defineProperty(this, \"getStartXRefPos\", {\n        value: () => this._transport.getStartXRefPos(),\n      });\n      Object.defineProperty(this, \"getAnnotArray\", {\n        value: pageIndex => this._transport.getAnnotArray(pageIndex),\n      });\n    }\n  }\n\n  /**\n   * @type {AnnotationStorage} Storage for annotation data in forms.\n   */\n  get annotationStorage() {\n    return this._transport.annotationStorage;\n  }\n\n  /**\n   * @type {Object} The canvas factory instance.\n   */\n  get canvasFactory() {\n    return this._transport.canvasFactory;\n  }\n\n  /**\n   * @type {Object} The filter factory instance.\n   */\n  get filterFactory() {\n    return this._transport.filterFactory;\n  }\n\n  /**\n   * @type {number} Total number of pages in the PDF file.\n   */\n  get numPages() {\n    return this._pdfInfo.numPages;\n  }\n\n  /**\n   * @type {Array<string | null>} A (not guaranteed to be) unique ID to identify\n   *   the PDF document.\n   *   NOTE: The first element will always be defined for all PDF documents,\n   *   whereas the second element is only defined for *modified* PDF documents.\n   */\n  get fingerprints() {\n    return this._pdfInfo.fingerprints;\n  }\n\n  /**\n   * @type {boolean} True if only XFA form.\n   */\n  get isPureXfa() {\n    return shadow(this, \"isPureXfa\", !!this._transport._htmlForXfa);\n  }\n\n  /**\n   * NOTE: This is (mostly) intended to support printing of XFA forms.\n   *\n   * @type {Object | null} An object representing a HTML tree structure\n   *   to render the XFA, or `null` when no XFA form exists.\n   */\n  get allXfaHtml() {\n    return this._transport._htmlForXfa;\n  }\n\n  /**\n   * @param {number} pageNumber - The page number to get. The first page is 1.\n   * @returns {Promise<PDFPageProxy>} A promise that is resolved with\n   *   a {@link PDFPageProxy} object.\n   */\n  getPage(pageNumber) {\n    return this._transport.getPage(pageNumber);\n  }\n\n  /**\n   * @param {RefProxy} ref - The page reference.\n   * @returns {Promise<number>} A promise that is resolved with the page index,\n   *   starting from zero, that is associated with the reference.\n   */\n  getPageIndex(ref) {\n    return this._transport.getPageIndex(ref);\n  }\n\n  /**\n   * @returns {Promise<Object<string, Array<any>>>} A promise that is resolved\n   *   with a mapping from named destinations to references.\n   *\n   * This can be slow for large documents. Use `getDestination` instead.\n   */\n  getDestinations() {\n    return this._transport.getDestinations();\n  }\n\n  /**\n   * @param {string} id - The named destination to get.\n   * @returns {Promise<Array<any> | null>} A promise that is resolved with all\n   *   information of the given named destination, or `null` when the named\n   *   destination is not present in the PDF file.\n   */\n  getDestination(id) {\n    return this._transport.getDestination(id);\n  }\n\n  /**\n   * @returns {Promise<Array<string> | null>} A promise that is resolved with\n   *   an {Array} containing the page labels that correspond to the page\n   *   indexes, or `null` when no page labels are present in the PDF file.\n   */\n  getPageLabels() {\n    return this._transport.getPageLabels();\n  }\n\n  /**\n   * @returns {Promise<string>} A promise that is resolved with a {string}\n   *   containing the page layout name.\n   */\n  getPageLayout() {\n    return this._transport.getPageLayout();\n  }\n\n  /**\n   * @returns {Promise<string>} A promise that is resolved with a {string}\n   *   containing the page mode name.\n   */\n  getPageMode() {\n    return this._transport.getPageMode();\n  }\n\n  /**\n   * @returns {Promise<Object | null>} A promise that is resolved with an\n   *   {Object} containing the viewer preferences, or `null` when no viewer\n   *   preferences are present in the PDF file.\n   */\n  getViewerPreferences() {\n    return this._transport.getViewerPreferences();\n  }\n\n  /**\n   * @returns {Promise<any | null>} A promise that is resolved with an {Array}\n   *   containing the destination, or `null` when no open action is present\n   *   in the PDF.\n   */\n  getOpenAction() {\n    return this._transport.getOpenAction();\n  }\n\n  /**\n   * @returns {Promise<any>} A promise that is resolved with a lookup table\n   *   for mapping named attachments to their content.\n   */\n  getAttachments() {\n    return this._transport.getAttachments();\n  }\n\n  /**\n   * @returns {Promise<Object | null>} A promise that is resolved with\n   *   an {Object} with the JavaScript actions:\n   *     - from the name tree.\n   *     - from A or AA entries in the catalog dictionary.\n   *   , or `null` if no JavaScript exists.\n   */\n  getJSActions() {\n    return this._transport.getDocJSActions();\n  }\n\n  /**\n   * @typedef {Object} OutlineNode\n   * @property {string} title\n   * @property {boolean} bold\n   * @property {boolean} italic\n   * @property {Uint8ClampedArray} color - The color in RGB format to use for\n   *   display purposes.\n   * @property {string | Array<any> | null} dest\n   * @property {string | null} url\n   * @property {string | undefined} unsafeUrl\n   * @property {boolean | undefined} newWindow\n   * @property {number | undefined} count\n   * @property {Array<OutlineNode>} items\n   */\n\n  /**\n   * @returns {Promise<Array<OutlineNode>>} A promise that is resolved with an\n   *   {Array} that is a tree outline (if it has one) of the PDF file.\n   */\n  getOutline() {\n    return this._transport.getOutline();\n  }\n\n  /**\n   * @typedef {Object} GetOptionalContentConfigParameters\n   * @property {string} [intent] - Determines the optional content groups that\n   *   are visible by default; valid values are:\n   *    - 'display' (viewable groups).\n   *    - 'print' (printable groups).\n   *    - 'any' (all groups).\n   *   The default value is 'display'.\n   */\n\n  /**\n   * @param {GetOptionalContentConfigParameters} [params] - Optional content\n   *   config parameters.\n   * @returns {Promise<OptionalContentConfig>} A promise that is resolved with\n   *   an {@link OptionalContentConfig} that contains all the optional content\n   *   groups (assuming that the document has any).\n   */\n  getOptionalContentConfig({ intent = \"display\" } = {}) {\n    const { renderingIntent } = this._transport.getRenderingIntent(intent);\n\n    return this._transport.getOptionalContentConfig(renderingIntent);\n  }\n\n  /**\n   * @returns {Promise<Array<number> | null>} A promise that is resolved with\n   *   an {Array} that contains the permission flags for the PDF document, or\n   *   `null` when no permissions are present in the PDF file.\n   */\n  getPermissions() {\n    return this._transport.getPermissions();\n  }\n\n  /**\n   * @returns {Promise<{ info: Object, metadata: Metadata }>} A promise that is\n   *   resolved with an {Object} that has `info` and `metadata` properties.\n   *   `info` is an {Object} filled with anything available in the information\n   *   dictionary and similarly `metadata` is a {Metadata} object with\n   *   information from the metadata section of the PDF.\n   */\n  getMetadata() {\n    return this._transport.getMetadata();\n  }\n\n  /**\n   * @typedef {Object} MarkInfo\n   * Properties correspond to Table 321 of the PDF 32000-1:2008 spec.\n   * @property {boolean} Marked\n   * @property {boolean} UserProperties\n   * @property {boolean} Suspects\n   */\n\n  /**\n   * @returns {Promise<MarkInfo | null>} A promise that is resolved with\n   *   a {MarkInfo} object that contains the MarkInfo flags for the PDF\n   *   document, or `null` when no MarkInfo values are present in the PDF file.\n   */\n  getMarkInfo() {\n    return this._transport.getMarkInfo();\n  }\n\n  /**\n   * @returns {Promise<Uint8Array>} A promise that is resolved with a\n   *   {Uint8Array} containing the raw data of the PDF document.\n   */\n  getData() {\n    return this._transport.getData();\n  }\n\n  /**\n   * @returns {Promise<Uint8Array>} A promise that is resolved with a\n   *   {Uint8Array} containing the full data of the saved document.\n   */\n  saveDocument() {\n    return this._transport.saveDocument();\n  }\n\n  /**\n   * @returns {Promise<{ length: number }>} A promise that is resolved when the\n   *   document's data is loaded. It is resolved with an {Object} that contains\n   *   the `length` property that indicates size of the PDF data in bytes.\n   */\n  getDownloadInfo() {\n    return this._transport.downloadInfoCapability.promise;\n  }\n\n  /**\n   * Cleans up resources allocated by the document on both the main and worker\n   * threads.\n   *\n   * NOTE: Do not, under any circumstances, call this method when rendering is\n   * currently ongoing since that may lead to rendering errors.\n   *\n   * @param {boolean} [keepLoadedFonts] - Let fonts remain attached to the DOM.\n   *   NOTE: This will increase persistent memory usage, hence don't use this\n   *   option unless absolutely necessary. The default value is `false`.\n   * @returns {Promise} A promise that is resolved when clean-up has finished.\n   */\n  cleanup(keepLoadedFonts = false) {\n    return this._transport.startCleanup(keepLoadedFonts || this.isPureXfa);\n  }\n\n  /**\n   * Destroys the current document instance and terminates the worker.\n   */\n  destroy() {\n    return this.loadingTask.destroy();\n  }\n\n  /**\n   * @param {RefProxy} ref - The page reference.\n   * @returns {number | null} The page number, if it's cached.\n   */\n  cachedPageNumber(ref) {\n    return this._transport.cachedPageNumber(ref);\n  }\n\n  /**\n   * @type {DocumentInitParameters} A subset of the current\n   *   {DocumentInitParameters}, which are needed in the viewer.\n   */\n  get loadingParams() {\n    return this._transport.loadingParams;\n  }\n\n  /**\n   * @type {PDFDocumentLoadingTask} The loadingTask for the current document.\n   */\n  get loadingTask() {\n    return this._transport.loadingTask;\n  }\n\n  /**\n   * @returns {Promise<Object<string, Array<Object>> | null>} A promise that is\n   *   resolved with an {Object} containing /AcroForm field data for the JS\n   *   sandbox, or `null` when no field data is present in the PDF file.\n   */\n  getFieldObjects() {\n    return this._transport.getFieldObjects();\n  }\n\n  /**\n   * @returns {Promise<boolean>} A promise that is resolved with `true`\n   *   if some /AcroForm fields have JavaScript actions.\n   */\n  hasJSActions() {\n    return this._transport.hasJSActions();\n  }\n\n  /**\n   * @returns {Promise<Array<string> | null>} A promise that is resolved with an\n   *   {Array<string>} containing IDs of annotations that have a calculation\n   *   action, or `null` when no such annotations are present in the PDF file.\n   */\n  getCalculationOrderIds() {\n    return this._transport.getCalculationOrderIds();\n  }\n}\n\n/**\n * Page getViewport parameters.\n *\n * @typedef {Object} GetViewportParameters\n * @property {number} scale - The desired scale of the viewport.\n * @property {number} [rotation] - The desired rotation, in degrees, of\n *   the viewport. If omitted it defaults to the page rotation.\n * @property {number} [offsetX] - The horizontal, i.e. x-axis, offset.\n *   The default value is `0`.\n * @property {number} [offsetY] - The vertical, i.e. y-axis, offset.\n *   The default value is `0`.\n * @property {boolean} [dontFlip] - If true, the y-axis will not be\n *   flipped. The default value is `false`.\n */\n\n/**\n * Page getTextContent parameters.\n *\n * @typedef {Object} getTextContentParameters\n * @property {boolean} [includeMarkedContent] - When true include marked\n *   content items in the items array of TextContent. The default is `false`.\n * @property {boolean} [disableNormalization] - When true the text is *not*\n *   normalized in the worker-thread. The default is `false`.\n */\n\n/**\n * Page text content.\n *\n * @typedef {Object} TextContent\n * @property {Array<TextItem | TextMarkedContent>} items - Array of\n *   {@link TextItem} and {@link TextMarkedContent} objects. TextMarkedContent\n *   items are included when includeMarkedContent is true.\n * @property {Object<string, TextStyle>} styles - {@link TextStyle} objects,\n *   indexed by font name.\n * @property {string | null} lang - The document /Lang attribute.\n */\n\n/**\n * Page text content part.\n *\n * @typedef {Object} TextItem\n * @property {string} str - Text content.\n * @property {string} dir - Text direction: 'ttb', 'ltr' or 'rtl'.\n * @property {Array<any>} transform - Transformation matrix.\n * @property {number} width - Width in device space.\n * @property {number} height - Height in device space.\n * @property {string} fontName - Font name used by PDF.js for converted font.\n * @property {boolean} hasEOL - Indicating if the text content is followed by a\n *   line-break.\n */\n\n/**\n * Page text marked content part.\n *\n * @typedef {Object} TextMarkedContent\n * @property {string} type - Either 'beginMarkedContent',\n *   'beginMarkedContentProps', or 'endMarkedContent'.\n * @property {string} id - The marked content identifier. Only used for type\n *   'beginMarkedContentProps'.\n */\n\n/**\n * Text style.\n *\n * @typedef {Object} TextStyle\n * @property {number} ascent - Font ascent.\n * @property {number} descent - Font descent.\n * @property {boolean} vertical - Whether or not the text is in vertical mode.\n * @property {string} fontFamily - The possible font family.\n */\n\n/**\n * Page annotation parameters.\n *\n * @typedef {Object} GetAnnotationsParameters\n * @property {string} [intent] - Determines the annotations that are fetched,\n *   can be 'display' (viewable annotations), 'print' (printable annotations),\n *   or 'any' (all annotations). The default value is 'display'.\n */\n\n/**\n * Page render parameters.\n *\n * @typedef {Object} RenderParameters\n * @property {CanvasRenderingContext2D} canvasContext - A 2D context of a DOM\n *   Canvas object.\n * @property {PageViewport} viewport - Rendering viewport obtained by calling\n *   the `PDFPageProxy.getViewport` method.\n * @property {string} [intent] - Rendering intent, can be 'display', 'print',\n *   or 'any'. The default value is 'display'.\n * @property {number} [annotationMode] Controls which annotations are rendered\n *   onto the canvas, for annotations with appearance-data; the values from\n *   {@link AnnotationMode} should be used. The following values are supported:\n *    - `AnnotationMode.DISABLE`, which disables all annotations.\n *    - `AnnotationMode.ENABLE`, which includes all possible annotations (thus\n *      it also depends on the `intent`-option, see above).\n *    - `AnnotationMode.ENABLE_FORMS`, which excludes annotations that contain\n *      interactive form elements (those will be rendered in the display layer).\n *    - `AnnotationMode.ENABLE_STORAGE`, which includes all possible annotations\n *      (as above) but where interactive form elements are updated with data\n *      from the {@link AnnotationStorage}-instance; useful e.g. for printing.\n *   The default value is `AnnotationMode.ENABLE`.\n * @property {Array<any>} [transform] - Additional transform, applied just\n *   before viewport transform.\n * @property {CanvasGradient | CanvasPattern | string} [background] - Background\n *   to use for the canvas.\n *   Any valid `canvas.fillStyle` can be used: a `DOMString` parsed as CSS\n *   <color> value, a `CanvasGradient` object (a linear or radial gradient) or\n *   a `CanvasPattern` object (a repetitive image). The default value is\n *   'rgb(255,255,255)'.\n *\n *   NOTE: This option may be partially, or completely, ignored when the\n *   `pageColors`-option is used.\n * @property {Object} [pageColors] - Overwrites background and foreground colors\n *   with user defined ones in order to improve readability in high contrast\n *   mode.\n * @property {Promise<OptionalContentConfig>} [optionalContentConfigPromise] -\n *   A promise that should resolve with an {@link OptionalContentConfig}\n *   created from `PDFDocumentProxy.getOptionalContentConfig`. If `null`,\n *   the configuration will be fetched automatically with the default visibility\n *   states set.\n * @property {Map<string, HTMLCanvasElement>} [annotationCanvasMap] - Map some\n *   annotation ids with canvases used to render them.\n * @property {PrintAnnotationStorage} [printAnnotationStorage]\n * @property {boolean} [isEditing] - Render the page in editing mode.\n */\n\n/**\n * Page getOperatorList parameters.\n *\n * @typedef {Object} GetOperatorListParameters\n * @property {string} [intent] - Rendering intent, can be 'display', 'print',\n *   or 'any'. The default value is 'display'.\n * @property {number} [annotationMode] Controls which annotations are included\n *   in the operatorList, for annotations with appearance-data; the values from\n *   {@link AnnotationMode} should be used. The following values are supported:\n *    - `AnnotationMode.DISABLE`, which disables all annotations.\n *    - `AnnotationMode.ENABLE`, which includes all possible annotations (thus\n *      it also depends on the `intent`-option, see above).\n *    - `AnnotationMode.ENABLE_FORMS`, which excludes annotations that contain\n *      interactive form elements (those will be rendered in the display layer).\n *    - `AnnotationMode.ENABLE_STORAGE`, which includes all possible annotations\n *      (as above) but where interactive form elements are updated with data\n *      from the {@link AnnotationStorage}-instance; useful e.g. for printing.\n *   The default value is `AnnotationMode.ENABLE`.\n * @property {PrintAnnotationStorage} [printAnnotationStorage]\n * @property {boolean} [isEditing] - Render the page in editing mode.\n */\n\n/**\n * Structure tree node. The root node will have a role \"Root\".\n *\n * @typedef {Object} StructTreeNode\n * @property {Array<StructTreeNode | StructTreeContent>} children - Array of\n *   {@link StructTreeNode} and {@link StructTreeContent} objects.\n * @property {string} role - element's role, already mapped if a role map exists\n * in the PDF.\n */\n\n/**\n * Structure tree content.\n *\n * @typedef {Object} StructTreeContent\n * @property {string} type - either \"content\" for page and stream structure\n *   elements or \"object\" for object references.\n * @property {string} id - unique id that will map to the text layer.\n */\n\n/**\n * PDF page operator list.\n *\n * @typedef {Object} PDFOperatorList\n * @property {Array<number>} fnArray - Array containing the operator functions.\n * @property {Array<any>} argsArray - Array containing the arguments of the\n *   functions.\n */\n\n/**\n * Proxy to a `PDFPage` in the worker thread.\n */\nclass PDFPageProxy {\n  #pendingCleanup = false;\n\n  constructor(pageIndex, pageInfo, transport, pdfBug = false) {\n    this._pageIndex = pageIndex;\n    this._pageInfo = pageInfo;\n    this._transport = transport;\n    this._stats = pdfBug ? new StatTimer() : null;\n    this._pdfBug = pdfBug;\n    /** @type {PDFObjects} */\n    this.commonObjs = transport.commonObjs;\n    this.objs = new PDFObjects();\n\n    this._intentStates = new Map();\n    this.destroyed = false;\n  }\n\n  /**\n   * @type {number} Page number of the page. First page is 1.\n   */\n  get pageNumber() {\n    return this._pageIndex + 1;\n  }\n\n  /**\n   * @type {number} The number of degrees the page is rotated clockwise.\n   */\n  get rotate() {\n    return this._pageInfo.rotate;\n  }\n\n  /**\n   * @type {RefProxy | null} The reference that points to this page.\n   */\n  get ref() {\n    return this._pageInfo.ref;\n  }\n\n  /**\n   * @type {number} The default size of units in 1/72nds of an inch.\n   */\n  get userUnit() {\n    return this._pageInfo.userUnit;\n  }\n\n  /**\n   * @type {Array<number>} An array of the visible portion of the PDF page in\n   *   user space units [x1, y1, x2, y2].\n   */\n  get view() {\n    return this._pageInfo.view;\n  }\n\n  /**\n   * @param {GetViewportParameters} params - Viewport parameters.\n   * @returns {PageViewport} Contains 'width' and 'height' properties\n   *   along with transforms required for rendering.\n   */\n  getViewport({\n    scale,\n    rotation = this.rotate,\n    offsetX = 0,\n    offsetY = 0,\n    dontFlip = false,\n  } = {}) {\n    return new PageViewport({\n      viewBox: this.view,\n      userUnit: this.userUnit,\n      scale,\n      rotation,\n      offsetX,\n      offsetY,\n      dontFlip,\n    });\n  }\n\n  /**\n   * @param {GetAnnotationsParameters} [params] - Annotation parameters.\n   * @returns {Promise<Array<any>>} A promise that is resolved with an\n   *   {Array} of the annotation objects.\n   */\n  getAnnotations({ intent = \"display\" } = {}) {\n    const { renderingIntent } = this._transport.getRenderingIntent(intent);\n\n    return this._transport.getAnnotations(this._pageIndex, renderingIntent);\n  }\n\n  /**\n   * @returns {Promise<Object>} A promise that is resolved with an\n   *   {Object} with JS actions.\n   */\n  getJSActions() {\n    return this._transport.getPageJSActions(this._pageIndex);\n  }\n\n  /**\n   * @type {Object} The filter factory instance.\n   */\n  get filterFactory() {\n    return this._transport.filterFactory;\n  }\n\n  /**\n   * @type {boolean} True if only XFA form.\n   */\n  get isPureXfa() {\n    return shadow(this, \"isPureXfa\", !!this._transport._htmlForXfa);\n  }\n\n  /**\n   * @returns {Promise<Object | null>} A promise that is resolved with\n   *   an {Object} with a fake DOM object (a tree structure where elements\n   *   are {Object} with a name, attributes (class, style, ...), value and\n   *   children, very similar to a HTML DOM tree), or `null` if no XFA exists.\n   */\n  async getXfa() {\n    return this._transport._htmlForXfa?.children[this._pageIndex] || null;\n  }\n\n  /**\n   * Begins the process of rendering a page to the desired context.\n   *\n   * @param {RenderParameters} params - Page render parameters.\n   * @returns {RenderTask} An object that contains a promise that is\n   *   resolved when the page finishes rendering.\n   */\n  render({\n    canvasContext,\n    viewport,\n    intent = \"display\",\n    annotationMode = AnnotationMode.ENABLE,\n    transform = null,\n    background = null,\n    optionalContentConfigPromise = null,\n    annotationCanvasMap = null,\n    pageColors = null,\n    printAnnotationStorage = null,\n    isEditing = false,\n  }) {\n    this._stats?.time(\"Overall\");\n\n    const intentArgs = this._transport.getRenderingIntent(\n      intent,\n      annotationMode,\n      printAnnotationStorage,\n      isEditing\n    );\n    const { renderingIntent, cacheKey } = intentArgs;\n    // If there was a pending destroy, cancel it so no cleanup happens during\n    // this call to render.\n    this.#pendingCleanup = false;\n\n    optionalContentConfigPromise ||=\n      this._transport.getOptionalContentConfig(renderingIntent);\n\n    let intentState = this._intentStates.get(cacheKey);\n    if (!intentState) {\n      intentState = Object.create(null);\n      this._intentStates.set(cacheKey, intentState);\n    }\n\n    // Ensure that a pending `streamReader` cancel timeout is always aborted.\n    if (intentState.streamReaderCancelTimeout) {\n      clearTimeout(intentState.streamReaderCancelTimeout);\n      intentState.streamReaderCancelTimeout = null;\n    }\n\n    const intentPrint = !!(renderingIntent & RenderingIntentFlag.PRINT);\n\n    // If there's no displayReadyCapability yet, then the operatorList\n    // was never requested before. Make the request and create the promise.\n    if (!intentState.displayReadyCapability) {\n      intentState.displayReadyCapability = Promise.withResolvers();\n      intentState.operatorList = {\n        fnArray: [],\n        argsArray: [],\n        lastChunk: false,\n        separateAnnots: null,\n      };\n\n      this._stats?.time(\"Page Request\");\n      this._pumpOperatorList(intentArgs);\n    }\n\n    const complete = error => {\n      intentState.renderTasks.delete(internalRenderTask);\n\n      // Attempt to reduce memory usage during *printing*, by always running\n      // cleanup immediately once rendering has finished.\n      if (intentPrint) {\n        this.#pendingCleanup = true;\n      }\n      this.#tryCleanup();\n\n      if (error) {\n        internalRenderTask.capability.reject(error);\n\n        this._abortOperatorList({\n          intentState,\n          reason: error instanceof Error ? error : new Error(error),\n        });\n      } else {\n        internalRenderTask.capability.resolve();\n      }\n\n      if (this._stats) {\n        this._stats.timeEnd(\"Rendering\");\n        this._stats.timeEnd(\"Overall\");\n\n        if (globalThis.Stats?.enabled) {\n          globalThis.Stats.add(this.pageNumber, this._stats);\n        }\n      }\n    };\n\n    const internalRenderTask = new InternalRenderTask({\n      callback: complete,\n      // Only include the required properties, and *not* the entire object.\n      params: {\n        canvasContext,\n        viewport,\n        transform,\n        background,\n      },\n      objs: this.objs,\n      commonObjs: this.commonObjs,\n      annotationCanvasMap,\n      operatorList: intentState.operatorList,\n      pageIndex: this._pageIndex,\n      canvasFactory: this._transport.canvasFactory,\n      filterFactory: this._transport.filterFactory,\n      useRequestAnimationFrame: !intentPrint,\n      pdfBug: this._pdfBug,\n      pageColors,\n    });\n\n    (intentState.renderTasks ||= new Set()).add(internalRenderTask);\n    const renderTask = internalRenderTask.task;\n\n    Promise.all([\n      intentState.displayReadyCapability.promise,\n      optionalContentConfigPromise,\n    ])\n      .then(([transparency, optionalContentConfig]) => {\n        if (this.destroyed) {\n          complete();\n          return;\n        }\n        this._stats?.time(\"Rendering\");\n\n        if (!(optionalContentConfig.renderingIntent & renderingIntent)) {\n          throw new Error(\n            \"Must use the same `intent`-argument when calling the `PDFPageProxy.render` \" +\n              \"and `PDFDocumentProxy.getOptionalContentConfig` methods.\"\n          );\n        }\n        internalRenderTask.initializeGraphics({\n          transparency,\n          optionalContentConfig,\n        });\n        internalRenderTask.operatorListChanged();\n      })\n      .catch(complete);\n\n    return renderTask;\n  }\n\n  /**\n   * @param {GetOperatorListParameters} params - Page getOperatorList\n   *   parameters.\n   * @returns {Promise<PDFOperatorList>} A promise resolved with an\n   *   {@link PDFOperatorList} object that represents the page's operator list.\n   */\n  getOperatorList({\n    intent = \"display\",\n    annotationMode = AnnotationMode.ENABLE,\n    printAnnotationStorage = null,\n    isEditing = false,\n  } = {}) {\n    if (typeof PDFJSDev !== \"undefined\" && !PDFJSDev.test(\"GENERIC\")) {\n      throw new Error(\"Not implemented: getOperatorList\");\n    }\n    function operatorListChanged() {\n      if (intentState.operatorList.lastChunk) {\n        intentState.opListReadCapability.resolve(intentState.operatorList);\n\n        intentState.renderTasks.delete(opListTask);\n      }\n    }\n\n    const intentArgs = this._transport.getRenderingIntent(\n      intent,\n      annotationMode,\n      printAnnotationStorage,\n      isEditing,\n      /* isOpList = */ true\n    );\n    let intentState = this._intentStates.get(intentArgs.cacheKey);\n    if (!intentState) {\n      intentState = Object.create(null);\n      this._intentStates.set(intentArgs.cacheKey, intentState);\n    }\n    let opListTask;\n\n    if (!intentState.opListReadCapability) {\n      opListTask = Object.create(null);\n      opListTask.operatorListChanged = operatorListChanged;\n      intentState.opListReadCapability = Promise.withResolvers();\n      (intentState.renderTasks ||= new Set()).add(opListTask);\n      intentState.operatorList = {\n        fnArray: [],\n        argsArray: [],\n        lastChunk: false,\n        separateAnnots: null,\n      };\n\n      this._stats?.time(\"Page Request\");\n      this._pumpOperatorList(intentArgs);\n    }\n    return intentState.opListReadCapability.promise;\n  }\n\n  /**\n   * NOTE: All occurrences of whitespace will be replaced by\n   * standard spaces (0x20).\n   *\n   * @param {getTextContentParameters} params - getTextContent parameters.\n   * @returns {ReadableStream} Stream for reading text content chunks.\n   */\n  streamTextContent({\n    includeMarkedContent = false,\n    disableNormalization = false,\n  } = {}) {\n    const TEXT_CONTENT_CHUNK_SIZE = 100;\n\n    return this._transport.messageHandler.sendWithStream(\n      \"GetTextContent\",\n      {\n        pageIndex: this._pageIndex,\n        includeMarkedContent: includeMarkedContent === true,\n        disableNormalization: disableNormalization === true,\n      },\n      {\n        highWaterMark: TEXT_CONTENT_CHUNK_SIZE,\n        size(textContent) {\n          return textContent.items.length;\n        },\n      }\n    );\n  }\n\n  /**\n   * NOTE: All occurrences of whitespace will be replaced by\n   * standard spaces (0x20).\n   *\n   * @param {getTextContentParameters} params - getTextContent parameters.\n   * @returns {Promise<TextContent>} A promise that is resolved with a\n   *   {@link TextContent} object that represents the page's text content.\n   */\n  getTextContent(params = {}) {\n    if (this._transport._htmlForXfa) {\n      // TODO: We need to revisit this once the XFA foreground patch lands and\n      // only do this for non-foreground XFA.\n      return this.getXfa().then(xfa => XfaText.textContent(xfa));\n    }\n    const readableStream = this.streamTextContent(params);\n\n    return new Promise(function (resolve, reject) {\n      function pump() {\n        reader.read().then(function ({ value, done }) {\n          if (done) {\n            resolve(textContent);\n            return;\n          }\n          textContent.lang ??= value.lang;\n          Object.assign(textContent.styles, value.styles);\n          textContent.items.push(...value.items);\n          pump();\n        }, reject);\n      }\n\n      const reader = readableStream.getReader();\n      const textContent = {\n        items: [],\n        styles: Object.create(null),\n        lang: null,\n      };\n      pump();\n    });\n  }\n\n  /**\n   * @returns {Promise<StructTreeNode>} A promise that is resolved with a\n   *   {@link StructTreeNode} object that represents the page's structure tree,\n   *   or `null` when no structure tree is present for the current page.\n   */\n  getStructTree() {\n    return this._transport.getStructTree(this._pageIndex);\n  }\n\n  /**\n   * Destroys the page object.\n   * @private\n   */\n  _destroy() {\n    this.destroyed = true;\n\n    const waitOn = [];\n    for (const intentState of this._intentStates.values()) {\n      this._abortOperatorList({\n        intentState,\n        reason: new Error(\"Page was destroyed.\"),\n        force: true,\n      });\n\n      if (intentState.opListReadCapability) {\n        // Avoid errors below, since the renderTasks are just stubs.\n        continue;\n      }\n      for (const internalRenderTask of intentState.renderTasks) {\n        waitOn.push(internalRenderTask.completed);\n        internalRenderTask.cancel();\n      }\n    }\n    this.objs.clear();\n    this.#pendingCleanup = false;\n\n    return Promise.all(waitOn);\n  }\n\n  /**\n   * Cleans up resources allocated by the page.\n   *\n   * @param {boolean} [resetStats] - Reset page stats, if enabled.\n   *   The default value is `false`.\n   * @returns {boolean} Indicates if clean-up was successfully run.\n   */\n  cleanup(resetStats = false) {\n    this.#pendingCleanup = true;\n    const success = this.#tryCleanup();\n\n    if (resetStats && success) {\n      this._stats &&= new StatTimer();\n    }\n    return success;\n  }\n\n  /**\n   * Attempts to clean up if rendering is in a state where that's possible.\n   * @returns {boolean} Indicates if clean-up was successfully run.\n   */\n  #tryCleanup() {\n    if (!this.#pendingCleanup || this.destroyed) {\n      return false;\n    }\n    for (const { renderTasks, operatorList } of this._intentStates.values()) {\n      if (renderTasks.size > 0 || !operatorList.lastChunk) {\n        return false;\n      }\n    }\n    this._intentStates.clear();\n    this.objs.clear();\n    this.#pendingCleanup = false;\n    return true;\n  }\n\n  /**\n   * @private\n   */\n  _startRenderPage(transparency, cacheKey) {\n    const intentState = this._intentStates.get(cacheKey);\n    if (!intentState) {\n      return; // Rendering was cancelled.\n    }\n    this._stats?.timeEnd(\"Page Request\");\n\n    // TODO Refactor RenderPageRequest to separate rendering\n    // and operator list logic\n    intentState.displayReadyCapability?.resolve(transparency);\n  }\n\n  /**\n   * @private\n   */\n  _renderPageChunk(operatorListChunk, intentState) {\n    // Add the new chunk to the current operator list.\n    for (let i = 0, ii = operatorListChunk.length; i < ii; i++) {\n      intentState.operatorList.fnArray.push(operatorListChunk.fnArray[i]);\n      intentState.operatorList.argsArray.push(operatorListChunk.argsArray[i]);\n    }\n    intentState.operatorList.lastChunk = operatorListChunk.lastChunk;\n    intentState.operatorList.separateAnnots = operatorListChunk.separateAnnots;\n\n    // Notify all the rendering tasks there are more operators to be consumed.\n    for (const internalRenderTask of intentState.renderTasks) {\n      internalRenderTask.operatorListChanged();\n    }\n\n    if (operatorListChunk.lastChunk) {\n      this.#tryCleanup();\n    }\n  }\n\n  /**\n   * @private\n   */\n  _pumpOperatorList({\n    renderingIntent,\n    cacheKey,\n    annotationStorageSerializable,\n    modifiedIds,\n  }) {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        Number.isInteger(renderingIntent) && renderingIntent > 0,\n        '_pumpOperatorList: Expected valid \"renderingIntent\" argument.'\n      );\n    }\n    const { map, transfer } = annotationStorageSerializable;\n\n    const readableStream = this._transport.messageHandler.sendWithStream(\n      \"GetOperatorList\",\n      {\n        pageIndex: this._pageIndex,\n        intent: renderingIntent,\n        cacheKey,\n        annotationStorage: map,\n        modifiedIds,\n      },\n      transfer\n    );\n    const reader = readableStream.getReader();\n\n    const intentState = this._intentStates.get(cacheKey);\n    intentState.streamReader = reader;\n\n    const pump = () => {\n      reader.read().then(\n        ({ value, done }) => {\n          if (done) {\n            intentState.streamReader = null;\n            return;\n          }\n          if (this._transport.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          this._renderPageChunk(value, intentState);\n          pump();\n        },\n        reason => {\n          intentState.streamReader = null;\n\n          if (this._transport.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          if (intentState.operatorList) {\n            // Mark operator list as complete.\n            intentState.operatorList.lastChunk = true;\n\n            for (const internalRenderTask of intentState.renderTasks) {\n              internalRenderTask.operatorListChanged();\n            }\n            this.#tryCleanup();\n          }\n\n          if (intentState.displayReadyCapability) {\n            intentState.displayReadyCapability.reject(reason);\n          } else if (intentState.opListReadCapability) {\n            intentState.opListReadCapability.reject(reason);\n          } else {\n            throw reason;\n          }\n        }\n      );\n    };\n    pump();\n  }\n\n  /**\n   * @private\n   */\n  _abortOperatorList({ intentState, reason, force = false }) {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        reason instanceof Error,\n        '_abortOperatorList: Expected valid \"reason\" argument.'\n      );\n    }\n\n    if (!intentState.streamReader) {\n      return;\n    }\n    // Ensure that a pending `streamReader` cancel timeout is always aborted.\n    if (intentState.streamReaderCancelTimeout) {\n      clearTimeout(intentState.streamReaderCancelTimeout);\n      intentState.streamReaderCancelTimeout = null;\n    }\n\n    if (!force) {\n      // Ensure that an Error occurring in *only* one `InternalRenderTask`, e.g.\n      // multiple render() calls on the same canvas, won't break all rendering.\n      if (intentState.renderTasks.size > 0) {\n        return;\n      }\n      // Don't immediately abort parsing on the worker-thread when rendering is\n      // cancelled, since that will unnecessarily delay re-rendering when (for\n      // partially parsed pages) e.g. zooming/rotation occurs in the viewer.\n      if (reason instanceof RenderingCancelledException) {\n        let delay = RENDERING_CANCELLED_TIMEOUT;\n        if (reason.extraDelay > 0 && reason.extraDelay < /* ms = */ 1000) {\n          // Above, we prevent the total delay from becoming arbitrarily large.\n          delay += reason.extraDelay;\n        }\n\n        intentState.streamReaderCancelTimeout = setTimeout(() => {\n          intentState.streamReaderCancelTimeout = null;\n          this._abortOperatorList({ intentState, reason, force: true });\n        }, delay);\n        return;\n      }\n    }\n    intentState.streamReader\n      .cancel(new AbortException(reason.message))\n      .catch(() => {\n        // Avoid \"Uncaught promise\" messages in the console.\n      });\n    intentState.streamReader = null;\n\n    if (this._transport.destroyed) {\n      return; // Ignore any pending requests if the worker was terminated.\n    }\n    // Remove the current `intentState`, since a cancelled `getOperatorList`\n    // call on the worker-thread cannot be re-started...\n    for (const [curCacheKey, curIntentState] of this._intentStates) {\n      if (curIntentState === intentState) {\n        this._intentStates.delete(curCacheKey);\n        break;\n      }\n    }\n    // ... and force clean-up to ensure that any old state is always removed.\n    this.cleanup();\n  }\n\n  /**\n   * @type {StatTimer | null} Returns page stats, if enabled; returns `null`\n   *   otherwise.\n   */\n  get stats() {\n    return this._stats;\n  }\n}\n\n/**\n * @typedef {Object} PDFWorkerParameters\n * @property {string} [name] - The name of the worker.\n * @property {Worker} [port] - The `workerPort` object.\n * @property {number} [verbosity] - Controls the logging level;\n *   the constants from {@link VerbosityLevel} should be used.\n */\n\n/**\n * PDF.js web worker abstraction that controls the instantiation of PDF\n * documents. Message handlers are used to pass information from the main\n * thread to the worker thread and vice versa. If the creation of a web\n * worker is not possible, a \"fake\" worker will be used instead.\n *\n * @param {PDFWorkerParameters} params - The worker initialization parameters.\n */\nclass PDFWorker {\n  #capability = Promise.withResolvers();\n\n  #messageHandler = null;\n\n  #port = null;\n\n  #webWorker = null;\n\n  static #fakeWorkerId = 0;\n\n  static #isWorkerDisabled = false;\n\n  static #workerPorts = new WeakMap();\n\n  static {\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"GENERIC\")) {\n      if (isNodeJS) {\n        // Workers aren't supported in Node.js, force-disabling them there.\n        this.#isWorkerDisabled = true;\n\n        GlobalWorkerOptions.workerSrc ||= PDFJSDev.test(\"LIB\")\n          ? \"../pdf.worker.js\"\n          : \"./pdf.worker.mjs\";\n      }\n\n      // Check if URLs have the same origin. For non-HTTP based URLs, returns\n      // false.\n      this._isSameOrigin = (baseUrl, otherUrl) => {\n        const base = URL.parse(baseUrl);\n        if (!base?.origin || base.origin === \"null\") {\n          return false; // non-HTTP url\n        }\n        const other = new URL(otherUrl, base);\n        return base.origin === other.origin;\n      };\n\n      this._createCDNWrapper = url => {\n        // We will rely on blob URL's property to specify origin.\n        // We want this function to fail in case if createObjectURL or Blob do\n        // not exist or fail for some reason -- our Worker creation will fail\n        // anyway.\n        const wrapper = `await import(\"${url}\");`;\n        return URL.createObjectURL(\n          new Blob([wrapper], { type: \"text/javascript\" })\n        );\n      };\n\n      this.fromPort = params => {\n        deprecated(\n          \"`PDFWorker.fromPort` - please use `PDFWorker.create` instead.\"\n        );\n        if (!params?.port) {\n          throw new Error(\"PDFWorker.fromPort - invalid method signature.\");\n        }\n        return this.create(params);\n      };\n    }\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      this._resetGlobalState = () => {\n        this.#isWorkerDisabled = false;\n        delete globalThis.pdfjsWorker;\n      };\n    }\n  }\n\n  constructor({\n    name = null,\n    port = null,\n    verbosity = getVerbosityLevel(),\n  } = {}) {\n    this.name = name;\n    this.destroyed = false;\n    this.verbosity = verbosity;\n\n    if (port) {\n      if (PDFWorker.#workerPorts.has(port)) {\n        throw new Error(\"Cannot use more than one PDFWorker per port.\");\n      }\n      PDFWorker.#workerPorts.set(port, this);\n      this.#initializeFromPort(port);\n    } else {\n      this.#initialize();\n    }\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"_webWorker\", {\n        get() {\n          return this.#webWorker;\n        },\n      });\n    }\n  }\n\n  /**\n   * Promise for worker initialization completion.\n   * @type {Promise<void>}\n   */\n  get promise() {\n    return this.#capability.promise;\n  }\n\n  #resolve() {\n    this.#capability.resolve();\n    // Send global setting, e.g. verbosity level.\n    this.#messageHandler.send(\"configure\", {\n      verbosity: this.verbosity,\n    });\n  }\n\n  /**\n   * The current `workerPort`, when it exists.\n   * @type {Worker}\n   */\n  get port() {\n    return this.#port;\n  }\n\n  /**\n   * The current MessageHandler-instance.\n   * @type {MessageHandler}\n   */\n  get messageHandler() {\n    return this.#messageHandler;\n  }\n\n  #initializeFromPort(port) {\n    this.#port = port;\n    this.#messageHandler = new MessageHandler(\"main\", \"worker\", port);\n    this.#messageHandler.on(\"ready\", () => {\n      // Ignoring \"ready\" event -- MessageHandler should already be initialized\n      // and ready to accept messages.\n    });\n    this.#resolve();\n  }\n\n  #initialize() {\n    // If worker support isn't disabled explicit and the browser has worker\n    // support, create a new web worker and test if it/the browser fulfills\n    // all requirements to run parts of pdf.js in a web worker.\n    // Right now, the requirement is, that an Uint8Array is still an\n    // Uint8Array as it arrives on the worker.\n    if (\n      PDFWorker.#isWorkerDisabled ||\n      PDFWorker.#mainThreadWorkerMessageHandler\n    ) {\n      this.#setupFakeWorker();\n      return;\n    }\n    let { workerSrc } = PDFWorker;\n\n    try {\n      // Wraps workerSrc path into blob URL, if the former does not belong\n      // to the same origin.\n      if (\n        typeof PDFJSDev !== \"undefined\" &&\n        PDFJSDev.test(\"GENERIC\") &&\n        !PDFWorker._isSameOrigin(window.location, workerSrc)\n      ) {\n        workerSrc = PDFWorker._createCDNWrapper(\n          new URL(workerSrc, window.location).href\n        );\n      }\n\n      const worker = new Worker(workerSrc, { type: \"module\" });\n      const messageHandler = new MessageHandler(\"main\", \"worker\", worker);\n      const terminateEarly = () => {\n        ac.abort();\n        messageHandler.destroy();\n        worker.terminate();\n        if (this.destroyed) {\n          this.#capability.reject(new Error(\"Worker was destroyed\"));\n        } else {\n          // Fall back to fake worker if the termination is caused by an\n          // error (e.g. NetworkError / SecurityError).\n          this.#setupFakeWorker();\n        }\n      };\n\n      const ac = new AbortController();\n      worker.addEventListener(\n        \"error\",\n        () => {\n          if (!this.#webWorker) {\n            // Worker failed to initialize due to an error. Clean up and fall\n            // back to the fake worker.\n            terminateEarly();\n          }\n        },\n        { signal: ac.signal }\n      );\n\n      messageHandler.on(\"test\", data => {\n        ac.abort();\n        if (this.destroyed || !data) {\n          terminateEarly();\n          return;\n        }\n        this.#messageHandler = messageHandler;\n        this.#port = worker;\n        this.#webWorker = worker;\n\n        this.#resolve();\n      });\n\n      messageHandler.on(\"ready\", data => {\n        ac.abort();\n        if (this.destroyed) {\n          terminateEarly();\n          return;\n        }\n        try {\n          sendTest();\n        } catch {\n          // We need fallback to a faked worker.\n          this.#setupFakeWorker();\n        }\n      });\n\n      const sendTest = () => {\n        const testObj = new Uint8Array();\n        // Ensure that we can use `postMessage` transfers.\n        messageHandler.send(\"test\", testObj, [testObj.buffer]);\n      };\n\n      // It might take time for the worker to initialize. We will try to send\n      // the \"test\" message immediately, and once the \"ready\" message arrives.\n      // The worker shall process only the first received \"test\" message.\n      sendTest();\n      return;\n    } catch {\n      info(\"The worker has been disabled.\");\n    }\n    // Either workers are not supported or have thrown an exception.\n    // Thus, we fallback to a faked worker.\n    this.#setupFakeWorker();\n  }\n\n  #setupFakeWorker() {\n    if (!PDFWorker.#isWorkerDisabled) {\n      warn(\"Setting up fake worker.\");\n      PDFWorker.#isWorkerDisabled = true;\n    }\n\n    PDFWorker._setupFakeWorkerGlobal\n      .then(WorkerMessageHandler => {\n        if (this.destroyed) {\n          this.#capability.reject(new Error(\"Worker was destroyed\"));\n          return;\n        }\n        const port = new LoopbackPort();\n        this.#port = port;\n\n        // All fake workers use the same port, making id unique.\n        const id = `fake${PDFWorker.#fakeWorkerId++}`;\n\n        // If the main thread is our worker, setup the handling for the\n        // messages -- the main thread sends to it self.\n        const workerHandler = new MessageHandler(id + \"_worker\", id, port);\n        WorkerMessageHandler.setup(workerHandler, port);\n\n        this.#messageHandler = new MessageHandler(id, id + \"_worker\", port);\n        this.#resolve();\n      })\n      .catch(reason => {\n        this.#capability.reject(\n          new Error(`Setting up fake worker failed: \"${reason.message}\".`)\n        );\n      });\n  }\n\n  /**\n   * Destroys the worker instance.\n   */\n  destroy() {\n    this.destroyed = true;\n\n    // We need to terminate only web worker created resource.\n    this.#webWorker?.terminate();\n    this.#webWorker = null;\n\n    PDFWorker.#workerPorts.delete(this.#port);\n    this.#port = null;\n\n    this.#messageHandler?.destroy();\n    this.#messageHandler = null;\n  }\n\n  /**\n   * @param {PDFWorkerParameters} params - The worker initialization parameters.\n   * @returns {PDFWorker}\n   */\n  static create(params) {\n    const cachedPort = this.#workerPorts.get(params?.port);\n    if (cachedPort) {\n      if (cachedPort._pendingDestroy) {\n        throw new Error(\n          \"PDFWorker.create - the worker is being destroyed.\\n\" +\n            \"Please remember to await `PDFDocumentLoadingTask.destroy()`-calls.\"\n        );\n      }\n      return cachedPort;\n    }\n    return new PDFWorker(params);\n  }\n\n  /**\n   * The current `workerSrc`, when it exists.\n   * @type {string}\n   */\n  static get workerSrc() {\n    if (GlobalWorkerOptions.workerSrc) {\n      return GlobalWorkerOptions.workerSrc;\n    }\n    throw new Error('No \"GlobalWorkerOptions.workerSrc\" specified.');\n  }\n\n  static get #mainThreadWorkerMessageHandler() {\n    try {\n      return globalThis.pdfjsWorker?.WorkerMessageHandler || null;\n    } catch {\n      return null;\n    }\n  }\n\n  // Loads worker code into the main-thread.\n  static get _setupFakeWorkerGlobal() {\n    const loader = async () => {\n      if (this.#mainThreadWorkerMessageHandler) {\n        // The worker was already loaded using e.g. a `<script>` tag.\n        return this.#mainThreadWorkerMessageHandler;\n      }\n      const worker =\n        typeof PDFJSDev === \"undefined\"\n          ? await import(\"pdfjs/pdf.worker.js\")\n          : await __raw_import__(this.workerSrc);\n      return worker.WorkerMessageHandler;\n    };\n\n    return shadow(this, \"_setupFakeWorkerGlobal\", loader());\n  }\n}\n\n/**\n * For internal use only.\n * @ignore\n */\nclass WorkerTransport {\n  #methodPromises = new Map();\n\n  #pageCache = new Map();\n\n  #pagePromises = new Map();\n\n  #pageRefCache = new Map();\n\n  #passwordCapability = null;\n\n  constructor(messageHandler, loadingTask, networkStream, params, factory) {\n    this.messageHandler = messageHandler;\n    this.loadingTask = loadingTask;\n    this.commonObjs = new PDFObjects();\n    this.fontLoader = new FontLoader({\n      ownerDocument: params.ownerDocument,\n      styleElement: params.styleElement,\n    });\n    this.loadingParams = params.loadingParams;\n    this._params = params;\n\n    this.canvasFactory = factory.canvasFactory;\n    this.filterFactory = factory.filterFactory;\n    this.cMapReaderFactory = factory.cMapReaderFactory;\n    this.standardFontDataFactory = factory.standardFontDataFactory;\n    this.wasmFactory = factory.wasmFactory;\n\n    this.destroyed = false;\n    this.destroyCapability = null;\n\n    this._networkStream = networkStream;\n    this._fullReader = null;\n    this._lastProgress = null;\n    this.downloadInfoCapability = Promise.withResolvers();\n\n    this.setupMessageHandler();\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"getNetworkStreamName\", {\n        value: () => networkStream?.constructor?.name || null,\n      });\n      Object.defineProperty(this, \"getXFADatasets\", {\n        value: () =>\n          this.messageHandler.sendWithPromise(\"GetXFADatasets\", null),\n      });\n      Object.defineProperty(this, \"getXRefPrevValue\", {\n        value: () =>\n          this.messageHandler.sendWithPromise(\"GetXRefPrevValue\", null),\n      });\n      Object.defineProperty(this, \"getStartXRefPos\", {\n        value: () =>\n          this.messageHandler.sendWithPromise(\"GetStartXRefPos\", null),\n      });\n      Object.defineProperty(this, \"getAnnotArray\", {\n        value: pageIndex =>\n          this.messageHandler.sendWithPromise(\"GetAnnotArray\", { pageIndex }),\n      });\n    }\n  }\n\n  #cacheSimpleMethod(name, data = null) {\n    const cachedPromise = this.#methodPromises.get(name);\n    if (cachedPromise) {\n      return cachedPromise;\n    }\n    const promise = this.messageHandler.sendWithPromise(name, data);\n\n    this.#methodPromises.set(name, promise);\n    return promise;\n  }\n\n  get annotationStorage() {\n    return shadow(this, \"annotationStorage\", new AnnotationStorage());\n  }\n\n  getRenderingIntent(\n    intent,\n    annotationMode = AnnotationMode.ENABLE,\n    printAnnotationStorage = null,\n    isEditing = false,\n    isOpList = false\n  ) {\n    let renderingIntent = RenderingIntentFlag.DISPLAY; // Default value.\n    let annotationStorageSerializable = SerializableEmpty;\n\n    switch (intent) {\n      case \"any\":\n        renderingIntent = RenderingIntentFlag.ANY;\n        break;\n      case \"display\":\n        break;\n      case \"print\":\n        renderingIntent = RenderingIntentFlag.PRINT;\n        break;\n      default:\n        warn(`getRenderingIntent - invalid intent: ${intent}`);\n    }\n\n    const annotationStorage =\n      renderingIntent & RenderingIntentFlag.PRINT &&\n      printAnnotationStorage instanceof PrintAnnotationStorage\n        ? printAnnotationStorage\n        : this.annotationStorage;\n\n    switch (annotationMode) {\n      case AnnotationMode.DISABLE:\n        renderingIntent += RenderingIntentFlag.ANNOTATIONS_DISABLE;\n        break;\n      case AnnotationMode.ENABLE:\n        break;\n      case AnnotationMode.ENABLE_FORMS:\n        renderingIntent += RenderingIntentFlag.ANNOTATIONS_FORMS;\n        break;\n      case AnnotationMode.ENABLE_STORAGE:\n        renderingIntent += RenderingIntentFlag.ANNOTATIONS_STORAGE;\n\n        annotationStorageSerializable = annotationStorage.serializable;\n        break;\n      default:\n        warn(`getRenderingIntent - invalid annotationMode: ${annotationMode}`);\n    }\n\n    if (isEditing) {\n      renderingIntent += RenderingIntentFlag.IS_EDITING;\n    }\n    if (isOpList) {\n      renderingIntent += RenderingIntentFlag.OPLIST;\n    }\n\n    const { ids: modifiedIds, hash: modifiedIdsHash } =\n      annotationStorage.modifiedIds;\n\n    const cacheKeyBuf = [\n      renderingIntent,\n      annotationStorageSerializable.hash,\n      modifiedIdsHash,\n    ];\n\n    return {\n      renderingIntent,\n      cacheKey: cacheKeyBuf.join(\"_\"),\n      annotationStorageSerializable,\n      modifiedIds,\n    };\n  }\n\n  destroy() {\n    if (this.destroyCapability) {\n      return this.destroyCapability.promise;\n    }\n\n    this.destroyed = true;\n    this.destroyCapability = Promise.withResolvers();\n\n    this.#passwordCapability?.reject(\n      new Error(\"Worker was destroyed during onPassword callback\")\n    );\n\n    const waitOn = [];\n    // We need to wait for all renderings to be completed, e.g.\n    // timeout/rAF can take a long time.\n    for (const page of this.#pageCache.values()) {\n      waitOn.push(page._destroy());\n    }\n    this.#pageCache.clear();\n    this.#pagePromises.clear();\n    this.#pageRefCache.clear();\n    // Allow `AnnotationStorage`-related clean-up when destroying the document.\n    if (this.hasOwnProperty(\"annotationStorage\")) {\n      this.annotationStorage.resetModified();\n    }\n    // We also need to wait for the worker to finish its long running tasks.\n    const terminated = this.messageHandler.sendWithPromise(\"Terminate\", null);\n    waitOn.push(terminated);\n\n    Promise.all(waitOn).then(() => {\n      this.commonObjs.clear();\n      this.fontLoader.clear();\n      this.#methodPromises.clear();\n      this.filterFactory.destroy();\n      TextLayer.cleanup();\n\n      this._networkStream?.cancelAllRequests(\n        new AbortException(\"Worker was terminated.\")\n      );\n\n      this.messageHandler?.destroy();\n      this.messageHandler = null;\n\n      this.destroyCapability.resolve();\n    }, this.destroyCapability.reject);\n    return this.destroyCapability.promise;\n  }\n\n  setupMessageHandler() {\n    const { messageHandler, loadingTask } = this;\n\n    messageHandler.on(\"GetReader\", (data, sink) => {\n      assert(\n        this._networkStream,\n        \"GetReader - no `IPDFStream` instance available.\"\n      );\n      this._fullReader = this._networkStream.getFullReader();\n      this._fullReader.onProgress = evt => {\n        this._lastProgress = {\n          loaded: evt.loaded,\n          total: evt.total,\n        };\n      };\n      sink.onPull = () => {\n        this._fullReader\n          .read()\n          .then(function ({ value, done }) {\n            if (done) {\n              sink.close();\n              return;\n            }\n            assert(\n              value instanceof ArrayBuffer,\n              \"GetReader - expected an ArrayBuffer.\"\n            );\n            // Enqueue data chunk into sink, and transfer it\n            // to other side as `Transferable` object.\n            sink.enqueue(new Uint8Array(value), 1, [value]);\n          })\n          .catch(reason => {\n            sink.error(reason);\n          });\n      };\n\n      sink.onCancel = reason => {\n        this._fullReader.cancel(reason);\n\n        sink.ready.catch(readyReason => {\n          if (this.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          throw readyReason;\n        });\n      };\n    });\n\n    messageHandler.on(\"ReaderHeadersReady\", async data => {\n      await this._fullReader.headersReady;\n\n      const { isStreamingSupported, isRangeSupported, contentLength } =\n        this._fullReader;\n\n      // If stream or range are disabled, it's our only way to report\n      // loading progress.\n      if (!isStreamingSupported || !isRangeSupported) {\n        if (this._lastProgress) {\n          loadingTask.onProgress?.(this._lastProgress);\n        }\n        this._fullReader.onProgress = evt => {\n          loadingTask.onProgress?.({\n            loaded: evt.loaded,\n            total: evt.total,\n          });\n        };\n      }\n\n      return { isStreamingSupported, isRangeSupported, contentLength };\n    });\n\n    messageHandler.on(\"GetRangeReader\", (data, sink) => {\n      assert(\n        this._networkStream,\n        \"GetRangeReader - no `IPDFStream` instance available.\"\n      );\n      const rangeReader = this._networkStream.getRangeReader(\n        data.begin,\n        data.end\n      );\n\n      // When streaming is enabled, it's possible that the data requested here\n      // has already been fetched via the `_fullRequestReader` implementation.\n      // However, given that the PDF data is loaded asynchronously on the\n      // main-thread and then sent via `postMessage` to the worker-thread,\n      // it may not have been available during parsing (hence the attempt to\n      // use range requests here).\n      //\n      // To avoid wasting time and resources here, we'll thus *not* dispatch\n      // range requests if the data was already loaded but has not been sent to\n      // the worker-thread yet (which will happen via the `_fullRequestReader`).\n      if (!rangeReader) {\n        sink.close();\n        return;\n      }\n\n      sink.onPull = () => {\n        rangeReader\n          .read()\n          .then(function ({ value, done }) {\n            if (done) {\n              sink.close();\n              return;\n            }\n            assert(\n              value instanceof ArrayBuffer,\n              \"GetRangeReader - expected an ArrayBuffer.\"\n            );\n            sink.enqueue(new Uint8Array(value), 1, [value]);\n          })\n          .catch(reason => {\n            sink.error(reason);\n          });\n      };\n\n      sink.onCancel = reason => {\n        rangeReader.cancel(reason);\n\n        sink.ready.catch(readyReason => {\n          if (this.destroyed) {\n            return; // Ignore any pending requests if the worker was terminated.\n          }\n          throw readyReason;\n        });\n      };\n    });\n\n    messageHandler.on(\"GetDoc\", ({ pdfInfo }) => {\n      this._numPages = pdfInfo.numPages;\n      this._htmlForXfa = pdfInfo.htmlForXfa;\n      delete pdfInfo.htmlForXfa;\n      loadingTask._capability.resolve(new PDFDocumentProxy(pdfInfo, this));\n    });\n\n    messageHandler.on(\"DocException\", ex => {\n      loadingTask._capability.reject(wrapReason(ex));\n    });\n\n    messageHandler.on(\"PasswordRequest\", ex => {\n      this.#passwordCapability = Promise.withResolvers();\n\n      try {\n        if (!loadingTask.onPassword) {\n          throw wrapReason(ex);\n        }\n\n        const updatePassword = password => {\n          if (password instanceof Error) {\n            this.#passwordCapability.reject(password);\n          } else {\n            this.#passwordCapability.resolve({ password });\n          }\n        };\n        loadingTask.onPassword(updatePassword, ex.code);\n      } catch (err) {\n        this.#passwordCapability.reject(err);\n      }\n      return this.#passwordCapability.promise;\n    });\n\n    messageHandler.on(\"DataLoaded\", data => {\n      // For consistency: Ensure that progress is always reported when the\n      // entire PDF file has been loaded, regardless of how it was fetched.\n      loadingTask.onProgress?.({\n        loaded: data.length,\n        total: data.length,\n      });\n\n      this.downloadInfoCapability.resolve(data);\n    });\n\n    messageHandler.on(\"StartRenderPage\", data => {\n      if (this.destroyed) {\n        return; // Ignore any pending requests if the worker was terminated.\n      }\n\n      const page = this.#pageCache.get(data.pageIndex);\n      page._startRenderPage(data.transparency, data.cacheKey);\n    });\n\n    messageHandler.on(\"commonobj\", ([id, type, exportedData]) => {\n      if (this.destroyed) {\n        return null; // Ignore any pending requests if the worker was terminated.\n      }\n\n      if (this.commonObjs.has(id)) {\n        return null;\n      }\n\n      switch (type) {\n        case \"Font\":\n          if (\"error\" in exportedData) {\n            const exportedError = exportedData.error;\n            warn(`Error during font loading: ${exportedError}`);\n            this.commonObjs.resolve(id, exportedError);\n            break;\n          }\n\n          const inspectFont =\n            this._params.pdfBug && globalThis.FontInspector?.enabled\n              ? (font, url) => globalThis.FontInspector.fontAdded(font, url)\n              : null;\n          const font = new FontFaceObject(exportedData, inspectFont);\n\n          this.fontLoader\n            .bind(font)\n            .catch(() => messageHandler.sendWithPromise(\"FontFallback\", { id }))\n            .finally(() => {\n              if (!font.fontExtraProperties && font.data) {\n                // Immediately release the `font.data` property once the font\n                // has been attached to the DOM, since it's no longer needed,\n                // rather than waiting for a `PDFDocumentProxy.cleanup` call.\n                // Since `font.data` could be very large, e.g. in some cases\n                // multiple megabytes, this will help reduce memory usage.\n                font.data = null;\n              }\n              this.commonObjs.resolve(id, font);\n            });\n          break;\n        case \"CopyLocalImage\":\n          const { imageRef } = exportedData;\n          assert(imageRef, \"The imageRef must be defined.\");\n\n          for (const pageProxy of this.#pageCache.values()) {\n            for (const [, data] of pageProxy.objs) {\n              if (data?.ref !== imageRef) {\n                continue;\n              }\n              if (!data.dataLen) {\n                return null;\n              }\n              this.commonObjs.resolve(id, structuredClone(data));\n              return data.dataLen;\n            }\n          }\n          break;\n        case \"FontPath\":\n        case \"Image\":\n        case \"Pattern\":\n          this.commonObjs.resolve(id, exportedData);\n          break;\n        default:\n          throw new Error(`Got unknown common object type ${type}`);\n      }\n\n      return null;\n    });\n\n    messageHandler.on(\"obj\", ([id, pageIndex, type, imageData]) => {\n      if (this.destroyed) {\n        // Ignore any pending requests if the worker was terminated.\n        return;\n      }\n\n      const pageProxy = this.#pageCache.get(pageIndex);\n      if (pageProxy.objs.has(id)) {\n        return;\n      }\n      // Don't store data *after* cleanup has successfully run, see bug 1854145.\n      if (pageProxy._intentStates.size === 0) {\n        imageData?.bitmap?.close(); // Release any `ImageBitmap` data.\n        return;\n      }\n\n      switch (type) {\n        case \"Image\":\n        case \"Pattern\":\n          pageProxy.objs.resolve(id, imageData);\n          break;\n        default:\n          throw new Error(`Got unknown object type ${type}`);\n      }\n    });\n\n    messageHandler.on(\"DocProgress\", data => {\n      if (this.destroyed) {\n        return; // Ignore any pending requests if the worker was terminated.\n      }\n      loadingTask.onProgress?.({\n        loaded: data.loaded,\n        total: data.total,\n      });\n    });\n\n    messageHandler.on(\"FetchBinaryData\", async data => {\n      if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"MOZCENTRAL\")) {\n        throw new Error(\"Not implemented: FetchBinaryData\");\n      }\n      if (this.destroyed) {\n        throw new Error(\"Worker was destroyed.\");\n      }\n      const factory = this[data.type];\n\n      if (!factory) {\n        throw new Error(\n          `${data.type} not initialized, see the \\`useWorkerFetch\\` parameter.`\n        );\n      }\n      return factory.fetch(data);\n    });\n  }\n\n  getData() {\n    return this.messageHandler.sendWithPromise(\"GetData\", null);\n  }\n\n  saveDocument() {\n    if (this.annotationStorage.size <= 0) {\n      warn(\n        \"saveDocument called while `annotationStorage` is empty, \" +\n          \"please use the getData-method instead.\"\n      );\n    }\n    const { map, transfer } = this.annotationStorage.serializable;\n\n    return this.messageHandler\n      .sendWithPromise(\n        \"SaveDocument\",\n        {\n          isPureXfa: !!this._htmlForXfa,\n          numPages: this._numPages,\n          annotationStorage: map,\n          filename: this._fullReader?.filename ?? null,\n        },\n        transfer\n      )\n      .finally(() => {\n        this.annotationStorage.resetModified();\n      });\n  }\n\n  getPage(pageNumber) {\n    if (\n      !Number.isInteger(pageNumber) ||\n      pageNumber <= 0 ||\n      pageNumber > this._numPages\n    ) {\n      return Promise.reject(new Error(\"Invalid page request.\"));\n    }\n\n    const pageIndex = pageNumber - 1,\n      cachedPromise = this.#pagePromises.get(pageIndex);\n    if (cachedPromise) {\n      return cachedPromise;\n    }\n    const promise = this.messageHandler\n      .sendWithPromise(\"GetPage\", {\n        pageIndex,\n      })\n      .then(pageInfo => {\n        if (this.destroyed) {\n          throw new Error(\"Transport destroyed\");\n        }\n        if (pageInfo.refStr) {\n          this.#pageRefCache.set(pageInfo.refStr, pageNumber);\n        }\n\n        const page = new PDFPageProxy(\n          pageIndex,\n          pageInfo,\n          this,\n          this._params.pdfBug\n        );\n        this.#pageCache.set(pageIndex, page);\n        return page;\n      });\n    this.#pagePromises.set(pageIndex, promise);\n    return promise;\n  }\n\n  getPageIndex(ref) {\n    if (!isRefProxy(ref)) {\n      return Promise.reject(new Error(\"Invalid pageIndex request.\"));\n    }\n    return this.messageHandler.sendWithPromise(\"GetPageIndex\", {\n      num: ref.num,\n      gen: ref.gen,\n    });\n  }\n\n  getAnnotations(pageIndex, intent) {\n    return this.messageHandler.sendWithPromise(\"GetAnnotations\", {\n      pageIndex,\n      intent,\n    });\n  }\n\n  getFieldObjects() {\n    return this.#cacheSimpleMethod(\"GetFieldObjects\");\n  }\n\n  hasJSActions() {\n    return this.#cacheSimpleMethod(\"HasJSActions\");\n  }\n\n  getCalculationOrderIds() {\n    return this.messageHandler.sendWithPromise(\"GetCalculationOrderIds\", null);\n  }\n\n  getDestinations() {\n    return this.messageHandler.sendWithPromise(\"GetDestinations\", null);\n  }\n\n  getDestination(id) {\n    if (typeof id !== \"string\") {\n      return Promise.reject(new Error(\"Invalid destination request.\"));\n    }\n    return this.messageHandler.sendWithPromise(\"GetDestination\", {\n      id,\n    });\n  }\n\n  getPageLabels() {\n    return this.messageHandler.sendWithPromise(\"GetPageLabels\", null);\n  }\n\n  getPageLayout() {\n    return this.messageHandler.sendWithPromise(\"GetPageLayout\", null);\n  }\n\n  getPageMode() {\n    return this.messageHandler.sendWithPromise(\"GetPageMode\", null);\n  }\n\n  getViewerPreferences() {\n    return this.messageHandler.sendWithPromise(\"GetViewerPreferences\", null);\n  }\n\n  getOpenAction() {\n    return this.messageHandler.sendWithPromise(\"GetOpenAction\", null);\n  }\n\n  getAttachments() {\n    return this.messageHandler.sendWithPromise(\"GetAttachments\", null);\n  }\n\n  getDocJSActions() {\n    return this.#cacheSimpleMethod(\"GetDocJSActions\");\n  }\n\n  getPageJSActions(pageIndex) {\n    return this.messageHandler.sendWithPromise(\"GetPageJSActions\", {\n      pageIndex,\n    });\n  }\n\n  getStructTree(pageIndex) {\n    return this.messageHandler.sendWithPromise(\"GetStructTree\", {\n      pageIndex,\n    });\n  }\n\n  getOutline() {\n    return this.messageHandler.sendWithPromise(\"GetOutline\", null);\n  }\n\n  getOptionalContentConfig(renderingIntent) {\n    return this.#cacheSimpleMethod(\"GetOptionalContentConfig\").then(\n      data => new OptionalContentConfig(data, renderingIntent)\n    );\n  }\n\n  getPermissions() {\n    return this.messageHandler.sendWithPromise(\"GetPermissions\", null);\n  }\n\n  getMetadata() {\n    const name = \"GetMetadata\",\n      cachedPromise = this.#methodPromises.get(name);\n    if (cachedPromise) {\n      return cachedPromise;\n    }\n    const promise = this.messageHandler\n      .sendWithPromise(name, null)\n      .then(results => ({\n        info: results[0],\n        metadata: results[1] ? new Metadata(results[1]) : null,\n        contentDispositionFilename: this._fullReader?.filename ?? null,\n        contentLength: this._fullReader?.contentLength ?? null,\n      }));\n    this.#methodPromises.set(name, promise);\n    return promise;\n  }\n\n  getMarkInfo() {\n    return this.messageHandler.sendWithPromise(\"GetMarkInfo\", null);\n  }\n\n  async startCleanup(keepLoadedFonts = false) {\n    if (this.destroyed) {\n      return; // No need to manually clean-up when destruction has started.\n    }\n    await this.messageHandler.sendWithPromise(\"Cleanup\", null);\n\n    for (const page of this.#pageCache.values()) {\n      const cleanupSuccessful = page.cleanup();\n\n      if (!cleanupSuccessful) {\n        throw new Error(\n          `startCleanup: Page ${page.pageNumber} is currently rendering.`\n        );\n      }\n    }\n    this.commonObjs.clear();\n    if (!keepLoadedFonts) {\n      this.fontLoader.clear();\n    }\n    this.#methodPromises.clear();\n    this.filterFactory.destroy(/* keepHCM = */ true);\n    TextLayer.cleanup();\n  }\n\n  cachedPageNumber(ref) {\n    if (!isRefProxy(ref)) {\n      return null;\n    }\n    const refStr = ref.gen === 0 ? `${ref.num}R` : `${ref.num}R${ref.gen}`;\n    return this.#pageRefCache.get(refStr) ?? null;\n  }\n}\n\n/**\n * Allows controlling of the rendering tasks.\n */\nclass RenderTask {\n  #internalRenderTask = null;\n\n  /**\n   * Callback for incremental rendering -- a function that will be called\n   * each time the rendering is paused.  To continue rendering call the\n   * function that is the first argument to the callback.\n   * @type {function}\n   */\n  onContinue = null;\n\n  /**\n   * A function that will be synchronously called when the rendering tasks\n   * finishes with an error (either because of an actual error, or because the\n   * rendering is cancelled).\n   *\n   * @type {function}\n   * @param {Error} error\n   */\n  onError = null;\n\n  constructor(internalRenderTask) {\n    this.#internalRenderTask = internalRenderTask;\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"getOperatorList\", {\n        value: () => this.#internalRenderTask.operatorList,\n      });\n    }\n  }\n\n  /**\n   * Promise for rendering task completion.\n   * @type {Promise<void>}\n   */\n  get promise() {\n    return this.#internalRenderTask.capability.promise;\n  }\n\n  /**\n   * Cancels the rendering task. If the task is currently rendering it will\n   * not be cancelled until graphics pauses with a timeout. The promise that\n   * this object extends will be rejected when cancelled.\n   *\n   * @param {number} [extraDelay]\n   */\n  cancel(extraDelay = 0) {\n    this.#internalRenderTask.cancel(/* error = */ null, extraDelay);\n  }\n\n  /**\n   * Whether form fields are rendered separately from the main operatorList.\n   * @type {boolean}\n   */\n  get separateAnnots() {\n    const { separateAnnots } = this.#internalRenderTask.operatorList;\n    if (!separateAnnots) {\n      return false;\n    }\n    const { annotationCanvasMap } = this.#internalRenderTask;\n    return (\n      separateAnnots.form ||\n      (separateAnnots.canvas && annotationCanvasMap?.size > 0)\n    );\n  }\n}\n\n/**\n * For internal use only.\n * @ignore\n */\nclass InternalRenderTask {\n  #rAF = null;\n\n  static #canvasInUse = new WeakSet();\n\n  constructor({\n    callback,\n    params,\n    objs,\n    commonObjs,\n    annotationCanvasMap,\n    operatorList,\n    pageIndex,\n    canvasFactory,\n    filterFactory,\n    useRequestAnimationFrame = false,\n    pdfBug = false,\n    pageColors = null,\n  }) {\n    this.callback = callback;\n    this.params = params;\n    this.objs = objs;\n    this.commonObjs = commonObjs;\n    this.annotationCanvasMap = annotationCanvasMap;\n    this.operatorListIdx = null;\n    this.operatorList = operatorList;\n    this._pageIndex = pageIndex;\n    this.canvasFactory = canvasFactory;\n    this.filterFactory = filterFactory;\n    this._pdfBug = pdfBug;\n    this.pageColors = pageColors;\n\n    this.running = false;\n    this.graphicsReadyCallback = null;\n    this.graphicsReady = false;\n    this._useRequestAnimationFrame =\n      useRequestAnimationFrame === true && typeof window !== \"undefined\";\n    this.cancelled = false;\n    this.capability = Promise.withResolvers();\n    this.task = new RenderTask(this);\n    // caching this-bound methods\n    this._cancelBound = this.cancel.bind(this);\n    this._continueBound = this._continue.bind(this);\n    this._scheduleNextBound = this._scheduleNext.bind(this);\n    this._nextBound = this._next.bind(this);\n    this._canvas = params.canvasContext.canvas;\n  }\n\n  get completed() {\n    return this.capability.promise.catch(function () {\n      // Ignoring errors, since we only want to know when rendering is\n      // no longer pending.\n    });\n  }\n\n  initializeGraphics({ transparency = false, optionalContentConfig }) {\n    if (this.cancelled) {\n      return;\n    }\n    if (this._canvas) {\n      if (InternalRenderTask.#canvasInUse.has(this._canvas)) {\n        throw new Error(\n          \"Cannot use the same canvas during multiple render() operations. \" +\n            \"Use different canvas or ensure previous operations were \" +\n            \"cancelled or completed.\"\n        );\n      }\n      InternalRenderTask.#canvasInUse.add(this._canvas);\n    }\n\n    if (this._pdfBug && globalThis.StepperManager?.enabled) {\n      this.stepper = globalThis.StepperManager.create(this._pageIndex);\n      this.stepper.init(this.operatorList);\n      this.stepper.nextBreakPoint = this.stepper.getNextBreakPoint();\n    }\n    const { canvasContext, viewport, transform, background } = this.params;\n\n    this.gfx = new CanvasGraphics(\n      canvasContext,\n      this.commonObjs,\n      this.objs,\n      this.canvasFactory,\n      this.filterFactory,\n      { optionalContentConfig },\n      this.annotationCanvasMap,\n      this.pageColors\n    );\n    this.gfx.beginDrawing({\n      transform,\n      viewport,\n      transparency,\n      background,\n    });\n    this.operatorListIdx = 0;\n    this.graphicsReady = true;\n    this.graphicsReadyCallback?.();\n  }\n\n  cancel(error = null, extraDelay = 0) {\n    this.running = false;\n    this.cancelled = true;\n    this.gfx?.endDrawing();\n    if (this.#rAF) {\n      window.cancelAnimationFrame(this.#rAF);\n      this.#rAF = null;\n    }\n    InternalRenderTask.#canvasInUse.delete(this._canvas);\n\n    error ||= new RenderingCancelledException(\n      `Rendering cancelled, page ${this._pageIndex + 1}`,\n      extraDelay\n    );\n    this.callback(error);\n\n    this.task.onError?.(error);\n  }\n\n  operatorListChanged() {\n    if (!this.graphicsReady) {\n      this.graphicsReadyCallback ||= this._continueBound;\n      return;\n    }\n    this.stepper?.updateOperatorList(this.operatorList);\n\n    if (this.running) {\n      return;\n    }\n    this._continue();\n  }\n\n  _continue() {\n    this.running = true;\n    if (this.cancelled) {\n      return;\n    }\n    if (this.task.onContinue) {\n      this.task.onContinue(this._scheduleNextBound);\n    } else {\n      this._scheduleNext();\n    }\n  }\n\n  _scheduleNext() {\n    if (this._useRequestAnimationFrame) {\n      this.#rAF = window.requestAnimationFrame(() => {\n        this.#rAF = null;\n        this._nextBound().catch(this._cancelBound);\n      });\n    } else {\n      Promise.resolve().then(this._nextBound).catch(this._cancelBound);\n    }\n  }\n\n  async _next() {\n    if (this.cancelled) {\n      return;\n    }\n    this.operatorListIdx = this.gfx.executeOperatorList(\n      this.operatorList,\n      this.operatorListIdx,\n      this._continueBound,\n      this.stepper\n    );\n    if (this.operatorListIdx === this.operatorList.argsArray.length) {\n      this.running = false;\n      if (this.operatorList.lastChunk) {\n        this.gfx.endDrawing();\n        InternalRenderTask.#canvasInUse.delete(this._canvas);\n\n        this.callback();\n      }\n    }\n  }\n}\n\n/** @type {string} */\nconst version =\n  typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_VERSION\") : null;\n/** @type {string} */\nconst build =\n  typeof PDFJSDev !== \"undefined\" ? PDFJSDev.eval(\"BUNDLE_BUILD\") : null;\n\nexport {\n  build,\n  getDocument,\n  PDFDataRangeTransport,\n  PDFDocumentLoadingTask,\n  PDFDocumentProxy,\n  PDFPageProxy,\n  PDFWorker,\n  RenderTask,\n  version,\n};\n","/* Copyright 2020 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * PLEASE NOTE: This file is currently imported in both the `../display/` and\n *              `../scripting_api/` folders, hence be EXTREMELY careful about\n *              introducing any dependencies here since that can lead to an\n *              unexpected/unnecessary size increase of the *built* files.\n */\n\nfunction makeColorComp(n) {\n  return Math.floor(Math.max(0, Math.min(1, n)) * 255)\n    .toString(16)\n    .padStart(2, \"0\");\n}\n\nfunction scaleAndClamp(x) {\n  return Math.max(0, Math.min(255, 255 * x));\n}\n\n// PDF specifications section 10.3\nclass ColorConverters {\n  static CMYK_G([c, y, m, k]) {\n    return [\"G\", 1 - Math.min(1, 0.3 * c + 0.59 * m + 0.11 * y + k)];\n  }\n\n  static G_CMYK([g]) {\n    return [\"CMYK\", 0, 0, 0, 1 - g];\n  }\n\n  static G_RGB([g]) {\n    return [\"RGB\", g, g, g];\n  }\n\n  static G_rgb([g]) {\n    g = scaleAndClamp(g);\n    return [g, g, g];\n  }\n\n  static G_HTML([g]) {\n    const G = makeColorComp(g);\n    return `#${G}${G}${G}`;\n  }\n\n  static RGB_G([r, g, b]) {\n    return [\"G\", 0.3 * r + 0.59 * g + 0.11 * b];\n  }\n\n  static RGB_rgb(color) {\n    return color.map(scaleAndClamp);\n  }\n\n  static RGB_HTML(color) {\n    return `#${color.map(makeColorComp).join(\"\")}`;\n  }\n\n  static T_HTML() {\n    return \"#00000000\";\n  }\n\n  static T_rgb() {\n    return [null];\n  }\n\n  static CMYK_RGB([c, y, m, k]) {\n    return [\n      \"RGB\",\n      1 - Math.min(1, c + k),\n      1 - Math.min(1, m + k),\n      1 - Math.min(1, y + k),\n    ];\n  }\n\n  static CMYK_rgb([c, y, m, k]) {\n    return [\n      scaleAndClamp(1 - Math.min(1, c + k)),\n      scaleAndClamp(1 - Math.min(1, m + k)),\n      scaleAndClamp(1 - Math.min(1, y + k)),\n    ];\n  }\n\n  static CMYK_HTML(components) {\n    const rgb = this.CMYK_RGB(components).slice(1);\n    return this.RGB_HTML(rgb);\n  }\n\n  static RGB_CMYK([r, g, b]) {\n    const c = 1 - r;\n    const m = 1 - g;\n    const y = 1 - b;\n    const k = Math.min(c, m, y);\n    return [\"CMYK\", c, m, y, k];\n  }\n}\n\nconst DateFormats = [\n  \"m/d\",\n  \"m/d/yy\",\n  \"mm/dd/yy\",\n  \"mm/yy\",\n  \"d-mmm\",\n  \"d-mmm-yy\",\n  \"dd-mmm-yy\",\n  \"yy-mm-dd\",\n  \"mmm-yy\",\n  \"mmmm-yy\",\n  \"mmm d, yyyy\",\n  \"mmmm d, yyyy\",\n  \"m/d/yy h:MM tt\",\n  \"m/d/yy HH:MM\",\n];\nconst TimeFormats = [\"HH:MM\", \"h:MM tt\", \"HH:MM:ss\", \"h:MM:ss tt\"];\n\nexport { ColorConverters, DateFormats, TimeFormats };\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { SVG_NS } from \"./display_utils.js\";\nimport { unreachable } from \"../shared/util.js\";\n\nclass BaseSVGFactory {\n  constructor() {\n    if (\n      (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) &&\n      this.constructor === BaseSVGFactory\n    ) {\n      unreachable(\"Cannot initialize BaseSVGFactory.\");\n    }\n  }\n\n  create(width, height, skipDimensions = false) {\n    if (width <= 0 || height <= 0) {\n      throw new Error(\"Invalid SVG dimensions\");\n    }\n    const svg = this._createSVG(\"svg:svg\");\n    svg.setAttribute(\"version\", \"1.1\");\n\n    if (!skipDimensions) {\n      svg.setAttribute(\"width\", `${width}px`);\n      svg.setAttribute(\"height\", `${height}px`);\n    }\n\n    svg.setAttribute(\"preserveAspectRatio\", \"none\");\n    svg.setAttribute(\"viewBox\", `0 0 ${width} ${height}`);\n\n    return svg;\n  }\n\n  createElement(type) {\n    if (typeof type !== \"string\") {\n      throw new Error(\"Invalid SVG element type\");\n    }\n    return this._createSVG(type);\n  }\n\n  /**\n   * @ignore\n   */\n  _createSVG(type) {\n    unreachable(\"Abstract method `_createSVG` called.\");\n  }\n}\n\nclass DOMSVGFactory extends BaseSVGFactory {\n  /**\n   * @ignore\n   */\n  _createSVG(type) {\n    return document.createElementNS(SVG_NS, type);\n  }\n}\n\nexport { BaseSVGFactory, DOMSVGFactory };\n","/* Copyright 2021 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_storage\").AnnotationStorage} AnnotationStorage */\n/** @typedef {import(\"./display_utils\").PageViewport} PageViewport */\n/** @typedef {import(\"../../web/interfaces\").IPDFLinkService} IPDFLinkService */\n\nimport { XfaText } from \"./xfa_text.js\";\n\n/**\n * @typedef {Object} XfaLayerParameters\n * @property {PageViewport} viewport\n * @property {HTMLDivElement} div\n * @property {Object} xfaHtml\n * @property {AnnotationStorage} [annotationStorage]\n * @property {IPDFLinkService} linkService\n * @property {string} [intent] - (default value is 'display').\n */\n\nclass XfaLayer {\n  static setupStorage(html, id, element, storage, intent) {\n    const storedData = storage.getValue(id, { value: null });\n    switch (element.name) {\n      case \"textarea\":\n        if (storedData.value !== null) {\n          html.textContent = storedData.value;\n        }\n        if (intent === \"print\") {\n          break;\n        }\n        html.addEventListener(\"input\", event => {\n          storage.setValue(id, { value: event.target.value });\n        });\n        break;\n      case \"input\":\n        if (\n          element.attributes.type === \"radio\" ||\n          element.attributes.type === \"checkbox\"\n        ) {\n          if (storedData.value === element.attributes.xfaOn) {\n            html.setAttribute(\"checked\", true);\n          } else if (storedData.value === element.attributes.xfaOff) {\n            // The checked attribute may have been set when opening the file,\n            // unset through the UI and we're here because of printing.\n            html.removeAttribute(\"checked\");\n          }\n          if (intent === \"print\") {\n            break;\n          }\n          html.addEventListener(\"change\", event => {\n            storage.setValue(id, {\n              value: event.target.checked\n                ? event.target.getAttribute(\"xfaOn\")\n                : event.target.getAttribute(\"xfaOff\"),\n            });\n          });\n        } else {\n          if (storedData.value !== null) {\n            html.setAttribute(\"value\", storedData.value);\n          }\n          if (intent === \"print\") {\n            break;\n          }\n          html.addEventListener(\"input\", event => {\n            storage.setValue(id, { value: event.target.value });\n          });\n        }\n        break;\n      case \"select\":\n        if (storedData.value !== null) {\n          html.setAttribute(\"value\", storedData.value);\n          for (const option of element.children) {\n            if (option.attributes.value === storedData.value) {\n              option.attributes.selected = true;\n            } else if (option.attributes.hasOwnProperty(\"selected\")) {\n              delete option.attributes.selected;\n            }\n          }\n        }\n        html.addEventListener(\"input\", event => {\n          const options = event.target.options;\n          const value =\n            options.selectedIndex === -1\n              ? \"\"\n              : options[options.selectedIndex].value;\n          storage.setValue(id, { value });\n        });\n        break;\n    }\n  }\n\n  static setAttributes({ html, element, storage = null, intent, linkService }) {\n    const { attributes } = element;\n    const isHTMLAnchorElement = html instanceof HTMLAnchorElement;\n\n    if (attributes.type === \"radio\") {\n      // Avoid to have a radio group when printing with the same as one\n      // already displayed.\n      attributes.name = `${attributes.name}-${intent}`;\n    }\n    for (const [key, value] of Object.entries(attributes)) {\n      if (value === null || value === undefined) {\n        continue;\n      }\n\n      switch (key) {\n        case \"class\":\n          if (value.length) {\n            html.setAttribute(key, value.join(\" \"));\n          }\n          break;\n        case \"dataId\":\n          // We don't need to add dataId in the html object but it can\n          // be useful to know its value when writing printing tests:\n          // in this case, don't skip dataId to have its value.\n          break;\n        case \"id\":\n          html.setAttribute(\"data-element-id\", value);\n          break;\n        case \"style\":\n          Object.assign(html.style, value);\n          break;\n        case \"textContent\":\n          html.textContent = value;\n          break;\n        default:\n          if (!isHTMLAnchorElement || (key !== \"href\" && key !== \"newWindow\")) {\n            html.setAttribute(key, value);\n          }\n      }\n    }\n\n    if (isHTMLAnchorElement) {\n      linkService.addLinkAttributes(\n        html,\n        attributes.href,\n        attributes.newWindow\n      );\n    }\n\n    // Set the value after the others to be sure to overwrite any other values.\n    if (storage && attributes.dataId) {\n      this.setupStorage(html, attributes.dataId, element, storage);\n    }\n  }\n\n  /**\n   * Render the XFA layer.\n   *\n   * @param {XfaLayerParameters} parameters\n   */\n  static render(parameters) {\n    const storage = parameters.annotationStorage;\n    const linkService = parameters.linkService;\n    const root = parameters.xfaHtml;\n    const intent = parameters.intent || \"display\";\n    const rootHtml = document.createElement(root.name);\n    if (root.attributes) {\n      this.setAttributes({\n        html: rootHtml,\n        element: root,\n        intent,\n        linkService,\n      });\n    }\n\n    const isNotForRichText = intent !== \"richText\";\n    const rootDiv = parameters.div;\n    rootDiv.append(rootHtml);\n\n    if (parameters.viewport) {\n      const transform = `matrix(${parameters.viewport.transform.join(\",\")})`;\n      rootDiv.style.transform = transform;\n    }\n\n    // Set defaults.\n    if (isNotForRichText) {\n      rootDiv.setAttribute(\"class\", \"xfaLayer xfaFont\");\n    }\n\n    // Text nodes used for the text highlighter.\n    const textDivs = [];\n\n    // In the rich text context, it's possible to just have a text node without\n    // a root element, so we handle this case here (see issue 17215).\n    if (root.children.length === 0) {\n      if (root.value) {\n        const node = document.createTextNode(root.value);\n        rootHtml.append(node);\n        if (isNotForRichText && XfaText.shouldBuildText(root.name)) {\n          textDivs.push(node);\n        }\n      }\n      return { textDivs };\n    }\n\n    const stack = [[root, -1, rootHtml]];\n\n    while (stack.length > 0) {\n      const [parent, i, html] = stack.at(-1);\n      if (i + 1 === parent.children.length) {\n        stack.pop();\n        continue;\n      }\n\n      const child = parent.children[++stack.at(-1)[1]];\n      if (child === null) {\n        continue;\n      }\n\n      const { name } = child;\n      if (name === \"#text\") {\n        const node = document.createTextNode(child.value);\n        textDivs.push(node);\n        html.append(node);\n        continue;\n      }\n\n      const childHtml = child?.attributes?.xmlns\n        ? document.createElementNS(child.attributes.xmlns, name)\n        : document.createElement(name);\n\n      html.append(childHtml);\n      if (child.attributes) {\n        this.setAttributes({\n          html: childHtml,\n          element: child,\n          storage,\n          intent,\n          linkService,\n        });\n      }\n\n      if (child.children?.length > 0) {\n        stack.push([child, -1, childHtml]);\n      } else if (child.value) {\n        const node = document.createTextNode(child.value);\n        if (isNotForRichText && XfaText.shouldBuildText(name)) {\n          textDivs.push(node);\n        }\n        childHtml.append(node);\n      }\n    }\n\n    /**\n     * TODO: re-enable that stuff once we've JS implementation.\n     * See https://bugzilla.mozilla.org/show_bug.cgi?id=1719465.\n     *\n     * for (const el of rootDiv.querySelectorAll(\n     * \".xfaDisabled input, .xfaDisabled textarea\"\n     * )) {\n     * el.setAttribute(\"disabled\", true);\n     * }\n     * for (const el of rootDiv.querySelectorAll(\n     * \".xfaReadOnly input, .xfaReadOnly textarea\"\n     * )) {\n     * el.setAttribute(\"readOnly\", true);\n     * }\n     */\n\n    for (const el of rootDiv.querySelectorAll(\n      \".xfaNonInteractive input, .xfaNonInteractive textarea\"\n    )) {\n      el.setAttribute(\"readOnly\", true);\n    }\n\n    return {\n      textDivs,\n    };\n  }\n\n  /**\n   * Update the XFA layer.\n   *\n   * @param {XfaLayerParameters} parameters\n   */\n  static update(parameters) {\n    const transform = `matrix(${parameters.viewport.transform.join(\",\")})`;\n    parameters.div.style.transform = transform;\n    parameters.div.hidden = false;\n  }\n}\n\nexport { XfaLayer };\n","/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** @typedef {import(\"./api\").PDFPageProxy} PDFPageProxy */\n/** @typedef {import(\"./display_utils\").PageViewport} PageViewport */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../web/text_accessibility.js\").TextAccessibilityManager} TextAccessibilityManager */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../web/interfaces\").IDownloadManager} IDownloadManager */\n/** @typedef {import(\"../../web/interfaces\").IPDFLinkService} IPDFLinkService */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/editor/tools.js\").AnnotationEditorUIManager} AnnotationEditorUIManager */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../web/struct_tree_layer_builder.js\").StructTreeLayerBuilder} StructTreeLayerBuilder */\n\nimport {\n  AnnotationBorderStyleType,\n  AnnotationEditorType,\n  AnnotationPrefix,\n  AnnotationType,\n  FeatureTest,\n  LINE_FACTOR,\n  shadow,\n  unreachable,\n  Util,\n  warn,\n} from \"../shared/util.js\";\nimport { PDFDateString, setLayerDimensions } from \"./display_utils.js\";\nimport { AnnotationStorage } from \"./annotation_storage.js\";\nimport { ColorConverters } from \"../shared/scripting_utils.js\";\nimport { DOMSVGFactory } from \"./svg_factory.js\";\nimport { XfaLayer } from \"./xfa_layer.js\";\n\nconst DEFAULT_FONT_SIZE = 9;\nconst GetElementsByNameSet = new WeakSet();\n\n/**\n * @typedef {Object} AnnotationElementParameters\n * @property {Object} data\n * @property {HTMLDivElement} layer\n * @property {IPDFLinkService} linkService\n * @property {IDownloadManager} [downloadManager]\n * @property {AnnotationStorage} [annotationStorage]\n * @property {string} [imageResourcesPath] - Path for image resources, mainly\n *   for annotation icons. Include trailing slash.\n * @property {boolean} renderForms\n * @property {Object} svgFactory\n * @property {boolean} [enableScripting]\n * @property {boolean} [hasJSActions]\n * @property {Object} [fieldObjects]\n */\n\nclass AnnotationElementFactory {\n  /**\n   * @param {AnnotationElementParameters} parameters\n   * @returns {AnnotationElement}\n   */\n  static create(parameters) {\n    const subtype = parameters.data.annotationType;\n\n    switch (subtype) {\n      case AnnotationType.LINK:\n        return new LinkAnnotationElement(parameters);\n\n      case AnnotationType.TEXT:\n        return new TextAnnotationElement(parameters);\n\n      case AnnotationType.WIDGET:\n        const fieldType = parameters.data.fieldType;\n\n        switch (fieldType) {\n          case \"Tx\":\n            return new TextWidgetAnnotationElement(parameters);\n          case \"Btn\":\n            if (parameters.data.radioButton) {\n              return new RadioButtonWidgetAnnotationElement(parameters);\n            } else if (parameters.data.checkBox) {\n              return new CheckboxWidgetAnnotationElement(parameters);\n            }\n            return new PushButtonWidgetAnnotationElement(parameters);\n          case \"Ch\":\n            return new ChoiceWidgetAnnotationElement(parameters);\n          case \"Sig\":\n            return new SignatureWidgetAnnotationElement(parameters);\n        }\n        return new WidgetAnnotationElement(parameters);\n\n      case AnnotationType.POPUP:\n        return new PopupAnnotationElement(parameters);\n\n      case AnnotationType.FREETEXT:\n        return new FreeTextAnnotationElement(parameters);\n\n      case AnnotationType.LINE:\n        return new LineAnnotationElement(parameters);\n\n      case AnnotationType.SQUARE:\n        return new SquareAnnotationElement(parameters);\n\n      case AnnotationType.CIRCLE:\n        return new CircleAnnotationElement(parameters);\n\n      case AnnotationType.POLYLINE:\n        return new PolylineAnnotationElement(parameters);\n\n      case AnnotationType.CARET:\n        return new CaretAnnotationElement(parameters);\n\n      case AnnotationType.INK:\n        return new InkAnnotationElement(parameters);\n\n      case AnnotationType.POLYGON:\n        return new PolygonAnnotationElement(parameters);\n\n      case AnnotationType.HIGHLIGHT:\n        return new HighlightAnnotationElement(parameters);\n\n      case AnnotationType.UNDERLINE:\n        return new UnderlineAnnotationElement(parameters);\n\n      case AnnotationType.SQUIGGLY:\n        return new SquigglyAnnotationElement(parameters);\n\n      case AnnotationType.STRIKEOUT:\n        return new StrikeOutAnnotationElement(parameters);\n\n      case AnnotationType.STAMP:\n        return new StampAnnotationElement(parameters);\n\n      case AnnotationType.FILEATTACHMENT:\n        return new FileAttachmentAnnotationElement(parameters);\n\n      default:\n        return new AnnotationElement(parameters);\n    }\n  }\n}\n\nclass AnnotationElement {\n  #updates = null;\n\n  #hasBorder = false;\n\n  #popupElement = null;\n\n  constructor(\n    parameters,\n    {\n      isRenderable = false,\n      ignoreBorder = false,\n      createQuadrilaterals = false,\n    } = {}\n  ) {\n    this.isRenderable = isRenderable;\n    this.data = parameters.data;\n    this.layer = parameters.layer;\n    this.linkService = parameters.linkService;\n    this.downloadManager = parameters.downloadManager;\n    this.imageResourcesPath = parameters.imageResourcesPath;\n    this.renderForms = parameters.renderForms;\n    this.svgFactory = parameters.svgFactory;\n    this.annotationStorage = parameters.annotationStorage;\n    this.enableScripting = parameters.enableScripting;\n    this.hasJSActions = parameters.hasJSActions;\n    this._fieldObjects = parameters.fieldObjects;\n    this.parent = parameters.parent;\n\n    if (isRenderable) {\n      this.container = this._createContainer(ignoreBorder);\n    }\n    if (createQuadrilaterals) {\n      this._createQuadrilaterals();\n    }\n  }\n\n  static _hasPopupData({ contentsObj, richText }) {\n    return !!(contentsObj?.str || richText?.str);\n  }\n\n  get _isEditable() {\n    return this.data.isEditable;\n  }\n\n  get hasPopupData() {\n    return AnnotationElement._hasPopupData(this.data);\n  }\n\n  updateEdited(params) {\n    if (!this.container) {\n      return;\n    }\n\n    this.#updates ||= {\n      rect: this.data.rect.slice(0),\n    };\n\n    const { rect } = params;\n\n    if (rect) {\n      this.#setRectEdited(rect);\n    }\n\n    this.#popupElement?.popup.updateEdited(params);\n  }\n\n  resetEdited() {\n    if (!this.#updates) {\n      return;\n    }\n    this.#setRectEdited(this.#updates.rect);\n    this.#popupElement?.popup.resetEdited();\n    this.#updates = null;\n  }\n\n  #setRectEdited(rect) {\n    const {\n      container: { style },\n      data: { rect: currentRect, rotation },\n      parent: {\n        viewport: {\n          rawDims: { pageWidth, pageHeight, pageX, pageY },\n        },\n      },\n    } = this;\n    currentRect?.splice(0, 4, ...rect);\n    style.left = `${(100 * (rect[0] - pageX)) / pageWidth}%`;\n    style.top = `${(100 * (pageHeight - rect[3] + pageY)) / pageHeight}%`;\n    if (rotation === 0) {\n      style.width = `${(100 * /* width = */ (rect[2] - rect[0])) / pageWidth}%`;\n      style.height = `${(100 * /* height = */ (rect[3] - rect[1])) / pageHeight}%`;\n    } else {\n      this.setRotation(rotation);\n    }\n  }\n\n  /**\n   * Create an empty container for the annotation's HTML element.\n   *\n   * @private\n   * @param {boolean} ignoreBorder\n   * @memberof AnnotationElement\n   * @returns {HTMLElement} A section element.\n   */\n  _createContainer(ignoreBorder) {\n    const {\n      data,\n      parent: { page, viewport },\n    } = this;\n\n    const container = document.createElement(\"section\");\n    container.setAttribute(\"data-annotation-id\", data.id);\n    if (!(this instanceof WidgetAnnotationElement)) {\n      container.tabIndex = 0;\n    }\n    const { style } = container;\n\n    // The accessibility manager will move the annotation in the DOM in\n    // order to match the visual ordering.\n    // But if an annotation is above an other one, then we must draw it\n    // after the other one whatever the order is in the DOM, hence the\n    // use of the z-index.\n    style.zIndex = this.parent.zIndex++;\n\n    if (data.alternativeText) {\n      container.title = data.alternativeText;\n    }\n\n    if (data.noRotate) {\n      container.classList.add(\"norotate\");\n    }\n\n    if (!data.rect || this instanceof PopupAnnotationElement) {\n      const { rotation } = data;\n      if (!data.hasOwnCanvas && rotation !== 0) {\n        this.setRotation(rotation, container);\n      }\n      return container;\n    }\n    const { width, height } = this;\n\n    if (!ignoreBorder && data.borderStyle.width > 0) {\n      style.borderWidth = `${data.borderStyle.width}px`;\n\n      const horizontalRadius = data.borderStyle.horizontalCornerRadius;\n      const verticalRadius = data.borderStyle.verticalCornerRadius;\n      if (horizontalRadius > 0 || verticalRadius > 0) {\n        const radius = `calc(${horizontalRadius}px * var(--total-scale-factor)) / calc(${verticalRadius}px * var(--total-scale-factor))`;\n        style.borderRadius = radius;\n      } else if (this instanceof RadioButtonWidgetAnnotationElement) {\n        const radius = `calc(${width}px * var(--total-scale-factor)) / calc(${height}px * var(--total-scale-factor))`;\n        style.borderRadius = radius;\n      }\n\n      switch (data.borderStyle.style) {\n        case AnnotationBorderStyleType.SOLID:\n          style.borderStyle = \"solid\";\n          break;\n\n        case AnnotationBorderStyleType.DASHED:\n          style.borderStyle = \"dashed\";\n          break;\n\n        case AnnotationBorderStyleType.BEVELED:\n          warn(\"Unimplemented border style: beveled\");\n          break;\n\n        case AnnotationBorderStyleType.INSET:\n          warn(\"Unimplemented border style: inset\");\n          break;\n\n        case AnnotationBorderStyleType.UNDERLINE:\n          style.borderBottomStyle = \"solid\";\n          break;\n\n        default:\n          break;\n      }\n\n      const borderColor = data.borderColor || null;\n      if (borderColor) {\n        this.#hasBorder = true;\n        style.borderColor = Util.makeHexColor(\n          borderColor[0] | 0,\n          borderColor[1] | 0,\n          borderColor[2] | 0\n        );\n      } else {\n        // Transparent (invisible) border, so do not draw it at all.\n        style.borderWidth = 0;\n      }\n    }\n\n    // Do *not* modify `data.rect`, since that will corrupt the annotation\n    // position on subsequent calls to `_createContainer` (see issue 6804).\n    const rect = Util.normalizeRect([\n      data.rect[0],\n      page.view[3] - data.rect[1] + page.view[1],\n      data.rect[2],\n      page.view[3] - data.rect[3] + page.view[1],\n    ]);\n    const { pageWidth, pageHeight, pageX, pageY } = viewport.rawDims;\n\n    style.left = `${(100 * (rect[0] - pageX)) / pageWidth}%`;\n    style.top = `${(100 * (rect[1] - pageY)) / pageHeight}%`;\n\n    const { rotation } = data;\n    if (data.hasOwnCanvas || rotation === 0) {\n      style.width = `${(100 * width) / pageWidth}%`;\n      style.height = `${(100 * height) / pageHeight}%`;\n    } else {\n      this.setRotation(rotation, container);\n    }\n\n    return container;\n  }\n\n  setRotation(angle, container = this.container) {\n    if (!this.data.rect) {\n      return;\n    }\n    const { pageWidth, pageHeight } = this.parent.viewport.rawDims;\n    let { width, height } = this;\n\n    if (angle % 180 !== 0) {\n      [width, height] = [height, width];\n    }\n    container.style.width = `${(100 * width) / pageWidth}%`;\n    container.style.height = `${(100 * height) / pageHeight}%`;\n\n    container.setAttribute(\"data-main-rotation\", (360 - angle) % 360);\n  }\n\n  get _commonActions() {\n    const setColor = (jsName, styleName, event) => {\n      const color = event.detail[jsName];\n      const colorType = color[0];\n      const colorArray = color.slice(1);\n      event.target.style[styleName] =\n        ColorConverters[`${colorType}_HTML`](colorArray);\n      this.annotationStorage.setValue(this.data.id, {\n        [styleName]: ColorConverters[`${colorType}_rgb`](colorArray),\n      });\n    };\n\n    return shadow(this, \"_commonActions\", {\n      display: event => {\n        const { display } = event.detail;\n        // See scripting/constants.js for the values of `Display`.\n        // 0 = visible, 1 = hidden, 2 = noPrint and 3 = noView.\n        const hidden = display % 2 === 1;\n        this.container.style.visibility = hidden ? \"hidden\" : \"visible\";\n        this.annotationStorage.setValue(this.data.id, {\n          noView: hidden,\n          noPrint: display === 1 || display === 2,\n        });\n      },\n      print: event => {\n        this.annotationStorage.setValue(this.data.id, {\n          noPrint: !event.detail.print,\n        });\n      },\n      hidden: event => {\n        const { hidden } = event.detail;\n        this.container.style.visibility = hidden ? \"hidden\" : \"visible\";\n        this.annotationStorage.setValue(this.data.id, {\n          noPrint: hidden,\n          noView: hidden,\n        });\n      },\n      focus: event => {\n        setTimeout(() => event.target.focus({ preventScroll: false }), 0);\n      },\n      userName: event => {\n        // tooltip\n        event.target.title = event.detail.userName;\n      },\n      readonly: event => {\n        event.target.disabled = event.detail.readonly;\n      },\n      required: event => {\n        this._setRequired(event.target, event.detail.required);\n      },\n      bgColor: event => {\n        setColor(\"bgColor\", \"backgroundColor\", event);\n      },\n      fillColor: event => {\n        setColor(\"fillColor\", \"backgroundColor\", event);\n      },\n      fgColor: event => {\n        setColor(\"fgColor\", \"color\", event);\n      },\n      textColor: event => {\n        setColor(\"textColor\", \"color\", event);\n      },\n      borderColor: event => {\n        setColor(\"borderColor\", \"borderColor\", event);\n      },\n      strokeColor: event => {\n        setColor(\"strokeColor\", \"borderColor\", event);\n      },\n      rotation: event => {\n        const angle = event.detail.rotation;\n        this.setRotation(angle);\n        this.annotationStorage.setValue(this.data.id, {\n          rotation: angle,\n        });\n      },\n    });\n  }\n\n  _dispatchEventFromSandbox(actions, jsEvent) {\n    const commonActions = this._commonActions;\n    for (const name of Object.keys(jsEvent.detail)) {\n      const action = actions[name] || commonActions[name];\n      action?.(jsEvent);\n    }\n  }\n\n  _setDefaultPropertiesFromJS(element) {\n    if (!this.enableScripting) {\n      return;\n    }\n\n    // Some properties may have been updated thanks to JS.\n    const storedData = this.annotationStorage.getRawValue(this.data.id);\n    if (!storedData) {\n      return;\n    }\n\n    const commonActions = this._commonActions;\n    for (const [actionName, detail] of Object.entries(storedData)) {\n      const action = commonActions[actionName];\n      if (action) {\n        const eventProxy = {\n          detail: {\n            [actionName]: detail,\n          },\n          target: element,\n        };\n        action(eventProxy);\n        // The action has been consumed: no need to keep it.\n        delete storedData[actionName];\n      }\n    }\n  }\n\n  /**\n   * Create quadrilaterals from the annotation's quadpoints.\n   *\n   * @private\n   * @memberof AnnotationElement\n   */\n  _createQuadrilaterals() {\n    if (!this.container) {\n      return;\n    }\n    const { quadPoints } = this.data;\n    if (!quadPoints) {\n      return;\n    }\n\n    const [rectBlX, rectBlY, rectTrX, rectTrY] = this.data.rect.map(x =>\n      Math.fround(x)\n    );\n\n    if (quadPoints.length === 8) {\n      const [trX, trY, blX, blY] = quadPoints.subarray(2, 6);\n      if (\n        rectTrX === trX &&\n        rectTrY === trY &&\n        rectBlX === blX &&\n        rectBlY === blY\n      ) {\n        // The quadpoints cover the whole annotation rectangle, so no need to\n        // create a quadrilateral.\n        return;\n      }\n    }\n\n    const { style } = this.container;\n    let svgBuffer;\n    if (this.#hasBorder) {\n      const { borderColor, borderWidth } = style;\n      style.borderWidth = 0;\n      svgBuffer = [\n        \"url('data:image/svg+xml;utf8,\",\n        `<svg xmlns=\"http://www.w3.org/2000/svg\"`,\n        ` preserveAspectRatio=\"none\" viewBox=\"0 0 1 1\">`,\n        `<g fill=\"transparent\" stroke=\"${borderColor}\" stroke-width=\"${borderWidth}\">`,\n      ];\n      this.container.classList.add(\"hasBorder\");\n    }\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      this.container.classList.add(\"hasClipPath\");\n    }\n\n    const width = rectTrX - rectBlX;\n    const height = rectTrY - rectBlY;\n\n    const { svgFactory } = this;\n    const svg = svgFactory.createElement(\"svg\");\n    svg.classList.add(\"quadrilateralsContainer\");\n    svg.setAttribute(\"width\", 0);\n    svg.setAttribute(\"height\", 0);\n    svg.role = \"none\";\n    const defs = svgFactory.createElement(\"defs\");\n    svg.append(defs);\n    const clipPath = svgFactory.createElement(\"clipPath\");\n    const id = `clippath_${this.data.id}`;\n    clipPath.setAttribute(\"id\", id);\n    clipPath.setAttribute(\"clipPathUnits\", \"objectBoundingBox\");\n    defs.append(clipPath);\n\n    for (let i = 2, ii = quadPoints.length; i < ii; i += 8) {\n      const trX = quadPoints[i];\n      const trY = quadPoints[i + 1];\n      const blX = quadPoints[i + 2];\n      const blY = quadPoints[i + 3];\n      const rect = svgFactory.createElement(\"rect\");\n      const x = (blX - rectBlX) / width;\n      const y = (rectTrY - trY) / height;\n      const rectWidth = (trX - blX) / width;\n      const rectHeight = (trY - blY) / height;\n      rect.setAttribute(\"x\", x);\n      rect.setAttribute(\"y\", y);\n      rect.setAttribute(\"width\", rectWidth);\n      rect.setAttribute(\"height\", rectHeight);\n      clipPath.append(rect);\n      svgBuffer?.push(\n        `<rect vector-effect=\"non-scaling-stroke\" x=\"${x}\" y=\"${y}\" width=\"${rectWidth}\" height=\"${rectHeight}\"/>`\n      );\n    }\n\n    if (this.#hasBorder) {\n      svgBuffer.push(`</g></svg>')`);\n      style.backgroundImage = svgBuffer.join(\"\");\n    }\n\n    this.container.append(svg);\n    this.container.style.clipPath = `url(#${id})`;\n  }\n\n  /**\n   * Create a popup for the annotation's HTML element. This is used for\n   * annotations that do not have a Popup entry in the dictionary, but\n   * are of a type that works with popups (such as Highlight annotations).\n   *\n   * @private\n   * @memberof AnnotationElement\n   */\n  _createPopup() {\n    const { data } = this;\n\n    const popup = (this.#popupElement = new PopupAnnotationElement({\n      data: {\n        color: data.color,\n        titleObj: data.titleObj,\n        modificationDate: data.modificationDate,\n        contentsObj: data.contentsObj,\n        richText: data.richText,\n        parentRect: data.rect,\n        borderStyle: 0,\n        id: `popup_${data.id}`,\n        rotation: data.rotation,\n        noRotate: true,\n      },\n      parent: this.parent,\n      elements: [this],\n    }));\n    this.parent.div.append(popup.render());\n  }\n\n  /**\n   * Render the annotation's HTML element(s).\n   *\n   * @public\n   * @memberof AnnotationElement\n   */\n  render() {\n    unreachable(\"Abstract method `AnnotationElement.render` called\");\n  }\n\n  /**\n   * @private\n   * @returns {Array}\n   */\n  _getElementsByName(name, skipId = null) {\n    const fields = [];\n\n    if (this._fieldObjects) {\n      const fieldObj = this._fieldObjects[name];\n      if (fieldObj) {\n        for (const { page, id, exportValues } of fieldObj) {\n          if (page === -1) {\n            continue;\n          }\n          if (id === skipId) {\n            continue;\n          }\n          const exportValue =\n            typeof exportValues === \"string\" ? exportValues : null;\n\n          const domElement = document.querySelector(\n            `[data-element-id=\"${id}\"]`\n          );\n          if (domElement && !GetElementsByNameSet.has(domElement)) {\n            warn(`_getElementsByName - element not allowed: ${id}`);\n            continue;\n          }\n          fields.push({ id, exportValue, domElement });\n        }\n      }\n      return fields;\n    }\n    // Fallback to a regular DOM lookup, to ensure that the standalone\n    // viewer components won't break.\n    for (const domElement of document.getElementsByName(name)) {\n      const { exportValue } = domElement;\n      const id = domElement.getAttribute(\"data-element-id\");\n      if (id === skipId) {\n        continue;\n      }\n      if (!GetElementsByNameSet.has(domElement)) {\n        continue;\n      }\n      fields.push({ id, exportValue, domElement });\n    }\n    return fields;\n  }\n\n  show() {\n    if (this.container) {\n      this.container.hidden = false;\n    }\n    this.popup?.maybeShow();\n  }\n\n  hide() {\n    if (this.container) {\n      this.container.hidden = true;\n    }\n    this.popup?.forceHide();\n  }\n\n  /**\n   * Get the HTML element(s) which can trigger a popup when clicked or hovered.\n   *\n   * @public\n   * @memberof AnnotationElement\n   * @returns {Array<HTMLElement>|HTMLElement} An array of elements or an\n   *          element.\n   */\n  getElementsToTriggerPopup() {\n    return this.container;\n  }\n\n  addHighlightArea() {\n    const triggers = this.getElementsToTriggerPopup();\n    if (Array.isArray(triggers)) {\n      for (const element of triggers) {\n        element.classList.add(\"highlightArea\");\n      }\n    } else {\n      triggers.classList.add(\"highlightArea\");\n    }\n  }\n\n  _editOnDoubleClick() {\n    if (!this._isEditable) {\n      return;\n    }\n    const {\n      annotationEditorType: mode,\n      data: { id: editId },\n    } = this;\n    this.container.addEventListener(\"dblclick\", () => {\n      this.linkService.eventBus?.dispatch(\"switchannotationeditormode\", {\n        source: this,\n        mode,\n        editId,\n        mustEnterInEditMode: true,\n      });\n    });\n  }\n\n  get width() {\n    return this.data.rect[2] - this.data.rect[0];\n  }\n\n  get height() {\n    return this.data.rect[3] - this.data.rect[1];\n  }\n}\n\nclass LinkAnnotationElement extends AnnotationElement {\n  constructor(parameters, options = null) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: !!options?.ignoreBorder,\n      createQuadrilaterals: true,\n    });\n    this.isTooltipOnly = parameters.data.isTooltipOnly;\n  }\n\n  render() {\n    const { data, linkService } = this;\n    const link = document.createElement(\"a\");\n    link.setAttribute(\"data-element-id\", data.id);\n    let isBound = false;\n\n    if (data.url) {\n      linkService.addLinkAttributes(link, data.url, data.newWindow);\n      isBound = true;\n    } else if (data.action) {\n      this._bindNamedAction(link, data.action);\n      isBound = true;\n    } else if (data.attachment) {\n      this.#bindAttachment(link, data.attachment, data.attachmentDest);\n      isBound = true;\n    } else if (data.setOCGState) {\n      this.#bindSetOCGState(link, data.setOCGState);\n      isBound = true;\n    } else if (data.dest) {\n      this._bindLink(link, data.dest);\n      isBound = true;\n    } else {\n      if (\n        data.actions &&\n        (data.actions.Action ||\n          data.actions[\"Mouse Up\"] ||\n          data.actions[\"Mouse Down\"]) &&\n        this.enableScripting &&\n        this.hasJSActions\n      ) {\n        this._bindJSAction(link, data);\n        isBound = true;\n      }\n\n      if (data.resetForm) {\n        this._bindResetFormAction(link, data.resetForm);\n        isBound = true;\n      } else if (this.isTooltipOnly && !isBound) {\n        this._bindLink(link, \"\");\n        isBound = true;\n      }\n    }\n\n    this.container.classList.add(\"linkAnnotation\");\n    if (isBound) {\n      this.container.append(link);\n    }\n\n    return this.container;\n  }\n\n  #setInternalLink() {\n    this.container.setAttribute(\"data-internal-link\", \"\");\n  }\n\n  /**\n   * Bind internal links to the link element.\n   *\n   * @private\n   * @param {Object} link\n   * @param {Object} destination\n   * @memberof LinkAnnotationElement\n   */\n  _bindLink(link, destination) {\n    link.href = this.linkService.getDestinationHash(destination);\n    link.onclick = () => {\n      if (destination) {\n        this.linkService.goToDestination(destination);\n      }\n      return false;\n    };\n    if (destination || destination === /* isTooltipOnly = */ \"\") {\n      this.#setInternalLink();\n    }\n  }\n\n  /**\n   * Bind named actions to the link element.\n   *\n   * @private\n   * @param {Object} link\n   * @param {Object} action\n   * @memberof LinkAnnotationElement\n   */\n  _bindNamedAction(link, action) {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    link.onclick = () => {\n      this.linkService.executeNamedAction(action);\n      return false;\n    };\n    this.#setInternalLink();\n  }\n\n  /**\n   * Bind attachments to the link element.\n   * @param {Object} link\n   * @param {Object} attachment\n   * @param {str} [dest]\n   */\n  #bindAttachment(link, attachment, dest = null) {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    if (attachment.description) {\n      link.title = attachment.description;\n    }\n    link.onclick = () => {\n      this.downloadManager?.openOrDownloadData(\n        attachment.content,\n        attachment.filename,\n        dest\n      );\n      return false;\n    };\n    this.#setInternalLink();\n  }\n\n  /**\n   * Bind SetOCGState actions to the link element.\n   * @param {Object} link\n   * @param {Object} action\n   */\n  #bindSetOCGState(link, action) {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    link.onclick = () => {\n      this.linkService.executeSetOCGState(action);\n      return false;\n    };\n    this.#setInternalLink();\n  }\n\n  /**\n   * Bind JS actions to the link element.\n   *\n   * @private\n   * @param {Object} link\n   * @param {Object} data\n   * @memberof LinkAnnotationElement\n   */\n  _bindJSAction(link, data) {\n    link.href = this.linkService.getAnchorUrl(\"\");\n    const map = new Map([\n      [\"Action\", \"onclick\"],\n      [\"Mouse Up\", \"onmouseup\"],\n      [\"Mouse Down\", \"onmousedown\"],\n    ]);\n    for (const name of Object.keys(data.actions)) {\n      const jsName = map.get(name);\n      if (!jsName) {\n        continue;\n      }\n      link[jsName] = () => {\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: data.id,\n            name,\n          },\n        });\n        return false;\n      };\n    }\n\n    if (!link.onclick) {\n      link.onclick = () => false;\n    }\n    this.#setInternalLink();\n  }\n\n  _bindResetFormAction(link, resetForm) {\n    const otherClickAction = link.onclick;\n    if (!otherClickAction) {\n      link.href = this.linkService.getAnchorUrl(\"\");\n    }\n    this.#setInternalLink();\n\n    if (!this._fieldObjects) {\n      warn(\n        `_bindResetFormAction - \"resetForm\" action not supported, ` +\n          \"ensure that the `fieldObjects` parameter is provided.\"\n      );\n      if (!otherClickAction) {\n        link.onclick = () => false;\n      }\n      return;\n    }\n\n    link.onclick = () => {\n      otherClickAction?.();\n\n      const {\n        fields: resetFormFields,\n        refs: resetFormRefs,\n        include,\n      } = resetForm;\n\n      const allFields = [];\n      if (resetFormFields.length !== 0 || resetFormRefs.length !== 0) {\n        const fieldIds = new Set(resetFormRefs);\n        for (const fieldName of resetFormFields) {\n          const fields = this._fieldObjects[fieldName] || [];\n          for (const { id } of fields) {\n            fieldIds.add(id);\n          }\n        }\n        for (const fields of Object.values(this._fieldObjects)) {\n          for (const field of fields) {\n            if (fieldIds.has(field.id) === include) {\n              allFields.push(field);\n            }\n          }\n        }\n      } else {\n        for (const fields of Object.values(this._fieldObjects)) {\n          allFields.push(...fields);\n        }\n      }\n\n      const storage = this.annotationStorage;\n      const allIds = [];\n      for (const field of allFields) {\n        const { id } = field;\n        allIds.push(id);\n        switch (field.type) {\n          case \"text\": {\n            const value = field.defaultValue || \"\";\n            storage.setValue(id, { value });\n            break;\n          }\n          case \"checkbox\":\n          case \"radiobutton\": {\n            const value = field.defaultValue === field.exportValues;\n            storage.setValue(id, { value });\n            break;\n          }\n          case \"combobox\":\n          case \"listbox\": {\n            const value = field.defaultValue || \"\";\n            storage.setValue(id, { value });\n            break;\n          }\n          default:\n            continue;\n        }\n\n        const domElement = document.querySelector(`[data-element-id=\"${id}\"]`);\n        if (!domElement) {\n          continue;\n        } else if (!GetElementsByNameSet.has(domElement)) {\n          warn(`_bindResetFormAction - element not allowed: ${id}`);\n          continue;\n        }\n        domElement.dispatchEvent(new Event(\"resetform\"));\n      }\n\n      if (this.enableScripting) {\n        // Update the values in the sandbox.\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: \"app\",\n            ids: allIds,\n            name: \"ResetForm\",\n          },\n        });\n      }\n\n      return false;\n    };\n  }\n}\n\nclass TextAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true });\n  }\n\n  render() {\n    this.container.classList.add(\"textAnnotation\");\n\n    const image = document.createElement(\"img\");\n    image.src =\n      this.imageResourcesPath +\n      \"annotation-\" +\n      this.data.name.toLowerCase() +\n      \".svg\";\n    image.setAttribute(\"data-l10n-id\", \"pdfjs-text-annotation-type\");\n    image.setAttribute(\n      \"data-l10n-args\",\n      JSON.stringify({ type: this.data.name })\n    );\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this.container.append(image);\n    return this.container;\n  }\n}\n\nclass WidgetAnnotationElement extends AnnotationElement {\n  render() {\n    // Show only the container for unsupported field types.\n    return this.container;\n  }\n\n  showElementAndHideCanvas(element) {\n    if (this.data.hasOwnCanvas) {\n      if (element.previousSibling?.nodeName === \"CANVAS\") {\n        element.previousSibling.hidden = true;\n      }\n      element.hidden = false;\n    }\n  }\n\n  _getKeyModifier(event) {\n    return FeatureTest.platform.isMac ? event.metaKey : event.ctrlKey;\n  }\n\n  _setEventListener(element, elementData, baseName, eventName, valueGetter) {\n    if (baseName.includes(\"mouse\")) {\n      // Mouse events\n      element.addEventListener(baseName, event => {\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: this.data.id,\n            name: eventName,\n            value: valueGetter(event),\n            shift: event.shiftKey,\n            modifier: this._getKeyModifier(event),\n          },\n        });\n      });\n    } else {\n      // Non-mouse events\n      element.addEventListener(baseName, event => {\n        if (baseName === \"blur\") {\n          if (!elementData.focused || !event.relatedTarget) {\n            return;\n          }\n          elementData.focused = false;\n        } else if (baseName === \"focus\") {\n          if (elementData.focused) {\n            return;\n          }\n          elementData.focused = true;\n        }\n\n        if (!valueGetter) {\n          return;\n        }\n\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id: this.data.id,\n            name: eventName,\n            value: valueGetter(event),\n          },\n        });\n      });\n    }\n  }\n\n  _setEventListeners(element, elementData, names, getter) {\n    for (const [baseName, eventName] of names) {\n      if (eventName === \"Action\" || this.data.actions?.[eventName]) {\n        if (eventName === \"Focus\" || eventName === \"Blur\") {\n          elementData ||= { focused: false };\n        }\n        this._setEventListener(\n          element,\n          elementData,\n          baseName,\n          eventName,\n          getter\n        );\n        if (eventName === \"Focus\" && !this.data.actions?.Blur) {\n          // Ensure that elementData will have the correct value.\n          this._setEventListener(element, elementData, \"blur\", \"Blur\", null);\n        } else if (eventName === \"Blur\" && !this.data.actions?.Focus) {\n          this._setEventListener(element, elementData, \"focus\", \"Focus\", null);\n        }\n      }\n    }\n  }\n\n  _setBackgroundColor(element) {\n    const color = this.data.backgroundColor || null;\n    element.style.backgroundColor =\n      color === null\n        ? \"transparent\"\n        : Util.makeHexColor(color[0], color[1], color[2]);\n  }\n\n  /**\n   * Apply text styles to the text in the element.\n   *\n   * @private\n   * @param {HTMLDivElement} element\n   * @memberof TextWidgetAnnotationElement\n   */\n  _setTextStyle(element) {\n    const TEXT_ALIGNMENT = [\"left\", \"center\", \"right\"];\n    const { fontColor } = this.data.defaultAppearanceData;\n    const fontSize =\n      this.data.defaultAppearanceData.fontSize || DEFAULT_FONT_SIZE;\n\n    const style = element.style;\n\n    // TODO: If the font-size is zero, calculate it based on the height and\n    //       width of the element.\n    // Not setting `style.fontSize` will use the default font-size for now.\n\n    // We don't use the font, as specified in the PDF document, for the <input>\n    // element. Hence using the original `fontSize` could look bad, which is why\n    // it's instead based on the field height.\n    // If the height is \"big\" then it could lead to a too big font size\n    // so in this case use the one we've in the pdf (hence the min).\n    let computedFontSize;\n    const BORDER_SIZE = 2;\n    const roundToOneDecimal = x => Math.round(10 * x) / 10;\n    if (this.data.multiLine) {\n      const height = Math.abs(\n        this.data.rect[3] - this.data.rect[1] - BORDER_SIZE\n      );\n      const numberOfLines = Math.round(height / (LINE_FACTOR * fontSize)) || 1;\n      const lineHeight = height / numberOfLines;\n      computedFontSize = Math.min(\n        fontSize,\n        roundToOneDecimal(lineHeight / LINE_FACTOR)\n      );\n    } else {\n      const height = Math.abs(\n        this.data.rect[3] - this.data.rect[1] - BORDER_SIZE\n      );\n      computedFontSize = Math.min(\n        fontSize,\n        roundToOneDecimal(height / LINE_FACTOR)\n      );\n    }\n    style.fontSize = `calc(${computedFontSize}px * var(--total-scale-factor))`;\n\n    style.color = Util.makeHexColor(fontColor[0], fontColor[1], fontColor[2]);\n\n    if (this.data.textAlignment !== null) {\n      style.textAlign = TEXT_ALIGNMENT[this.data.textAlignment];\n    }\n  }\n\n  _setRequired(element, isRequired) {\n    if (isRequired) {\n      element.setAttribute(\"required\", true);\n    } else {\n      element.removeAttribute(\"required\");\n    }\n    element.setAttribute(\"aria-required\", isRequired);\n  }\n}\n\nclass TextWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    const isRenderable =\n      parameters.renderForms ||\n      parameters.data.hasOwnCanvas ||\n      (!parameters.data.hasAppearance && !!parameters.data.fieldValue);\n    super(parameters, { isRenderable });\n  }\n\n  setPropertyOnSiblings(base, key, value, keyInStorage) {\n    const storage = this.annotationStorage;\n    for (const element of this._getElementsByName(\n      base.name,\n      /* skipId = */ base.id\n    )) {\n      if (element.domElement) {\n        element.domElement[key] = value;\n      }\n      storage.setValue(element.id, { [keyInStorage]: value });\n    }\n  }\n\n  render() {\n    const storage = this.annotationStorage;\n    const id = this.data.id;\n\n    this.container.classList.add(\"textWidgetAnnotation\");\n\n    let element = null;\n    if (this.renderForms) {\n      // NOTE: We cannot set the values using `element.value` below, since it\n      //       prevents the AnnotationLayer rasterizer in `test/driver.js`\n      //       from parsing the elements correctly for the reference tests.\n      const storedData = storage.getValue(id, {\n        value: this.data.fieldValue,\n      });\n      let textContent = storedData.value || \"\";\n      const maxLen = storage.getValue(id, {\n        charLimit: this.data.maxLen,\n      }).charLimit;\n      if (maxLen && textContent.length > maxLen) {\n        textContent = textContent.slice(0, maxLen);\n      }\n\n      let fieldFormattedValues =\n        storedData.formattedValue || this.data.textContent?.join(\"\\n\") || null;\n      if (fieldFormattedValues && this.data.comb) {\n        fieldFormattedValues = fieldFormattedValues.replaceAll(/\\s+/g, \"\");\n      }\n\n      const elementData = {\n        userValue: textContent,\n        formattedValue: fieldFormattedValues,\n        lastCommittedValue: null,\n        commitKey: 1,\n        focused: false,\n      };\n\n      if (this.data.multiLine) {\n        element = document.createElement(\"textarea\");\n        element.textContent = fieldFormattedValues ?? textContent;\n        if (this.data.doNotScroll) {\n          element.style.overflowY = \"hidden\";\n        }\n      } else {\n        element = document.createElement(\"input\");\n        element.type = this.data.password ? \"password\" : \"text\";\n        element.setAttribute(\"value\", fieldFormattedValues ?? textContent);\n        if (this.data.doNotScroll) {\n          element.style.overflowX = \"hidden\";\n        }\n      }\n      if (this.data.hasOwnCanvas) {\n        element.hidden = true;\n      }\n      GetElementsByNameSet.add(element);\n      element.setAttribute(\"data-element-id\", id);\n\n      element.disabled = this.data.readOnly;\n      element.name = this.data.fieldName;\n      element.tabIndex = 0;\n      const format = this.data.dateFormat || this.data.timeFormat;\n      if (format) {\n        element.title = format;\n      }\n\n      this._setRequired(element, this.data.required);\n\n      if (maxLen) {\n        element.maxLength = maxLen;\n      }\n\n      element.addEventListener(\"input\", event => {\n        storage.setValue(id, { value: event.target.value });\n        this.setPropertyOnSiblings(\n          element,\n          \"value\",\n          event.target.value,\n          \"value\"\n        );\n        elementData.formattedValue = null;\n      });\n\n      element.addEventListener(\"resetform\", event => {\n        const defaultValue = this.data.defaultFieldValue ?? \"\";\n        element.value = elementData.userValue = defaultValue;\n        elementData.formattedValue = null;\n      });\n\n      let blurListener = event => {\n        const { formattedValue } = elementData;\n        if (formattedValue !== null && formattedValue !== undefined) {\n          event.target.value = formattedValue;\n        }\n        // Reset the cursor position to the start of the field (issue 12359).\n        event.target.scrollLeft = 0;\n      };\n\n      if (this.enableScripting && this.hasJSActions) {\n        element.addEventListener(\"focus\", event => {\n          if (elementData.focused) {\n            return;\n          }\n          const { target } = event;\n          if (elementData.userValue) {\n            target.value = elementData.userValue;\n          }\n          elementData.lastCommittedValue = target.value;\n          elementData.commitKey = 1;\n          if (!this.data.actions?.Focus) {\n            elementData.focused = true;\n          }\n        });\n\n        element.addEventListener(\"updatefromsandbox\", jsEvent => {\n          this.showElementAndHideCanvas(jsEvent.target);\n          const actions = {\n            value(event) {\n              elementData.userValue = event.detail.value ?? \"\";\n              storage.setValue(id, { value: elementData.userValue.toString() });\n              event.target.value = elementData.userValue;\n            },\n            formattedValue(event) {\n              const { formattedValue } = event.detail;\n              elementData.formattedValue = formattedValue;\n              if (\n                formattedValue !== null &&\n                formattedValue !== undefined &&\n                event.target !== document.activeElement\n              ) {\n                // Input hasn't the focus so display formatted string\n                event.target.value = formattedValue;\n              }\n              storage.setValue(id, {\n                formattedValue,\n              });\n            },\n            selRange(event) {\n              event.target.setSelectionRange(...event.detail.selRange);\n            },\n            charLimit: event => {\n              const { charLimit } = event.detail;\n              const { target } = event;\n              if (charLimit === 0) {\n                target.removeAttribute(\"maxLength\");\n                return;\n              }\n\n              target.setAttribute(\"maxLength\", charLimit);\n              let value = elementData.userValue;\n              if (!value || value.length <= charLimit) {\n                return;\n              }\n              value = value.slice(0, charLimit);\n              target.value = elementData.userValue = value;\n              storage.setValue(id, { value });\n\n              this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n                source: this,\n                detail: {\n                  id,\n                  name: \"Keystroke\",\n                  value,\n                  willCommit: true,\n                  commitKey: 1,\n                  selStart: target.selectionStart,\n                  selEnd: target.selectionEnd,\n                },\n              });\n            },\n          };\n          this._dispatchEventFromSandbox(actions, jsEvent);\n        });\n\n        // Even if the field hasn't any actions\n        // leaving it can still trigger some actions with Calculate\n        element.addEventListener(\"keydown\", event => {\n          elementData.commitKey = 1;\n          // If the key is one of Escape, Enter then the data are committed.\n          // If we've a Tab then data will be committed on blur.\n          let commitKey = -1;\n          if (event.key === \"Escape\") {\n            commitKey = 0;\n          } else if (event.key === \"Enter\" && !this.data.multiLine) {\n            // When we've a multiline field, \"Enter\" key is a key as the other\n            // hence we don't commit the data (Acrobat behaves the same way)\n            // (see issue #15627).\n            commitKey = 2;\n          } else if (event.key === \"Tab\") {\n            elementData.commitKey = 3;\n          }\n          if (commitKey === -1) {\n            return;\n          }\n          const { value } = event.target;\n          if (elementData.lastCommittedValue === value) {\n            return;\n          }\n          elementData.lastCommittedValue = value;\n          // Save the entered value\n          elementData.userValue = value;\n          this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n            source: this,\n            detail: {\n              id,\n              name: \"Keystroke\",\n              value,\n              willCommit: true,\n              commitKey,\n              selStart: event.target.selectionStart,\n              selEnd: event.target.selectionEnd,\n            },\n          });\n        });\n        const _blurListener = blurListener;\n        blurListener = null;\n        element.addEventListener(\"blur\", event => {\n          if (!elementData.focused || !event.relatedTarget) {\n            return;\n          }\n          if (!this.data.actions?.Blur) {\n            elementData.focused = false;\n          }\n          const { value } = event.target;\n          elementData.userValue = value;\n          if (elementData.lastCommittedValue !== value) {\n            this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n              source: this,\n              detail: {\n                id,\n                name: \"Keystroke\",\n                value,\n                willCommit: true,\n                commitKey: elementData.commitKey,\n                selStart: event.target.selectionStart,\n                selEnd: event.target.selectionEnd,\n              },\n            });\n          }\n          _blurListener(event);\n        });\n\n        if (this.data.actions?.Keystroke) {\n          element.addEventListener(\"beforeinput\", event => {\n            elementData.lastCommittedValue = null;\n            const { data, target } = event;\n            const { value, selectionStart, selectionEnd } = target;\n\n            let selStart = selectionStart,\n              selEnd = selectionEnd;\n\n            switch (event.inputType) {\n              // https://rawgit.com/w3c/input-events/v1/index.html#interface-InputEvent-Attributes\n              case \"deleteWordBackward\": {\n                const match = value\n                  .substring(0, selectionStart)\n                  .match(/\\w*[^\\w]*$/);\n                if (match) {\n                  selStart -= match[0].length;\n                }\n                break;\n              }\n              case \"deleteWordForward\": {\n                const match = value\n                  .substring(selectionStart)\n                  .match(/^[^\\w]*\\w*/);\n                if (match) {\n                  selEnd += match[0].length;\n                }\n                break;\n              }\n              case \"deleteContentBackward\":\n                if (selectionStart === selectionEnd) {\n                  selStart -= 1;\n                }\n                break;\n              case \"deleteContentForward\":\n                if (selectionStart === selectionEnd) {\n                  selEnd += 1;\n                }\n                break;\n            }\n\n            // We handle the event ourselves.\n            event.preventDefault();\n            this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n              source: this,\n              detail: {\n                id,\n                name: \"Keystroke\",\n                value,\n                change: data || \"\",\n                willCommit: false,\n                selStart,\n                selEnd,\n              },\n            });\n          });\n        }\n\n        this._setEventListeners(\n          element,\n          elementData,\n          [\n            [\"focus\", \"Focus\"],\n            [\"blur\", \"Blur\"],\n            [\"mousedown\", \"Mouse Down\"],\n            [\"mouseenter\", \"Mouse Enter\"],\n            [\"mouseleave\", \"Mouse Exit\"],\n            [\"mouseup\", \"Mouse Up\"],\n          ],\n          event => event.target.value\n        );\n      }\n\n      if (blurListener) {\n        element.addEventListener(\"blur\", blurListener);\n      }\n\n      if (this.data.comb) {\n        const fieldWidth = this.data.rect[2] - this.data.rect[0];\n        const combWidth = fieldWidth / maxLen;\n\n        element.classList.add(\"comb\");\n        element.style.letterSpacing = `calc(${combWidth}px * var(--total-scale-factor) - 1ch)`;\n      }\n    } else {\n      element = document.createElement(\"div\");\n      element.textContent = this.data.fieldValue;\n      element.style.verticalAlign = \"middle\";\n      element.style.display = \"table-cell\";\n\n      if (this.data.hasOwnCanvas) {\n        element.hidden = true;\n      }\n    }\n\n    this._setTextStyle(element);\n    this._setBackgroundColor(element);\n    this._setDefaultPropertiesFromJS(element);\n\n    this.container.append(element);\n    return this.container;\n  }\n}\n\nclass SignatureWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: !!parameters.data.hasOwnCanvas });\n  }\n}\n\nclass CheckboxWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: parameters.renderForms });\n  }\n\n  render() {\n    const storage = this.annotationStorage;\n    const data = this.data;\n    const id = data.id;\n    let value = storage.getValue(id, {\n      value: data.exportValue === data.fieldValue,\n    }).value;\n    if (typeof value === \"string\") {\n      // The value has been changed through js and set in annotationStorage.\n      value = value !== \"Off\";\n      storage.setValue(id, { value });\n    }\n\n    this.container.classList.add(\"buttonWidgetAnnotation\", \"checkBox\");\n\n    const element = document.createElement(\"input\");\n    GetElementsByNameSet.add(element);\n    element.setAttribute(\"data-element-id\", id);\n\n    element.disabled = data.readOnly;\n    this._setRequired(element, this.data.required);\n    element.type = \"checkbox\";\n    element.name = data.fieldName;\n    if (value) {\n      element.setAttribute(\"checked\", true);\n    }\n    element.setAttribute(\"exportValue\", data.exportValue);\n    element.tabIndex = 0;\n\n    element.addEventListener(\"change\", event => {\n      const { name, checked } = event.target;\n      for (const checkbox of this._getElementsByName(name, /* skipId = */ id)) {\n        const curChecked = checked && checkbox.exportValue === data.exportValue;\n        if (checkbox.domElement) {\n          checkbox.domElement.checked = curChecked;\n        }\n        storage.setValue(checkbox.id, { value: curChecked });\n      }\n      storage.setValue(id, { value: checked });\n    });\n\n    element.addEventListener(\"resetform\", event => {\n      const defaultValue = data.defaultFieldValue || \"Off\";\n      event.target.checked = defaultValue === data.exportValue;\n    });\n\n    if (this.enableScripting && this.hasJSActions) {\n      element.addEventListener(\"updatefromsandbox\", jsEvent => {\n        const actions = {\n          value(event) {\n            event.target.checked = event.detail.value !== \"Off\";\n            storage.setValue(id, { value: event.target.checked });\n          },\n        };\n        this._dispatchEventFromSandbox(actions, jsEvent);\n      });\n\n      this._setEventListeners(\n        element,\n        null,\n        [\n          [\"change\", \"Validate\"],\n          [\"change\", \"Action\"],\n          [\"focus\", \"Focus\"],\n          [\"blur\", \"Blur\"],\n          [\"mousedown\", \"Mouse Down\"],\n          [\"mouseenter\", \"Mouse Enter\"],\n          [\"mouseleave\", \"Mouse Exit\"],\n          [\"mouseup\", \"Mouse Up\"],\n        ],\n        event => event.target.checked\n      );\n    }\n\n    this._setBackgroundColor(element);\n    this._setDefaultPropertiesFromJS(element);\n\n    this.container.append(element);\n    return this.container;\n  }\n}\n\nclass RadioButtonWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: parameters.renderForms });\n  }\n\n  render() {\n    this.container.classList.add(\"buttonWidgetAnnotation\", \"radioButton\");\n    const storage = this.annotationStorage;\n    const data = this.data;\n    const id = data.id;\n    let value = storage.getValue(id, {\n      value: data.fieldValue === data.buttonValue,\n    }).value;\n    if (typeof value === \"string\") {\n      // The value has been changed through js and set in annotationStorage.\n      value = value !== data.buttonValue;\n      storage.setValue(id, { value });\n    }\n\n    if (value) {\n      // It's possible that multiple radio buttons are checked.\n      // So if this one is checked we just reset the other ones.\n      // (see bug 1864136). Then when the other ones will be rendered they will\n      // unchecked (because of their value in the storage).\n      // Consequently, the first checked radio button will be the only checked\n      // one.\n      for (const radio of this._getElementsByName(\n        data.fieldName,\n        /* skipId = */ id\n      )) {\n        storage.setValue(radio.id, { value: false });\n      }\n    }\n\n    const element = document.createElement(\"input\");\n    GetElementsByNameSet.add(element);\n    element.setAttribute(\"data-element-id\", id);\n\n    element.disabled = data.readOnly;\n    this._setRequired(element, this.data.required);\n    element.type = \"radio\";\n    element.name = data.fieldName;\n    if (value) {\n      element.setAttribute(\"checked\", true);\n    }\n    element.tabIndex = 0;\n\n    element.addEventListener(\"change\", event => {\n      const { name, checked } = event.target;\n      for (const radio of this._getElementsByName(name, /* skipId = */ id)) {\n        storage.setValue(radio.id, { value: false });\n      }\n      storage.setValue(id, { value: checked });\n    });\n\n    element.addEventListener(\"resetform\", event => {\n      const defaultValue = data.defaultFieldValue;\n      event.target.checked =\n        defaultValue !== null &&\n        defaultValue !== undefined &&\n        defaultValue === data.buttonValue;\n    });\n\n    if (this.enableScripting && this.hasJSActions) {\n      const pdfButtonValue = data.buttonValue;\n      element.addEventListener(\"updatefromsandbox\", jsEvent => {\n        const actions = {\n          value: event => {\n            const checked = pdfButtonValue === event.detail.value;\n            for (const radio of this._getElementsByName(event.target.name)) {\n              const curChecked = checked && radio.id === id;\n              if (radio.domElement) {\n                radio.domElement.checked = curChecked;\n              }\n              storage.setValue(radio.id, { value: curChecked });\n            }\n          },\n        };\n        this._dispatchEventFromSandbox(actions, jsEvent);\n      });\n\n      this._setEventListeners(\n        element,\n        null,\n        [\n          [\"change\", \"Validate\"],\n          [\"change\", \"Action\"],\n          [\"focus\", \"Focus\"],\n          [\"blur\", \"Blur\"],\n          [\"mousedown\", \"Mouse Down\"],\n          [\"mouseenter\", \"Mouse Enter\"],\n          [\"mouseleave\", \"Mouse Exit\"],\n          [\"mouseup\", \"Mouse Up\"],\n        ],\n        event => event.target.checked\n      );\n    }\n\n    this._setBackgroundColor(element);\n    this._setDefaultPropertiesFromJS(element);\n\n    this.container.append(element);\n    return this.container;\n  }\n}\n\nclass PushButtonWidgetAnnotationElement extends LinkAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { ignoreBorder: parameters.data.hasAppearance });\n  }\n\n  render() {\n    // The rendering and functionality of a push button widget annotation is\n    // equal to that of a link annotation, but may have more functionality, such\n    // as performing actions on form fields (resetting, submitting, et cetera).\n    const container = super.render();\n    container.classList.add(\"buttonWidgetAnnotation\", \"pushButton\");\n\n    const linkElement = container.lastChild;\n    if (this.enableScripting && this.hasJSActions && linkElement) {\n      this._setDefaultPropertiesFromJS(linkElement);\n\n      linkElement.addEventListener(\"updatefromsandbox\", jsEvent => {\n        this._dispatchEventFromSandbox({}, jsEvent);\n      });\n    }\n\n    return container;\n  }\n}\n\nclass ChoiceWidgetAnnotationElement extends WidgetAnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: parameters.renderForms });\n  }\n\n  render() {\n    this.container.classList.add(\"choiceWidgetAnnotation\");\n    const storage = this.annotationStorage;\n    const id = this.data.id;\n\n    const storedData = storage.getValue(id, {\n      value: this.data.fieldValue,\n    });\n\n    const selectElement = document.createElement(\"select\");\n    GetElementsByNameSet.add(selectElement);\n    selectElement.setAttribute(\"data-element-id\", id);\n\n    selectElement.disabled = this.data.readOnly;\n    this._setRequired(selectElement, this.data.required);\n    selectElement.name = this.data.fieldName;\n    selectElement.tabIndex = 0;\n\n    let addAnEmptyEntry = this.data.combo && this.data.options.length > 0;\n\n    if (!this.data.combo) {\n      // List boxes have a size and (optionally) multiple selection.\n      selectElement.size = this.data.options.length;\n      if (this.data.multiSelect) {\n        selectElement.multiple = true;\n      }\n    }\n\n    selectElement.addEventListener(\"resetform\", event => {\n      const defaultValue = this.data.defaultFieldValue;\n      for (const option of selectElement.options) {\n        option.selected = option.value === defaultValue;\n      }\n    });\n\n    // Insert the options into the choice field.\n    for (const option of this.data.options) {\n      const optionElement = document.createElement(\"option\");\n      optionElement.textContent = option.displayValue;\n      optionElement.value = option.exportValue;\n      if (storedData.value.includes(option.exportValue)) {\n        optionElement.setAttribute(\"selected\", true);\n        addAnEmptyEntry = false;\n      }\n      selectElement.append(optionElement);\n    }\n\n    let removeEmptyEntry = null;\n    if (addAnEmptyEntry) {\n      const noneOptionElement = document.createElement(\"option\");\n      noneOptionElement.value = \" \";\n      noneOptionElement.setAttribute(\"hidden\", true);\n      noneOptionElement.setAttribute(\"selected\", true);\n      selectElement.prepend(noneOptionElement);\n\n      removeEmptyEntry = () => {\n        noneOptionElement.remove();\n        selectElement.removeEventListener(\"input\", removeEmptyEntry);\n        removeEmptyEntry = null;\n      };\n      selectElement.addEventListener(\"input\", removeEmptyEntry);\n    }\n\n    const getValue = isExport => {\n      const name = isExport ? \"value\" : \"textContent\";\n      const { options, multiple } = selectElement;\n      if (!multiple) {\n        return options.selectedIndex === -1\n          ? null\n          : options[options.selectedIndex][name];\n      }\n      return Array.prototype.filter\n        .call(options, option => option.selected)\n        .map(option => option[name]);\n    };\n\n    let selectedValues = getValue(/* isExport */ false);\n\n    const getItems = event => {\n      const options = event.target.options;\n      return Array.prototype.map.call(options, option => ({\n        displayValue: option.textContent,\n        exportValue: option.value,\n      }));\n    };\n\n    if (this.enableScripting && this.hasJSActions) {\n      selectElement.addEventListener(\"updatefromsandbox\", jsEvent => {\n        const actions = {\n          value(event) {\n            removeEmptyEntry?.();\n            const value = event.detail.value;\n            const values = new Set(Array.isArray(value) ? value : [value]);\n            for (const option of selectElement.options) {\n              option.selected = values.has(option.value);\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          multipleSelection(event) {\n            selectElement.multiple = true;\n          },\n          remove(event) {\n            const options = selectElement.options;\n            const index = event.detail.remove;\n            options[index].selected = false;\n            selectElement.remove(index);\n            if (options.length > 0) {\n              const i = Array.prototype.findIndex.call(\n                options,\n                option => option.selected\n              );\n              if (i === -1) {\n                options[0].selected = true;\n              }\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n              items: getItems(event),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          clear(event) {\n            while (selectElement.length !== 0) {\n              selectElement.remove(0);\n            }\n            storage.setValue(id, { value: null, items: [] });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          insert(event) {\n            const { index, displayValue, exportValue } = event.detail.insert;\n            const selectChild = selectElement.children[index];\n            const optionElement = document.createElement(\"option\");\n            optionElement.textContent = displayValue;\n            optionElement.value = exportValue;\n\n            if (selectChild) {\n              selectChild.before(optionElement);\n            } else {\n              selectElement.append(optionElement);\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n              items: getItems(event),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          items(event) {\n            const { items } = event.detail;\n            while (selectElement.length !== 0) {\n              selectElement.remove(0);\n            }\n            for (const item of items) {\n              const { displayValue, exportValue } = item;\n              const optionElement = document.createElement(\"option\");\n              optionElement.textContent = displayValue;\n              optionElement.value = exportValue;\n              selectElement.append(optionElement);\n            }\n            if (selectElement.options.length > 0) {\n              selectElement.options[0].selected = true;\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n              items: getItems(event),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          indices(event) {\n            const indices = new Set(event.detail.indices);\n            for (const option of event.target.options) {\n              option.selected = indices.has(option.index);\n            }\n            storage.setValue(id, {\n              value: getValue(/* isExport */ true),\n            });\n            selectedValues = getValue(/* isExport */ false);\n          },\n          editable(event) {\n            event.target.disabled = !event.detail.editable;\n          },\n        };\n        this._dispatchEventFromSandbox(actions, jsEvent);\n      });\n\n      selectElement.addEventListener(\"input\", event => {\n        const exportValue = getValue(/* isExport */ true);\n        const change = getValue(/* isExport */ false);\n        storage.setValue(id, { value: exportValue });\n\n        event.preventDefault();\n\n        this.linkService.eventBus?.dispatch(\"dispatcheventinsandbox\", {\n          source: this,\n          detail: {\n            id,\n            name: \"Keystroke\",\n            value: selectedValues,\n            change,\n            changeEx: exportValue,\n            willCommit: false,\n            commitKey: 1,\n            keyDown: false,\n          },\n        });\n      });\n\n      this._setEventListeners(\n        selectElement,\n        null,\n        [\n          [\"focus\", \"Focus\"],\n          [\"blur\", \"Blur\"],\n          [\"mousedown\", \"Mouse Down\"],\n          [\"mouseenter\", \"Mouse Enter\"],\n          [\"mouseleave\", \"Mouse Exit\"],\n          [\"mouseup\", \"Mouse Up\"],\n          [\"input\", \"Action\"],\n          [\"input\", \"Validate\"],\n        ],\n        event => event.target.value\n      );\n    } else {\n      selectElement.addEventListener(\"input\", function (event) {\n        storage.setValue(id, { value: getValue(/* isExport */ true) });\n      });\n    }\n\n    if (this.data.combo) {\n      this._setTextStyle(selectElement);\n    } else {\n      // Just use the default font size...\n      // it's a bit hard to guess what is a good size.\n    }\n    this._setBackgroundColor(selectElement);\n    this._setDefaultPropertiesFromJS(selectElement);\n\n    this.container.append(selectElement);\n    return this.container;\n  }\n}\n\nclass PopupAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    const { data, elements } = parameters;\n    super(parameters, { isRenderable: AnnotationElement._hasPopupData(data) });\n    this.elements = elements;\n    this.popup = null;\n  }\n\n  render() {\n    const { container } = this;\n    container.classList.add(\"popupAnnotation\");\n    container.role = \"comment\";\n\n    const popup = (this.popup = new PopupElement({\n      container: this.container,\n      color: this.data.color,\n      titleObj: this.data.titleObj,\n      modificationDate: this.data.modificationDate,\n      contentsObj: this.data.contentsObj,\n      richText: this.data.richText,\n      rect: this.data.rect,\n      parentRect: this.data.parentRect || null,\n      parent: this.parent,\n      elements: this.elements,\n      open: this.data.open,\n    }));\n\n    const elementIds = [];\n    for (const element of this.elements) {\n      element.popup = popup;\n      element.container.ariaHasPopup = \"dialog\";\n      elementIds.push(element.data.id);\n      element.addHighlightArea();\n    }\n\n    this.container.setAttribute(\n      \"aria-controls\",\n      elementIds.map(id => `${AnnotationPrefix}${id}`).join(\",\")\n    );\n\n    return this.container;\n  }\n}\n\nclass PopupElement {\n  #boundKeyDown = this.#keyDown.bind(this);\n\n  #boundHide = this.#hide.bind(this);\n\n  #boundShow = this.#show.bind(this);\n\n  #boundToggle = this.#toggle.bind(this);\n\n  #color = null;\n\n  #container = null;\n\n  #contentsObj = null;\n\n  #dateObj = null;\n\n  #elements = null;\n\n  #parent = null;\n\n  #parentRect = null;\n\n  #pinned = false;\n\n  #popup = null;\n\n  #position = null;\n\n  #rect = null;\n\n  #richText = null;\n\n  #titleObj = null;\n\n  #updates = null;\n\n  #wasVisible = false;\n\n  constructor({\n    container,\n    color,\n    elements,\n    titleObj,\n    modificationDate,\n    contentsObj,\n    richText,\n    parent,\n    rect,\n    parentRect,\n    open,\n  }) {\n    this.#container = container;\n    this.#titleObj = titleObj;\n    this.#contentsObj = contentsObj;\n    this.#richText = richText;\n    this.#parent = parent;\n    this.#color = color;\n    this.#rect = rect;\n    this.#parentRect = parentRect;\n    this.#elements = elements;\n\n    // The modification date is shown in the popup instead of the creation\n    // date if it is available and can be parsed correctly, which is\n    // consistent with other viewers such as Adobe Acrobat.\n    this.#dateObj = PDFDateString.toDateObject(modificationDate);\n\n    this.trigger = elements.flatMap(e => e.getElementsToTriggerPopup());\n    // Attach the event listeners to the trigger element.\n    for (const element of this.trigger) {\n      element.addEventListener(\"click\", this.#boundToggle);\n      element.addEventListener(\"mouseenter\", this.#boundShow);\n      element.addEventListener(\"mouseleave\", this.#boundHide);\n      element.classList.add(\"popupTriggerArea\");\n    }\n\n    // Attach the event listener to toggle the popup with the keyboard.\n    for (const element of elements) {\n      element.container?.addEventListener(\"keydown\", this.#boundKeyDown);\n    }\n\n    this.#container.hidden = true;\n    if (open) {\n      this.#toggle();\n    }\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      // Since the popup is lazily created, we need to ensure that it'll be\n      // created and displayed during reference tests.\n      this.#parent.popupShow.push(async () => {\n        if (this.#container.hidden) {\n          this.#show();\n        }\n      });\n    }\n  }\n\n  render() {\n    if (this.#popup) {\n      return;\n    }\n\n    const popup = (this.#popup = document.createElement(\"div\"));\n    popup.className = \"popup\";\n\n    if (this.#color) {\n      const baseColor = (popup.style.outlineColor = Util.makeHexColor(\n        ...this.#color\n      ));\n      popup.style.backgroundColor = `color-mix(in srgb, ${baseColor} 30%, white)`;\n    }\n\n    const header = document.createElement(\"span\");\n    header.className = \"header\";\n    const title = document.createElement(\"h1\");\n    header.append(title);\n    ({ dir: title.dir, str: title.textContent } = this.#titleObj);\n    popup.append(header);\n\n    if (this.#dateObj) {\n      const modificationDate = document.createElement(\"time\");\n      modificationDate.classList.add(\"popupDate\");\n      modificationDate.setAttribute(\n        \"data-l10n-id\",\n        \"pdfjs-annotation-date-time-string\"\n      );\n      modificationDate.setAttribute(\n        \"data-l10n-args\",\n        JSON.stringify({ dateObj: this.#dateObj.valueOf() })\n      );\n      modificationDate.dateTime = this.#dateObj.toISOString();\n      header.append(modificationDate);\n    }\n\n    const html = this.#html;\n    if (html) {\n      XfaLayer.render({\n        xfaHtml: html,\n        intent: \"richText\",\n        div: popup,\n      });\n      popup.lastChild.classList.add(\"richText\", \"popupContent\");\n    } else {\n      const contents = this._formatContents(this.#contentsObj);\n      popup.append(contents);\n    }\n    this.#container.append(popup);\n  }\n\n  get #html() {\n    const richText = this.#richText;\n    const contentsObj = this.#contentsObj;\n    if (\n      richText?.str &&\n      (!contentsObj?.str || contentsObj.str === richText.str)\n    ) {\n      return this.#richText.html || null;\n    }\n    return null;\n  }\n\n  get #fontSize() {\n    return this.#html?.attributes?.style?.fontSize || 0;\n  }\n\n  get #fontColor() {\n    return this.#html?.attributes?.style?.color || null;\n  }\n\n  #makePopupContent(text) {\n    const popupLines = [];\n    const popupContent = {\n      str: text,\n      html: {\n        name: \"div\",\n        attributes: {\n          dir: \"auto\",\n        },\n        children: [\n          {\n            name: \"p\",\n            children: popupLines,\n          },\n        ],\n      },\n    };\n    const lineAttributes = {\n      style: {\n        color: this.#fontColor,\n        fontSize: this.#fontSize\n          ? `calc(${this.#fontSize}px * var(--total-scale-factor))`\n          : \"\",\n      },\n    };\n    for (const line of text.split(\"\\n\")) {\n      popupLines.push({\n        name: \"span\",\n        value: line,\n        attributes: lineAttributes,\n      });\n    }\n    return popupContent;\n  }\n\n  /**\n   * Format the contents of the popup by adding newlines where necessary.\n   *\n   * @private\n   * @param {Object<string, string>} contentsObj\n   * @memberof PopupElement\n   * @returns {HTMLParagraphElement}\n   */\n  _formatContents({ str, dir }) {\n    const p = document.createElement(\"p\");\n    p.classList.add(\"popupContent\");\n    p.dir = dir;\n    const lines = str.split(/(?:\\r\\n?|\\n)/);\n    for (let i = 0, ii = lines.length; i < ii; ++i) {\n      const line = lines[i];\n      p.append(document.createTextNode(line));\n      if (i < ii - 1) {\n        p.append(document.createElement(\"br\"));\n      }\n    }\n    return p;\n  }\n\n  #keyDown(event) {\n    if (event.altKey || event.shiftKey || event.ctrlKey || event.metaKey) {\n      return;\n    }\n\n    if (event.key === \"Enter\" || (event.key === \"Escape\" && this.#pinned)) {\n      this.#toggle();\n    }\n  }\n\n  updateEdited({ rect, popupContent }) {\n    this.#updates ||= {\n      contentsObj: this.#contentsObj,\n      richText: this.#richText,\n    };\n    if (rect) {\n      this.#position = null;\n    }\n    if (popupContent) {\n      this.#richText = this.#makePopupContent(popupContent);\n      this.#contentsObj = null;\n    }\n    this.#popup?.remove();\n    this.#popup = null;\n  }\n\n  resetEdited() {\n    if (!this.#updates) {\n      return;\n    }\n    ({ contentsObj: this.#contentsObj, richText: this.#richText } =\n      this.#updates);\n    this.#updates = null;\n    this.#popup?.remove();\n    this.#popup = null;\n    this.#position = null;\n  }\n\n  #setPosition() {\n    if (this.#position !== null) {\n      return;\n    }\n    const {\n      page: { view },\n      viewport: {\n        rawDims: { pageWidth, pageHeight, pageX, pageY },\n      },\n    } = this.#parent;\n\n    let useParentRect = !!this.#parentRect;\n    let rect = useParentRect ? this.#parentRect : this.#rect;\n    for (const element of this.#elements) {\n      if (!rect || Util.intersect(element.data.rect, rect) !== null) {\n        rect = element.data.rect;\n        useParentRect = true;\n        break;\n      }\n    }\n\n    const normalizedRect = Util.normalizeRect([\n      rect[0],\n      view[3] - rect[1] + view[1],\n      rect[2],\n      view[3] - rect[3] + view[1],\n    ]);\n\n    const HORIZONTAL_SPACE_AFTER_ANNOTATION = 5;\n    const parentWidth = useParentRect\n      ? rect[2] - rect[0] + HORIZONTAL_SPACE_AFTER_ANNOTATION\n      : 0;\n    const popupLeft = normalizedRect[0] + parentWidth;\n    const popupTop = normalizedRect[1];\n    this.#position = [\n      (100 * (popupLeft - pageX)) / pageWidth,\n      (100 * (popupTop - pageY)) / pageHeight,\n    ];\n\n    const { style } = this.#container;\n    style.left = `${this.#position[0]}%`;\n    style.top = `${this.#position[1]}%`;\n  }\n\n  /**\n   * Toggle the visibility of the popup.\n   */\n  #toggle() {\n    this.#pinned = !this.#pinned;\n    if (this.#pinned) {\n      this.#show();\n      this.#container.addEventListener(\"click\", this.#boundToggle);\n      this.#container.addEventListener(\"keydown\", this.#boundKeyDown);\n    } else {\n      this.#hide();\n      this.#container.removeEventListener(\"click\", this.#boundToggle);\n      this.#container.removeEventListener(\"keydown\", this.#boundKeyDown);\n    }\n  }\n\n  /**\n   * Show the popup.\n   */\n  #show() {\n    if (!this.#popup) {\n      this.render();\n    }\n    if (!this.isVisible) {\n      this.#setPosition();\n      this.#container.hidden = false;\n      this.#container.style.zIndex =\n        parseInt(this.#container.style.zIndex) + 1000;\n    } else if (this.#pinned) {\n      this.#container.classList.add(\"focused\");\n    }\n  }\n\n  /**\n   * Hide the popup.\n   */\n  #hide() {\n    this.#container.classList.remove(\"focused\");\n    if (this.#pinned || !this.isVisible) {\n      return;\n    }\n    this.#container.hidden = true;\n    this.#container.style.zIndex =\n      parseInt(this.#container.style.zIndex) - 1000;\n  }\n\n  forceHide() {\n    this.#wasVisible = this.isVisible;\n    if (!this.#wasVisible) {\n      return;\n    }\n    this.#container.hidden = true;\n  }\n\n  maybeShow() {\n    if (!this.#wasVisible) {\n      return;\n    }\n    if (!this.#popup) {\n      this.#show();\n    }\n    this.#wasVisible = false;\n    this.#container.hidden = false;\n  }\n\n  get isVisible() {\n    return this.#container.hidden === false;\n  }\n}\n\nclass FreeTextAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n    this.textContent = parameters.data.textContent;\n    this.textPosition = parameters.data.textPosition;\n    this.annotationEditorType = AnnotationEditorType.FREETEXT;\n  }\n\n  render() {\n    this.container.classList.add(\"freeTextAnnotation\");\n\n    if (this.textContent) {\n      const content = document.createElement(\"div\");\n      content.classList.add(\"annotationTextContent\");\n      content.setAttribute(\"role\", \"comment\");\n      for (const line of this.textContent) {\n        const lineSpan = document.createElement(\"span\");\n        lineSpan.textContent = line;\n        content.append(lineSpan);\n      }\n      this.container.append(content);\n    }\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this._editOnDoubleClick();\n\n    return this.container;\n  }\n}\n\nclass LineAnnotationElement extends AnnotationElement {\n  #line = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"lineAnnotation\");\n\n    // Create an invisible line with the same starting and ending coordinates\n    // that acts as the trigger for the popup. Only the line itself should\n    // trigger the popup, not the entire container.\n    const { data, width, height } = this;\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // PDF coordinates are calculated from a bottom left origin, so transform\n    // the line coordinates to a top left origin for the SVG element.\n    const line = (this.#line = this.svgFactory.createElement(\"svg:line\"));\n    line.setAttribute(\"x1\", data.rect[2] - data.lineCoordinates[0]);\n    line.setAttribute(\"y1\", data.rect[3] - data.lineCoordinates[1]);\n    line.setAttribute(\"x2\", data.rect[2] - data.lineCoordinates[2]);\n    line.setAttribute(\"y2\", data.rect[3] - data.lineCoordinates[3]);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    line.setAttribute(\"stroke-width\", data.borderStyle.width || 1);\n    line.setAttribute(\"stroke\", \"transparent\");\n    line.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(line);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the line instead\n    // of to the entire container (which is the default).\n    if (!data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#line;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass SquareAnnotationElement extends AnnotationElement {\n  #square = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"squareAnnotation\");\n\n    // Create an invisible square with the same rectangle that acts as the\n    // trigger for the popup. Only the square itself should trigger the\n    // popup, not the entire container.\n    const { data, width, height } = this;\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // The browser draws half of the borders inside the square and half of\n    // the borders outside the square by default. This behavior cannot be\n    // changed programmatically, so correct for that here.\n    const borderWidth = data.borderStyle.width;\n    const square = (this.#square = this.svgFactory.createElement(\"svg:rect\"));\n    square.setAttribute(\"x\", borderWidth / 2);\n    square.setAttribute(\"y\", borderWidth / 2);\n    square.setAttribute(\"width\", width - borderWidth);\n    square.setAttribute(\"height\", height - borderWidth);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    square.setAttribute(\"stroke-width\", borderWidth || 1);\n    square.setAttribute(\"stroke\", \"transparent\");\n    square.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(square);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the square instead\n    // of to the entire container (which is the default).\n    if (!data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#square;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass CircleAnnotationElement extends AnnotationElement {\n  #circle = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"circleAnnotation\");\n\n    // Create an invisible circle with the same ellipse that acts as the\n    // trigger for the popup. Only the circle itself should trigger the\n    // popup, not the entire container.\n    const { data, width, height } = this;\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // The browser draws half of the borders inside the circle and half of\n    // the borders outside the circle by default. This behavior cannot be\n    // changed programmatically, so correct for that here.\n    const borderWidth = data.borderStyle.width;\n    const circle = (this.#circle =\n      this.svgFactory.createElement(\"svg:ellipse\"));\n    circle.setAttribute(\"cx\", width / 2);\n    circle.setAttribute(\"cy\", height / 2);\n    circle.setAttribute(\"rx\", width / 2 - borderWidth / 2);\n    circle.setAttribute(\"ry\", height / 2 - borderWidth / 2);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    circle.setAttribute(\"stroke-width\", borderWidth || 1);\n    circle.setAttribute(\"stroke\", \"transparent\");\n    circle.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(circle);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the circle instead\n    // of to the entire container (which is the default).\n    if (!data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#circle;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass PolylineAnnotationElement extends AnnotationElement {\n  #polyline = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n\n    this.containerClassName = \"polylineAnnotation\";\n    this.svgElementName = \"svg:polyline\";\n  }\n\n  render() {\n    this.container.classList.add(this.containerClassName);\n\n    // Create an invisible polyline with the same points that acts as the\n    // trigger for the popup. Only the polyline itself should trigger the\n    // popup, not the entire container.\n    const {\n      data: { rect, vertices, borderStyle, popupRef },\n      width,\n      height,\n    } = this;\n    if (!vertices) {\n      return this.container;\n    }\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n\n    // Convert the vertices array to a single points string that the SVG\n    // polyline element expects (\"x1,y1 x2,y2 ...\"). PDF coordinates are\n    // calculated from a bottom left origin, so transform the polyline\n    // coordinates to a top left origin for the SVG element.\n    let points = [];\n    for (let i = 0, ii = vertices.length; i < ii; i += 2) {\n      const x = vertices[i] - rect[0];\n      const y = rect[3] - vertices[i + 1];\n      points.push(`${x},${y}`);\n    }\n    points = points.join(\" \");\n\n    const polyline = (this.#polyline = this.svgFactory.createElement(\n      this.svgElementName\n    ));\n    polyline.setAttribute(\"points\", points);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    polyline.setAttribute(\"stroke-width\", borderStyle.width || 1);\n    polyline.setAttribute(\"stroke\", \"transparent\");\n    polyline.setAttribute(\"fill\", \"transparent\");\n\n    svg.append(polyline);\n    this.container.append(svg);\n\n    // Create the popup ourselves so that we can bind it to the polyline\n    // instead of to the entire container (which is the default).\n    if (!popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    return this.container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#polyline;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass PolygonAnnotationElement extends PolylineAnnotationElement {\n  constructor(parameters) {\n    // Polygons are specific forms of polylines, so reuse their logic.\n    super(parameters);\n\n    this.containerClassName = \"polygonAnnotation\";\n    this.svgElementName = \"svg:polygon\";\n  }\n}\n\nclass CaretAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n  }\n\n  render() {\n    this.container.classList.add(\"caretAnnotation\");\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n    return this.container;\n  }\n}\n\nclass InkAnnotationElement extends AnnotationElement {\n  #polylinesGroupElement = null;\n\n  #polylines = [];\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n\n    this.containerClassName = \"inkAnnotation\";\n\n    // Use the polyline SVG element since it allows us to use coordinates\n    // directly and to draw both straight lines and curves.\n    this.svgElementName = \"svg:polyline\";\n\n    this.annotationEditorType =\n      this.data.it === \"InkHighlight\"\n        ? AnnotationEditorType.HIGHLIGHT\n        : AnnotationEditorType.INK;\n  }\n\n  #getTransform(rotation, rect) {\n    // PDF coordinates are calculated from a bottom left origin, so\n    // transform the polyline coordinates to a top left origin for the\n    // SVG element.\n    switch (rotation) {\n      case 90:\n        return {\n          transform: `rotate(90) translate(${-rect[0]},${rect[1]}) scale(1,-1)`,\n          width: rect[3] - rect[1],\n          height: rect[2] - rect[0],\n        };\n      case 180:\n        return {\n          transform: `rotate(180) translate(${-rect[2]},${rect[1]}) scale(1,-1)`,\n          width: rect[2] - rect[0],\n          height: rect[3] - rect[1],\n        };\n      case 270:\n        return {\n          transform: `rotate(270) translate(${-rect[2]},${rect[3]}) scale(1,-1)`,\n          width: rect[3] - rect[1],\n          height: rect[2] - rect[0],\n        };\n      default:\n        return {\n          transform: `translate(${-rect[0]},${rect[3]}) scale(1,-1)`,\n          width: rect[2] - rect[0],\n          height: rect[3] - rect[1],\n        };\n    }\n  }\n\n  render() {\n    this.container.classList.add(this.containerClassName);\n\n    // Create an invisible polyline with the same points that acts as the\n    // trigger for the popup.\n    const {\n      data: { rect, rotation, inkLists, borderStyle, popupRef },\n    } = this;\n    const { transform, width, height } = this.#getTransform(rotation, rect);\n\n    const svg = this.svgFactory.create(\n      width,\n      height,\n      /* skipDimensions = */ true\n    );\n    const g = (this.#polylinesGroupElement =\n      this.svgFactory.createElement(\"svg:g\"));\n    svg.append(g);\n    // Ensure that the 'stroke-width' is always non-zero, since otherwise it\n    // won't be possible to open/close the popup (note e.g. issue 11122).\n    g.setAttribute(\"stroke-width\", borderStyle.width || 1);\n    g.setAttribute(\"stroke-linecap\", \"round\");\n    g.setAttribute(\"stroke-linejoin\", \"round\");\n    g.setAttribute(\"stroke-miterlimit\", 10);\n    g.setAttribute(\"stroke\", \"transparent\");\n    g.setAttribute(\"fill\", \"transparent\");\n    g.setAttribute(\"transform\", transform);\n\n    for (let i = 0, ii = inkLists.length; i < ii; i++) {\n      const polyline = this.svgFactory.createElement(this.svgElementName);\n      this.#polylines.push(polyline);\n      polyline.setAttribute(\"points\", inkLists[i].join(\",\"));\n      g.append(polyline);\n    }\n\n    if (!popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this.container.append(svg);\n    this._editOnDoubleClick();\n\n    return this.container;\n  }\n\n  updateEdited(params) {\n    super.updateEdited(params);\n    const { thickness, points, rect } = params;\n    const g = this.#polylinesGroupElement;\n    if (thickness >= 0) {\n      g.setAttribute(\"stroke-width\", thickness || 1);\n    }\n    if (points) {\n      for (let i = 0, ii = this.#polylines.length; i < ii; i++) {\n        this.#polylines[i].setAttribute(\"points\", points[i].join(\",\"));\n      }\n    }\n    if (rect) {\n      const { transform, width, height } = this.#getTransform(\n        this.data.rotation,\n        rect\n      );\n      const root = g.parentElement;\n      root.setAttribute(\"viewBox\", `0 0 ${width} ${height}`);\n      g.setAttribute(\"transform\", transform);\n    }\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#polylines;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n}\n\nclass HighlightAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n    this.annotationEditorType = AnnotationEditorType.HIGHLIGHT;\n  }\n\n  render() {\n    const {\n      data: { overlaidText, popupRef },\n    } = this;\n    if (!popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"highlightAnnotation\");\n    this._editOnDoubleClick();\n\n    if (overlaidText) {\n      const mark = document.createElement(\"mark\");\n      mark.classList.add(\"overlaidText\");\n      mark.textContent = overlaidText;\n      this.container.append(mark);\n    }\n\n    return this.container;\n  }\n}\n\nclass UnderlineAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    const {\n      data: { overlaidText, popupRef },\n    } = this;\n    if (!popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"underlineAnnotation\");\n\n    if (overlaidText) {\n      const underline = document.createElement(\"u\");\n      underline.classList.add(\"overlaidText\");\n      underline.textContent = overlaidText;\n      this.container.append(underline);\n    }\n\n    return this.container;\n  }\n}\n\nclass SquigglyAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    const {\n      data: { overlaidText, popupRef },\n    } = this;\n    if (!popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"squigglyAnnotation\");\n\n    if (overlaidText) {\n      const underline = document.createElement(\"u\");\n      underline.classList.add(\"overlaidText\");\n      underline.textContent = overlaidText;\n      this.container.append(underline);\n    }\n\n    return this.container;\n  }\n}\n\nclass StrikeOutAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, {\n      isRenderable: true,\n      ignoreBorder: true,\n      createQuadrilaterals: true,\n    });\n  }\n\n  render() {\n    const {\n      data: { overlaidText, popupRef },\n    } = this;\n    if (!popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n\n    this.container.classList.add(\"strikeoutAnnotation\");\n\n    if (overlaidText) {\n      const strikeout = document.createElement(\"s\");\n      strikeout.classList.add(\"overlaidText\");\n      strikeout.textContent = overlaidText;\n      this.container.append(strikeout);\n    }\n\n    return this.container;\n  }\n}\n\nclass StampAnnotationElement extends AnnotationElement {\n  constructor(parameters) {\n    super(parameters, { isRenderable: true, ignoreBorder: true });\n    this.annotationEditorType = AnnotationEditorType.STAMP;\n  }\n\n  render() {\n    this.container.classList.add(\"stampAnnotation\");\n    this.container.setAttribute(\"role\", \"img\");\n\n    if (!this.data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    }\n    this._editOnDoubleClick();\n\n    return this.container;\n  }\n}\n\nclass FileAttachmentAnnotationElement extends AnnotationElement {\n  #trigger = null;\n\n  constructor(parameters) {\n    super(parameters, { isRenderable: true });\n\n    const { file } = this.data;\n    this.filename = file.filename;\n    this.content = file.content;\n\n    this.linkService.eventBus?.dispatch(\"fileattachmentannotation\", {\n      source: this,\n      ...file,\n    });\n  }\n\n  render() {\n    this.container.classList.add(\"fileAttachmentAnnotation\");\n\n    const { container, data } = this;\n    let trigger;\n    if (data.hasAppearance || data.fillAlpha === 0) {\n      trigger = document.createElement(\"div\");\n    } else {\n      // Unfortunately it seems that it's not clearly specified exactly what\n      // names are actually valid, since Table 184 contains:\n      //   Conforming readers shall provide predefined icon appearances for at\n      //   least the following standard names: GraphPushPin, PaperclipTag.\n      //   Additional names may be supported as well. Default value: PushPin.\n      trigger = document.createElement(\"img\");\n      trigger.src = `${this.imageResourcesPath}annotation-${\n        /paperclip/i.test(data.name) ? \"paperclip\" : \"pushpin\"\n      }.svg`;\n\n      if (data.fillAlpha && data.fillAlpha < 1) {\n        trigger.style = `filter: opacity(${Math.round(\n          data.fillAlpha * 100\n        )}%);`;\n\n        if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n          this.container.classList.add(\"hasFillAlpha\");\n        }\n      }\n    }\n    trigger.addEventListener(\"dblclick\", this.#download.bind(this));\n    this.#trigger = trigger;\n\n    const { isMac } = FeatureTest.platform;\n    container.addEventListener(\"keydown\", evt => {\n      if (evt.key === \"Enter\" && (isMac ? evt.metaKey : evt.ctrlKey)) {\n        this.#download();\n      }\n    });\n\n    if (!data.popupRef && this.hasPopupData) {\n      this._createPopup();\n    } else {\n      trigger.classList.add(\"popupTriggerArea\");\n    }\n\n    container.append(trigger);\n    return container;\n  }\n\n  getElementsToTriggerPopup() {\n    return this.#trigger;\n  }\n\n  addHighlightArea() {\n    this.container.classList.add(\"highlightArea\");\n  }\n\n  /**\n   * Download the file attachment associated with this annotation.\n   */\n  #download() {\n    this.downloadManager?.openOrDownloadData(this.content, this.filename);\n  }\n}\n\n/**\n * @typedef {Object} AnnotationLayerParameters\n * @property {PageViewport} viewport\n * @property {HTMLDivElement} div\n * @property {Array} annotations\n * @property {PDFPageProxy} page\n * @property {IPDFLinkService} linkService\n * @property {IDownloadManager} [downloadManager]\n * @property {AnnotationStorage} [annotationStorage]\n * @property {string} [imageResourcesPath] - Path for image resources, mainly\n *   for annotation icons. Include trailing slash.\n * @property {boolean} renderForms\n * @property {boolean} [enableScripting] - Enable embedded script execution.\n * @property {boolean} [hasJSActions] - Some fields have JS actions.\n *   The default value is `false`.\n * @property {Object<string, Array<Object>> | null} [fieldObjects]\n * @property {Map<string, HTMLCanvasElement>} [annotationCanvasMap]\n * @property {TextAccessibilityManager} [accessibilityManager]\n * @property {AnnotationEditorUIManager} [annotationEditorUIManager]\n * @property {StructTreeLayerBuilder} [structTreeLayer]\n */\n\n/**\n * Manage the layer containing all the annotations.\n */\nclass AnnotationLayer {\n  #accessibilityManager = null;\n\n  #annotationCanvasMap = null;\n\n  #editableAnnotations = new Map();\n\n  #structTreeLayer = null;\n\n  constructor({\n    div,\n    accessibilityManager,\n    annotationCanvasMap,\n    annotationEditorUIManager,\n    page,\n    viewport,\n    structTreeLayer,\n  }) {\n    this.div = div;\n    this.#accessibilityManager = accessibilityManager;\n    this.#annotationCanvasMap = annotationCanvasMap;\n    this.#structTreeLayer = structTreeLayer || null;\n    this.page = page;\n    this.viewport = viewport;\n    this.zIndex = 0;\n    this._annotationEditorUIManager = annotationEditorUIManager;\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      // For testing purposes.\n      Object.defineProperty(this, \"showPopups\", {\n        value: async () => {\n          for (const show of this.popupShow) {\n            await show();\n          }\n        },\n      });\n      this.popupShow = [];\n    }\n  }\n\n  hasEditableAnnotations() {\n    return this.#editableAnnotations.size > 0;\n  }\n\n  async #appendElement(element, id, popupElements) {\n    const contentElement = element.firstChild || element;\n    const annotationId = (contentElement.id = `${AnnotationPrefix}${id}`);\n    const ariaAttributes =\n      await this.#structTreeLayer?.getAriaAttributes(annotationId);\n    if (ariaAttributes) {\n      for (const [key, value] of ariaAttributes) {\n        contentElement.setAttribute(key, value);\n      }\n    }\n\n    if (popupElements) {\n      // Set the popup just after the first element associated with the popup.\n      popupElements.at(-1).container.after(element);\n    } else {\n      this.div.append(element);\n      this.#accessibilityManager?.moveElementInDOM(\n        this.div,\n        element,\n        contentElement,\n        /* isRemovable = */ false\n      );\n    }\n  }\n\n  /**\n   * Render a new annotation layer with all annotation elements.\n   *\n   * @param {AnnotationLayerParameters} params\n   * @memberof AnnotationLayer\n   */\n  async render(params) {\n    const { annotations } = params;\n    const layer = this.div;\n    setLayerDimensions(layer, this.viewport);\n\n    const popupToElements = new Map();\n    const elementParams = {\n      data: null,\n      layer,\n      linkService: params.linkService,\n      downloadManager: params.downloadManager,\n      imageResourcesPath: params.imageResourcesPath || \"\",\n      renderForms: params.renderForms !== false,\n      svgFactory: new DOMSVGFactory(),\n      annotationStorage: params.annotationStorage || new AnnotationStorage(),\n      enableScripting: params.enableScripting === true,\n      hasJSActions: params.hasJSActions,\n      fieldObjects: params.fieldObjects,\n      parent: this,\n      elements: null,\n    };\n\n    for (const data of annotations) {\n      if (data.noHTML) {\n        continue;\n      }\n      const isPopupAnnotation = data.annotationType === AnnotationType.POPUP;\n      if (!isPopupAnnotation) {\n        if (data.rect[2] === data.rect[0] || data.rect[3] === data.rect[1]) {\n          continue; // Ignore empty annotations.\n        }\n      } else {\n        const elements = popupToElements.get(data.id);\n        if (!elements) {\n          // Ignore popup annotations without a corresponding annotation.\n          continue;\n        }\n        elementParams.elements = elements;\n      }\n      elementParams.data = data;\n      const element = AnnotationElementFactory.create(elementParams);\n\n      if (!element.isRenderable) {\n        continue;\n      }\n\n      if (!isPopupAnnotation && data.popupRef) {\n        const elements = popupToElements.get(data.popupRef);\n        if (!elements) {\n          popupToElements.set(data.popupRef, [element]);\n        } else {\n          elements.push(element);\n        }\n      }\n\n      const rendered = element.render();\n      if (data.hidden) {\n        rendered.style.visibility = \"hidden\";\n      }\n      await this.#appendElement(rendered, data.id, elementParams.elements);\n\n      if (element._isEditable) {\n        this.#editableAnnotations.set(element.data.id, element);\n        this._annotationEditorUIManager?.renderAnnotationElement(element);\n      }\n    }\n\n    this.#setAnnotationCanvasMap();\n  }\n\n  /**\n   * Add link annotations to the annotation layer.\n   *\n   * @param {Array<Object>} annotations\n   * @param {IPDFLinkService} linkService\n   * @memberof AnnotationLayer\n   */\n  async addLinkAnnotations(annotations, linkService) {\n    const elementParams = {\n      data: null,\n      layer: this.div,\n      linkService,\n      svgFactory: new DOMSVGFactory(),\n      parent: this,\n    };\n    for (const data of annotations) {\n      data.borderStyle ||= AnnotationLayer._defaultBorderStyle;\n\n      elementParams.data = data;\n      const element = AnnotationElementFactory.create(elementParams);\n\n      if (!element.isRenderable) {\n        continue;\n      }\n      const rendered = element.render();\n      await this.#appendElement(rendered, data.id, null);\n    }\n  }\n\n  /**\n   * Update the annotation elements on existing annotation layer.\n   *\n   * @param {AnnotationLayerParameters} viewport\n   * @memberof AnnotationLayer\n   */\n  update({ viewport }) {\n    const layer = this.div;\n    this.viewport = viewport;\n    setLayerDimensions(layer, { rotation: viewport.rotation });\n\n    this.#setAnnotationCanvasMap();\n    layer.hidden = false;\n  }\n\n  #setAnnotationCanvasMap() {\n    if (!this.#annotationCanvasMap) {\n      return;\n    }\n    const layer = this.div;\n    for (const [id, canvas] of this.#annotationCanvasMap) {\n      const element = layer.querySelector(`[data-annotation-id=\"${id}\"]`);\n      if (!element) {\n        continue;\n      }\n\n      canvas.className = \"annotationContent\";\n      const { firstChild } = element;\n      if (!firstChild) {\n        element.append(canvas);\n      } else if (firstChild.nodeName === \"CANVAS\") {\n        firstChild.replaceWith(canvas);\n      } else if (!firstChild.classList.contains(\"annotationContent\")) {\n        firstChild.before(canvas);\n      } else {\n        firstChild.after(canvas);\n      }\n\n      const editableAnnotation = this.#editableAnnotations.get(id);\n      if (!editableAnnotation) {\n        continue;\n      }\n      if (editableAnnotation._hasNoCanvas) {\n        // The canvas wasn't available when the annotation was created.\n        this._annotationEditorUIManager?.setMissingCanvas(\n          id,\n          element.id,\n          canvas\n        );\n        editableAnnotation._hasNoCanvas = false;\n      } else {\n        editableAnnotation.canvas = canvas;\n      }\n    }\n    this.#annotationCanvasMap.clear();\n  }\n\n  getEditableAnnotations() {\n    return Array.from(this.#editableAnnotations.values());\n  }\n\n  getEditableAnnotation(id) {\n    return this.#editableAnnotations.get(id);\n  }\n\n  /**\n   * @private\n   */\n  static get _defaultBorderStyle() {\n    return shadow(\n      this,\n      \"_defaultBorderStyle\",\n      Object.freeze({\n        width: 1,\n        rawWidth: 1,\n        style: AnnotationBorderStyleType.SOLID,\n        dashArray: [3],\n        horizontalCornerRadius: 0,\n        verticalCornerRadius: 0,\n      })\n    );\n  }\n}\n\nexport {\n  AnnotationLayer,\n  FreeTextAnnotationElement,\n  HighlightAnnotationElement,\n  InkAnnotationElement,\n  StampAnnotationElement,\n};\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./annotation_editor_layer.js\").AnnotationEditorLayer} AnnotationEditorLayer */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  assert,\n  LINE_FACTOR,\n  shadow,\n  Util,\n} from \"../../shared/util.js\";\nimport { AnnotationEditorUIManager, KeyboardManager } from \"./tools.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { FreeTextAnnotationElement } from \"../annotation_layer.js\";\n\nconst EOL_PATTERN = /\\r\\n?|\\n/g;\n\n/**\n * Basic text editor in order to create a FreeTex annotation.\n */\nclass FreeTextEditor extends AnnotationEditor {\n  #color;\n\n  #content = \"\";\n\n  #editorDivId = `${this.id}-editor`;\n\n  #editModeAC = null;\n\n  #fontSize;\n\n  static _freeTextDefaultContent = \"\";\n\n  static _internalPadding = 0;\n\n  static _defaultColor = null;\n\n  static _defaultFontSize = 10;\n\n  static get _keyboardManager() {\n    const proto = FreeTextEditor.prototype;\n\n    const arrowChecker = self => self.isEmpty();\n\n    const small = AnnotationEditorUIManager.TRANSLATE_SMALL;\n    const big = AnnotationEditorUIManager.TRANSLATE_BIG;\n\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [\n          // Commit the text in case the user use ctrl+s to save the document.\n          // The event must bubble in order to be caught by the viewer.\n          // See bug 1831574.\n          [\"ctrl+s\", \"mac+meta+s\", \"ctrl+p\", \"mac+meta+p\"],\n          proto.commitOrRemove,\n          { bubbles: true },\n        ],\n        [\n          [\"ctrl+Enter\", \"mac+meta+Enter\", \"Escape\", \"mac+Escape\"],\n          proto.commitOrRemove,\n        ],\n        [\n          [\"ArrowLeft\", \"mac+ArrowLeft\"],\n          proto._translateEmpty,\n          { args: [-small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowLeft\", \"mac+shift+ArrowLeft\"],\n          proto._translateEmpty,\n          { args: [-big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowRight\", \"mac+ArrowRight\"],\n          proto._translateEmpty,\n          { args: [small, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowRight\", \"mac+shift+ArrowRight\"],\n          proto._translateEmpty,\n          { args: [big, 0], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowUp\", \"mac+ArrowUp\"],\n          proto._translateEmpty,\n          { args: [0, -small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowUp\", \"mac+shift+ArrowUp\"],\n          proto._translateEmpty,\n          { args: [0, -big], checker: arrowChecker },\n        ],\n        [\n          [\"ArrowDown\", \"mac+ArrowDown\"],\n          proto._translateEmpty,\n          { args: [0, small], checker: arrowChecker },\n        ],\n        [\n          [\"ctrl+ArrowDown\", \"mac+shift+ArrowDown\"],\n          proto._translateEmpty,\n          { args: [0, big], checker: arrowChecker },\n        ],\n      ])\n    );\n  }\n\n  static _type = \"freetext\";\n\n  static _editorType = AnnotationEditorType.FREETEXT;\n\n  constructor(params) {\n    super({ ...params, name: \"freeTextEditor\" });\n    this.#color =\n      params.color ||\n      FreeTextEditor._defaultColor ||\n      AnnotationEditor._defaultLineColor;\n    this.#fontSize = params.fontSize || FreeTextEditor._defaultFontSize;\n    if (!this.annotationElementId) {\n      this._uiManager.a11yAlert(\"pdfjs-editor-freetext-added-alert\");\n    }\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n    const style = getComputedStyle(document.documentElement);\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      const lineHeight = parseFloat(\n        style.getPropertyValue(\"--freetext-line-height\")\n      );\n      assert(\n        lineHeight === LINE_FACTOR,\n        \"Update the CSS variable to agree with the constant.\"\n      );\n    }\n\n    this._internalPadding = parseFloat(\n      style.getPropertyValue(\"--freetext-padding\")\n    );\n  }\n\n  /** @inheritdoc */\n  static updateDefaultParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.FREETEXT_SIZE:\n        FreeTextEditor._defaultFontSize = value;\n        break;\n      case AnnotationEditorParamsType.FREETEXT_COLOR:\n        FreeTextEditor._defaultColor = value;\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  updateParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.FREETEXT_SIZE:\n        this.#updateFontSize(value);\n        break;\n      case AnnotationEditorParamsType.FREETEXT_COLOR:\n        this.#updateColor(value);\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  static get defaultPropertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.FREETEXT_SIZE,\n        FreeTextEditor._defaultFontSize,\n      ],\n      [\n        AnnotationEditorParamsType.FREETEXT_COLOR,\n        FreeTextEditor._defaultColor || AnnotationEditor._defaultLineColor,\n      ],\n    ];\n  }\n\n  /** @inheritdoc */\n  get propertiesToUpdate() {\n    return [\n      [AnnotationEditorParamsType.FREETEXT_SIZE, this.#fontSize],\n      [AnnotationEditorParamsType.FREETEXT_COLOR, this.#color],\n    ];\n  }\n\n  /**\n   * Update the font size and make this action as undoable.\n   * @param {number} fontSize\n   */\n  #updateFontSize(fontSize) {\n    const setFontsize = size => {\n      this.editorDiv.style.fontSize = `calc(${size}px * var(--total-scale-factor))`;\n      this.translate(0, -(size - this.#fontSize) * this.parentScale);\n      this.#fontSize = size;\n      this.#setEditorDimensions();\n    };\n    const savedFontsize = this.#fontSize;\n    this.addCommands({\n      cmd: setFontsize.bind(this, fontSize),\n      undo: setFontsize.bind(this, savedFontsize),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.FREETEXT_SIZE,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /**\n   * Update the color and make this action undoable.\n   * @param {string} color\n   */\n  #updateColor(color) {\n    const setColor = col => {\n      this.#color = this.editorDiv.style.color = col;\n    };\n    const savedColor = this.#color;\n    this.addCommands({\n      cmd: setColor.bind(this, color),\n      undo: setColor.bind(this, savedColor),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.FREETEXT_COLOR,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /**\n   * Helper to translate the editor with the keyboard when it's empty.\n   * @param {number} x in page units.\n   * @param {number} y in page units.\n   */\n  _translateEmpty(x, y) {\n    this._uiManager.translateSelectedEditors(x, y, /* noCommit = */ true);\n  }\n\n  /** @inheritdoc */\n  getInitialTranslation() {\n    // The start of the base line is where the user clicked.\n    const scale = this.parentScale;\n    return [\n      -FreeTextEditor._internalPadding * scale,\n      -(FreeTextEditor._internalPadding + this.#fontSize) * scale,\n    ];\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilting it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  /** @inheritdoc */\n  enableEditMode() {\n    if (!super.enableEditMode()) {\n      return false;\n    }\n\n    this.overlayDiv.classList.remove(\"enabled\");\n    this.editorDiv.contentEditable = true;\n    this._isDraggable = false;\n    this.div.removeAttribute(\"aria-activedescendant\");\n\n    if (typeof PDFJSDev === \"undefined\" || PDFJSDev.test(\"TESTING\")) {\n      assert(\n        !this.#editModeAC,\n        \"No `this.#editModeAC` AbortController should exist.\"\n      );\n    }\n    this.#editModeAC = new AbortController();\n    const signal = this._uiManager.combinedSignal(this.#editModeAC);\n\n    this.editorDiv.addEventListener(\n      \"keydown\",\n      this.editorDivKeydown.bind(this),\n      { signal }\n    );\n    this.editorDiv.addEventListener(\"focus\", this.editorDivFocus.bind(this), {\n      signal,\n    });\n    this.editorDiv.addEventListener(\"blur\", this.editorDivBlur.bind(this), {\n      signal,\n    });\n    this.editorDiv.addEventListener(\"input\", this.editorDivInput.bind(this), {\n      signal,\n    });\n    this.editorDiv.addEventListener(\"paste\", this.editorDivPaste.bind(this), {\n      signal,\n    });\n\n    return true;\n  }\n\n  /** @inheritdoc */\n  disableEditMode() {\n    if (!super.disableEditMode()) {\n      return false;\n    }\n\n    this.overlayDiv.classList.add(\"enabled\");\n    this.editorDiv.contentEditable = false;\n    this.div.setAttribute(\"aria-activedescendant\", this.#editorDivId);\n    this._isDraggable = true;\n\n    this.#editModeAC?.abort();\n    this.#editModeAC = null;\n\n    // On Chrome, the focus is given to <body> when contentEditable is set to\n    // false, hence we focus the div.\n    this.div.focus({\n      preventScroll: true /* See issue #15744 */,\n    });\n\n    // In case the blur callback hasn't been called.\n    this.isEditing = false;\n    this.parent.div.classList.add(\"freetextEditing\");\n\n    return true;\n  }\n\n  /** @inheritdoc */\n  focusin(event) {\n    if (!this._focusEventsAllowed) {\n      return;\n    }\n    super.focusin(event);\n    if (event.target !== this.editorDiv) {\n      this.editorDiv.focus();\n    }\n  }\n\n  /** @inheritdoc */\n  onceAdded(focus) {\n    if (this.width) {\n      // The editor was created in using ctrl+c.\n      return;\n    }\n    this.enableEditMode();\n    if (focus) {\n      this.editorDiv.focus();\n    }\n    if (this._initialOptions?.isCentered) {\n      this.center();\n    }\n    this._initialOptions = null;\n  }\n\n  /** @inheritdoc */\n  isEmpty() {\n    return !this.editorDiv || this.editorDiv.innerText.trim() === \"\";\n  }\n\n  /** @inheritdoc */\n  remove() {\n    this.isEditing = false;\n    if (this.parent) {\n      this.parent.setEditingState(true);\n      this.parent.div.classList.add(\"freetextEditing\");\n    }\n    super.remove();\n  }\n\n  /**\n   * Extract the text from this editor.\n   * @returns {string}\n   */\n  #extractText() {\n    // We don't use innerText because there are some bugs with line breaks.\n    const buffer = [];\n    this.editorDiv.normalize();\n    let prevChild = null;\n    for (const child of this.editorDiv.childNodes) {\n      if (prevChild?.nodeType === Node.TEXT_NODE && child.nodeName === \"BR\") {\n        // It can happen if the user uses shift+enter to add a new line.\n        // If we don't skip it, we'll end up with an extra line (one for the\n        // text and one for the br element).\n        continue;\n      }\n      buffer.push(FreeTextEditor.#getNodeContent(child));\n      prevChild = child;\n    }\n    return buffer.join(\"\\n\");\n  }\n\n  #setEditorDimensions() {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n\n    let rect;\n    if (this.isAttachedToDOM) {\n      rect = this.div.getBoundingClientRect();\n    } else {\n      // This editor isn't on screen but we need to get its dimensions, so\n      // we just insert it in the DOM, get its bounding box and then remove it.\n      const { currentLayer, div } = this;\n      const savedDisplay = div.style.display;\n      const savedVisibility = div.classList.contains(\"hidden\");\n      div.classList.remove(\"hidden\");\n      div.style.display = \"hidden\";\n      currentLayer.div.append(this.div);\n      rect = div.getBoundingClientRect();\n      div.remove();\n      div.style.display = savedDisplay;\n      div.classList.toggle(\"hidden\", savedVisibility);\n    }\n\n    // The dimensions are relative to the rotation of the page, hence we need to\n    // take that into account (see issue #16636).\n    if (this.rotation % 180 === this.parentRotation % 180) {\n      this.width = rect.width / parentWidth;\n      this.height = rect.height / parentHeight;\n    } else {\n      this.width = rect.height / parentWidth;\n      this.height = rect.width / parentHeight;\n    }\n    this.fixAndSetPosition();\n  }\n\n  /**\n   * Commit the content we have in this editor.\n   * @returns {undefined}\n   */\n  commit() {\n    if (!this.isInEditMode()) {\n      return;\n    }\n\n    super.commit();\n    this.disableEditMode();\n    const savedText = this.#content;\n    const newText = (this.#content = this.#extractText().trimEnd());\n    if (savedText === newText) {\n      return;\n    }\n\n    const setText = text => {\n      this.#content = text;\n      if (!text) {\n        this.remove();\n        return;\n      }\n      this.#setContent();\n      this._uiManager.rebuild(this);\n      this.#setEditorDimensions();\n    };\n    this.addCommands({\n      cmd: () => {\n        setText(newText);\n      },\n      undo: () => {\n        setText(savedText);\n      },\n      mustExec: false,\n    });\n    this.#setEditorDimensions();\n  }\n\n  /** @inheritdoc */\n  shouldGetKeyboardEvents() {\n    return this.isInEditMode();\n  }\n\n  /** @inheritdoc */\n  enterInEditMode() {\n    this.enableEditMode();\n    this.editorDiv.focus();\n  }\n\n  /** @inheritdoc */\n  keydown(event) {\n    if (event.target === this.div && event.key === \"Enter\") {\n      this.enterInEditMode();\n      // Avoid to add an unwanted new line.\n      event.preventDefault();\n    }\n  }\n\n  editorDivKeydown(event) {\n    FreeTextEditor._keyboardManager.exec(this, event);\n  }\n\n  editorDivFocus(event) {\n    this.isEditing = true;\n  }\n\n  editorDivBlur(event) {\n    this.isEditing = false;\n  }\n\n  editorDivInput(event) {\n    this.parent.div.classList.toggle(\"freetextEditing\", this.isEmpty());\n  }\n\n  /** @inheritdoc */\n  disableEditing() {\n    this.editorDiv.setAttribute(\"role\", \"comment\");\n    this.editorDiv.removeAttribute(\"aria-multiline\");\n  }\n\n  /** @inheritdoc */\n  enableEditing() {\n    this.editorDiv.setAttribute(\"role\", \"textbox\");\n    this.editorDiv.setAttribute(\"aria-multiline\", true);\n  }\n\n  /** @inheritdoc */\n  get canChangeContent() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    if (this._isCopy || this.annotationElementId) {\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    super.render();\n    this.editorDiv = document.createElement(\"div\");\n    this.editorDiv.className = \"internal\";\n\n    this.editorDiv.setAttribute(\"id\", this.#editorDivId);\n    this.editorDiv.setAttribute(\"data-l10n-id\", \"pdfjs-free-text2\");\n    this.editorDiv.setAttribute(\"data-l10n-attrs\", \"default-content\");\n    this.enableEditing();\n\n    this.editorDiv.contentEditable = true;\n\n    const { style } = this.editorDiv;\n    style.fontSize = `calc(${this.#fontSize}px * var(--total-scale-factor))`;\n    style.color = this.#color;\n\n    this.div.append(this.editorDiv);\n\n    this.overlayDiv = document.createElement(\"div\");\n    this.overlayDiv.classList.add(\"overlay\", \"enabled\");\n    this.div.append(this.overlayDiv);\n\n    if (this._isCopy || this.annotationElementId) {\n      // This editor was created in using copy (ctrl+c).\n      const [parentWidth, parentHeight] = this.parentDimensions;\n      if (this.annotationElementId) {\n        // This stuff is hard to test: if something is changed here, please\n        // test with the following PDF file:\n        //  - freetexts.pdf\n        //  - rotated_freetexts.pdf\n        // Only small variations between the original annotation and its editor\n        // are allowed.\n\n        // position is the position of the first glyph in the annotation\n        // and it's relative to its container.\n        const { position } = this._initialData;\n        let [tx, ty] = this.getInitialTranslation();\n        [tx, ty] = this.pageTranslationToScreen(tx, ty);\n        const [pageWidth, pageHeight] = this.pageDimensions;\n        const [pageX, pageY] = this.pageTranslation;\n        let posX, posY;\n        switch (this.rotation) {\n          case 0:\n            posX = baseX + (position[0] - pageX) / pageWidth;\n            posY = baseY + this.height - (position[1] - pageY) / pageHeight;\n            break;\n          case 90:\n            posX = baseX + (position[0] - pageX) / pageWidth;\n            posY = baseY - (position[1] - pageY) / pageHeight;\n            [tx, ty] = [ty, -tx];\n            break;\n          case 180:\n            posX = baseX - this.width + (position[0] - pageX) / pageWidth;\n            posY = baseY - (position[1] - pageY) / pageHeight;\n            [tx, ty] = [-tx, -ty];\n            break;\n          case 270:\n            posX =\n              baseX +\n              (position[0] - pageX - this.height * pageHeight) / pageWidth;\n            posY =\n              baseY +\n              (position[1] - pageY - this.width * pageWidth) / pageHeight;\n            [tx, ty] = [-ty, tx];\n            break;\n        }\n        this.setAt(posX * parentWidth, posY * parentHeight, tx, ty);\n      } else {\n        this._moveAfterPaste(baseX, baseY);\n      }\n\n      this.#setContent();\n      this._isDraggable = true;\n      this.editorDiv.contentEditable = false;\n    } else {\n      this._isDraggable = false;\n      this.editorDiv.contentEditable = true;\n    }\n\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      this.div.setAttribute(\"annotation-id\", this.annotationElementId);\n    }\n\n    return this.div;\n  }\n\n  static #getNodeContent(node) {\n    return (\n      node.nodeType === Node.TEXT_NODE ? node.nodeValue : node.innerText\n    ).replaceAll(EOL_PATTERN, \"\");\n  }\n\n  editorDivPaste(event) {\n    const clipboardData = event.clipboardData || window.clipboardData;\n    const { types } = clipboardData;\n    if (types.length === 1 && types[0] === \"text/plain\") {\n      return;\n    }\n\n    event.preventDefault();\n    const paste = FreeTextEditor.#deserializeContent(\n      clipboardData.getData(\"text\") || \"\"\n    ).replaceAll(EOL_PATTERN, \"\\n\");\n    if (!paste) {\n      return;\n    }\n    const selection = window.getSelection();\n    if (!selection.rangeCount) {\n      return;\n    }\n    this.editorDiv.normalize();\n    selection.deleteFromDocument();\n    const range = selection.getRangeAt(0);\n    if (!paste.includes(\"\\n\")) {\n      range.insertNode(document.createTextNode(paste));\n      this.editorDiv.normalize();\n      selection.collapseToStart();\n      return;\n    }\n\n    // Collect the text before and after the caret.\n    const { startContainer, startOffset } = range;\n    const bufferBefore = [];\n    const bufferAfter = [];\n    if (startContainer.nodeType === Node.TEXT_NODE) {\n      const parent = startContainer.parentElement;\n      bufferAfter.push(\n        startContainer.nodeValue.slice(startOffset).replaceAll(EOL_PATTERN, \"\")\n      );\n      if (parent !== this.editorDiv) {\n        let buffer = bufferBefore;\n        for (const child of this.editorDiv.childNodes) {\n          if (child === parent) {\n            buffer = bufferAfter;\n            continue;\n          }\n          buffer.push(FreeTextEditor.#getNodeContent(child));\n        }\n      }\n      bufferBefore.push(\n        startContainer.nodeValue\n          .slice(0, startOffset)\n          .replaceAll(EOL_PATTERN, \"\")\n      );\n    } else if (startContainer === this.editorDiv) {\n      let buffer = bufferBefore;\n      let i = 0;\n      for (const child of this.editorDiv.childNodes) {\n        if (i++ === startOffset) {\n          buffer = bufferAfter;\n        }\n        buffer.push(FreeTextEditor.#getNodeContent(child));\n      }\n    }\n    this.#content = `${bufferBefore.join(\"\\n\")}${paste}${bufferAfter.join(\"\\n\")}`;\n    this.#setContent();\n\n    // Set the caret at the right position.\n    const newRange = new Range();\n    let beforeLength = Math.sumPrecise(bufferBefore.map(line => line.length));\n    for (const { firstChild } of this.editorDiv.childNodes) {\n      // Each child is either a div with a text node or a br element.\n      if (firstChild.nodeType === Node.TEXT_NODE) {\n        const length = firstChild.nodeValue.length;\n        if (beforeLength <= length) {\n          newRange.setStart(firstChild, beforeLength);\n          newRange.setEnd(firstChild, beforeLength);\n          break;\n        }\n        beforeLength -= length;\n      }\n    }\n    selection.removeAllRanges();\n    selection.addRange(newRange);\n  }\n\n  #setContent() {\n    this.editorDiv.replaceChildren();\n    if (!this.#content) {\n      return;\n    }\n    for (const line of this.#content.split(\"\\n\")) {\n      const div = document.createElement(\"div\");\n      div.append(\n        line ? document.createTextNode(line) : document.createElement(\"br\")\n      );\n      this.editorDiv.append(div);\n    }\n  }\n\n  #serializeContent() {\n    return this.#content.replaceAll(\"\\xa0\", \" \");\n  }\n\n  static #deserializeContent(content) {\n    return content.replaceAll(\" \", \"\\xa0\");\n  }\n\n  /** @inheritdoc */\n  get contentDiv() {\n    return this.editorDiv;\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    let initialData = null;\n    if (data instanceof FreeTextAnnotationElement) {\n      const {\n        data: {\n          defaultAppearanceData: { fontSize, fontColor },\n          rect,\n          rotation,\n          id,\n          popupRef,\n        },\n        textContent,\n        textPosition,\n        parent: {\n          page: { pageNumber },\n        },\n      } = data;\n      // textContent is supposed to be an array of strings containing each line\n      // of text. However, it can be null or empty.\n      if (!textContent || textContent.length === 0) {\n        // Empty annotation.\n        return null;\n      }\n      initialData = data = {\n        annotationType: AnnotationEditorType.FREETEXT,\n        color: Array.from(fontColor),\n        fontSize,\n        value: textContent.join(\"\\n\"),\n        position: textPosition,\n        pageIndex: pageNumber - 1,\n        rect: rect.slice(0),\n        rotation,\n        annotationElementId: id,\n        id,\n        deleted: false,\n        popupRef,\n      };\n    }\n    const editor = await super.deserialize(data, parent, uiManager);\n    editor.#fontSize = data.fontSize;\n    editor.#color = Util.makeHexColor(...data.color);\n    editor.#content = FreeTextEditor.#deserializeContent(data.value);\n    editor._initialData = initialData;\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false) {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    if (this.deleted) {\n      return this.serializeDeleted();\n    }\n\n    const padding = FreeTextEditor._internalPadding * this.parentScale;\n    const rect = this.getRect(padding, padding);\n    const color = AnnotationEditor._colorManager.convert(\n      this.isAttachedToDOM\n        ? getComputedStyle(this.editorDiv).color\n        : this.#color\n    );\n\n    const serialized = {\n      annotationType: AnnotationEditorType.FREETEXT,\n      color,\n      fontSize: this.#fontSize,\n      value: this.#serializeContent(),\n      pageIndex: this.pageIndex,\n      rect,\n      rotation: this.rotation,\n      structTreeParentId: this._structTreeParentId,\n    };\n\n    if (isForCopying) {\n      // Don't add the id when copying because the pasted editor mustn't be\n      // linked to an existing annotation.\n      serialized.isCopy = true;\n      return serialized;\n    }\n\n    if (this.annotationElementId && !this.#hasElementChanged(serialized)) {\n      return null;\n    }\n\n    serialized.id = this.annotationElementId;\n\n    return serialized;\n  }\n\n  #hasElementChanged(serialized) {\n    const { value, fontSize, color, pageIndex } = this._initialData;\n\n    return (\n      this._hasBeenMoved ||\n      serialized.value !== value ||\n      serialized.fontSize !== fontSize ||\n      serialized.color.some((c, i) => c !== color[i]) ||\n      serialized.pageIndex !== pageIndex\n    );\n  }\n\n  /** @inheritdoc */\n  renderAnnotationElement(annotation) {\n    const content = super.renderAnnotationElement(annotation);\n    if (this.deleted) {\n      return content;\n    }\n    const { style } = content;\n    style.fontSize = `calc(${this.#fontSize}px * var(--total-scale-factor))`;\n    style.color = this.#color;\n\n    content.replaceChildren();\n    for (const line of this.#content.split(\"\\n\")) {\n      const div = document.createElement(\"div\");\n      div.append(\n        line ? document.createTextNode(line) : document.createElement(\"br\")\n      );\n      content.append(div);\n    }\n\n    const padding = FreeTextEditor._internalPadding * this.parentScale;\n    annotation.updateEdited({\n      rect: this.getRect(padding, padding),\n      popupContent: this.#content,\n    });\n\n    return content;\n  }\n\n  resetAnnotationElement(annotation) {\n    super.resetAnnotationElement(annotation);\n    annotation.resetEdited();\n  }\n}\n\nexport { FreeTextEditor };\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { unreachable } from \"../../../shared/util.js\";\n\nclass Outline {\n  static PRECISION = 1e-4;\n\n  /**\n   * @returns {string} The SVG path of the outline.\n   */\n  toSVGPath() {\n    unreachable(\"Abstract method `toSVGPath` must be implemented.\");\n  }\n\n  /**\n   * @type {Object|null} The bounding box of the outline.\n   */\n  // eslint-disable-next-line getter-return\n  get box() {\n    unreachable(\"Abstract getter `box` must be implemented.\");\n  }\n\n  serialize(_bbox, _rotation) {\n    unreachable(\"Abstract method `serialize` must be implemented.\");\n  }\n\n  static _rescale(src, tx, ty, sx, sy, dest) {\n    dest ||= new Float32Array(src.length);\n    for (let i = 0, ii = src.length; i < ii; i += 2) {\n      dest[i] = tx + src[i] * sx;\n      dest[i + 1] = ty + src[i + 1] * sy;\n    }\n    return dest;\n  }\n\n  static _rescaleAndSwap(src, tx, ty, sx, sy, dest) {\n    dest ||= new Float32Array(src.length);\n    for (let i = 0, ii = src.length; i < ii; i += 2) {\n      dest[i] = tx + src[i + 1] * sx;\n      dest[i + 1] = ty + src[i] * sy;\n    }\n    return dest;\n  }\n\n  static _translate(src, tx, ty, dest) {\n    dest ||= new Float32Array(src.length);\n    for (let i = 0, ii = src.length; i < ii; i += 2) {\n      dest[i] = tx + src[i];\n      dest[i + 1] = ty + src[i + 1];\n    }\n    return dest;\n  }\n\n  static svgRound(x) {\n    // 0.1234 will be 1234 and this way we economize 2 bytes per number.\n    // Of course, it makes sense only when the viewBox is [0 0 10000 10000].\n    // And it helps to avoid bugs like:\n    //  https://bugzilla.mozilla.org/show_bug.cgi?id=1929340\n    return Math.round(x * 10000);\n  }\n\n  static _normalizePoint(x, y, parentWidth, parentHeight, rotation) {\n    switch (rotation) {\n      case 90:\n        return [1 - y / parentWidth, x / parentHeight];\n      case 180:\n        return [1 - x / parentWidth, 1 - y / parentHeight];\n      case 270:\n        return [y / parentWidth, 1 - x / parentHeight];\n      default:\n        return [x / parentWidth, y / parentHeight];\n    }\n  }\n\n  static _normalizePagePoint(x, y, rotation) {\n    switch (rotation) {\n      case 90:\n        return [1 - y, x];\n      case 180:\n        return [1 - x, 1 - y];\n      case 270:\n        return [y, 1 - x];\n      default:\n        return [x, y];\n    }\n  }\n\n  static createBezierPoints(x1, y1, x2, y2, x3, y3) {\n    return [\n      (x1 + 5 * x2) / 6,\n      (y1 + 5 * y2) / 6,\n      (5 * x2 + x3) / 6,\n      (5 * y2 + y3) / 6,\n      (x2 + x3) / 2,\n      (y2 + y3) / 2,\n    ];\n  }\n}\n\nexport { Outline };\n","/* Copyright 2024 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Outline } from \"./outline.js\";\nimport { Util } from \"../../../shared/util.js\";\n\nclass FreeDrawOutliner {\n  #box;\n\n  #bottom = [];\n\n  #innerMargin;\n\n  #isLTR;\n\n  #top = [];\n\n  // The first 6 elements are the last 3 points of the top part of the outline.\n  // The next 6 elements are the last 3 points of the line.\n  // The next 6 elements are the last 3 points of the bottom part of the\n  // outline.\n  // We track the last 3 points in order to be able to:\n  //  - compute the normal of the line,\n  //  - compute the control points of the quadratic Bzier curve.\n  #last = new Float32Array(18);\n\n  #lastX;\n\n  #lastY;\n\n  #min;\n\n  #min_dist;\n\n  #scaleFactor;\n\n  #thickness;\n\n  #points = [];\n\n  static #MIN_DIST = 8;\n\n  static #MIN_DIFF = 2;\n\n  static #MIN = FreeDrawOutliner.#MIN_DIST + FreeDrawOutliner.#MIN_DIFF;\n\n  constructor({ x, y }, box, scaleFactor, thickness, isLTR, innerMargin = 0) {\n    this.#box = box;\n    this.#thickness = thickness * scaleFactor;\n    this.#isLTR = isLTR;\n    this.#last.set([NaN, NaN, NaN, NaN, x, y], 6);\n    this.#innerMargin = innerMargin;\n    this.#min_dist = FreeDrawOutliner.#MIN_DIST * scaleFactor;\n    this.#min = FreeDrawOutliner.#MIN * scaleFactor;\n    this.#scaleFactor = scaleFactor;\n    this.#points.push(x, y);\n  }\n\n  isEmpty() {\n    // When we add a second point then this.#last.slice(6) will be something\n    // like [NaN, NaN, firstX, firstY, secondX, secondY,...] so having a NaN\n    // at index 8 means that we've only one point.\n    return isNaN(this.#last[8]);\n  }\n\n  #getLastCoords() {\n    const lastTop = this.#last.subarray(4, 6);\n    const lastBottom = this.#last.subarray(16, 18);\n    const [x, y, width, height] = this.#box;\n\n    return [\n      (this.#lastX + (lastTop[0] - lastBottom[0]) / 2 - x) / width,\n      (this.#lastY + (lastTop[1] - lastBottom[1]) / 2 - y) / height,\n      (this.#lastX + (lastBottom[0] - lastTop[0]) / 2 - x) / width,\n      (this.#lastY + (lastBottom[1] - lastTop[1]) / 2 - y) / height,\n    ];\n  }\n\n  add({ x, y }) {\n    this.#lastX = x;\n    this.#lastY = y;\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n    let [x1, y1, x2, y2] = this.#last.subarray(8, 12);\n    const diffX = x - x2;\n    const diffY = y - y2;\n    const d = Math.hypot(diffX, diffY);\n    if (d < this.#min) {\n      // The idea is to avoid garbage points around the last point.\n      // When the points are too close, it just leads to bad normal vectors and\n      // control points.\n      return false;\n    }\n    const diffD = d - this.#min_dist;\n    const K = diffD / d;\n    const shiftX = K * diffX;\n    const shiftY = K * diffY;\n\n    // We update the last 3 points of the line.\n    let x0 = x1;\n    let y0 = y1;\n    x1 = x2;\n    y1 = y2;\n    x2 += shiftX;\n    y2 += shiftY;\n\n    // We keep track of the points in order to be able to compute the focus\n    // outline.\n    this.#points?.push(x, y);\n\n    // Create the normal unit vector.\n    // |(shiftX, shiftY)| = |K| * |(diffX, diffY)| = |K| * d = diffD.\n    const nX = -shiftY / diffD;\n    const nY = shiftX / diffD;\n    const thX = nX * this.#thickness;\n    const thY = nY * this.#thickness;\n    this.#last.set(this.#last.subarray(2, 8), 0);\n    this.#last.set([x2 + thX, y2 + thY], 4);\n    this.#last.set(this.#last.subarray(14, 18), 12);\n    this.#last.set([x2 - thX, y2 - thY], 16);\n\n    if (isNaN(this.#last[6])) {\n      if (this.#top.length === 0) {\n        this.#last.set([x1 + thX, y1 + thY], 2);\n        this.#top.push(\n          NaN,\n          NaN,\n          NaN,\n          NaN,\n          (x1 + thX - layerX) / layerWidth,\n          (y1 + thY - layerY) / layerHeight\n        );\n        this.#last.set([x1 - thX, y1 - thY], 14);\n        this.#bottom.push(\n          NaN,\n          NaN,\n          NaN,\n          NaN,\n          (x1 - thX - layerX) / layerWidth,\n          (y1 - thY - layerY) / layerHeight\n        );\n      }\n      this.#last.set([x0, y0, x1, y1, x2, y2], 6);\n      return !this.isEmpty();\n    }\n\n    this.#last.set([x0, y0, x1, y1, x2, y2], 6);\n\n    const angle = Math.abs(\n      Math.atan2(y0 - y1, x0 - x1) - Math.atan2(shiftY, shiftX)\n    );\n    if (angle < Math.PI / 2) {\n      // In order to avoid some possible artifacts, we're going to use the a\n      // straight line instead of a quadratic Bzier curve.\n      [x1, y1, x2, y2] = this.#last.subarray(2, 6);\n      this.#top.push(\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        ((x1 + x2) / 2 - layerX) / layerWidth,\n        ((y1 + y2) / 2 - layerY) / layerHeight\n      );\n      [x1, y1, x0, y0] = this.#last.subarray(14, 18);\n      this.#bottom.push(\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        ((x0 + x1) / 2 - layerX) / layerWidth,\n        ((y0 + y1) / 2 - layerY) / layerHeight\n      );\n      return true;\n    }\n\n    // Control points and the final point for the quadratic Bzier curve.\n    [x0, y0, x1, y1, x2, y2] = this.#last.subarray(0, 6);\n    this.#top.push(\n      ((x0 + 5 * x1) / 6 - layerX) / layerWidth,\n      ((y0 + 5 * y1) / 6 - layerY) / layerHeight,\n      ((5 * x1 + x2) / 6 - layerX) / layerWidth,\n      ((5 * y1 + y2) / 6 - layerY) / layerHeight,\n      ((x1 + x2) / 2 - layerX) / layerWidth,\n      ((y1 + y2) / 2 - layerY) / layerHeight\n    );\n    [x2, y2, x1, y1, x0, y0] = this.#last.subarray(12, 18);\n    this.#bottom.push(\n      ((x0 + 5 * x1) / 6 - layerX) / layerWidth,\n      ((y0 + 5 * y1) / 6 - layerY) / layerHeight,\n      ((5 * x1 + x2) / 6 - layerX) / layerWidth,\n      ((5 * y1 + y2) / 6 - layerY) / layerHeight,\n      ((x1 + x2) / 2 - layerX) / layerWidth,\n      ((y1 + y2) / 2 - layerY) / layerHeight\n    );\n    return true;\n  }\n\n  toSVGPath() {\n    if (this.isEmpty()) {\n      // We've only one point.\n      return \"\";\n    }\n    const top = this.#top;\n    const bottom = this.#bottom;\n\n    if (isNaN(this.#last[6]) && !this.isEmpty()) {\n      // We've only two points.\n      return this.#toSVGPathTwoPoints();\n    }\n\n    const buffer = [];\n    buffer.push(`M${top[4]} ${top[5]}`);\n    for (let i = 6; i < top.length; i += 6) {\n      if (isNaN(top[i])) {\n        buffer.push(`L${top[i + 4]} ${top[i + 5]}`);\n      } else {\n        buffer.push(\n          `C${top[i]} ${top[i + 1]} ${top[i + 2]} ${top[i + 3]} ${top[i + 4]} ${\n            top[i + 5]\n          }`\n        );\n      }\n    }\n\n    this.#toSVGPathEnd(buffer);\n\n    for (let i = bottom.length - 6; i >= 6; i -= 6) {\n      if (isNaN(bottom[i])) {\n        buffer.push(`L${bottom[i + 4]} ${bottom[i + 5]}`);\n      } else {\n        buffer.push(\n          `C${bottom[i]} ${bottom[i + 1]} ${bottom[i + 2]} ${bottom[i + 3]} ${\n            bottom[i + 4]\n          } ${bottom[i + 5]}`\n        );\n      }\n    }\n\n    this.#toSVGPathStart(buffer);\n\n    return buffer.join(\" \");\n  }\n\n  #toSVGPathTwoPoints() {\n    const [x, y, width, height] = this.#box;\n    const [lastTopX, lastTopY, lastBottomX, lastBottomY] =\n      this.#getLastCoords();\n\n    return `M${(this.#last[2] - x) / width} ${\n      (this.#last[3] - y) / height\n    } L${(this.#last[4] - x) / width} ${(this.#last[5] - y) / height} L${lastTopX} ${lastTopY} L${lastBottomX} ${lastBottomY} L${\n      (this.#last[16] - x) / width\n    } ${(this.#last[17] - y) / height} L${(this.#last[14] - x) / width} ${\n      (this.#last[15] - y) / height\n    } Z`;\n  }\n\n  #toSVGPathStart(buffer) {\n    const bottom = this.#bottom;\n    buffer.push(`L${bottom[4]} ${bottom[5]} Z`);\n  }\n\n  #toSVGPathEnd(buffer) {\n    const [x, y, width, height] = this.#box;\n    const lastTop = this.#last.subarray(4, 6);\n    const lastBottom = this.#last.subarray(16, 18);\n    const [lastTopX, lastTopY, lastBottomX, lastBottomY] =\n      this.#getLastCoords();\n\n    buffer.push(\n      `L${(lastTop[0] - x) / width} ${(lastTop[1] - y) / height} L${lastTopX} ${lastTopY} L${lastBottomX} ${lastBottomY} L${\n        (lastBottom[0] - x) / width\n      } ${(lastBottom[1] - y) / height}`\n    );\n  }\n\n  newFreeDrawOutline(outline, points, box, scaleFactor, innerMargin, isLTR) {\n    return new FreeDrawOutline(\n      outline,\n      points,\n      box,\n      scaleFactor,\n      innerMargin,\n      isLTR\n    );\n  }\n\n  getOutlines() {\n    const top = this.#top;\n    const bottom = this.#bottom;\n    const last = this.#last;\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n\n    const points = new Float32Array((this.#points?.length ?? 0) + 2);\n    for (let i = 0, ii = points.length - 2; i < ii; i += 2) {\n      points[i] = (this.#points[i] - layerX) / layerWidth;\n      points[i + 1] = (this.#points[i + 1] - layerY) / layerHeight;\n    }\n    points[points.length - 2] = (this.#lastX - layerX) / layerWidth;\n    points[points.length - 1] = (this.#lastY - layerY) / layerHeight;\n\n    if (isNaN(last[6]) && !this.isEmpty()) {\n      // We've only two points.\n      return this.#getOutlineTwoPoints(points);\n    }\n\n    const outline = new Float32Array(\n      this.#top.length + 24 + this.#bottom.length\n    );\n    let N = top.length;\n    for (let i = 0; i < N; i += 2) {\n      if (isNaN(top[i])) {\n        outline[i] = outline[i + 1] = NaN;\n        continue;\n      }\n      outline[i] = top[i];\n      outline[i + 1] = top[i + 1];\n    }\n\n    N = this.#getOutlineEnd(outline, N);\n\n    for (let i = bottom.length - 6; i >= 6; i -= 6) {\n      for (let j = 0; j < 6; j += 2) {\n        if (isNaN(bottom[i + j])) {\n          outline[N] = outline[N + 1] = NaN;\n          N += 2;\n          continue;\n        }\n        outline[N] = bottom[i + j];\n        outline[N + 1] = bottom[i + j + 1];\n        N += 2;\n      }\n    }\n\n    this.#getOutlineStart(outline, N);\n\n    return this.newFreeDrawOutline(\n      outline,\n      points,\n      this.#box,\n      this.#scaleFactor,\n      this.#innerMargin,\n      this.#isLTR\n    );\n  }\n\n  #getOutlineTwoPoints(points) {\n    const last = this.#last;\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n    const [lastTopX, lastTopY, lastBottomX, lastBottomY] =\n      this.#getLastCoords();\n    const outline = new Float32Array(36);\n    outline.set(\n      [\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (last[2] - layerX) / layerWidth,\n        (last[3] - layerY) / layerHeight,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (last[4] - layerX) / layerWidth,\n        (last[5] - layerY) / layerHeight,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        lastTopX,\n        lastTopY,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        lastBottomX,\n        lastBottomY,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (last[16] - layerX) / layerWidth,\n        (last[17] - layerY) / layerHeight,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (last[14] - layerX) / layerWidth,\n        (last[15] - layerY) / layerHeight,\n      ],\n      0\n    );\n    return this.newFreeDrawOutline(\n      outline,\n      points,\n      this.#box,\n      this.#scaleFactor,\n      this.#innerMargin,\n      this.#isLTR\n    );\n  }\n\n  #getOutlineStart(outline, pos) {\n    const bottom = this.#bottom;\n    outline.set([NaN, NaN, NaN, NaN, bottom[4], bottom[5]], pos);\n    return (pos += 6);\n  }\n\n  #getOutlineEnd(outline, pos) {\n    const lastTop = this.#last.subarray(4, 6);\n    const lastBottom = this.#last.subarray(16, 18);\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n    const [lastTopX, lastTopY, lastBottomX, lastBottomY] =\n      this.#getLastCoords();\n    outline.set(\n      [\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (lastTop[0] - layerX) / layerWidth,\n        (lastTop[1] - layerY) / layerHeight,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        lastTopX,\n        lastTopY,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        lastBottomX,\n        lastBottomY,\n        NaN,\n        NaN,\n        NaN,\n        NaN,\n        (lastBottom[0] - layerX) / layerWidth,\n        (lastBottom[1] - layerY) / layerHeight,\n      ],\n      pos\n    );\n    return (pos += 24);\n  }\n}\n\nclass FreeDrawOutline extends Outline {\n  #box;\n\n  #bbox = new Float32Array(4);\n\n  #innerMargin;\n\n  #isLTR;\n\n  #points;\n\n  #scaleFactor;\n\n  #outline;\n\n  constructor(outline, points, box, scaleFactor, innerMargin, isLTR) {\n    super();\n    this.#outline = outline;\n    this.#points = points;\n    this.#box = box;\n    this.#scaleFactor = scaleFactor;\n    this.#innerMargin = innerMargin;\n    this.#isLTR = isLTR;\n    this.lastPoint = [NaN, NaN];\n    this.#computeMinMax(isLTR);\n\n    const [x, y, width, height] = this.#bbox;\n    for (let i = 0, ii = outline.length; i < ii; i += 2) {\n      outline[i] = (outline[i] - x) / width;\n      outline[i + 1] = (outline[i + 1] - y) / height;\n    }\n    for (let i = 0, ii = points.length; i < ii; i += 2) {\n      points[i] = (points[i] - x) / width;\n      points[i + 1] = (points[i + 1] - y) / height;\n    }\n  }\n\n  toSVGPath() {\n    const buffer = [`M${this.#outline[4]} ${this.#outline[5]}`];\n    for (let i = 6, ii = this.#outline.length; i < ii; i += 6) {\n      if (isNaN(this.#outline[i])) {\n        buffer.push(`L${this.#outline[i + 4]} ${this.#outline[i + 5]}`);\n        continue;\n      }\n      buffer.push(\n        `C${this.#outline[i]} ${this.#outline[i + 1]} ${this.#outline[i + 2]} ${\n          this.#outline[i + 3]\n        } ${this.#outline[i + 4]} ${this.#outline[i + 5]}`\n      );\n    }\n    buffer.push(\"Z\");\n    return buffer.join(\" \");\n  }\n\n  serialize([blX, blY, trX, trY], rotation) {\n    const width = trX - blX;\n    const height = trY - blY;\n    let outline;\n    let points;\n    switch (rotation) {\n      case 0:\n        outline = Outline._rescale(this.#outline, blX, trY, width, -height);\n        points = Outline._rescale(this.#points, blX, trY, width, -height);\n        break;\n      case 90:\n        outline = Outline._rescaleAndSwap(\n          this.#outline,\n          blX,\n          blY,\n          width,\n          height\n        );\n        points = Outline._rescaleAndSwap(this.#points, blX, blY, width, height);\n        break;\n      case 180:\n        outline = Outline._rescale(this.#outline, trX, blY, -width, height);\n        points = Outline._rescale(this.#points, trX, blY, -width, height);\n        break;\n      case 270:\n        outline = Outline._rescaleAndSwap(\n          this.#outline,\n          trX,\n          trY,\n          -width,\n          -height\n        );\n        points = Outline._rescaleAndSwap(\n          this.#points,\n          trX,\n          trY,\n          -width,\n          -height\n        );\n        break;\n    }\n    return { outline: Array.from(outline), points: [Array.from(points)] };\n  }\n\n  #computeMinMax(isLTR) {\n    const outline = this.#outline;\n    let lastX = outline[4];\n    let lastY = outline[5];\n    const minMax = [lastX, lastY, lastX, lastY];\n    let lastPointX = lastX;\n    let lastPointY = lastY;\n    const ltrCallback = isLTR ? Math.max : Math.min;\n\n    for (let i = 6, ii = outline.length; i < ii; i += 6) {\n      const x = outline[i + 4],\n        y = outline[i + 5];\n\n      if (isNaN(outline[i])) {\n        Util.pointBoundingBox(x, y, minMax);\n\n        if (lastPointY < y) {\n          lastPointX = x;\n          lastPointY = y;\n        } else if (lastPointY === y) {\n          lastPointX = ltrCallback(lastPointX, x);\n        }\n      } else {\n        const bbox = [Infinity, Infinity, -Infinity, -Infinity];\n        Util.bezierBoundingBox(lastX, lastY, ...outline.slice(i, i + 6), bbox);\n\n        Util.rectBoundingBox(...bbox, minMax);\n\n        if (lastPointY < bbox[3]) {\n          lastPointX = bbox[2];\n          lastPointY = bbox[3];\n        } else if (lastPointY === bbox[3]) {\n          lastPointX = ltrCallback(lastPointX, bbox[2]);\n        }\n      }\n      lastX = x;\n      lastY = y;\n    }\n\n    const bbox = this.#bbox;\n    bbox[0] = minMax[0] - this.#innerMargin;\n    bbox[1] = minMax[1] - this.#innerMargin;\n    bbox[2] = minMax[2] - minMax[0] + 2 * this.#innerMargin;\n    bbox[3] = minMax[3] - minMax[1] + 2 * this.#innerMargin;\n    this.lastPoint = [lastPointX, lastPointY];\n  }\n\n  get box() {\n    return this.#bbox;\n  }\n\n  newOutliner(point, box, scaleFactor, thickness, isLTR, innerMargin = 0) {\n    return new FreeDrawOutliner(\n      point,\n      box,\n      scaleFactor,\n      thickness,\n      isLTR,\n      innerMargin\n    );\n  }\n\n  getNewOutline(thickness, innerMargin) {\n    // Build the outline of the highlight to use as the focus outline.\n    const [x, y, width, height] = this.#bbox;\n    const [layerX, layerY, layerWidth, layerHeight] = this.#box;\n    const sx = width * layerWidth;\n    const sy = height * layerHeight;\n    const tx = x * layerWidth + layerX;\n    const ty = y * layerHeight + layerY;\n    const outliner = this.newOutliner(\n      {\n        x: this.#points[0] * sx + tx,\n        y: this.#points[1] * sy + ty,\n      },\n      this.#box,\n      this.#scaleFactor,\n      thickness,\n      this.#isLTR,\n      innerMargin ?? this.#innerMargin\n    );\n    for (let i = 2; i < this.#points.length; i += 2) {\n      outliner.add({\n        x: this.#points[i] * sx + tx,\n        y: this.#points[i + 1] * sy + ty,\n      });\n    }\n    return outliner.getOutlines();\n  }\n}\n\nexport { FreeDrawOutline, FreeDrawOutliner };\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FreeDrawOutline, FreeDrawOutliner } from \"./freedraw.js\";\nimport { Outline } from \"./outline.js\";\nimport { Util } from \"../../../shared/util.js\";\n\nclass HighlightOutliner {\n  #box;\n\n  #lastPoint;\n\n  #verticalEdges = [];\n\n  #intervals = [];\n\n  /**\n   * Construct an outliner.\n   * @param {Array<Object>} boxes - An array of axis-aligned rectangles.\n   * @param {number} borderWidth - The width of the border of the boxes, it\n   *   allows to make the boxes bigger (or smaller).\n   * @param {number} innerMargin - The margin between the boxes and the\n   *   outlines. It's important to not have a null innerMargin when we want to\n   *   draw the outline else the stroked outline could be clipped because of its\n   *   width.\n   * @param {boolean} isLTR - true if we're in LTR mode. It's used to determine\n   *   the last point of the boxes.\n   */\n  constructor(boxes, borderWidth = 0, innerMargin = 0, isLTR = true) {\n    const minMax = [Infinity, Infinity, -Infinity, -Infinity];\n\n    // We round the coordinates to slightly reduce the number of edges in the\n    // final outlines.\n    const NUMBER_OF_DIGITS = 4;\n    const EPSILON = 10 ** -NUMBER_OF_DIGITS;\n\n    // The coordinates of the boxes are in the page coordinate system.\n    for (const { x, y, width, height } of boxes) {\n      const x1 = Math.floor((x - borderWidth) / EPSILON) * EPSILON;\n      const x2 = Math.ceil((x + width + borderWidth) / EPSILON) * EPSILON;\n      const y1 = Math.floor((y - borderWidth) / EPSILON) * EPSILON;\n      const y2 = Math.ceil((y + height + borderWidth) / EPSILON) * EPSILON;\n      const left = [x1, y1, y2, true];\n      const right = [x2, y1, y2, false];\n      this.#verticalEdges.push(left, right);\n\n      Util.rectBoundingBox(x1, y1, x2, y2, minMax);\n    }\n\n    const bboxWidth = minMax[2] - minMax[0] + 2 * innerMargin;\n    const bboxHeight = minMax[3] - minMax[1] + 2 * innerMargin;\n    const shiftedMinX = minMax[0] - innerMargin;\n    const shiftedMinY = minMax[1] - innerMargin;\n    const lastEdge = this.#verticalEdges.at(isLTR ? -1 : -2);\n    const lastPoint = [lastEdge[0], lastEdge[2]];\n\n    // Convert the coordinates of the edges into box coordinates.\n    for (const edge of this.#verticalEdges) {\n      const [x, y1, y2] = edge;\n      edge[0] = (x - shiftedMinX) / bboxWidth;\n      edge[1] = (y1 - shiftedMinY) / bboxHeight;\n      edge[2] = (y2 - shiftedMinY) / bboxHeight;\n    }\n\n    this.#box = new Float32Array([\n      shiftedMinX,\n      shiftedMinY,\n      bboxWidth,\n      bboxHeight,\n    ]);\n    this.#lastPoint = lastPoint;\n  }\n\n  getOutlines() {\n    // We begin to sort lexicographically the vertical edges by their abscissa,\n    // and then by their ordinate.\n    this.#verticalEdges.sort(\n      (a, b) => a[0] - b[0] || a[1] - b[1] || a[2] - b[2]\n    );\n\n    // We're now using a sweep line algorithm to find the outlines.\n    // We start with the leftmost vertical edge, and we're going to iterate\n    // over all the vertical edges from left to right.\n    // Each time we encounter a left edge, we're going to insert the interval\n    // [y1, y2] in the set of intervals.\n    // This set of intervals is used to break the vertical edges into chunks:\n    // we only take the part of the vertical edge that isn't in the union of\n    // the intervals.\n    const outlineVerticalEdges = [];\n    for (const edge of this.#verticalEdges) {\n      if (edge[3]) {\n        // Left edge.\n        outlineVerticalEdges.push(...this.#breakEdge(edge));\n        this.#insert(edge);\n      } else {\n        // Right edge.\n        this.#remove(edge);\n        outlineVerticalEdges.push(...this.#breakEdge(edge));\n      }\n    }\n    return this.#getOutlines(outlineVerticalEdges);\n  }\n\n  #getOutlines(outlineVerticalEdges) {\n    const edges = [];\n    const allEdges = new Set();\n\n    for (const edge of outlineVerticalEdges) {\n      const [x, y1, y2] = edge;\n      edges.push([x, y1, edge], [x, y2, edge]);\n    }\n\n    // We sort lexicographically the vertices of each edge by their ordinate and\n    // by their abscissa.\n    // Every pair (v_2i, v_{2i + 1}) of vertices defines a horizontal edge.\n    // So for every vertical edge, we're going to add the two vertical edges\n    // which are connected to it through a horizontal edge.\n    edges.sort((a, b) => a[1] - b[1] || a[0] - b[0]);\n    for (let i = 0, ii = edges.length; i < ii; i += 2) {\n      const edge1 = edges[i][2];\n      const edge2 = edges[i + 1][2];\n      edge1.push(edge2);\n      edge2.push(edge1);\n      allEdges.add(edge1);\n      allEdges.add(edge2);\n    }\n    const outlines = [];\n    let outline;\n\n    while (allEdges.size > 0) {\n      const edge = allEdges.values().next().value;\n      let [x, y1, y2, edge1, edge2] = edge;\n      allEdges.delete(edge);\n      let lastPointX = x;\n      let lastPointY = y1;\n\n      outline = [x, y2];\n      outlines.push(outline);\n\n      while (true) {\n        let e;\n        if (allEdges.has(edge1)) {\n          e = edge1;\n        } else if (allEdges.has(edge2)) {\n          e = edge2;\n        } else {\n          break;\n        }\n\n        allEdges.delete(e);\n        [x, y1, y2, edge1, edge2] = e;\n\n        if (lastPointX !== x) {\n          outline.push(lastPointX, lastPointY, x, lastPointY === y1 ? y1 : y2);\n          lastPointX = x;\n        }\n        lastPointY = lastPointY === y1 ? y2 : y1;\n      }\n      outline.push(lastPointX, lastPointY);\n    }\n    return new HighlightOutline(outlines, this.#box, this.#lastPoint);\n  }\n\n  #binarySearch(y) {\n    const array = this.#intervals;\n    let start = 0;\n    let end = array.length - 1;\n\n    while (start <= end) {\n      const middle = (start + end) >> 1;\n      const y1 = array[middle][0];\n      if (y1 === y) {\n        return middle;\n      }\n      if (y1 < y) {\n        start = middle + 1;\n      } else {\n        end = middle - 1;\n      }\n    }\n    return end + 1;\n  }\n\n  #insert([, y1, y2]) {\n    const index = this.#binarySearch(y1);\n    this.#intervals.splice(index, 0, [y1, y2]);\n  }\n\n  #remove([, y1, y2]) {\n    const index = this.#binarySearch(y1);\n    for (let i = index; i < this.#intervals.length; i++) {\n      const [start, end] = this.#intervals[i];\n      if (start !== y1) {\n        break;\n      }\n      if (start === y1 && end === y2) {\n        this.#intervals.splice(i, 1);\n        return;\n      }\n    }\n    for (let i = index - 1; i >= 0; i--) {\n      const [start, end] = this.#intervals[i];\n      if (start !== y1) {\n        break;\n      }\n      if (start === y1 && end === y2) {\n        this.#intervals.splice(i, 1);\n        return;\n      }\n    }\n  }\n\n  #breakEdge(edge) {\n    const [x, y1, y2] = edge;\n    const results = [[x, y1, y2]];\n    const index = this.#binarySearch(y2);\n    for (let i = 0; i < index; i++) {\n      const [start, end] = this.#intervals[i];\n      for (let j = 0, jj = results.length; j < jj; j++) {\n        const [, y3, y4] = results[j];\n        if (end <= y3 || y4 <= start) {\n          // There is no intersection between the interval and the edge, hence\n          // we keep it as is.\n          continue;\n        }\n        if (y3 >= start) {\n          if (y4 > end) {\n            results[j][1] = end;\n          } else {\n            if (jj === 1) {\n              return [];\n            }\n            // The edge is included in the interval, hence we remove it.\n            results.splice(j, 1);\n            j--;\n            jj--;\n          }\n          continue;\n        }\n        results[j][2] = start;\n        if (y4 > end) {\n          results.push([x, end, y4]);\n        }\n      }\n    }\n    return results;\n  }\n}\n\nclass HighlightOutline extends Outline {\n  #box;\n\n  #outlines;\n\n  constructor(outlines, box, lastPoint) {\n    super();\n    this.#outlines = outlines;\n    this.#box = box;\n    this.lastPoint = lastPoint;\n  }\n\n  toSVGPath() {\n    const buffer = [];\n    for (const polygon of this.#outlines) {\n      let [prevX, prevY] = polygon;\n      buffer.push(`M${prevX} ${prevY}`);\n      for (let i = 2; i < polygon.length; i += 2) {\n        const x = polygon[i];\n        const y = polygon[i + 1];\n        if (x === prevX) {\n          buffer.push(`V${y}`);\n          prevY = y;\n        } else if (y === prevY) {\n          buffer.push(`H${x}`);\n          prevX = x;\n        }\n      }\n      buffer.push(\"Z\");\n    }\n    return buffer.join(\" \");\n  }\n\n  /**\n   * Serialize the outlines into the PDF page coordinate system.\n   * @param {Array<number>} _bbox - the bounding box of the annotation.\n   * @param {number} _rotation - the rotation of the annotation.\n   * @returns {Array<Array<number>>}\n   */\n  serialize([blX, blY, trX, trY], _rotation) {\n    const outlines = [];\n    const width = trX - blX;\n    const height = trY - blY;\n    for (const outline of this.#outlines) {\n      const points = new Array(outline.length);\n      for (let i = 0; i < outline.length; i += 2) {\n        points[i] = blX + outline[i] * width;\n        points[i + 1] = trY - outline[i + 1] * height;\n      }\n      outlines.push(points);\n    }\n    return outlines;\n  }\n\n  get box() {\n    return this.#box;\n  }\n\n  get classNamesForOutlining() {\n    return [\"highlightOutline\"];\n  }\n}\n\nclass FreeHighlightOutliner extends FreeDrawOutliner {\n  newFreeDrawOutline(outline, points, box, scaleFactor, innerMargin, isLTR) {\n    return new FreeHighlightOutline(\n      outline,\n      points,\n      box,\n      scaleFactor,\n      innerMargin,\n      isLTR\n    );\n  }\n}\n\nclass FreeHighlightOutline extends FreeDrawOutline {\n  newOutliner(point, box, scaleFactor, thickness, isLTR, innerMargin = 0) {\n    return new FreeHighlightOutliner(\n      point,\n      box,\n      scaleFactor,\n      thickness,\n      isLTR,\n      innerMargin\n    );\n  }\n}\n\nexport { FreeHighlightOutliner, HighlightOutliner };\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AnnotationEditorParamsType, shadow } from \"../../shared/util.js\";\nimport { KeyboardManager } from \"./tools.js\";\nimport { noContextMenu } from \"../display_utils.js\";\n\nclass ColorPicker {\n  #button = null;\n\n  #buttonSwatch = null;\n\n  #defaultColor;\n\n  #dropdown = null;\n\n  #dropdownWasFromKeyboard = false;\n\n  #isMainColorPicker = false;\n\n  #editor = null;\n\n  #eventBus;\n\n  #openDropdownAC = null;\n\n  #uiManager = null;\n\n  #type;\n\n  static #l10nColor = null;\n\n  static get _keyboardManager() {\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [\n          [\"Escape\", \"mac+Escape\"],\n          ColorPicker.prototype._hideDropdownFromKeyboard,\n        ],\n        [[\" \", \"mac+ \"], ColorPicker.prototype._colorSelectFromKeyboard],\n        [\n          [\"ArrowDown\", \"ArrowRight\", \"mac+ArrowDown\", \"mac+ArrowRight\"],\n          ColorPicker.prototype._moveToNext,\n        ],\n        [\n          [\"ArrowUp\", \"ArrowLeft\", \"mac+ArrowUp\", \"mac+ArrowLeft\"],\n          ColorPicker.prototype._moveToPrevious,\n        ],\n        [[\"Home\", \"mac+Home\"], ColorPicker.prototype._moveToBeginning],\n        [[\"End\", \"mac+End\"], ColorPicker.prototype._moveToEnd],\n      ])\n    );\n  }\n\n  constructor({ editor = null, uiManager = null }) {\n    if (editor) {\n      this.#isMainColorPicker = false;\n      this.#type = AnnotationEditorParamsType.HIGHLIGHT_COLOR;\n      this.#editor = editor;\n    } else {\n      this.#isMainColorPicker = true;\n      this.#type = AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR;\n    }\n    this.#uiManager = editor?._uiManager || uiManager;\n    this.#eventBus = this.#uiManager._eventBus;\n    this.#defaultColor =\n      editor?.color?.toUpperCase() ||\n      this.#uiManager?.highlightColors.values().next().value ||\n      \"#FFFF98\";\n\n    ColorPicker.#l10nColor ||= Object.freeze({\n      blue: \"pdfjs-editor-colorpicker-blue\",\n      green: \"pdfjs-editor-colorpicker-green\",\n      pink: \"pdfjs-editor-colorpicker-pink\",\n      red: \"pdfjs-editor-colorpicker-red\",\n      yellow: \"pdfjs-editor-colorpicker-yellow\",\n    });\n  }\n\n  renderButton() {\n    const button = (this.#button = document.createElement(\"button\"));\n    button.className = \"colorPicker\";\n    button.tabIndex = \"0\";\n    button.setAttribute(\"data-l10n-id\", \"pdfjs-editor-colorpicker-button\");\n    button.ariaHasPopup = \"true\";\n    if (this.#editor) {\n      button.ariaControls = `${this.#editor.id}_colorpicker_dropdown`;\n    }\n    const signal = this.#uiManager._signal;\n    button.addEventListener(\"click\", this.#openDropdown.bind(this), { signal });\n    button.addEventListener(\"keydown\", this.#keyDown.bind(this), { signal });\n    const swatch = (this.#buttonSwatch = document.createElement(\"span\"));\n    swatch.className = \"swatch\";\n    swatch.ariaHidden = \"true\";\n    swatch.style.backgroundColor = this.#defaultColor;\n    button.append(swatch);\n    return button;\n  }\n\n  renderMainDropdown() {\n    const dropdown = (this.#dropdown = this.#getDropdownRoot());\n    dropdown.ariaOrientation = \"horizontal\";\n    dropdown.ariaLabelledBy = \"highlightColorPickerLabel\";\n\n    return dropdown;\n  }\n\n  #getDropdownRoot() {\n    const div = document.createElement(\"div\");\n    const signal = this.#uiManager._signal;\n    div.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    div.className = \"dropdown\";\n    div.role = \"listbox\";\n    div.ariaMultiSelectable = \"false\";\n    div.ariaOrientation = \"vertical\";\n    div.setAttribute(\"data-l10n-id\", \"pdfjs-editor-colorpicker-dropdown\");\n    if (this.#editor) {\n      div.id = `${this.#editor.id}_colorpicker_dropdown`;\n    }\n    for (const [name, color] of this.#uiManager.highlightColors) {\n      const button = document.createElement(\"button\");\n      button.tabIndex = \"0\";\n      button.role = \"option\";\n      button.setAttribute(\"data-color\", color);\n      button.title = name;\n      button.setAttribute(\"data-l10n-id\", ColorPicker.#l10nColor[name]);\n      const swatch = document.createElement(\"span\");\n      button.append(swatch);\n      swatch.className = \"swatch\";\n      swatch.style.backgroundColor = color;\n      button.ariaSelected = color === this.#defaultColor;\n      button.addEventListener(\"click\", this.#colorSelect.bind(this, color), {\n        signal,\n      });\n      div.append(button);\n    }\n\n    div.addEventListener(\"keydown\", this.#keyDown.bind(this), { signal });\n\n    return div;\n  }\n\n  #colorSelect(color, event) {\n    event.stopPropagation();\n    this.#eventBus.dispatch(\"switchannotationeditorparams\", {\n      source: this,\n      type: this.#type,\n      value: color,\n    });\n  }\n\n  _colorSelectFromKeyboard(event) {\n    if (event.target === this.#button) {\n      this.#openDropdown(event);\n      return;\n    }\n    const color = event.target.getAttribute(\"data-color\");\n    if (!color) {\n      return;\n    }\n    this.#colorSelect(color, event);\n  }\n\n  _moveToNext(event) {\n    if (!this.#isDropdownVisible) {\n      this.#openDropdown(event);\n      return;\n    }\n    if (event.target === this.#button) {\n      this.#dropdown.firstChild?.focus();\n      return;\n    }\n    event.target.nextSibling?.focus();\n  }\n\n  _moveToPrevious(event) {\n    if (\n      event.target === this.#dropdown?.firstChild ||\n      event.target === this.#button\n    ) {\n      if (this.#isDropdownVisible) {\n        this._hideDropdownFromKeyboard();\n      }\n      return;\n    }\n    if (!this.#isDropdownVisible) {\n      this.#openDropdown(event);\n    }\n    event.target.previousSibling?.focus();\n  }\n\n  _moveToBeginning(event) {\n    if (!this.#isDropdownVisible) {\n      this.#openDropdown(event);\n      return;\n    }\n    this.#dropdown.firstChild?.focus();\n  }\n\n  _moveToEnd(event) {\n    if (!this.#isDropdownVisible) {\n      this.#openDropdown(event);\n      return;\n    }\n    this.#dropdown.lastChild?.focus();\n  }\n\n  #keyDown(event) {\n    ColorPicker._keyboardManager.exec(this, event);\n  }\n\n  #openDropdown(event) {\n    if (this.#isDropdownVisible) {\n      this.hideDropdown();\n      return;\n    }\n    this.#dropdownWasFromKeyboard = event.detail === 0;\n\n    if (!this.#openDropdownAC) {\n      this.#openDropdownAC = new AbortController();\n\n      window.addEventListener(\"pointerdown\", this.#pointerDown.bind(this), {\n        signal: this.#uiManager.combinedSignal(this.#openDropdownAC),\n      });\n    }\n    this.#button.ariaExpanded = \"true\";\n    if (this.#dropdown) {\n      this.#dropdown.classList.remove(\"hidden\");\n      return;\n    }\n    const root = (this.#dropdown = this.#getDropdownRoot());\n    this.#button.append(root);\n  }\n\n  #pointerDown(event) {\n    if (this.#dropdown?.contains(event.target)) {\n      return;\n    }\n    this.hideDropdown();\n  }\n\n  hideDropdown() {\n    this.#dropdown?.classList.add(\"hidden\");\n    this.#button.ariaExpanded = \"false\";\n    this.#openDropdownAC?.abort();\n    this.#openDropdownAC = null;\n  }\n\n  get #isDropdownVisible() {\n    return this.#dropdown && !this.#dropdown.classList.contains(\"hidden\");\n  }\n\n  _hideDropdownFromKeyboard() {\n    if (this.#isMainColorPicker) {\n      return;\n    }\n    if (!this.#isDropdownVisible) {\n      // The user pressed Escape with no dropdown visible, so we must\n      // unselect it.\n      this.#editor?.unselect();\n      return;\n    }\n    this.hideDropdown();\n    this.#button.focus({\n      preventScroll: true,\n      focusVisible: this.#dropdownWasFromKeyboard,\n    });\n  }\n\n  updateColor(color) {\n    if (this.#buttonSwatch) {\n      this.#buttonSwatch.style.backgroundColor = color;\n    }\n    if (!this.#dropdown) {\n      return;\n    }\n\n    const i = this.#uiManager.highlightColors.values();\n    for (const child of this.#dropdown.children) {\n      child.ariaSelected = i.next().value === color.toUpperCase();\n    }\n  }\n\n  destroy() {\n    this.#button?.remove();\n    this.#button = null;\n    this.#buttonSwatch = null;\n    this.#dropdown?.remove();\n    this.#dropdown = null;\n  }\n}\n\nexport { ColorPicker };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  shadow,\n  Util,\n} from \"../../shared/util.js\";\nimport { bindEvents, KeyboardManager } from \"./tools.js\";\nimport {\n  FreeHighlightOutliner,\n  HighlightOutliner,\n} from \"./drawers/highlight.js\";\nimport {\n  HighlightAnnotationElement,\n  InkAnnotationElement,\n} from \"../annotation_layer.js\";\nimport { noContextMenu, stopEvent } from \"../display_utils.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { ColorPicker } from \"./color_picker.js\";\n\n/**\n * Basic draw editor in order to generate an Highlight annotation.\n */\nclass HighlightEditor extends AnnotationEditor {\n  #anchorNode = null;\n\n  #anchorOffset = 0;\n\n  #boxes;\n\n  #clipPathId = null;\n\n  #colorPicker = null;\n\n  #focusOutlines = null;\n\n  #focusNode = null;\n\n  #focusOffset = 0;\n\n  #highlightDiv = null;\n\n  #highlightOutlines = null;\n\n  #id = null;\n\n  #isFreeHighlight = false;\n\n  #lastPoint = null;\n\n  #opacity;\n\n  #outlineId = null;\n\n  #text = \"\";\n\n  #thickness;\n\n  #methodOfCreation = \"\";\n\n  static _defaultColor = null;\n\n  static _defaultOpacity = 1;\n\n  static _defaultThickness = 12;\n\n  static _type = \"highlight\";\n\n  static _editorType = AnnotationEditorType.HIGHLIGHT;\n\n  static _freeHighlightId = -1;\n\n  static _freeHighlight = null;\n\n  static _freeHighlightClipId = \"\";\n\n  static get _keyboardManager() {\n    const proto = HighlightEditor.prototype;\n    return shadow(\n      this,\n      \"_keyboardManager\",\n      new KeyboardManager([\n        [[\"ArrowLeft\", \"mac+ArrowLeft\"], proto._moveCaret, { args: [0] }],\n        [[\"ArrowRight\", \"mac+ArrowRight\"], proto._moveCaret, { args: [1] }],\n        [[\"ArrowUp\", \"mac+ArrowUp\"], proto._moveCaret, { args: [2] }],\n        [[\"ArrowDown\", \"mac+ArrowDown\"], proto._moveCaret, { args: [3] }],\n      ])\n    );\n  }\n\n  constructor(params) {\n    super({ ...params, name: \"highlightEditor\" });\n    this.color = params.color || HighlightEditor._defaultColor;\n    this.#thickness = params.thickness || HighlightEditor._defaultThickness;\n    this.#opacity = params.opacity || HighlightEditor._defaultOpacity;\n    this.#boxes = params.boxes || null;\n    this.#methodOfCreation = params.methodOfCreation || \"\";\n    this.#text = params.text || \"\";\n    this._isDraggable = false;\n    this.defaultL10nId = \"pdfjs-editor-highlight-editor\";\n\n    if (params.highlightId > -1) {\n      this.#isFreeHighlight = true;\n      this.#createFreeOutlines(params);\n      this.#addToDrawLayer();\n    } else if (this.#boxes) {\n      this.#anchorNode = params.anchorNode;\n      this.#anchorOffset = params.anchorOffset;\n      this.#focusNode = params.focusNode;\n      this.#focusOffset = params.focusOffset;\n      this.#createOutlines();\n      this.#addToDrawLayer();\n      this.rotate(this.rotation);\n    }\n\n    if (!this.annotationElementId) {\n      this._uiManager.a11yAlert(\"pdfjs-editor-highlight-added-alert\");\n    }\n  }\n\n  /** @inheritdoc */\n  get telemetryInitialData() {\n    return {\n      action: \"added\",\n      type: this.#isFreeHighlight ? \"free_highlight\" : \"highlight\",\n      color: this._uiManager.highlightColorNames.get(this.color),\n      thickness: this.#thickness,\n      methodOfCreation: this.#methodOfCreation,\n    };\n  }\n\n  /** @inheritdoc */\n  get telemetryFinalData() {\n    return {\n      type: \"highlight\",\n      color: this._uiManager.highlightColorNames.get(this.color),\n    };\n  }\n\n  static computeTelemetryFinalData(data) {\n    // We want to know how many colors have been used.\n    return { numberOfColors: data.get(\"color\").size };\n  }\n\n  #createOutlines() {\n    const outliner = new HighlightOutliner(\n      this.#boxes,\n      /* borderWidth = */ 0.001\n    );\n    this.#highlightOutlines = outliner.getOutlines();\n    [this.x, this.y, this.width, this.height] = this.#highlightOutlines.box;\n\n    const outlinerForOutline = new HighlightOutliner(\n      this.#boxes,\n      /* borderWidth = */ 0.0025,\n      /* innerMargin = */ 0.001,\n      this._uiManager.direction === \"ltr\"\n    );\n    this.#focusOutlines = outlinerForOutline.getOutlines();\n\n    // The last point is in the pages coordinate system.\n    const { lastPoint } = this.#focusOutlines;\n    this.#lastPoint = [\n      (lastPoint[0] - this.x) / this.width,\n      (lastPoint[1] - this.y) / this.height,\n    ];\n  }\n\n  #createFreeOutlines({ highlightOutlines, highlightId, clipPathId }) {\n    this.#highlightOutlines = highlightOutlines;\n    const extraThickness = 1.5;\n    this.#focusOutlines = highlightOutlines.getNewOutline(\n      /* Slightly bigger than the highlight in order to have a little\n         space between the highlight and the outline. */\n      this.#thickness / 2 + extraThickness,\n      /* innerMargin = */ 0.0025\n    );\n\n    if (highlightId >= 0) {\n      this.#id = highlightId;\n      this.#clipPathId = clipPathId;\n      // We need to redraw the highlight because we change the coordinates to be\n      // in the box coordinate system.\n      this.parent.drawLayer.finalizeDraw(highlightId, {\n        bbox: highlightOutlines.box,\n        path: {\n          d: highlightOutlines.toSVGPath(),\n        },\n      });\n      this.#outlineId = this.parent.drawLayer.drawOutline(\n        {\n          rootClass: {\n            highlightOutline: true,\n            free: true,\n          },\n          bbox: this.#focusOutlines.box,\n          path: {\n            d: this.#focusOutlines.toSVGPath(),\n          },\n        },\n        /* mustRemoveSelfIntersections = */ true\n      );\n    } else if (this.parent) {\n      const angle = this.parent.viewport.rotation;\n      this.parent.drawLayer.updateProperties(this.#id, {\n        bbox: HighlightEditor.#rotateBbox(\n          this.#highlightOutlines.box,\n          (angle - this.rotation + 360) % 360\n        ),\n        path: {\n          d: highlightOutlines.toSVGPath(),\n        },\n      });\n      this.parent.drawLayer.updateProperties(this.#outlineId, {\n        bbox: HighlightEditor.#rotateBbox(this.#focusOutlines.box, angle),\n        path: {\n          d: this.#focusOutlines.toSVGPath(),\n        },\n      });\n    }\n    const [x, y, width, height] = highlightOutlines.box;\n    switch (this.rotation) {\n      case 0:\n        this.x = x;\n        this.y = y;\n        this.width = width;\n        this.height = height;\n        break;\n      case 90: {\n        const [pageWidth, pageHeight] = this.parentDimensions;\n        this.x = y;\n        this.y = 1 - x;\n        this.width = (width * pageHeight) / pageWidth;\n        this.height = (height * pageWidth) / pageHeight;\n        break;\n      }\n      case 180:\n        this.x = 1 - x;\n        this.y = 1 - y;\n        this.width = width;\n        this.height = height;\n        break;\n      case 270: {\n        const [pageWidth, pageHeight] = this.parentDimensions;\n        this.x = 1 - y;\n        this.y = x;\n        this.width = (width * pageHeight) / pageWidth;\n        this.height = (height * pageWidth) / pageHeight;\n        break;\n      }\n    }\n\n    const { lastPoint } = this.#focusOutlines;\n    this.#lastPoint = [(lastPoint[0] - x) / width, (lastPoint[1] - y) / height];\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n    HighlightEditor._defaultColor ||=\n      uiManager.highlightColors?.values().next().value || \"#fff066\";\n  }\n\n  /** @inheritdoc */\n  static updateDefaultParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:\n        HighlightEditor._defaultColor = value;\n        break;\n      case AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:\n        HighlightEditor._defaultThickness = value;\n        break;\n    }\n  }\n\n  /** @inheritdoc */\n  translateInPage(x, y) {}\n\n  /** @inheritdoc */\n  get toolbarPosition() {\n    return this.#lastPoint;\n  }\n\n  /** @inheritdoc */\n  updateParams(type, value) {\n    switch (type) {\n      case AnnotationEditorParamsType.HIGHLIGHT_COLOR:\n        this.#updateColor(value);\n        break;\n      case AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:\n        this.#updateThickness(value);\n        break;\n    }\n  }\n\n  static get defaultPropertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR,\n        HighlightEditor._defaultColor,\n      ],\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,\n        HighlightEditor._defaultThickness,\n      ],\n    ];\n  }\n\n  /** @inheritdoc */\n  get propertiesToUpdate() {\n    return [\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_COLOR,\n        this.color || HighlightEditor._defaultColor,\n      ],\n      [\n        AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,\n        this.#thickness || HighlightEditor._defaultThickness,\n      ],\n      [AnnotationEditorParamsType.HIGHLIGHT_FREE, this.#isFreeHighlight],\n    ];\n  }\n\n  /**\n   * Update the color and make this action undoable.\n   * @param {string} color\n   */\n  #updateColor(color) {\n    const setColorAndOpacity = (col, opa) => {\n      this.color = col;\n      this.#opacity = opa;\n      this.parent?.drawLayer.updateProperties(this.#id, {\n        root: {\n          fill: col,\n          \"fill-opacity\": opa,\n        },\n      });\n      this.#colorPicker?.updateColor(col);\n    };\n    const savedColor = this.color;\n    const savedOpacity = this.#opacity;\n    this.addCommands({\n      cmd: setColorAndOpacity.bind(\n        this,\n        color,\n        HighlightEditor._defaultOpacity\n      ),\n      undo: setColorAndOpacity.bind(this, savedColor, savedOpacity),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.HIGHLIGHT_COLOR,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n\n    this._reportTelemetry(\n      {\n        action: \"color_changed\",\n        color: this._uiManager.highlightColorNames.get(color),\n      },\n      /* mustWait = */ true\n    );\n  }\n\n  /**\n   * Update the thickness and make this action undoable.\n   * @param {number} thickness\n   */\n  #updateThickness(thickness) {\n    const savedThickness = this.#thickness;\n    const setThickness = th => {\n      this.#thickness = th;\n      this.#changeThickness(th);\n    };\n    this.addCommands({\n      cmd: setThickness.bind(this, thickness),\n      undo: setThickness.bind(this, savedThickness),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type: AnnotationEditorParamsType.INK_THICKNESS,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n    this._reportTelemetry(\n      { action: \"thickness_changed\", thickness },\n      /* mustWait = */ true\n    );\n  }\n\n  /** @inheritdoc */\n  get toolbarButtons() {\n    if (this._uiManager.highlightColors) {\n      const colorPicker = (this.#colorPicker = new ColorPicker({\n        editor: this,\n      }));\n      return [[\"colorPicker\", colorPicker]];\n    }\n    return super.toolbarButtons;\n  }\n\n  /** @inheritdoc */\n  disableEditing() {\n    super.disableEditing();\n    this.div.classList.toggle(\"disabled\", true);\n  }\n\n  /** @inheritdoc */\n  enableEditing() {\n    super.enableEditing();\n    this.div.classList.toggle(\"disabled\", false);\n  }\n\n  /** @inheritdoc */\n  fixAndSetPosition() {\n    return super.fixAndSetPosition(this.#getRotation());\n  }\n\n  /** @inheritdoc */\n  getBaseTranslation() {\n    // The editor itself doesn't have any CSS border (we're drawing one\n    // ourselves in using SVG).\n    return [0, 0];\n  }\n\n  /** @inheritdoc */\n  getRect(tx, ty) {\n    return super.getRect(tx, ty, this.#getRotation());\n  }\n\n  /** @inheritdoc */\n  onceAdded(focus) {\n    if (!this.annotationElementId) {\n      this.parent.addUndoableEditor(this);\n    }\n    if (focus) {\n      this.div.focus();\n    }\n  }\n\n  /** @inheritdoc */\n  remove() {\n    this.#cleanDrawLayer();\n    this._reportTelemetry({\n      action: \"deleted\",\n    });\n    super.remove();\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    this.#addToDrawLayer();\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilding it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  setParent(parent) {\n    let mustBeSelected = false;\n    if (this.parent && !parent) {\n      this.#cleanDrawLayer();\n    } else if (parent) {\n      this.#addToDrawLayer(parent);\n      // If mustBeSelected is true it means that this editor was selected\n      // when its parent has been destroyed, hence we must select it again.\n      mustBeSelected =\n        !this.parent && this.div?.classList.contains(\"selectedEditor\");\n    }\n    super.setParent(parent);\n    this.show(this._isVisible);\n    if (mustBeSelected) {\n      // We select it after the parent has been set.\n      this.select();\n    }\n  }\n\n  #changeThickness(thickness) {\n    if (!this.#isFreeHighlight) {\n      return;\n    }\n    this.#createFreeOutlines({\n      highlightOutlines: this.#highlightOutlines.getNewOutline(thickness / 2),\n    });\n    this.fixAndSetPosition();\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.setDims(this.width * parentWidth, this.height * parentHeight);\n  }\n\n  #cleanDrawLayer() {\n    if (this.#id === null || !this.parent) {\n      return;\n    }\n    this.parent.drawLayer.remove(this.#id);\n    this.#id = null;\n    this.parent.drawLayer.remove(this.#outlineId);\n    this.#outlineId = null;\n  }\n\n  #addToDrawLayer(parent = this.parent) {\n    if (this.#id !== null) {\n      return;\n    }\n    ({ id: this.#id, clipPathId: this.#clipPathId } = parent.drawLayer.draw(\n      {\n        bbox: this.#highlightOutlines.box,\n        root: {\n          viewBox: \"0 0 1 1\",\n          fill: this.color,\n          \"fill-opacity\": this.#opacity,\n        },\n        rootClass: {\n          highlight: true,\n          free: this.#isFreeHighlight,\n        },\n        path: {\n          d: this.#highlightOutlines.toSVGPath(),\n        },\n      },\n      /* isPathUpdatable = */ false,\n      /* hasClip = */ true\n    ));\n    this.#outlineId = parent.drawLayer.drawOutline(\n      {\n        rootClass: {\n          highlightOutline: true,\n          free: this.#isFreeHighlight,\n        },\n        bbox: this.#focusOutlines.box,\n        path: {\n          d: this.#focusOutlines.toSVGPath(),\n        },\n      },\n      /* mustRemoveSelfIntersections = */ this.#isFreeHighlight\n    );\n\n    if (this.#highlightDiv) {\n      this.#highlightDiv.style.clipPath = this.#clipPathId;\n    }\n  }\n\n  static #rotateBbox([x, y, width, height], angle) {\n    switch (angle) {\n      case 90:\n        return [1 - y - height, x, height, width];\n      case 180:\n        return [1 - x - width, 1 - y - height, width, height];\n      case 270:\n        return [y, 1 - x - width, height, width];\n    }\n    return [x, y, width, height];\n  }\n\n  /** @inheritdoc */\n  rotate(angle) {\n    // We need to rotate the svgs because of the coordinates system.\n    const { drawLayer } = this.parent;\n    let box;\n    if (this.#isFreeHighlight) {\n      angle = (angle - this.rotation + 360) % 360;\n      box = HighlightEditor.#rotateBbox(this.#highlightOutlines.box, angle);\n    } else {\n      // An highlight annotation is always drawn horizontally.\n      box = HighlightEditor.#rotateBbox(\n        [this.x, this.y, this.width, this.height],\n        angle\n      );\n    }\n    drawLayer.updateProperties(this.#id, {\n      bbox: box,\n      root: {\n        \"data-main-rotation\": angle,\n      },\n    });\n    drawLayer.updateProperties(this.#outlineId, {\n      bbox: HighlightEditor.#rotateBbox(this.#focusOutlines.box, angle),\n      root: {\n        \"data-main-rotation\": angle,\n      },\n    });\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    const div = super.render();\n    if (this.#text) {\n      div.setAttribute(\"aria-label\", this.#text);\n      div.setAttribute(\"role\", \"mark\");\n    }\n    if (this.#isFreeHighlight) {\n      div.classList.add(\"free\");\n    } else {\n      this.div.addEventListener(\"keydown\", this.#keydown.bind(this), {\n        signal: this._uiManager._signal,\n      });\n    }\n    const highlightDiv = (this.#highlightDiv = document.createElement(\"div\"));\n    div.append(highlightDiv);\n    highlightDiv.setAttribute(\"aria-hidden\", \"true\");\n    highlightDiv.className = \"internal\";\n    highlightDiv.style.clipPath = this.#clipPathId;\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.setDims(this.width * parentWidth, this.height * parentHeight);\n\n    bindEvents(this, this.#highlightDiv, [\"pointerover\", \"pointerleave\"]);\n    this.enableEditing();\n\n    return div;\n  }\n\n  pointerover() {\n    if (!this.isSelected) {\n      this.parent?.drawLayer.updateProperties(this.#outlineId, {\n        rootClass: {\n          hovered: true,\n        },\n      });\n    }\n  }\n\n  pointerleave() {\n    if (!this.isSelected) {\n      this.parent?.drawLayer.updateProperties(this.#outlineId, {\n        rootClass: {\n          hovered: false,\n        },\n      });\n    }\n  }\n\n  #keydown(event) {\n    HighlightEditor._keyboardManager.exec(this, event);\n  }\n\n  _moveCaret(direction) {\n    this.parent.unselect(this);\n    switch (direction) {\n      case 0 /* left */:\n      case 2 /* up */:\n        this.#setCaret(/* start = */ true);\n        break;\n      case 1 /* right */:\n      case 3 /* down */:\n        this.#setCaret(/* start = */ false);\n        break;\n    }\n  }\n\n  #setCaret(start) {\n    if (!this.#anchorNode) {\n      return;\n    }\n    const selection = window.getSelection();\n    if (start) {\n      selection.setPosition(this.#anchorNode, this.#anchorOffset);\n    } else {\n      selection.setPosition(this.#focusNode, this.#focusOffset);\n    }\n  }\n\n  /** @inheritdoc */\n  select() {\n    super.select();\n    if (!this.#outlineId) {\n      return;\n    }\n    this.parent?.drawLayer.updateProperties(this.#outlineId, {\n      rootClass: {\n        hovered: false,\n        selected: true,\n      },\n    });\n  }\n\n  /** @inheritdoc */\n  unselect() {\n    super.unselect();\n    if (!this.#outlineId) {\n      return;\n    }\n    this.parent?.drawLayer.updateProperties(this.#outlineId, {\n      rootClass: {\n        selected: false,\n      },\n    });\n    if (!this.#isFreeHighlight) {\n      this.#setCaret(/* start = */ false);\n    }\n  }\n\n  /** @inheritdoc */\n  get _mustFixPosition() {\n    return !this.#isFreeHighlight;\n  }\n\n  /** @inheritdoc */\n  show(visible = this._isVisible) {\n    super.show(visible);\n    if (this.parent) {\n      this.parent.drawLayer.updateProperties(this.#id, {\n        rootClass: {\n          hidden: !visible,\n        },\n      });\n      this.parent.drawLayer.updateProperties(this.#outlineId, {\n        rootClass: {\n          hidden: !visible,\n        },\n      });\n    }\n  }\n\n  #getRotation() {\n    // Highlight annotations are always drawn horizontally but if\n    // a free highlight annotation can be rotated.\n    return this.#isFreeHighlight ? this.rotation : 0;\n  }\n\n  #serializeBoxes() {\n    if (this.#isFreeHighlight) {\n      return null;\n    }\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    const [pageX, pageY] = this.pageTranslation;\n    const boxes = this.#boxes;\n    const quadPoints = new Float32Array(boxes.length * 8);\n    let i = 0;\n    for (const { x, y, width, height } of boxes) {\n      const sx = x * pageWidth + pageX;\n      const sy = (1 - y) * pageHeight + pageY;\n      // Serializes the rectangle in the Adobe Acrobat format.\n      // The rectangle's coordinates (b = bottom, t = top, L = left, R = right)\n      // are ordered as follows: tL, tR, bL, bR (bL origin).\n      quadPoints[i] = quadPoints[i + 4] = sx;\n      quadPoints[i + 1] = quadPoints[i + 3] = sy;\n      quadPoints[i + 2] = quadPoints[i + 6] = sx + width * pageWidth;\n      quadPoints[i + 5] = quadPoints[i + 7] = sy - height * pageHeight;\n      i += 8;\n    }\n    return quadPoints;\n  }\n\n  #serializeOutlines(rect) {\n    return this.#highlightOutlines.serialize(rect, this.#getRotation());\n  }\n\n  static startHighlighting(parent, isLTR, { target: textLayer, x, y }) {\n    const {\n      x: layerX,\n      y: layerY,\n      width: parentWidth,\n      height: parentHeight,\n    } = textLayer.getBoundingClientRect();\n\n    const ac = new AbortController();\n    const signal = parent.combinedSignal(ac);\n\n    const pointerUpCallback = e => {\n      ac.abort();\n      this.#endHighlight(parent, e);\n    };\n    window.addEventListener(\"blur\", pointerUpCallback, { signal });\n    window.addEventListener(\"pointerup\", pointerUpCallback, { signal });\n    window.addEventListener(\n      \"pointerdown\",\n      stopEvent /* Avoid to have undesired clicks during the drawing. */,\n      {\n        capture: true,\n        passive: false,\n        signal,\n      }\n    );\n    window.addEventListener(\"contextmenu\", noContextMenu, { signal });\n\n    textLayer.addEventListener(\n      \"pointermove\",\n      this.#highlightMove.bind(this, parent),\n      { signal }\n    );\n    this._freeHighlight = new FreeHighlightOutliner(\n      { x, y },\n      [layerX, layerY, parentWidth, parentHeight],\n      parent.scale,\n      this._defaultThickness / 2,\n      isLTR,\n      /* innerMargin = */ 0.001\n    );\n    ({ id: this._freeHighlightId, clipPathId: this._freeHighlightClipId } =\n      parent.drawLayer.draw(\n        {\n          bbox: [0, 0, 1, 1],\n          root: {\n            viewBox: \"0 0 1 1\",\n            fill: this._defaultColor,\n            \"fill-opacity\": this._defaultOpacity,\n          },\n          rootClass: {\n            highlight: true,\n            free: true,\n          },\n          path: {\n            d: this._freeHighlight.toSVGPath(),\n          },\n        },\n        /* isPathUpdatable = */ true,\n        /* hasClip = */ true\n      ));\n  }\n\n  static #highlightMove(parent, event) {\n    if (this._freeHighlight.add(event)) {\n      // Redraw only if the point has been added.\n      parent.drawLayer.updateProperties(this._freeHighlightId, {\n        path: {\n          d: this._freeHighlight.toSVGPath(),\n        },\n      });\n    }\n  }\n\n  static #endHighlight(parent, event) {\n    if (!this._freeHighlight.isEmpty()) {\n      parent.createAndAddNewEditor(event, false, {\n        highlightId: this._freeHighlightId,\n        highlightOutlines: this._freeHighlight.getOutlines(),\n        clipPathId: this._freeHighlightClipId,\n        methodOfCreation: \"main_toolbar\",\n      });\n    } else {\n      parent.drawLayer.remove(this._freeHighlightId);\n    }\n    this._freeHighlightId = -1;\n    this._freeHighlight = null;\n    this._freeHighlightClipId = \"\";\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    let initialData = null;\n    if (data instanceof HighlightAnnotationElement) {\n      const {\n        data: { quadPoints, rect, rotation, id, color, opacity, popupRef },\n        parent: {\n          page: { pageNumber },\n        },\n      } = data;\n      initialData = data = {\n        annotationType: AnnotationEditorType.HIGHLIGHT,\n        color: Array.from(color),\n        opacity,\n        quadPoints,\n        boxes: null,\n        pageIndex: pageNumber - 1,\n        rect: rect.slice(0),\n        rotation,\n        annotationElementId: id,\n        id,\n        deleted: false,\n        popupRef,\n      };\n    } else if (data instanceof InkAnnotationElement) {\n      const {\n        data: {\n          inkLists,\n          rect,\n          rotation,\n          id,\n          color,\n          borderStyle: { rawWidth: thickness },\n          popupRef,\n        },\n        parent: {\n          page: { pageNumber },\n        },\n      } = data;\n      initialData = data = {\n        annotationType: AnnotationEditorType.HIGHLIGHT,\n        color: Array.from(color),\n        thickness,\n        inkLists,\n        boxes: null,\n        pageIndex: pageNumber - 1,\n        rect: rect.slice(0),\n        rotation,\n        annotationElementId: id,\n        id,\n        deleted: false,\n        popupRef,\n      };\n    }\n\n    const { color, quadPoints, inkLists, opacity } = data;\n    const editor = await super.deserialize(data, parent, uiManager);\n\n    editor.color = Util.makeHexColor(...color);\n    editor.#opacity = opacity || 1;\n    if (inkLists) {\n      editor.#thickness = data.thickness;\n    }\n    editor._initialData = initialData;\n\n    const [pageWidth, pageHeight] = editor.pageDimensions;\n    const [pageX, pageY] = editor.pageTranslation;\n\n    if (quadPoints) {\n      const boxes = (editor.#boxes = []);\n      for (let i = 0; i < quadPoints.length; i += 8) {\n        boxes.push({\n          x: (quadPoints[i] - pageX) / pageWidth,\n          y: 1 - (quadPoints[i + 1] - pageY) / pageHeight,\n          width: (quadPoints[i + 2] - quadPoints[i]) / pageWidth,\n          height: (quadPoints[i + 1] - quadPoints[i + 5]) / pageHeight,\n        });\n      }\n      editor.#createOutlines();\n      editor.#addToDrawLayer();\n      editor.rotate(editor.rotation);\n    } else if (inkLists) {\n      editor.#isFreeHighlight = true;\n      const points = inkLists[0];\n      const point = {\n        x: points[0] - pageX,\n        y: pageHeight - (points[1] - pageY),\n      };\n      const outliner = new FreeHighlightOutliner(\n        point,\n        [0, 0, pageWidth, pageHeight],\n        1,\n        editor.#thickness / 2,\n        true,\n        0.001\n      );\n      for (let i = 0, ii = points.length; i < ii; i += 2) {\n        point.x = points[i] - pageX;\n        point.y = pageHeight - (points[i + 1] - pageY);\n        outliner.add(point);\n      }\n      const { id, clipPathId } = parent.drawLayer.draw(\n        {\n          bbox: [0, 0, 1, 1],\n          root: {\n            viewBox: \"0 0 1 1\",\n            fill: editor.color,\n            \"fill-opacity\": editor._defaultOpacity,\n          },\n          rootClass: {\n            highlight: true,\n            free: true,\n          },\n          path: {\n            d: outliner.toSVGPath(),\n          },\n        },\n        /* isPathUpdatable = */ true,\n        /* hasClip = */ true\n      );\n      editor.#createFreeOutlines({\n        highlightOutlines: outliner.getOutlines(),\n        highlightId: id,\n        clipPathId,\n      });\n      editor.#addToDrawLayer();\n      editor.rotate(editor.parentRotation);\n    }\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false) {\n    // It doesn't make sense to copy/paste a highlight annotation.\n    if (this.isEmpty() || isForCopying) {\n      return null;\n    }\n\n    if (this.deleted) {\n      return this.serializeDeleted();\n    }\n\n    const rect = this.getRect(0, 0);\n    const color = AnnotationEditor._colorManager.convert(this.color);\n\n    const serialized = {\n      annotationType: AnnotationEditorType.HIGHLIGHT,\n      color,\n      opacity: this.#opacity,\n      thickness: this.#thickness,\n      quadPoints: this.#serializeBoxes(),\n      outlines: this.#serializeOutlines(rect),\n      pageIndex: this.pageIndex,\n      rect,\n      rotation: this.#getRotation(),\n      structTreeParentId: this._structTreeParentId,\n    };\n\n    if (this.annotationElementId && !this.#hasElementChanged(serialized)) {\n      return null;\n    }\n\n    serialized.id = this.annotationElementId;\n    return serialized;\n  }\n\n  #hasElementChanged(serialized) {\n    const { color } = this._initialData;\n    return serialized.color.some((c, i) => c !== color[i]);\n  }\n\n  /** @inheritdoc */\n  renderAnnotationElement(annotation) {\n    annotation.updateEdited({\n      rect: this.getRect(0, 0),\n    });\n\n    return null;\n  }\n\n  static canCreateNewEmptyEditor() {\n    return false;\n  }\n}\n\nexport { HighlightEditor };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AnnotationEditorParamsType, unreachable } from \"../../shared/util.js\";\nimport { noContextMenu, stopEvent } from \"../display_utils.js\";\nimport { AnnotationEditor } from \"./editor.js\";\n\nclass DrawingOptions {\n  #svgProperties = Object.create(null);\n\n  updateProperty(name, value) {\n    this[name] = value;\n    this.updateSVGProperty(name, value);\n  }\n\n  updateProperties(properties) {\n    if (!properties) {\n      return;\n    }\n    for (const [name, value] of Object.entries(properties)) {\n      if (!name.startsWith(\"_\")) {\n        this.updateProperty(name, value);\n      }\n    }\n  }\n\n  updateSVGProperty(name, value) {\n    this.#svgProperties[name] = value;\n  }\n\n  toSVGProperties() {\n    const root = this.#svgProperties;\n    this.#svgProperties = Object.create(null);\n    return { root };\n  }\n\n  reset() {\n    this.#svgProperties = Object.create(null);\n  }\n\n  updateAll(options = this) {\n    this.updateProperties(options);\n  }\n\n  clone() {\n    unreachable(\"Not implemented\");\n  }\n}\n\n/**\n * Basic draw editor.\n */\nclass DrawingEditor extends AnnotationEditor {\n  #drawOutlines = null;\n\n  #mustBeCommitted;\n\n  _drawId = null;\n\n  static _currentDrawId = -1;\n\n  static _currentParent = null;\n\n  static #currentDraw = null;\n\n  static #currentDrawingAC = null;\n\n  static #currentDrawingOptions = null;\n\n  static #currentPointerId = NaN;\n\n  static #currentPointerType = null;\n\n  static #currentPointerIds = null;\n\n  static #currentMoveTimestamp = NaN;\n\n  static _INNER_MARGIN = 3;\n\n  constructor(params) {\n    super(params);\n    this.#mustBeCommitted = params.mustBeCommitted || false;\n\n    this._addOutlines(params);\n  }\n\n  _addOutlines(params) {\n    if (params.drawOutlines) {\n      this.#createDrawOutlines(params);\n      this.#addToDrawLayer();\n    }\n  }\n\n  #createDrawOutlines({ drawOutlines, drawId, drawingOptions }) {\n    this.#drawOutlines = drawOutlines;\n    this._drawingOptions ||= drawingOptions;\n    if (!this.annotationElementId) {\n      this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`);\n    }\n\n    if (drawId >= 0) {\n      this._drawId = drawId;\n      // We need to redraw the drawing because we changed the coordinates to be\n      // in the box coordinate system.\n      this.parent.drawLayer.finalizeDraw(\n        drawId,\n        drawOutlines.defaultProperties\n      );\n    } else {\n      // We create a new drawing.\n      this._drawId = this.#createDrawing(drawOutlines, this.parent);\n    }\n\n    this.#updateBbox(drawOutlines.box);\n  }\n\n  #createDrawing(drawOutlines, parent) {\n    const { id } = parent.drawLayer.draw(\n      DrawingEditor._mergeSVGProperties(\n        this._drawingOptions.toSVGProperties(),\n        drawOutlines.defaultSVGProperties\n      ),\n      /* isPathUpdatable = */ false,\n      /* hasClip = */ false\n    );\n    return id;\n  }\n\n  static _mergeSVGProperties(p1, p2) {\n    const p1Keys = new Set(Object.keys(p1));\n\n    for (const [key, value] of Object.entries(p2)) {\n      if (p1Keys.has(key)) {\n        Object.assign(p1[key], value);\n      } else {\n        p1[key] = value;\n      }\n    }\n    return p1;\n  }\n\n  /**\n   * @param {Object} options\n   * @return {DrawingOptions} the default options to use for a new editor.\n   */\n  static getDefaultDrawingOptions(_options) {\n    unreachable(\"Not implemented\");\n  }\n\n  /**\n   * @return {Map<AnnotationEditorParamsType, string>} a map between the\n   *   parameter types and the name of the options.\n   */\n  // eslint-disable-next-line getter-return\n  static get typesMap() {\n    unreachable(\"Not implemented\");\n  }\n\n  static get isDrawer() {\n    return true;\n  }\n\n  /**\n   * @returns {boolean} `true` if several drawings can be added to the\n   * annotation.\n   */\n  static get supportMultipleDrawings() {\n    return false;\n  }\n\n  /** @inheritdoc */\n  static updateDefaultParams(type, value) {\n    const propertyName = this.typesMap.get(type);\n    if (propertyName) {\n      this._defaultDrawingOptions.updateProperty(propertyName, value);\n    }\n    if (this._currentParent) {\n      DrawingEditor.#currentDraw.updateProperty(propertyName, value);\n      this._currentParent.drawLayer.updateProperties(\n        this._currentDrawId,\n        this._defaultDrawingOptions.toSVGProperties()\n      );\n    }\n  }\n\n  /** @inheritdoc */\n  updateParams(type, value) {\n    const propertyName = this.constructor.typesMap.get(type);\n    if (propertyName) {\n      this._updateProperty(type, propertyName, value);\n    }\n  }\n\n  /** @inheritdoc */\n  static get defaultPropertiesToUpdate() {\n    const properties = [];\n    const options = this._defaultDrawingOptions;\n    for (const [type, name] of this.typesMap) {\n      properties.push([type, options[name]]);\n    }\n    return properties;\n  }\n\n  /** @inheritdoc */\n  get propertiesToUpdate() {\n    const properties = [];\n    const { _drawingOptions } = this;\n    for (const [type, name] of this.constructor.typesMap) {\n      properties.push([type, _drawingOptions[name]]);\n    }\n    return properties;\n  }\n\n  /**\n   * Update a property and make this action undoable.\n   * @param {string} color\n   */\n  _updateProperty(type, name, value) {\n    const options = this._drawingOptions;\n    const savedValue = options[name];\n    const setter = val => {\n      options.updateProperty(name, val);\n      const bbox = this.#drawOutlines.updateProperty(name, val);\n      if (bbox) {\n        this.#updateBbox(bbox);\n      }\n      this.parent?.drawLayer.updateProperties(\n        this._drawId,\n        options.toSVGProperties()\n      );\n    };\n    this.addCommands({\n      cmd: setter.bind(this, value),\n      undo: setter.bind(this, savedValue),\n      post: this._uiManager.updateUI.bind(this._uiManager, this),\n      mustExec: true,\n      type,\n      overwriteIfSameType: true,\n      keepUndo: true,\n    });\n  }\n\n  /** @inheritdoc */\n  _onResizing() {\n    this.parent?.drawLayer.updateProperties(\n      this._drawId,\n      DrawingEditor._mergeSVGProperties(\n        this.#drawOutlines.getPathResizingSVGProperties(\n          this.#convertToDrawSpace()\n        ),\n        {\n          bbox: this.#rotateBox(),\n        }\n      )\n    );\n  }\n\n  /** @inheritdoc */\n  _onResized() {\n    this.parent?.drawLayer.updateProperties(\n      this._drawId,\n      DrawingEditor._mergeSVGProperties(\n        this.#drawOutlines.getPathResizedSVGProperties(\n          this.#convertToDrawSpace()\n        ),\n        {\n          bbox: this.#rotateBox(),\n        }\n      )\n    );\n  }\n\n  /** @inheritdoc */\n  _onTranslating(_x, _y) {\n    this.parent?.drawLayer.updateProperties(this._drawId, {\n      bbox: this.#rotateBox(),\n    });\n  }\n\n  /** @inheritdoc */\n  _onTranslated() {\n    this.parent?.drawLayer.updateProperties(\n      this._drawId,\n      DrawingEditor._mergeSVGProperties(\n        this.#drawOutlines.getPathTranslatedSVGProperties(\n          this.#convertToDrawSpace(),\n          this.parentDimensions\n        ),\n        {\n          bbox: this.#rotateBox(),\n        }\n      )\n    );\n  }\n\n  _onStartDragging() {\n    this.parent?.drawLayer.updateProperties(this._drawId, {\n      rootClass: {\n        moving: true,\n      },\n    });\n  }\n\n  _onStopDragging() {\n    this.parent?.drawLayer.updateProperties(this._drawId, {\n      rootClass: {\n        moving: false,\n      },\n    });\n  }\n\n  /** @inheritdoc */\n  commit() {\n    super.commit();\n\n    this.disableEditMode();\n    this.disableEditing();\n  }\n\n  /** @inheritdoc */\n  disableEditing() {\n    super.disableEditing();\n    this.div.classList.toggle(\"disabled\", true);\n  }\n\n  /** @inheritdoc */\n  enableEditing() {\n    super.enableEditing();\n    this.div.classList.toggle(\"disabled\", false);\n  }\n\n  /** @inheritdoc */\n  getBaseTranslation() {\n    // The editor itself doesn't have any CSS border (we're drawing one\n    // ourselves in using SVG).\n    return [0, 0];\n  }\n\n  /** @inheritdoc */\n  get isResizable() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  onceAdded(focus) {\n    if (!this.annotationElementId) {\n      this.parent.addUndoableEditor(this);\n    }\n    this._isDraggable = true;\n    if (this.#mustBeCommitted) {\n      this.#mustBeCommitted = false;\n      this.commit();\n      this.parent.setSelected(this);\n      if (focus && this.isOnScreen) {\n        this.div.focus();\n      }\n    }\n  }\n\n  /** @inheritdoc */\n  remove() {\n    this.#cleanDrawLayer();\n    super.remove();\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    this.#addToDrawLayer();\n    this.#updateBbox(this.#drawOutlines.box);\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilding it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  setParent(parent) {\n    let mustBeSelected = false;\n    if (this.parent && !parent) {\n      this._uiManager.removeShouldRescale(this);\n      this.#cleanDrawLayer();\n    } else if (parent) {\n      this._uiManager.addShouldRescale(this);\n      this.#addToDrawLayer(parent);\n      // If mustBeSelected is true it means that this editor was selected\n      // when its parent has been destroyed, hence we must select it again.\n      mustBeSelected =\n        !this.parent && this.div?.classList.contains(\"selectedEditor\");\n    }\n    super.setParent(parent);\n    if (mustBeSelected) {\n      // We select it after the parent has been set.\n      this.select();\n    }\n  }\n\n  #cleanDrawLayer() {\n    if (this._drawId === null || !this.parent) {\n      return;\n    }\n    this.parent.drawLayer.remove(this._drawId);\n    this._drawId = null;\n\n    // All the SVG properties must be reset in order to make it possible to\n    // undo.\n    this._drawingOptions.reset();\n  }\n\n  #addToDrawLayer(parent = this.parent) {\n    if (this._drawId !== null && this.parent === parent) {\n      return;\n    }\n    if (this._drawId !== null) {\n      // The parent has changed, we need to move the drawing to the new parent.\n      this.parent.drawLayer.updateParent(this._drawId, parent.drawLayer);\n      return;\n    }\n    this._drawingOptions.updateAll();\n    this._drawId = this.#createDrawing(this.#drawOutlines, parent);\n  }\n\n  #convertToParentSpace([x, y, width, height]) {\n    const {\n      parentDimensions: [pW, pH],\n      rotation,\n    } = this;\n    switch (rotation) {\n      case 90:\n        return [y, 1 - x, width * (pH / pW), height * (pW / pH)];\n      case 180:\n        return [1 - x, 1 - y, width, height];\n      case 270:\n        return [1 - y, x, width * (pH / pW), height * (pW / pH)];\n      default:\n        return [x, y, width, height];\n    }\n  }\n\n  #convertToDrawSpace() {\n    const {\n      x,\n      y,\n      width,\n      height,\n      parentDimensions: [pW, pH],\n      rotation,\n    } = this;\n    switch (rotation) {\n      case 90:\n        return [1 - y, x, width * (pW / pH), height * (pH / pW)];\n      case 180:\n        return [1 - x, 1 - y, width, height];\n      case 270:\n        return [y, 1 - x, width * (pW / pH), height * (pH / pW)];\n      default:\n        return [x, y, width, height];\n    }\n  }\n\n  #updateBbox(bbox) {\n    [this.x, this.y, this.width, this.height] =\n      this.#convertToParentSpace(bbox);\n    if (this.div) {\n      this.fixAndSetPosition();\n      const [parentWidth, parentHeight] = this.parentDimensions;\n      this.setDims(this.width * parentWidth, this.height * parentHeight);\n    }\n    this._onResized();\n  }\n\n  #rotateBox() {\n    // We've to deal with two rotations: the rotation of the annotation and the\n    // rotation of the parent page.\n    // When the page is rotated, all the layers are just rotated thanks to CSS\n    // but there is a notable exception: the canvas wrapper.\n    // The canvas wrapper is not rotated but the dimensions are (or not) swapped\n    // and the page is redrawn with the rotation applied to the canvas.\n    // The drawn layer is under the canvas wrapper and is not rotated so we have\n    // to \"manually\" rotate the coordinates.\n    //\n    // The coordinates (this.x, this.y) correspond to the top-left corner of\n    // the editor after it has been rotated in the page coordinate system.\n\n    const {\n      x,\n      y,\n      width,\n      height,\n      rotation,\n      parentRotation,\n      parentDimensions: [pW, pH],\n    } = this;\n    switch ((rotation * 4 + parentRotation) / 90) {\n      case 1:\n        // 0 -> 90\n        return [1 - y - height, x, height, width];\n      case 2:\n        // 0 -> 180\n        return [1 - x - width, 1 - y - height, width, height];\n      case 3:\n        // 0 -> 270\n        return [y, 1 - x - width, height, width];\n      case 4:\n        // 90 -> 0\n        return [\n          x,\n          y - width * (pW / pH),\n          height * (pH / pW),\n          width * (pW / pH),\n        ];\n      case 5:\n        // 90 -> 90\n        return [1 - y, x, width * (pW / pH), height * (pH / pW)];\n      case 6:\n        // 90 -> 180\n        return [\n          1 - x - height * (pH / pW),\n          1 - y,\n          height * (pH / pW),\n          width * (pW / pH),\n        ];\n      case 7:\n        // 90 -> 270\n        return [\n          y - width * (pW / pH),\n          1 - x - height * (pH / pW),\n          width * (pW / pH),\n          height * (pH / pW),\n        ];\n      case 8:\n        // 180 -> 0\n        return [x - width, y - height, width, height];\n      case 9:\n        // 180 -> 90\n        return [1 - y, x - width, height, width];\n      case 10:\n        // 180 -> 180\n        return [1 - x, 1 - y, width, height];\n      case 11:\n        // 180 -> 270\n        return [y - height, 1 - x, height, width];\n      case 12:\n        // 270 -> 0\n        return [\n          x - height * (pH / pW),\n          y,\n          height * (pH / pW),\n          width * (pW / pH),\n        ];\n      case 13:\n        // 270 -> 90\n        return [\n          1 - y - width * (pW / pH),\n          x - height * (pH / pW),\n          width * (pW / pH),\n          height * (pH / pW),\n        ];\n      case 14:\n        // 270 -> 180\n        return [\n          1 - x,\n          1 - y - width * (pW / pH),\n          height * (pH / pW),\n          width * (pW / pH),\n        ];\n      case 15:\n        // 270 -> 270\n        return [y, 1 - x, width * (pW / pH), height * (pH / pW)];\n      default:\n        // 0 -> 0\n        return [x, y, width, height];\n    }\n  }\n\n  /** @inheritdoc */\n  rotate() {\n    if (!this.parent) {\n      return;\n    }\n    this.parent.drawLayer.updateProperties(\n      this._drawId,\n      DrawingEditor._mergeSVGProperties(\n        {\n          bbox: this.#rotateBox(),\n        },\n        this.#drawOutlines.updateRotation(\n          (this.parentRotation - this.rotation + 360) % 360\n        )\n      )\n    );\n  }\n\n  onScaleChanging() {\n    if (!this.parent) {\n      return;\n    }\n    this.#updateBbox(\n      this.#drawOutlines.updateParentDimensions(\n        this.parentDimensions,\n        this.parent.scale\n      )\n    );\n  }\n\n  static onScaleChangingWhenDrawing() {}\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    if (this._isCopy) {\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    const div = super.render();\n    div.classList.add(\"draw\");\n\n    const drawDiv = document.createElement(\"div\");\n    div.append(drawDiv);\n    drawDiv.setAttribute(\"aria-hidden\", \"true\");\n    drawDiv.className = \"internal\";\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.setDims(this.width * parentWidth, this.height * parentHeight);\n    this._uiManager.addShouldRescale(this);\n    this.disableEditing();\n\n    if (this._isCopy) {\n      this._moveAfterPaste(baseX, baseY);\n    }\n\n    return div;\n  }\n\n  /**\n   * Create a new drawer instance.\n   * @param {number} x - The x coordinate of the event.\n   * @param {number} y - The y coordinate of the event.\n   * @param {number} parentWidth - The parent width.\n   * @param {number} parentHeight - The parent height.\n   * @param {number} rotation - The parent rotation.\n   */\n  static createDrawerInstance(_x, _y, _parentWidth, _parentHeight, _rotation) {\n    unreachable(\"Not implemented\");\n  }\n\n  static startDrawing(parent, uiManager, _isLTR, event) {\n    // The _currentPointerType is set when the user starts an empty drawing\n    // session. If, in the same drawing session, the user starts using a\n    // different type of pointer (e.g. a pen and then a finger), we just return.\n    //\n    // The _currentPointerId  and _currentPointerIds are used to keep track of\n    // the pointers with a same type (e.g. two fingers). If the user starts to\n    // draw with a finger and then uses a second finger, we just stop the\n    // current drawing and let the user zoom the document.\n\n    const { target, offsetX: x, offsetY: y, pointerId, pointerType } = event;\n    if (\n      DrawingEditor.#currentPointerType &&\n      DrawingEditor.#currentPointerType !== pointerType\n    ) {\n      return;\n    }\n\n    const {\n      viewport: { rotation },\n    } = parent;\n    const { width: parentWidth, height: parentHeight } =\n      target.getBoundingClientRect();\n\n    const ac = (DrawingEditor.#currentDrawingAC = new AbortController());\n    const signal = parent.combinedSignal(ac);\n\n    DrawingEditor.#currentPointerId ||= pointerId;\n    DrawingEditor.#currentPointerType ??= pointerType;\n\n    window.addEventListener(\n      \"pointerup\",\n      e => {\n        if (DrawingEditor.#currentPointerId === e.pointerId) {\n          this._endDraw(e);\n        } else {\n          DrawingEditor.#currentPointerIds?.delete(e.pointerId);\n        }\n      },\n      { signal }\n    );\n    window.addEventListener(\n      \"pointercancel\",\n      e => {\n        if (DrawingEditor.#currentPointerId === e.pointerId) {\n          this._currentParent.endDrawingSession();\n        } else {\n          DrawingEditor.#currentPointerIds?.delete(e.pointerId);\n        }\n      },\n      { signal }\n    );\n    window.addEventListener(\n      \"pointerdown\",\n      e => {\n        if (DrawingEditor.#currentPointerType !== e.pointerType) {\n          // For example, we started with a pen and the user\n          // is now using a finger.\n          return;\n        }\n\n        // For example, the user is using a second finger.\n        (DrawingEditor.#currentPointerIds ||= new Set()).add(e.pointerId);\n\n        // The first finger created a first point and a second finger just\n        // started, so we stop the drawing and remove this only point.\n        if (DrawingEditor.#currentDraw.isCancellable()) {\n          DrawingEditor.#currentDraw.removeLastElement();\n          if (DrawingEditor.#currentDraw.isEmpty()) {\n            this._currentParent.endDrawingSession(/* isAborted = */ true);\n          } else {\n            this._endDraw(null);\n          }\n        }\n      },\n      {\n        capture: true,\n        passive: false,\n        signal,\n      }\n    );\n    window.addEventListener(\"contextmenu\", noContextMenu, { signal });\n    target.addEventListener(\"pointermove\", this._drawMove.bind(this), {\n      signal,\n    });\n    target.addEventListener(\n      \"touchmove\",\n      e => {\n        if (e.timeStamp === DrawingEditor.#currentMoveTimestamp) {\n          // This move event is used to draw so we don't want to scroll.\n          stopEvent(e);\n        }\n      },\n      { signal }\n    );\n    parent.toggleDrawing();\n    uiManager._editorUndoBar?.hide();\n\n    if (DrawingEditor.#currentDraw) {\n      parent.drawLayer.updateProperties(\n        this._currentDrawId,\n        DrawingEditor.#currentDraw.startNew(\n          x,\n          y,\n          parentWidth,\n          parentHeight,\n          rotation\n        )\n      );\n      return;\n    }\n\n    uiManager.updateUIForDefaultProperties(this);\n\n    DrawingEditor.#currentDraw = this.createDrawerInstance(\n      x,\n      y,\n      parentWidth,\n      parentHeight,\n      rotation\n    );\n    DrawingEditor.#currentDrawingOptions = this.getDefaultDrawingOptions();\n    this._currentParent = parent;\n\n    ({ id: this._currentDrawId } = parent.drawLayer.draw(\n      this._mergeSVGProperties(\n        DrawingEditor.#currentDrawingOptions.toSVGProperties(),\n        DrawingEditor.#currentDraw.defaultSVGProperties\n      ),\n      /* isPathUpdatable = */ true,\n      /* hasClip = */ false\n    ));\n  }\n\n  static _drawMove(event) {\n    DrawingEditor.#currentMoveTimestamp = -1;\n    if (!DrawingEditor.#currentDraw) {\n      return;\n    }\n    const { offsetX, offsetY, pointerId } = event;\n\n    if (DrawingEditor.#currentPointerId !== pointerId) {\n      return;\n    }\n    if (DrawingEditor.#currentPointerIds?.size >= 1) {\n      // The user is using multiple fingers and the first one is moving.\n      this._endDraw(event);\n      return;\n    }\n    this._currentParent.drawLayer.updateProperties(\n      this._currentDrawId,\n      DrawingEditor.#currentDraw.add(offsetX, offsetY)\n    );\n    // We track the timestamp to know if the touchmove event is used to draw.\n    DrawingEditor.#currentMoveTimestamp = event.timeStamp;\n    stopEvent(event);\n  }\n\n  static _cleanup(all) {\n    if (all) {\n      this._currentDrawId = -1;\n      this._currentParent = null;\n      DrawingEditor.#currentDraw = null;\n      DrawingEditor.#currentDrawingOptions = null;\n      DrawingEditor.#currentPointerType = null;\n      DrawingEditor.#currentMoveTimestamp = NaN;\n    }\n\n    if (DrawingEditor.#currentDrawingAC) {\n      DrawingEditor.#currentDrawingAC.abort();\n      DrawingEditor.#currentDrawingAC = null;\n      DrawingEditor.#currentPointerId = NaN;\n      DrawingEditor.#currentPointerIds = null;\n    }\n  }\n\n  static _endDraw(event) {\n    const parent = this._currentParent;\n    if (!parent) {\n      return;\n    }\n\n    parent.toggleDrawing(true);\n    this._cleanup(false);\n\n    if (event?.target === parent.div) {\n      parent.drawLayer.updateProperties(\n        this._currentDrawId,\n        DrawingEditor.#currentDraw.end(event.offsetX, event.offsetY)\n      );\n    }\n    if (this.supportMultipleDrawings) {\n      const draw = DrawingEditor.#currentDraw;\n      const drawId = this._currentDrawId;\n      const lastElement = draw.getLastElement();\n      parent.addCommands({\n        cmd: () => {\n          parent.drawLayer.updateProperties(\n            drawId,\n            draw.setLastElement(lastElement)\n          );\n        },\n        undo: () => {\n          parent.drawLayer.updateProperties(drawId, draw.removeLastElement());\n        },\n        mustExec: false,\n        type: AnnotationEditorParamsType.DRAW_STEP,\n      });\n\n      return;\n    }\n\n    this.endDrawing(/* isAborted = */ false);\n  }\n\n  static endDrawing(isAborted) {\n    const parent = this._currentParent;\n    if (!parent) {\n      return null;\n    }\n    parent.toggleDrawing(true);\n    parent.cleanUndoStack(AnnotationEditorParamsType.DRAW_STEP);\n\n    if (!DrawingEditor.#currentDraw.isEmpty()) {\n      const {\n        pageDimensions: [pageWidth, pageHeight],\n        scale,\n      } = parent;\n\n      const editor = parent.createAndAddNewEditor(\n        { offsetX: 0, offsetY: 0 },\n        false,\n        {\n          drawId: this._currentDrawId,\n          drawOutlines: DrawingEditor.#currentDraw.getOutlines(\n            pageWidth * scale,\n            pageHeight * scale,\n            scale,\n            this._INNER_MARGIN\n          ),\n          drawingOptions: DrawingEditor.#currentDrawingOptions,\n          mustBeCommitted: !isAborted,\n        }\n      );\n      this._cleanup(true);\n      return editor;\n    }\n\n    parent.drawLayer.remove(this._currentDrawId);\n    this._cleanup(true);\n    return null;\n  }\n\n  /**\n   * Create the drawing options.\n   * @param {Object} _data\n   */\n  createDrawingOptions(_data) {}\n\n  /**\n   * Deserialize the drawing outlines.\n   * @param {number} pageX - The x coordinate of the page.\n   * @param {number} pageY - The y coordinate of the page.\n   * @param {number} pageWidth - The width of the page.\n   * @param {number} pageHeight - The height of the page.\n   * @param {number} innerWidth - The inner width.\n   * @param {Object} data - The data to deserialize.\n   * @returns {Object} The deserialized outlines.\n   */\n  static deserializeDraw(\n    _pageX,\n    _pageY,\n    _pageWidth,\n    _pageHeight,\n    _innerWidth,\n    _data\n  ) {\n    unreachable(\"Not implemented\");\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    const {\n      rawDims: { pageWidth, pageHeight, pageX, pageY },\n    } = parent.viewport;\n    const drawOutlines = this.deserializeDraw(\n      pageX,\n      pageY,\n      pageWidth,\n      pageHeight,\n      this._INNER_MARGIN,\n      data\n    );\n    const editor = await super.deserialize(data, parent, uiManager);\n    editor.createDrawingOptions(data);\n    editor.#createDrawOutlines({ drawOutlines });\n    editor.#addToDrawLayer();\n    editor.onScaleChanging();\n    editor.rotate();\n\n    return editor;\n  }\n\n  serializeDraw(isForCopying) {\n    const [pageX, pageY] = this.pageTranslation;\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    return this.#drawOutlines.serialize(\n      [pageX, pageY, pageWidth, pageHeight],\n      isForCopying\n    );\n  }\n\n  /** @inheritdoc */\n  renderAnnotationElement(annotation) {\n    annotation.updateEdited({\n      rect: this.getRect(0, 0),\n    });\n\n    return null;\n  }\n\n  static canCreateNewEmptyEditor() {\n    return false;\n  }\n}\n\nexport { DrawingEditor, DrawingOptions };\n","/* Copyright 2024 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { MathClamp, Util } from \"../../../shared/util.js\";\nimport { Outline } from \"./outline.js\";\n\nclass InkDrawOutliner {\n  // The last 3 points of the line.\n  #last = new Float64Array(6);\n\n  #line;\n\n  #lines;\n\n  #rotation;\n\n  #thickness;\n\n  #points;\n\n  #lastSVGPath = \"\";\n\n  #lastIndex = 0;\n\n  #outlines = new InkDrawOutline();\n\n  #parentWidth;\n\n  #parentHeight;\n\n  constructor(x, y, parentWidth, parentHeight, rotation, thickness) {\n    this.#parentWidth = parentWidth;\n    this.#parentHeight = parentHeight;\n    this.#rotation = rotation;\n    this.#thickness = thickness;\n\n    [x, y] = this.#normalizePoint(x, y);\n\n    const line = (this.#line = [NaN, NaN, NaN, NaN, x, y]);\n    this.#points = [x, y];\n    this.#lines = [{ line, points: this.#points }];\n    this.#last.set(line, 0);\n  }\n\n  updateProperty(name, value) {\n    if (name === \"stroke-width\") {\n      this.#thickness = value;\n    }\n  }\n\n  #normalizePoint(x, y) {\n    return Outline._normalizePoint(\n      x,\n      y,\n      this.#parentWidth,\n      this.#parentHeight,\n      this.#rotation\n    );\n  }\n\n  isEmpty() {\n    return !this.#lines || this.#lines.length === 0;\n  }\n\n  isCancellable() {\n    // The user a second finger after drawing 5 points: it's small enough\n    // to not be a real drawing.\n    return this.#points.length <= 10;\n  }\n\n  add(x, y) {\n    // The point is in canvas coordinates which means that there is no rotation.\n    // It's the same as parent coordinates.\n    [x, y] = this.#normalizePoint(x, y);\n    const [x1, y1, x2, y2] = this.#last.subarray(2, 6);\n    const diffX = x - x2;\n    const diffY = y - y2;\n    const d = Math.hypot(this.#parentWidth * diffX, this.#parentHeight * diffY);\n    if (d <= 2) {\n      // The idea is to avoid garbage points around the last point.\n      // When the points are too close, it just leads to bad normal vectors and\n      // control points.\n      return null;\n    }\n\n    this.#points.push(x, y);\n\n    if (isNaN(x1)) {\n      // We've only one point.\n      this.#last.set([x2, y2, x, y], 2);\n      this.#line.push(NaN, NaN, NaN, NaN, x, y);\n      return {\n        path: {\n          d: this.toSVGPath(),\n        },\n      };\n    }\n\n    if (isNaN(this.#last[0])) {\n      // We've only two points.\n      this.#line.splice(6, 6);\n    }\n\n    this.#last.set([x1, y1, x2, y2, x, y], 0);\n    this.#line.push(...Outline.createBezierPoints(x1, y1, x2, y2, x, y));\n\n    return {\n      path: {\n        d: this.toSVGPath(),\n      },\n    };\n  }\n\n  end(x, y) {\n    const change = this.add(x, y);\n    if (change) {\n      return change;\n    }\n    if (this.#points.length === 2) {\n      // We've only one point.\n      return {\n        path: {\n          d: this.toSVGPath(),\n        },\n      };\n    }\n    return null;\n  }\n\n  startNew(x, y, parentWidth, parentHeight, rotation) {\n    this.#parentWidth = parentWidth;\n    this.#parentHeight = parentHeight;\n    this.#rotation = rotation;\n\n    [x, y] = this.#normalizePoint(x, y);\n\n    const line = (this.#line = [NaN, NaN, NaN, NaN, x, y]);\n    this.#points = [x, y];\n    const last = this.#lines.at(-1);\n    if (last) {\n      last.line = new Float32Array(last.line);\n      last.points = new Float32Array(last.points);\n    }\n    this.#lines.push({ line, points: this.#points });\n    this.#last.set(line, 0);\n    this.#lastIndex = 0;\n    this.toSVGPath();\n\n    return null;\n  }\n\n  getLastElement() {\n    return this.#lines.at(-1);\n  }\n\n  setLastElement(element) {\n    if (!this.#lines) {\n      return this.#outlines.setLastElement(element);\n    }\n    this.#lines.push(element);\n    this.#line = element.line;\n    this.#points = element.points;\n    this.#lastIndex = 0;\n    return {\n      path: {\n        d: this.toSVGPath(),\n      },\n    };\n  }\n\n  removeLastElement() {\n    if (!this.#lines) {\n      return this.#outlines.removeLastElement();\n    }\n    this.#lines.pop();\n    this.#lastSVGPath = \"\";\n    for (let i = 0, ii = this.#lines.length; i < ii; i++) {\n      const { line, points } = this.#lines[i];\n      this.#line = line;\n      this.#points = points;\n      this.#lastIndex = 0;\n      this.toSVGPath();\n    }\n\n    return {\n      path: {\n        d: this.#lastSVGPath,\n      },\n    };\n  }\n\n  toSVGPath() {\n    const firstX = Outline.svgRound(this.#line[4]);\n    const firstY = Outline.svgRound(this.#line[5]);\n    if (this.#points.length === 2) {\n      this.#lastSVGPath = `${this.#lastSVGPath} M ${firstX} ${firstY} Z`;\n      return this.#lastSVGPath;\n    }\n\n    if (this.#points.length <= 6) {\n      // We've 2 or 3 points.\n      const i = this.#lastSVGPath.lastIndexOf(\"M\");\n      this.#lastSVGPath = `${this.#lastSVGPath.slice(0, i)} M ${firstX} ${firstY}`;\n      this.#lastIndex = 6;\n    }\n\n    if (this.#points.length === 4) {\n      const secondX = Outline.svgRound(this.#line[10]);\n      const secondY = Outline.svgRound(this.#line[11]);\n      this.#lastSVGPath = `${this.#lastSVGPath} L ${secondX} ${secondY}`;\n      this.#lastIndex = 12;\n      return this.#lastSVGPath;\n    }\n\n    const buffer = [];\n    if (this.#lastIndex === 0) {\n      buffer.push(`M ${firstX} ${firstY}`);\n      this.#lastIndex = 6;\n    }\n\n    for (let i = this.#lastIndex, ii = this.#line.length; i < ii; i += 6) {\n      const [c1x, c1y, c2x, c2y, x, y] = this.#line\n        .slice(i, i + 6)\n        .map(Outline.svgRound);\n      buffer.push(`C${c1x} ${c1y} ${c2x} ${c2y} ${x} ${y}`);\n    }\n    this.#lastSVGPath += buffer.join(\" \");\n    this.#lastIndex = this.#line.length;\n\n    return this.#lastSVGPath;\n  }\n\n  getOutlines(parentWidth, parentHeight, scale, innerMargin) {\n    const last = this.#lines.at(-1);\n    last.line = new Float32Array(last.line);\n    last.points = new Float32Array(last.points);\n\n    this.#outlines.build(\n      this.#lines,\n      parentWidth,\n      parentHeight,\n      scale,\n      this.#rotation,\n      this.#thickness,\n      innerMargin\n    );\n\n    // We reset everything: the drawing is done.\n    this.#last = null;\n    this.#line = null;\n    this.#lines = null;\n    this.#lastSVGPath = null;\n\n    return this.#outlines;\n  }\n\n  get defaultSVGProperties() {\n    return {\n      root: {\n        viewBox: \"0 0 10000 10000\",\n      },\n      rootClass: {\n        draw: true,\n      },\n      bbox: [0, 0, 1, 1],\n    };\n  }\n}\n\nclass InkDrawOutline extends Outline {\n  #bbox;\n\n  #currentRotation = 0;\n\n  #innerMargin;\n\n  #lines;\n\n  #parentWidth;\n\n  #parentHeight;\n\n  #parentScale;\n\n  #rotation;\n\n  #thickness;\n\n  build(\n    lines,\n    parentWidth,\n    parentHeight,\n    parentScale,\n    rotation,\n    thickness,\n    innerMargin\n  ) {\n    this.#parentWidth = parentWidth;\n    this.#parentHeight = parentHeight;\n    this.#parentScale = parentScale;\n    this.#rotation = rotation;\n    this.#thickness = thickness;\n    this.#innerMargin = innerMargin ?? 0;\n    this.#lines = lines;\n\n    this.#computeBbox();\n  }\n\n  get thickness() {\n    return this.#thickness;\n  }\n\n  setLastElement(element) {\n    this.#lines.push(element);\n    return {\n      path: {\n        d: this.toSVGPath(),\n      },\n    };\n  }\n\n  removeLastElement() {\n    this.#lines.pop();\n    return {\n      path: {\n        d: this.toSVGPath(),\n      },\n    };\n  }\n\n  toSVGPath() {\n    const buffer = [];\n    for (const { line } of this.#lines) {\n      buffer.push(`M${Outline.svgRound(line[4])} ${Outline.svgRound(line[5])}`);\n      if (line.length === 6) {\n        buffer.push(\"Z\");\n        continue;\n      }\n      if (line.length === 12 && isNaN(line[6])) {\n        buffer.push(\n          `L${Outline.svgRound(line[10])} ${Outline.svgRound(line[11])}`\n        );\n        continue;\n      }\n      for (let i = 6, ii = line.length; i < ii; i += 6) {\n        const [c1x, c1y, c2x, c2y, x, y] = line\n          .subarray(i, i + 6)\n          .map(Outline.svgRound);\n        buffer.push(`C${c1x} ${c1y} ${c2x} ${c2y} ${x} ${y}`);\n      }\n    }\n    return buffer.join(\"\");\n  }\n\n  serialize([pageX, pageY, pageWidth, pageHeight], isForCopying) {\n    const serializedLines = [];\n    const serializedPoints = [];\n    const [x, y, width, height] = this.#getBBoxWithNoMargin();\n    let tx, ty, sx, sy, x1, y1, x2, y2, rescaleFn;\n\n    switch (this.#rotation) {\n      case 0:\n        rescaleFn = Outline._rescale;\n        tx = pageX;\n        ty = pageY + pageHeight;\n        sx = pageWidth;\n        sy = -pageHeight;\n        x1 = pageX + x * pageWidth;\n        y1 = pageY + (1 - y - height) * pageHeight;\n        x2 = pageX + (x + width) * pageWidth;\n        y2 = pageY + (1 - y) * pageHeight;\n        break;\n      case 90:\n        rescaleFn = Outline._rescaleAndSwap;\n        tx = pageX;\n        ty = pageY;\n        sx = pageWidth;\n        sy = pageHeight;\n        x1 = pageX + y * pageWidth;\n        y1 = pageY + x * pageHeight;\n        x2 = pageX + (y + height) * pageWidth;\n        y2 = pageY + (x + width) * pageHeight;\n        break;\n      case 180:\n        rescaleFn = Outline._rescale;\n        tx = pageX + pageWidth;\n        ty = pageY;\n        sx = -pageWidth;\n        sy = pageHeight;\n        x1 = pageX + (1 - x - width) * pageWidth;\n        y1 = pageY + y * pageHeight;\n        x2 = pageX + (1 - x) * pageWidth;\n        y2 = pageY + (y + height) * pageHeight;\n        break;\n      case 270:\n        rescaleFn = Outline._rescaleAndSwap;\n        tx = pageX + pageWidth;\n        ty = pageY + pageHeight;\n        sx = -pageWidth;\n        sy = -pageHeight;\n        x1 = pageX + (1 - y - height) * pageWidth;\n        y1 = pageY + (1 - x - width) * pageHeight;\n        x2 = pageX + (1 - y) * pageWidth;\n        y2 = pageY + (1 - x) * pageHeight;\n        break;\n    }\n\n    for (const { line, points } of this.#lines) {\n      serializedLines.push(\n        rescaleFn(\n          line,\n          tx,\n          ty,\n          sx,\n          sy,\n          isForCopying ? new Array(line.length) : null\n        )\n      );\n      serializedPoints.push(\n        rescaleFn(\n          points,\n          tx,\n          ty,\n          sx,\n          sy,\n          isForCopying ? new Array(points.length) : null\n        )\n      );\n    }\n\n    return {\n      lines: serializedLines,\n      points: serializedPoints,\n      rect: [x1, y1, x2, y2],\n    };\n  }\n\n  static deserialize(\n    pageX,\n    pageY,\n    pageWidth,\n    pageHeight,\n    innerMargin,\n    { paths: { lines, points }, rotation, thickness }\n  ) {\n    const newLines = [];\n    let tx, ty, sx, sy, rescaleFn;\n    switch (rotation) {\n      case 0:\n        rescaleFn = Outline._rescale;\n        tx = -pageX / pageWidth;\n        ty = pageY / pageHeight + 1;\n        sx = 1 / pageWidth;\n        sy = -1 / pageHeight;\n        break;\n      case 90:\n        rescaleFn = Outline._rescaleAndSwap;\n        tx = -pageY / pageHeight;\n        ty = -pageX / pageWidth;\n        sx = 1 / pageHeight;\n        sy = 1 / pageWidth;\n        break;\n      case 180:\n        rescaleFn = Outline._rescale;\n        tx = pageX / pageWidth + 1;\n        ty = -pageY / pageHeight;\n        sx = -1 / pageWidth;\n        sy = 1 / pageHeight;\n        break;\n      case 270:\n        rescaleFn = Outline._rescaleAndSwap;\n        tx = pageY / pageHeight + 1;\n        ty = pageX / pageWidth + 1;\n        sx = -1 / pageHeight;\n        sy = -1 / pageWidth;\n        break;\n    }\n\n    if (!lines) {\n      lines = [];\n      for (const point of points) {\n        const len = point.length;\n        if (len === 2) {\n          lines.push(\n            new Float32Array([NaN, NaN, NaN, NaN, point[0], point[1]])\n          );\n          continue;\n        }\n        if (len === 4) {\n          lines.push(\n            new Float32Array([\n              NaN,\n              NaN,\n              NaN,\n              NaN,\n              point[0],\n              point[1],\n              NaN,\n              NaN,\n              NaN,\n              NaN,\n              point[2],\n              point[3],\n            ])\n          );\n          continue;\n        }\n        const line = new Float32Array(3 * (len - 2));\n        lines.push(line);\n        let [x1, y1, x2, y2] = point.subarray(0, 4);\n        line.set([NaN, NaN, NaN, NaN, x1, y1], 0);\n        for (let i = 4; i < len; i += 2) {\n          const x = point[i];\n          const y = point[i + 1];\n          line.set(\n            Outline.createBezierPoints(x1, y1, x2, y2, x, y),\n            (i - 2) * 3\n          );\n          [x1, y1, x2, y2] = [x2, y2, x, y];\n        }\n      }\n    }\n\n    for (let i = 0, ii = lines.length; i < ii; i++) {\n      newLines.push({\n        line: rescaleFn(\n          lines[i].map(x => x ?? NaN),\n          tx,\n          ty,\n          sx,\n          sy\n        ),\n        points: rescaleFn(\n          points[i].map(x => x ?? NaN),\n          tx,\n          ty,\n          sx,\n          sy\n        ),\n      });\n    }\n\n    const outlines = new this.prototype.constructor();\n    outlines.build(\n      newLines,\n      pageWidth,\n      pageHeight,\n      1,\n      rotation,\n      thickness,\n      innerMargin\n    );\n\n    return outlines;\n  }\n\n  #getMarginComponents(thickness = this.#thickness) {\n    const margin = this.#innerMargin + (thickness / 2) * this.#parentScale;\n    return this.#rotation % 180 === 0\n      ? [margin / this.#parentWidth, margin / this.#parentHeight]\n      : [margin / this.#parentHeight, margin / this.#parentWidth];\n  }\n\n  #getBBoxWithNoMargin() {\n    const [x, y, width, height] = this.#bbox;\n    const [marginX, marginY] = this.#getMarginComponents(0);\n\n    return [\n      x + marginX,\n      y + marginY,\n      width - 2 * marginX,\n      height - 2 * marginY,\n    ];\n  }\n\n  #computeBbox() {\n    const bbox = (this.#bbox = new Float32Array([\n      Infinity,\n      Infinity,\n      -Infinity,\n      -Infinity,\n    ]));\n\n    for (const { line } of this.#lines) {\n      if (line.length <= 12) {\n        // We've only one or two points => no bezier curve.\n        for (let i = 4, ii = line.length; i < ii; i += 6) {\n          Util.pointBoundingBox(line[i], line[i + 1], bbox);\n        }\n        continue;\n      }\n      let lastX = line[4],\n        lastY = line[5];\n      for (let i = 6, ii = line.length; i < ii; i += 6) {\n        const [c1x, c1y, c2x, c2y, x, y] = line.subarray(i, i + 6);\n        Util.bezierBoundingBox(lastX, lastY, c1x, c1y, c2x, c2y, x, y, bbox);\n        lastX = x;\n        lastY = y;\n      }\n    }\n\n    const [marginX, marginY] = this.#getMarginComponents();\n    bbox[0] = MathClamp(bbox[0] - marginX, 0, 1);\n    bbox[1] = MathClamp(bbox[1] - marginY, 0, 1);\n    bbox[2] = MathClamp(bbox[2] + marginX, 0, 1);\n    bbox[3] = MathClamp(bbox[3] + marginY, 0, 1);\n\n    bbox[2] -= bbox[0];\n    bbox[3] -= bbox[1];\n  }\n\n  get box() {\n    return this.#bbox;\n  }\n\n  updateProperty(name, value) {\n    if (name === \"stroke-width\") {\n      return this.#updateThickness(value);\n    }\n    return null;\n  }\n\n  #updateThickness(thickness) {\n    const [oldMarginX, oldMarginY] = this.#getMarginComponents();\n    this.#thickness = thickness;\n    const [newMarginX, newMarginY] = this.#getMarginComponents();\n    const [diffMarginX, diffMarginY] = [\n      newMarginX - oldMarginX,\n      newMarginY - oldMarginY,\n    ];\n    const bbox = this.#bbox;\n    bbox[0] -= diffMarginX;\n    bbox[1] -= diffMarginY;\n    bbox[2] += 2 * diffMarginX;\n    bbox[3] += 2 * diffMarginY;\n\n    return bbox;\n  }\n\n  updateParentDimensions([width, height], scale) {\n    const [oldMarginX, oldMarginY] = this.#getMarginComponents();\n    this.#parentWidth = width;\n    this.#parentHeight = height;\n    this.#parentScale = scale;\n    const [newMarginX, newMarginY] = this.#getMarginComponents();\n    const diffMarginX = newMarginX - oldMarginX;\n    const diffMarginY = newMarginY - oldMarginY;\n\n    const bbox = this.#bbox;\n    bbox[0] -= diffMarginX;\n    bbox[1] -= diffMarginY;\n    bbox[2] += 2 * diffMarginX;\n    bbox[3] += 2 * diffMarginY;\n\n    return bbox;\n  }\n\n  updateRotation(rotation) {\n    this.#currentRotation = rotation;\n    return {\n      path: {\n        transform: this.rotationTransform,\n      },\n    };\n  }\n\n  get viewBox() {\n    return this.#bbox.map(Outline.svgRound).join(\" \");\n  }\n\n  get defaultProperties() {\n    const [x, y] = this.#bbox;\n    return {\n      root: {\n        viewBox: this.viewBox,\n      },\n      path: {\n        \"transform-origin\": `${Outline.svgRound(x)} ${Outline.svgRound(y)}`,\n      },\n    };\n  }\n\n  get rotationTransform() {\n    const [, , width, height] = this.#bbox;\n    let a = 0,\n      b = 0,\n      c = 0,\n      d = 0,\n      e = 0,\n      f = 0;\n    switch (this.#currentRotation) {\n      case 90:\n        b = height / width;\n        c = -width / height;\n        e = width;\n        break;\n      case 180:\n        a = -1;\n        d = -1;\n        e = width;\n        f = height;\n        break;\n      case 270:\n        b = -height / width;\n        c = width / height;\n        f = height;\n        break;\n      default:\n        return \"\";\n    }\n    return `matrix(${a} ${b} ${c} ${d} ${Outline.svgRound(e)} ${Outline.svgRound(f)})`;\n  }\n\n  getPathResizingSVGProperties([newX, newY, newWidth, newHeight]) {\n    const [marginX, marginY] = this.#getMarginComponents();\n    const [x, y, width, height] = this.#bbox;\n\n    if (\n      Math.abs(width - marginX) <= Outline.PRECISION ||\n      Math.abs(height - marginY) <= Outline.PRECISION\n    ) {\n      // Center the path in the new bounding box.\n      const tx = newX + newWidth / 2 - (x + width / 2);\n      const ty = newY + newHeight / 2 - (y + height / 2);\n      return {\n        path: {\n          \"transform-origin\": `${Outline.svgRound(newX)} ${Outline.svgRound(newY)}`,\n          transform: `${this.rotationTransform} translate(${tx} ${ty})`,\n        },\n      };\n    }\n\n    // We compute the following transform:\n    //  1. Translate the path to the origin (-marginX, -marginY).\n    //  2. Scale the path to the new size:\n    //   ((newWidth - 2*marginX) / (bbox.width - 2*marginX),\n    //   (newHeight - 2*marginY) / (bbox.height - 2*marginY)).\n    //  3. Translate the path back to its original position\n    //   (marginX, marginY).\n    //  4. Scale the inverse of bbox scaling:\n    //   (bbox.width / newWidth, bbox.height / newHeight).\n\n    const s1x = (newWidth - 2 * marginX) / (width - 2 * marginX);\n    const s1y = (newHeight - 2 * marginY) / (height - 2 * marginY);\n    const s2x = width / newWidth;\n    const s2y = height / newHeight;\n\n    return {\n      path: {\n        \"transform-origin\": `${Outline.svgRound(x)} ${Outline.svgRound(y)}`,\n        transform:\n          `${this.rotationTransform} scale(${s2x} ${s2y}) ` +\n          `translate(${Outline.svgRound(marginX)} ${Outline.svgRound(marginY)}) scale(${s1x} ${s1y}) ` +\n          `translate(${Outline.svgRound(-marginX)} ${Outline.svgRound(-marginY)})`,\n      },\n    };\n  }\n\n  getPathResizedSVGProperties([newX, newY, newWidth, newHeight]) {\n    const [marginX, marginY] = this.#getMarginComponents();\n    const bbox = this.#bbox;\n    const [x, y, width, height] = bbox;\n\n    bbox[0] = newX;\n    bbox[1] = newY;\n    bbox[2] = newWidth;\n    bbox[3] = newHeight;\n\n    if (\n      Math.abs(width - marginX) <= Outline.PRECISION ||\n      Math.abs(height - marginY) <= Outline.PRECISION\n    ) {\n      // Center the path in the new bounding box.\n      const tx = newX + newWidth / 2 - (x + width / 2);\n      const ty = newY + newHeight / 2 - (y + height / 2);\n      for (const { line, points } of this.#lines) {\n        Outline._translate(line, tx, ty, line);\n        Outline._translate(points, tx, ty, points);\n      }\n      return {\n        root: {\n          viewBox: this.viewBox,\n        },\n        path: {\n          \"transform-origin\": `${Outline.svgRound(newX)} ${Outline.svgRound(newY)}`,\n          transform: this.rotationTransform || null,\n          d: this.toSVGPath(),\n        },\n      };\n    }\n\n    // We compute the following transform:\n    //  1. Translate the path to the origin (-(x + marginX), -(y + marginY)).\n    //  2. Scale the path to the new size:\n    //   ((newWidth - 2*marginX) / (bbox.width - 2*marginX),\n    //   (newHeight - 2*marginY) / (bbox.height - 2*marginY)).\n    //  3. Translate the path back to its new position\n    //     (newX + marginX,y newY + marginY).\n\n    const s1x = (newWidth - 2 * marginX) / (width - 2 * marginX);\n    const s1y = (newHeight - 2 * marginY) / (height - 2 * marginY);\n    const tx = -s1x * (x + marginX) + newX + marginX;\n    const ty = -s1y * (y + marginY) + newY + marginY;\n\n    if (s1x !== 1 || s1y !== 1 || tx !== 0 || ty !== 0) {\n      for (const { line, points } of this.#lines) {\n        Outline._rescale(line, tx, ty, s1x, s1y, line);\n        Outline._rescale(points, tx, ty, s1x, s1y, points);\n      }\n    }\n\n    return {\n      root: {\n        viewBox: this.viewBox,\n      },\n      path: {\n        \"transform-origin\": `${Outline.svgRound(newX)} ${Outline.svgRound(newY)}`,\n        transform: this.rotationTransform || null,\n        d: this.toSVGPath(),\n      },\n    };\n  }\n\n  getPathTranslatedSVGProperties([newX, newY], parentDimensions) {\n    const [newParentWidth, newParentHeight] = parentDimensions;\n    const bbox = this.#bbox;\n    const tx = newX - bbox[0];\n    const ty = newY - bbox[1];\n\n    if (\n      this.#parentWidth === newParentWidth &&\n      this.#parentHeight === newParentHeight\n    ) {\n      // We don't change the parent dimensions so it's a simple translation.\n      for (const { line, points } of this.#lines) {\n        Outline._translate(line, tx, ty, line);\n        Outline._translate(points, tx, ty, points);\n      }\n    } else {\n      const sx = this.#parentWidth / newParentWidth;\n      const sy = this.#parentHeight / newParentHeight;\n      this.#parentWidth = newParentWidth;\n      this.#parentHeight = newParentHeight;\n\n      for (const { line, points } of this.#lines) {\n        Outline._rescale(line, tx, ty, sx, sy, line);\n        Outline._rescale(points, tx, ty, sx, sy, points);\n      }\n      bbox[2] *= sx;\n      bbox[3] *= sy;\n    }\n    bbox[0] = newX;\n    bbox[1] = newY;\n\n    return {\n      root: {\n        viewBox: this.viewBox,\n      },\n      path: {\n        d: this.toSVGPath(),\n        \"transform-origin\": `${Outline.svgRound(newX)} ${Outline.svgRound(newY)}`,\n      },\n    };\n  }\n\n  get defaultSVGProperties() {\n    const bbox = this.#bbox;\n    return {\n      root: {\n        viewBox: this.viewBox,\n      },\n      rootClass: {\n        draw: true,\n      },\n      path: {\n        d: this.toSVGPath(),\n        \"transform-origin\": `${Outline.svgRound(bbox[0])} ${Outline.svgRound(bbox[1])}`,\n        transform: this.rotationTransform || null,\n      },\n      bbox,\n    };\n  }\n}\n\nexport { InkDrawOutline, InkDrawOutliner };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  shadow,\n  Util,\n} from \"../../shared/util.js\";\nimport { DrawingEditor, DrawingOptions } from \"./draw.js\";\nimport { InkDrawOutline, InkDrawOutliner } from \"./drawers/inkdraw.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { InkAnnotationElement } from \"../annotation_layer.js\";\n\nclass InkDrawingOptions extends DrawingOptions {\n  constructor(viewerParameters) {\n    super();\n    this._viewParameters = viewerParameters;\n\n    super.updateProperties({\n      fill: \"none\",\n      stroke: AnnotationEditor._defaultLineColor,\n      \"stroke-opacity\": 1,\n      \"stroke-width\": 1,\n      \"stroke-linecap\": \"round\",\n      \"stroke-linejoin\": \"round\",\n      \"stroke-miterlimit\": 10,\n    });\n  }\n\n  updateSVGProperty(name, value) {\n    if (name === \"stroke-width\") {\n      value ??= this[\"stroke-width\"];\n      value *= this._viewParameters.realScale;\n    }\n    super.updateSVGProperty(name, value);\n  }\n\n  clone() {\n    const clone = new InkDrawingOptions(this._viewParameters);\n    clone.updateAll(this);\n    return clone;\n  }\n}\n\n/**\n * Basic draw editor in order to generate an Ink annotation.\n */\nclass InkEditor extends DrawingEditor {\n  static _type = \"ink\";\n\n  static _editorType = AnnotationEditorType.INK;\n\n  static _defaultDrawingOptions = null;\n\n  constructor(params) {\n    super({ ...params, name: \"inkEditor\" });\n    this._willKeepAspectRatio = true;\n    this.defaultL10nId = \"pdfjs-editor-ink-editor\";\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n    this._defaultDrawingOptions = new InkDrawingOptions(\n      uiManager.viewParameters\n    );\n  }\n\n  /** @inheritdoc */\n  static getDefaultDrawingOptions(options) {\n    const clone = this._defaultDrawingOptions.clone();\n    clone.updateProperties(options);\n    return clone;\n  }\n\n  /** @inheritdoc */\n  static get supportMultipleDrawings() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  static get typesMap() {\n    return shadow(\n      this,\n      \"typesMap\",\n      new Map([\n        [AnnotationEditorParamsType.INK_THICKNESS, \"stroke-width\"],\n        [AnnotationEditorParamsType.INK_COLOR, \"stroke\"],\n        [AnnotationEditorParamsType.INK_OPACITY, \"stroke-opacity\"],\n      ])\n    );\n  }\n\n  /** @inheritdoc */\n  static createDrawerInstance(x, y, parentWidth, parentHeight, rotation) {\n    return new InkDrawOutliner(\n      x,\n      y,\n      parentWidth,\n      parentHeight,\n      rotation,\n      this._defaultDrawingOptions[\"stroke-width\"]\n    );\n  }\n\n  /** @inheritdoc */\n  static deserializeDraw(\n    pageX,\n    pageY,\n    pageWidth,\n    pageHeight,\n    innerMargin,\n    data\n  ) {\n    return InkDrawOutline.deserialize(\n      pageX,\n      pageY,\n      pageWidth,\n      pageHeight,\n      innerMargin,\n      data\n    );\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    let initialData = null;\n    if (data instanceof InkAnnotationElement) {\n      const {\n        data: {\n          inkLists,\n          rect,\n          rotation,\n          id,\n          color,\n          opacity,\n          borderStyle: { rawWidth: thickness },\n          popupRef,\n        },\n        parent: {\n          page: { pageNumber },\n        },\n      } = data;\n      initialData = data = {\n        annotationType: AnnotationEditorType.INK,\n        color: Array.from(color),\n        thickness,\n        opacity,\n        paths: { points: inkLists },\n        boxes: null,\n        pageIndex: pageNumber - 1,\n        rect: rect.slice(0),\n        rotation,\n        annotationElementId: id,\n        id,\n        deleted: false,\n        popupRef,\n      };\n    }\n\n    const editor = await super.deserialize(data, parent, uiManager);\n    editor._initialData = initialData;\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  onScaleChanging() {\n    if (!this.parent) {\n      return;\n    }\n    super.onScaleChanging();\n    const { _drawId, _drawingOptions, parent } = this;\n    _drawingOptions.updateSVGProperty(\"stroke-width\");\n    parent.drawLayer.updateProperties(\n      _drawId,\n      _drawingOptions.toSVGProperties()\n    );\n  }\n\n  static onScaleChangingWhenDrawing() {\n    const parent = this._currentParent;\n    if (!parent) {\n      return;\n    }\n    super.onScaleChangingWhenDrawing();\n    this._defaultDrawingOptions.updateSVGProperty(\"stroke-width\");\n    parent.drawLayer.updateProperties(\n      this._currentDrawId,\n      this._defaultDrawingOptions.toSVGProperties()\n    );\n  }\n\n  /** @inheritdoc */\n  createDrawingOptions({ color, thickness, opacity }) {\n    this._drawingOptions = InkEditor.getDefaultDrawingOptions({\n      stroke: Util.makeHexColor(...color),\n      \"stroke-width\": thickness,\n      \"stroke-opacity\": opacity,\n    });\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false) {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    if (this.deleted) {\n      return this.serializeDeleted();\n    }\n\n    const { lines, points, rect } = this.serializeDraw(isForCopying);\n    const {\n      _drawingOptions: {\n        stroke,\n        \"stroke-opacity\": opacity,\n        \"stroke-width\": thickness,\n      },\n    } = this;\n    const serialized = {\n      annotationType: AnnotationEditorType.INK,\n      color: AnnotationEditor._colorManager.convert(stroke),\n      opacity,\n      thickness,\n      paths: {\n        lines,\n        points,\n      },\n      pageIndex: this.pageIndex,\n      rect,\n      rotation: this.rotation,\n      structTreeParentId: this._structTreeParentId,\n    };\n\n    if (isForCopying) {\n      serialized.isCopy = true;\n      return serialized;\n    }\n\n    if (this.annotationElementId && !this.#hasElementChanged(serialized)) {\n      return null;\n    }\n\n    serialized.id = this.annotationElementId;\n    return serialized;\n  }\n\n  #hasElementChanged(serialized) {\n    const { color, thickness, opacity, pageIndex } = this._initialData;\n    return (\n      this._hasBeenMoved ||\n      this._hasBeenResized ||\n      serialized.color.some((c, i) => c !== color[i]) ||\n      serialized.thickness !== thickness ||\n      serialized.opacity !== opacity ||\n      serialized.pageIndex !== pageIndex\n    );\n  }\n\n  /** @inheritdoc */\n  renderAnnotationElement(annotation) {\n    const { points, rect } = this.serializeDraw(/* isForCopying = */ false);\n    annotation.updateEdited({\n      rect,\n      thickness: this._drawingOptions[\"stroke-width\"],\n      points,\n    });\n\n    return null;\n  }\n}\n\nexport { InkDrawingOptions, InkEditor };\n","/* Copyright 2024 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InkDrawOutline } from \"./inkdraw.js\";\n\nclass ContourDrawOutline extends InkDrawOutline {\n  toSVGPath() {\n    let path = super.toSVGPath();\n    if (!path.endsWith(\"Z\")) {\n      path += \"Z\";\n    }\n    return path;\n  }\n}\n\nexport { ContourDrawOutline };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { fromBase64Util, toBase64Util, warn } from \"../../../shared/util.js\";\nimport { ContourDrawOutline } from \"./contour.js\";\nimport { InkDrawOutline } from \"./inkdraw.js\";\nimport { Outline } from \"./outline.js\";\n\nconst BASE_HEADER_LENGTH = 8;\nconst POINTS_PROPERTIES_NUMBER = 3;\n\n/**\n * Basic text editor in order to create a Signature annotation.\n */\nclass SignatureExtractor {\n  static #PARAMETERS = {\n    maxDim: 512,\n    sigmaSFactor: 0.02,\n    sigmaR: 25,\n    kernelSize: 16,\n  };\n\n  static #neighborIndexToId(i0, j0, i, j) {\n    /*\n      The idea is to map the neighbors of a pixel into a unique id.\n        3 2 1\n        4 X 0\n        5 6 7\n    */\n\n    i -= i0;\n    j -= j0;\n\n    if (i === 0) {\n      return j > 0 ? 0 : 4;\n    }\n\n    if (i === 1) {\n      return j + 6;\n    }\n\n    return 2 - j;\n  }\n\n  static #neighborIdToIndex = new Int32Array([\n    0, 1, -1, 1, -1, 0, -1, -1, 0, -1, 1, -1, 1, 0, 1, 1,\n  ]);\n\n  static #clockwiseNonZero(buf, width, i0, j0, i, j, offset) {\n    const id = this.#neighborIndexToId(i0, j0, i, j);\n    for (let k = 0; k < 8; k++) {\n      const kk = (-k + id - offset + 16) % 8;\n      const shiftI = this.#neighborIdToIndex[2 * kk];\n      const shiftJ = this.#neighborIdToIndex[2 * kk + 1];\n      if (buf[(i0 + shiftI) * width + (j0 + shiftJ)] !== 0) {\n        return kk;\n      }\n    }\n    return -1;\n  }\n\n  static #counterClockwiseNonZero(buf, width, i0, j0, i, j, offset) {\n    const id = this.#neighborIndexToId(i0, j0, i, j);\n    for (let k = 0; k < 8; k++) {\n      const kk = (k + id + offset + 16) % 8;\n      const shiftI = this.#neighborIdToIndex[2 * kk];\n      const shiftJ = this.#neighborIdToIndex[2 * kk + 1];\n      if (buf[(i0 + shiftI) * width + (j0 + shiftJ)] !== 0) {\n        return kk;\n      }\n    }\n    return -1;\n  }\n\n  static #findContours(buf, width, height, threshold) {\n    // Based on the Suzuki's algorithm:\n    //  https://web.archive.org/web/20231213161741/https://www.nevis.columbia.edu/~vgenty/public/suzuki_et_al.pdf\n\n    const N = buf.length;\n    const types = new Int32Array(N);\n    for (let i = 0; i < N; i++) {\n      types[i] = buf[i] <= threshold ? 1 : 0;\n    }\n\n    for (let i = 1; i < height - 1; i++) {\n      types[i * width] = types[i * width + width - 1] = 0;\n    }\n    for (let i = 0; i < width; i++) {\n      types[i] = types[width * height - 1 - i] = 0;\n    }\n\n    let nbd = 1;\n    let lnbd;\n    const contours = [];\n\n    for (let i = 1; i < height - 1; i++) {\n      lnbd = 1;\n      for (let j = 1; j < width - 1; j++) {\n        const ij = i * width + j;\n        const pix = types[ij];\n        if (pix === 0) {\n          continue;\n        }\n\n        let i2 = i;\n        let j2 = j;\n\n        if (pix === 1 && types[ij - 1] === 0) {\n          // Outer border.\n          nbd += 1;\n          j2 -= 1;\n        } else if (pix >= 1 && types[ij + 1] === 0) {\n          // Hole border.\n          nbd += 1;\n          j2 += 1;\n          if (pix > 1) {\n            lnbd = pix;\n          }\n        } else {\n          if (pix !== 1) {\n            lnbd = Math.abs(pix);\n          }\n          continue;\n        }\n\n        const points = [j, i];\n        const isHole = j2 === j + 1;\n        const contour = {\n          isHole,\n          points,\n          id: nbd,\n          parent: 0,\n        };\n        contours.push(contour);\n\n        let contour0;\n        for (const c of contours) {\n          if (c.id === lnbd) {\n            contour0 = c;\n            break;\n          }\n        }\n\n        if (!contour0) {\n          contour.parent = isHole ? lnbd : 0;\n        } else if (contour0.isHole) {\n          contour.parent = isHole ? contour0.parent : lnbd;\n        } else {\n          contour.parent = isHole ? lnbd : contour0.parent;\n        }\n\n        const k = this.#clockwiseNonZero(types, width, i, j, i2, j2, 0);\n        if (k === -1) {\n          types[ij] = -nbd;\n          if (types[ij] !== 1) {\n            lnbd = Math.abs(types[ij]);\n          }\n          continue;\n        }\n\n        let shiftI = this.#neighborIdToIndex[2 * k];\n        let shiftJ = this.#neighborIdToIndex[2 * k + 1];\n        const i1 = i + shiftI;\n        const j1 = j + shiftJ;\n        i2 = i1;\n        j2 = j1;\n        let i3 = i;\n        let j3 = j;\n\n        while (true) {\n          const kk = this.#counterClockwiseNonZero(\n            types,\n            width,\n            i3,\n            j3,\n            i2,\n            j2,\n            1\n          );\n          shiftI = this.#neighborIdToIndex[2 * kk];\n          shiftJ = this.#neighborIdToIndex[2 * kk + 1];\n          const i4 = i3 + shiftI;\n          const j4 = j3 + shiftJ;\n          points.push(j4, i4);\n          const ij3 = i3 * width + j3;\n          if (types[ij3 + 1] === 0) {\n            types[ij3] = -nbd;\n          } else if (types[ij3] === 1) {\n            types[ij3] = nbd;\n          }\n\n          if (i4 === i && j4 === j && i3 === i1 && j3 === j1) {\n            if (types[ij] !== 1) {\n              lnbd = Math.abs(types[ij]);\n            }\n            break;\n          } else {\n            i2 = i3;\n            j2 = j3;\n            i3 = i4;\n            j3 = j4;\n          }\n        }\n      }\n    }\n    return contours;\n  }\n\n  static #douglasPeuckerHelper(points, start, end, output) {\n    // Based on the Douglas-Peucker algorithm:\n    //  https://en.wikipedia.org/wiki/Ramer%E2%80%93Douglas%E2%80%93Peucker_algorithm\n    if (end - start <= 4) {\n      for (let i = start; i < end - 2; i += 2) {\n        output.push(points[i], points[i + 1]);\n      }\n      return;\n    }\n\n    const ax = points[start];\n    const ay = points[start + 1];\n    const abx = points[end - 4] - ax;\n    const aby = points[end - 3] - ay;\n    const dist = Math.hypot(abx, aby);\n    const nabx = abx / dist;\n    const naby = aby / dist;\n    const aa = nabx * ay - naby * ax;\n\n    // Guessing the epsilon value.\n    // See \"A novel framework for making dominant point detection methods\n    // non-parametric\".\n    const m = aby / abx;\n    const invS = 1 / dist;\n    const phi = Math.atan(m);\n    const cosPhi = Math.cos(phi);\n    const sinPhi = Math.sin(phi);\n    const tmax = invS * (Math.abs(cosPhi) + Math.abs(sinPhi));\n    const poly = invS * (1 - tmax + tmax ** 2);\n    const partialPhi = Math.max(\n      Math.atan(Math.abs(sinPhi + cosPhi) * poly),\n      Math.atan(Math.abs(sinPhi - cosPhi) * poly)\n    );\n\n    let dmax = 0;\n    let index = start;\n    for (let i = start + 2; i < end - 2; i += 2) {\n      const d = Math.abs(aa - nabx * points[i + 1] + naby * points[i]);\n      if (d > dmax) {\n        index = i;\n        dmax = d;\n      }\n    }\n\n    if (dmax > (dist * partialPhi) ** 2) {\n      this.#douglasPeuckerHelper(points, start, index + 2, output);\n      this.#douglasPeuckerHelper(points, index, end, output);\n    } else {\n      output.push(ax, ay);\n    }\n  }\n\n  static #douglasPeucker(points) {\n    const output = [];\n    const len = points.length;\n    this.#douglasPeuckerHelper(points, 0, len, output);\n    output.push(points[len - 2], points[len - 1]);\n    return output.length <= 4 ? null : output;\n  }\n\n  static #bilateralFilter(buf, width, height, sigmaS, sigmaR, kernelSize) {\n    // The bilateral filter is a nonlinear filter that does spatial averaging.\n    // Its main interest is to preserve edges while removing noise.\n    // See https://en.wikipedia.org/wiki/Bilateral_filter for more details.\n    // sigmaS is the standard deviation of the spatial gaussian.\n    // sigmaR is the standard deviation of the range (in term of pixel\n    // intensity) gaussian.\n\n    // Create a gaussian kernel\n    const kernel = new Float32Array(kernelSize ** 2);\n    const sigmaS2 = -2 * sigmaS ** 2;\n    const halfSize = kernelSize >> 1;\n\n    for (let i = 0; i < kernelSize; i++) {\n      const x = (i - halfSize) ** 2;\n      for (let j = 0; j < kernelSize; j++) {\n        kernel[i * kernelSize + j] = Math.exp(\n          (x + (j - halfSize) ** 2) / sigmaS2\n        );\n      }\n    }\n\n    // Create the range values to be used with the distance between pixels.\n    // It's a way faster with a lookup table than computing the exponential.\n    const rangeValues = new Float32Array(256);\n    const sigmaR2 = -2 * sigmaR ** 2;\n    for (let i = 0; i < 256; i++) {\n      rangeValues[i] = Math.exp(i ** 2 / sigmaR2);\n    }\n\n    const N = buf.length;\n    const out = new Uint8Array(N);\n\n    // We compute the histogram here instead of doing it later: it's slightly\n    // faster.\n    const histogram = new Uint32Array(256);\n    for (let i = 0; i < height; i++) {\n      for (let j = 0; j < width; j++) {\n        const ij = i * width + j;\n        const center = buf[ij];\n        let sum = 0;\n        let norm = 0;\n\n        for (let k = 0; k < kernelSize; k++) {\n          const y = i + k - halfSize;\n          if (y < 0 || y >= height) {\n            continue;\n          }\n          for (let l = 0; l < kernelSize; l++) {\n            const x = j + l - halfSize;\n            if (x < 0 || x >= width) {\n              continue;\n            }\n            const neighbour = buf[y * width + x];\n            const w =\n              kernel[k * kernelSize + l] *\n              rangeValues[Math.abs(neighbour - center)];\n            sum += neighbour * w;\n            norm += w;\n          }\n        }\n\n        const pix = (out[ij] = Math.round(sum / norm));\n        histogram[pix]++;\n      }\n    }\n\n    return [out, histogram];\n  }\n\n  static #getHistogram(buf) {\n    const histogram = new Uint32Array(256);\n    for (const g of buf) {\n      histogram[g]++;\n    }\n    return histogram;\n  }\n\n  static #toUint8(buf) {\n    // We have a RGBA buffer, containing a grayscale image.\n    // We want to convert it into a basic G buffer.\n    // Also, we want to normalize the values between 0 and 255 in order to\n    // increase the contrast.\n    const N = buf.length;\n    const out = new Uint8ClampedArray(N >> 2);\n    let max = -Infinity;\n    let min = Infinity;\n    for (let i = 0, ii = out.length; i < ii; i++) {\n      const A = buf[(i << 2) + 3];\n      if (A === 0) {\n        max = out[i] = 0xff;\n        continue;\n      }\n      const pix = (out[i] = buf[i << 2]);\n      if (pix > max) {\n        max = pix;\n      }\n      if (pix < min) {\n        min = pix;\n      }\n    }\n    const ratio = 255 / (max - min);\n    for (let i = 0; i < N; i++) {\n      out[i] = (out[i] - min) * ratio;\n    }\n\n    return out;\n  }\n\n  static #guessThreshold(histogram) {\n    // We want to find the threshold that will separate the background from the\n    // foreground.\n    // We could have used Otsu's method, but unfortunately it doesn't work well\n    // when the background has too much shade of greys.\n    // So the idea is to find a maximum in the black part of the histogram and\n    // figure out the value which will be the first one of the white part.\n\n    let i;\n    let M = -Infinity;\n    let L = -Infinity;\n    const min = histogram.findIndex(v => v !== 0);\n    let pos = min;\n    let spos = min;\n    for (i = min; i < 256; i++) {\n      const v = histogram[i];\n      if (v > M) {\n        if (i - pos > L) {\n          L = i - pos;\n          spos = i - 1;\n        }\n        M = v;\n        pos = i;\n      }\n    }\n    for (i = spos - 1; i >= 0; i--) {\n      if (histogram[i] > histogram[i + 1]) {\n        break;\n      }\n    }\n\n    return i;\n  }\n\n  static #getGrayPixels(bitmap) {\n    const originalBitmap = bitmap;\n    const { width, height } = bitmap;\n    const { maxDim } = this.#PARAMETERS;\n    let newWidth = width;\n    let newHeight = height;\n\n    if (width > maxDim || height > maxDim) {\n      let prevWidth = width;\n      let prevHeight = height;\n\n      let steps = Math.log2(Math.max(width, height) / maxDim);\n      const isteps = Math.floor(steps);\n      steps = steps === isteps ? isteps - 1 : isteps;\n      for (let i = 0; i < steps; i++) {\n        newWidth = Math.ceil(prevWidth / 2);\n        newHeight = Math.ceil(prevHeight / 2);\n\n        const offscreen = new OffscreenCanvas(newWidth, newHeight);\n        const ctx = offscreen.getContext(\"2d\");\n        ctx.drawImage(\n          bitmap,\n          0,\n          0,\n          prevWidth,\n          prevHeight,\n          0,\n          0,\n          newWidth,\n          newHeight\n        );\n        prevWidth = newWidth;\n        prevHeight = newHeight;\n\n        // Release the resources associated with the bitmap.\n        if (bitmap !== originalBitmap) {\n          bitmap.close();\n        }\n        bitmap = offscreen.transferToImageBitmap();\n      }\n\n      const ratio = Math.min(maxDim / newWidth, maxDim / newHeight);\n      newWidth = Math.round(newWidth * ratio);\n      newHeight = Math.round(newHeight * ratio);\n    }\n    const offscreen = new OffscreenCanvas(newWidth, newHeight);\n    const ctx = offscreen.getContext(\"2d\", { willReadFrequently: true });\n    ctx.filter = \"grayscale(1)\";\n    ctx.drawImage(\n      bitmap,\n      0,\n      0,\n      bitmap.width,\n      bitmap.height,\n      0,\n      0,\n      newWidth,\n      newHeight\n    );\n    const grayImage = ctx.getImageData(0, 0, newWidth, newHeight).data;\n    const uint8Buf = this.#toUint8(grayImage);\n\n    return [uint8Buf, newWidth, newHeight];\n  }\n\n  static extractContoursFromText(\n    text,\n    { fontFamily, fontStyle, fontWeight },\n    pageWidth,\n    pageHeight,\n    rotation,\n    innerMargin\n  ) {\n    let canvas = new OffscreenCanvas(1, 1);\n    let ctx = canvas.getContext(\"2d\", { alpha: false });\n    const fontSize = 200;\n    const font =\n      (ctx.font = `${fontStyle} ${fontWeight} ${fontSize}px ${fontFamily}`);\n    const {\n      actualBoundingBoxLeft,\n      actualBoundingBoxRight,\n      actualBoundingBoxAscent,\n      actualBoundingBoxDescent,\n      fontBoundingBoxAscent,\n      fontBoundingBoxDescent,\n      width,\n    } = ctx.measureText(text);\n\n    // We rescale the canvas to make \"sure\" the text fits.\n    const SCALE = 1.5;\n    const canvasWidth = Math.ceil(\n      Math.max(\n        Math.abs(actualBoundingBoxLeft) + Math.abs(actualBoundingBoxRight) || 0,\n        width\n      ) * SCALE\n    );\n    const canvasHeight = Math.ceil(\n      Math.max(\n        Math.abs(actualBoundingBoxAscent) +\n          Math.abs(actualBoundingBoxDescent) || fontSize,\n        Math.abs(fontBoundingBoxAscent) + Math.abs(fontBoundingBoxDescent) ||\n          fontSize\n      ) * SCALE\n    );\n    canvas = new OffscreenCanvas(canvasWidth, canvasHeight);\n    ctx = canvas.getContext(\"2d\", { alpha: true, willReadFrequently: true });\n    ctx.font = font;\n    ctx.filter = \"grayscale(1)\";\n    ctx.fillStyle = \"white\";\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n    ctx.fillStyle = \"black\";\n    ctx.fillText(\n      text,\n      (canvasWidth * (SCALE - 1)) / 2,\n      (canvasHeight * (3 - SCALE)) / 2\n    );\n\n    const uint8Buf = this.#toUint8(\n      ctx.getImageData(0, 0, canvasWidth, canvasHeight).data\n    );\n    const histogram = this.#getHistogram(uint8Buf);\n    const threshold = this.#guessThreshold(histogram);\n\n    const contourList = this.#findContours(\n      uint8Buf,\n      canvasWidth,\n      canvasHeight,\n      threshold\n    );\n\n    return this.processDrawnLines({\n      lines: { curves: contourList, width: canvasWidth, height: canvasHeight },\n      pageWidth,\n      pageHeight,\n      rotation,\n      innerMargin,\n      mustSmooth: true,\n      areContours: true,\n    });\n  }\n\n  static process(bitmap, pageWidth, pageHeight, rotation, innerMargin) {\n    const [uint8Buf, width, height] = this.#getGrayPixels(bitmap);\n    const [buffer, histogram] = this.#bilateralFilter(\n      uint8Buf,\n      width,\n      height,\n      Math.hypot(width, height) * this.#PARAMETERS.sigmaSFactor,\n      this.#PARAMETERS.sigmaR,\n      this.#PARAMETERS.kernelSize\n    );\n\n    const threshold = this.#guessThreshold(histogram);\n    const contourList = this.#findContours(buffer, width, height, threshold);\n\n    return this.processDrawnLines({\n      lines: { curves: contourList, width, height },\n      pageWidth,\n      pageHeight,\n      rotation,\n      innerMargin,\n      mustSmooth: true,\n      areContours: true,\n    });\n  }\n\n  static processDrawnLines({\n    lines,\n    pageWidth,\n    pageHeight,\n    rotation,\n    innerMargin,\n    mustSmooth,\n    areContours,\n  }) {\n    if (rotation % 180 !== 0) {\n      [pageWidth, pageHeight] = [pageHeight, pageWidth];\n    }\n\n    const { curves, width, height } = lines;\n    const thickness = lines.thickness ?? 0;\n    const linesAndPoints = [];\n    const ratio = Math.min(pageWidth / width, pageHeight / height);\n    const xScale = ratio / pageWidth;\n    const yScale = ratio / pageHeight;\n    const newCurves = [];\n\n    for (const { points } of curves) {\n      const reducedPoints = mustSmooth ? this.#douglasPeucker(points) : points;\n      if (!reducedPoints) {\n        continue;\n      }\n      newCurves.push(reducedPoints);\n\n      const len = reducedPoints.length;\n      const newPoints = new Float32Array(len);\n      const line = new Float32Array(3 * (len === 2 ? 2 : len - 2));\n      linesAndPoints.push({ line, points: newPoints });\n\n      if (len === 2) {\n        newPoints[0] = reducedPoints[0] * xScale;\n        newPoints[1] = reducedPoints[1] * yScale;\n        line.set([NaN, NaN, NaN, NaN, newPoints[0], newPoints[1]], 0);\n        continue;\n      }\n\n      let [x1, y1, x2, y2] = reducedPoints;\n      x1 *= xScale;\n      y1 *= yScale;\n      x2 *= xScale;\n      y2 *= yScale;\n      newPoints.set([x1, y1, x2, y2], 0);\n\n      line.set([NaN, NaN, NaN, NaN, x1, y1], 0);\n      for (let i = 4; i < len; i += 2) {\n        const x = (newPoints[i] = reducedPoints[i] * xScale);\n        const y = (newPoints[i + 1] = reducedPoints[i + 1] * yScale);\n        line.set(Outline.createBezierPoints(x1, y1, x2, y2, x, y), (i - 2) * 3);\n        [x1, y1, x2, y2] = [x2, y2, x, y];\n      }\n    }\n\n    if (linesAndPoints.length === 0) {\n      return null;\n    }\n\n    const outline = areContours\n      ? new ContourDrawOutline()\n      : new InkDrawOutline();\n\n    outline.build(\n      linesAndPoints,\n      pageWidth,\n      pageHeight,\n      1,\n      rotation,\n      areContours ? 0 : thickness,\n      innerMargin\n    );\n\n    return { outline, newCurves, areContours, thickness, width, height };\n  }\n\n  static async compressSignature({\n    outlines,\n    areContours,\n    thickness,\n    width,\n    height,\n  }) {\n    // We create a single array containing all the outlines.\n    // The format is the following:\n    // - 4 bytes: data length.\n    // - 4 bytes: version.\n    // - 4 bytes: width.\n    // - 4 bytes: height.\n    // - 4 bytes: 0 if it's a contour, 1 if it's an ink.\n    // - 4 bytes: thickness.\n    // - 4 bytes: number of drawings.\n    // - 4 bytes: size of the buffer containing the diff of the coordinates.\n    // - 4 bytes: number of points in the first drawing.\n    // - 4 bytes: x coordinate of the first point.\n    // - 4 bytes: y coordinate of the first point.\n    // - 4 bytes: number of points in the second drawing.\n    // - 4 bytes: x coordinate of the first point.\n    // - 4 bytes: y coordinate of the first point.\n    // - ...\n    // - The buffer containing the diff of the coordinates.\n\n    // The coordinates are supposed to be positive integers.\n\n    // We also compute the min and max difference between two points.\n    // This will help us to determine the type of the buffer (Int8, Int16 or\n    // Int32) in order to minimize the amount of data we have.\n    let minDiff = Infinity;\n    let maxDiff = -Infinity;\n    let outlinesLength = 0;\n    for (const points of outlines) {\n      outlinesLength += points.length;\n      for (let i = 2, ii = points.length; i < ii; i++) {\n        const dx = points[i] - points[i - 2];\n        minDiff = Math.min(minDiff, dx);\n        maxDiff = Math.max(maxDiff, dx);\n      }\n    }\n\n    let bufferType;\n    if (minDiff >= -128 && maxDiff <= 127) {\n      bufferType = Int8Array;\n    } else if (minDiff >= -32768 && maxDiff <= 32767) {\n      bufferType = Int16Array;\n    } else {\n      bufferType = Int32Array;\n    }\n\n    const len = outlines.length;\n    const headerLength = BASE_HEADER_LENGTH + POINTS_PROPERTIES_NUMBER * len;\n    const header = new Uint32Array(headerLength);\n\n    let offset = 0;\n    header[offset++] =\n      headerLength * Uint32Array.BYTES_PER_ELEMENT +\n      (outlinesLength - 2 * len) * bufferType.BYTES_PER_ELEMENT;\n    header[offset++] = 0; // Version.\n    header[offset++] = width;\n    header[offset++] = height;\n    header[offset++] = areContours ? 0 : 1;\n    header[offset++] = Math.max(0, Math.floor(thickness ?? 0));\n    header[offset++] = len;\n    header[offset++] = bufferType.BYTES_PER_ELEMENT;\n    for (const points of outlines) {\n      header[offset++] = points.length - 2;\n      header[offset++] = points[0];\n      header[offset++] = points[1];\n    }\n\n    const cs = new CompressionStream(\"deflate-raw\");\n    const writer = cs.writable.getWriter();\n    await writer.ready;\n\n    writer.write(header);\n    const BufferCtor = bufferType.prototype.constructor;\n    for (const points of outlines) {\n      const diffs = new BufferCtor(points.length - 2);\n      for (let i = 2, ii = points.length; i < ii; i++) {\n        diffs[i - 2] = points[i] - points[i - 2];\n      }\n      writer.write(diffs);\n    }\n\n    writer.close();\n\n    const buf = await new Response(cs.readable).arrayBuffer();\n    const bytes = new Uint8Array(buf);\n\n    return toBase64Util(bytes);\n  }\n\n  static async decompressSignature(signatureData) {\n    try {\n      const bytes = fromBase64Util(signatureData);\n      const { readable, writable } = new DecompressionStream(\"deflate-raw\");\n      const writer = writable.getWriter();\n      await writer.ready;\n\n      // We can't await writer.write() because it'll block until the reader\n      // starts which happens few lines below.\n      writer\n        .write(bytes)\n        .then(async () => {\n          await writer.ready;\n          await writer.close();\n        })\n        .catch(() => {});\n\n      let data = null;\n      let offset = 0;\n      for await (const chunk of readable) {\n        data ||= new Uint8Array(new Uint32Array(chunk.buffer, 0, 4)[0]);\n        data.set(chunk, offset);\n        offset += chunk.length;\n      }\n\n      // We take a bit too much data for the header but it's fine.\n      const header = new Uint32Array(data.buffer, 0, data.length >> 2);\n      const version = header[1];\n      if (version !== 0) {\n        throw new Error(`Invalid version: ${version}`);\n      }\n      const width = header[2];\n      const height = header[3];\n      const areContours = header[4] === 0;\n      const thickness = header[5];\n      const numberOfDrawings = header[6];\n      const bufferType = header[7];\n      const outlines = [];\n      const diffsOffset =\n        (BASE_HEADER_LENGTH + POINTS_PROPERTIES_NUMBER * numberOfDrawings) *\n        Uint32Array.BYTES_PER_ELEMENT;\n      let diffs;\n\n      switch (bufferType) {\n        case Int8Array.BYTES_PER_ELEMENT:\n          diffs = new Int8Array(data.buffer, diffsOffset);\n          break;\n        case Int16Array.BYTES_PER_ELEMENT:\n          diffs = new Int16Array(data.buffer, diffsOffset);\n          break;\n        case Int32Array.BYTES_PER_ELEMENT:\n          diffs = new Int32Array(data.buffer, diffsOffset);\n          break;\n      }\n\n      offset = 0;\n      for (let i = 0; i < numberOfDrawings; i++) {\n        const len = header[POINTS_PROPERTIES_NUMBER * i + BASE_HEADER_LENGTH];\n        const points = new Float32Array(len + 2);\n        outlines.push(points);\n\n        for (let j = 0; j < POINTS_PROPERTIES_NUMBER - 1; j++) {\n          points[j] =\n            header[POINTS_PROPERTIES_NUMBER * i + BASE_HEADER_LENGTH + j + 1];\n        }\n        for (let j = 0; j < len; j++) {\n          points[j + 2] = points[j] + diffs[offset++];\n        }\n      }\n\n      return {\n        areContours,\n        thickness,\n        outlines,\n        width,\n        height,\n      };\n    } catch (e) {\n      warn(`decompressSignature: ${e}`);\n      return null;\n    }\n  }\n}\n\nexport { SignatureExtractor };\n","/* Copyright 2025 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AnnotationEditorType, shadow } from \"../../shared/util.js\";\nimport { DrawingEditor, DrawingOptions } from \"./draw.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { ContourDrawOutline } from \"./drawers/contour.js\";\nimport { InkDrawingOptions } from \"./ink.js\";\nimport { InkDrawOutline } from \"./drawers/inkdraw.js\";\nimport { SignatureExtractor } from \"./drawers/signaturedraw.js\";\n\nclass SignatureOptions extends DrawingOptions {\n  constructor() {\n    super();\n\n    super.updateProperties({\n      fill: AnnotationEditor._defaultLineColor,\n      \"stroke-width\": 0,\n    });\n  }\n\n  clone() {\n    const clone = new SignatureOptions();\n    clone.updateAll(this);\n    return clone;\n  }\n}\n\nclass DrawnSignatureOptions extends InkDrawingOptions {\n  constructor(viewerParameters) {\n    super(viewerParameters);\n\n    super.updateProperties({\n      stroke: AnnotationEditor._defaultLineColor,\n      \"stroke-width\": 1,\n    });\n  }\n\n  clone() {\n    const clone = new DrawnSignatureOptions(this._viewParameters);\n    clone.updateAll(this);\n    return clone;\n  }\n}\n\n/**\n * Basic editor in order to generate an Stamp annotation annotation containing\n * a signature drawing.\n */\nclass SignatureEditor extends DrawingEditor {\n  #isExtracted = false;\n\n  #description = null;\n\n  #signatureData = null;\n\n  #signatureUUID = null;\n\n  static _type = \"signature\";\n\n  static _editorType = AnnotationEditorType.SIGNATURE;\n\n  static _defaultDrawingOptions = null;\n\n  constructor(params) {\n    super({ ...params, mustBeCommitted: true, name: \"signatureEditor\" });\n    this._willKeepAspectRatio = true;\n    this.#signatureData = params.signatureData || null;\n    this.#description = null;\n    this.defaultL10nId = \"pdfjs-editor-signature-editor1\";\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n\n    this._defaultDrawingOptions = new SignatureOptions();\n    this._defaultDrawnSignatureOptions = new DrawnSignatureOptions(\n      uiManager.viewParameters\n    );\n  }\n\n  /** @inheritdoc */\n  static getDefaultDrawingOptions(options) {\n    const clone = this._defaultDrawingOptions.clone();\n    clone.updateProperties(options);\n    return clone;\n  }\n\n  /** @inheritdoc */\n  static get supportMultipleDrawings() {\n    return false;\n  }\n\n  static get typesMap() {\n    return shadow(this, \"typesMap\", new Map());\n  }\n\n  static get isDrawer() {\n    return false;\n  }\n\n  /** @inheritdoc */\n  get telemetryFinalData() {\n    return {\n      type: \"signature\",\n      hasDescription: !!this.#description,\n    };\n  }\n\n  static computeTelemetryFinalData(data) {\n    const hasDescriptionStats = data.get(\"hasDescription\");\n    return {\n      hasAltText: hasDescriptionStats.get(true) ?? 0,\n      hasNoAltText: hasDescriptionStats.get(false) ?? 0,\n    };\n  }\n\n  /** @inheritdoc */\n  get isResizable() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  onScaleChanging() {\n    if (this._drawId === null) {\n      return;\n    }\n    super.onScaleChanging();\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    const { _isCopy } = this;\n    if (_isCopy) {\n      // No need to adjust the position when rendering in DrawingEditor.\n      this._isCopy = false;\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    super.render();\n\n    if (this._drawId === null) {\n      if (this.#signatureData) {\n        const {\n          lines,\n          mustSmooth,\n          areContours,\n          description,\n          uuid,\n          heightInPage,\n        } = this.#signatureData;\n        const {\n          rawDims: { pageWidth, pageHeight },\n          rotation,\n        } = this.parent.viewport;\n        const outline = SignatureExtractor.processDrawnLines({\n          lines,\n          pageWidth,\n          pageHeight,\n          rotation,\n          innerMargin: SignatureEditor._INNER_MARGIN,\n          mustSmooth,\n          areContours,\n        });\n        this.addSignature(outline, heightInPage, description, uuid);\n      } else {\n        // Avoid Firefox crashing (with a local build) because the description\n        // parameter is missing.\n        this.div.setAttribute(\n          \"data-l10n-args\",\n          JSON.stringify({ description: \"\" })\n        );\n        this.div.hidden = true;\n        this._uiManager.getSignature(this);\n      }\n    }\n\n    if (_isCopy) {\n      this._isCopy = true;\n      this._moveAfterPaste(baseX, baseY);\n    }\n\n    return this.div;\n  }\n\n  setUuid(uuid) {\n    this.#signatureUUID = uuid;\n    this.addEditToolbar();\n  }\n\n  getUuid() {\n    return this.#signatureUUID;\n  }\n\n  get description() {\n    return this.#description;\n  }\n\n  set description(description) {\n    this.#description = description;\n    super.addEditToolbar().then(toolbar => {\n      toolbar?.updateEditSignatureButton(description);\n    });\n  }\n\n  getSignaturePreview() {\n    const { newCurves, areContours, thickness, width, height } =\n      this.#signatureData;\n    const maxDim = Math.max(width, height);\n    const outlineData = SignatureExtractor.processDrawnLines({\n      lines: {\n        curves: newCurves.map(points => ({ points })),\n        thickness,\n        width,\n        height,\n      },\n      pageWidth: maxDim,\n      pageHeight: maxDim,\n      rotation: 0,\n      innerMargin: 0,\n      mustSmooth: false,\n      areContours,\n    });\n    return { areContours, outline: outlineData.outline };\n  }\n\n  /** @inheritdoc */\n  get toolbarButtons() {\n    if (this._uiManager.signatureManager) {\n      return [[\"editSignature\", this._uiManager.signatureManager]];\n    }\n    return super.toolbarButtons;\n  }\n\n  addSignature(data, heightInPage, description, uuid) {\n    const { x: savedX, y: savedY } = this;\n    const { outline } = (this.#signatureData = data);\n    this.#isExtracted = outline instanceof ContourDrawOutline;\n    this.description = description;\n    this.div.setAttribute(\"data-l10n-args\", JSON.stringify({ description }));\n    let drawingOptions;\n    if (this.#isExtracted) {\n      drawingOptions = SignatureEditor.getDefaultDrawingOptions();\n    } else {\n      drawingOptions = SignatureEditor._defaultDrawnSignatureOptions.clone();\n      drawingOptions.updateProperties({ \"stroke-width\": outline.thickness });\n    }\n    this._addOutlines({\n      drawOutlines: outline,\n      drawingOptions,\n    });\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const [, pageHeight] = this.pageDimensions;\n    let newHeight = heightInPage / pageHeight;\n    // Ensure the signature doesn't exceed the page height.\n    // If the signature is too big, we scale it down to 50% of the page height.\n    newHeight = newHeight >= 1 ? 0.5 : newHeight;\n\n    this.width *= newHeight / this.height;\n    if (this.width >= 1) {\n      newHeight *= 0.9 / this.width;\n      this.width = 0.9;\n    }\n\n    this.height = newHeight;\n    this.setDims(parentWidth * this.width, parentHeight * this.height);\n    this.x = savedX;\n    this.y = savedY;\n    this.center();\n\n    this._onResized();\n    this.onScaleChanging();\n    this.rotate();\n    this._uiManager.addToAnnotationStorage(this);\n    this.setUuid(uuid);\n\n    this._reportTelemetry({\n      action: \"pdfjs.signature.inserted\",\n      data: {\n        hasBeenSaved: !!uuid,\n        hasDescription: !!description,\n      },\n    });\n\n    this.div.hidden = false;\n  }\n\n  getFromImage(bitmap) {\n    const {\n      rawDims: { pageWidth, pageHeight },\n      rotation,\n    } = this.parent.viewport;\n    return SignatureExtractor.process(\n      bitmap,\n      pageWidth,\n      pageHeight,\n      rotation,\n      SignatureEditor._INNER_MARGIN\n    );\n  }\n\n  getFromText(text, fontInfo) {\n    const {\n      rawDims: { pageWidth, pageHeight },\n      rotation,\n    } = this.parent.viewport;\n    return SignatureExtractor.extractContoursFromText(\n      text,\n      fontInfo,\n      pageWidth,\n      pageHeight,\n      rotation,\n      SignatureEditor._INNER_MARGIN\n    );\n  }\n\n  getDrawnSignature(curves) {\n    const {\n      rawDims: { pageWidth, pageHeight },\n      rotation,\n    } = this.parent.viewport;\n    return SignatureExtractor.processDrawnLines({\n      lines: curves,\n      pageWidth,\n      pageHeight,\n      rotation,\n      innerMargin: SignatureEditor._INNER_MARGIN,\n      mustSmooth: false,\n      areContours: false,\n    });\n  }\n\n  /** @inheritdoc */\n  createDrawingOptions({ areContours, thickness }) {\n    if (areContours) {\n      this._drawingOptions = SignatureEditor.getDefaultDrawingOptions();\n    } else {\n      this._drawingOptions =\n        SignatureEditor._defaultDrawnSignatureOptions.clone();\n      this._drawingOptions.updateProperties({ \"stroke-width\": thickness });\n    }\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false) {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    const { lines, points, rect } = this.serializeDraw(isForCopying);\n    const {\n      _drawingOptions: { \"stroke-width\": thickness },\n    } = this;\n    const serialized = {\n      annotationType: AnnotationEditorType.SIGNATURE,\n      isSignature: true,\n      areContours: this.#isExtracted,\n      color: [0, 0, 0],\n      thickness: this.#isExtracted ? 0 : thickness,\n      pageIndex: this.pageIndex,\n      rect,\n      rotation: this.rotation,\n      structTreeParentId: this._structTreeParentId,\n    };\n    if (isForCopying) {\n      serialized.paths = { lines, points };\n      serialized.uuid = this.#signatureUUID;\n      serialized.isCopy = true;\n    } else {\n      serialized.lines = lines;\n    }\n    if (this.#description) {\n      serialized.accessibilityData = { type: \"Figure\", alt: this.#description };\n    }\n    return serialized;\n  }\n\n  /** @inheritdoc */\n  static deserializeDraw(\n    pageX,\n    pageY,\n    pageWidth,\n    pageHeight,\n    innerMargin,\n    data\n  ) {\n    if (data.areContours) {\n      return ContourDrawOutline.deserialize(\n        pageX,\n        pageY,\n        pageWidth,\n        pageHeight,\n        innerMargin,\n        data\n      );\n    }\n\n    return InkDrawOutline.deserialize(\n      pageX,\n      pageY,\n      pageWidth,\n      pageHeight,\n      innerMargin,\n      data\n    );\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    const editor = await super.deserialize(data, parent, uiManager);\n    editor.#isExtracted = data.areContours;\n    editor.#description = data.accessibilityData?.alt || \"\";\n    editor.#signatureUUID = data.uuid;\n    return editor;\n  }\n}\n\nexport { SignatureEditor };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AnnotationEditorType, AnnotationPrefix } from \"../../shared/util.js\";\nimport {\n  OutputScale,\n  PixelsPerInch,\n  SupportedImageMimeTypes,\n} from \"../display_utils.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { StampAnnotationElement } from \"../annotation_layer.js\";\n\n/**\n * Basic text editor in order to create a FreeTex annotation.\n */\nclass StampEditor extends AnnotationEditor {\n  #bitmap = null;\n\n  #bitmapId = null;\n\n  #bitmapPromise = null;\n\n  #bitmapUrl = null;\n\n  #bitmapFile = null;\n\n  #bitmapFileName = \"\";\n\n  #canvas = null;\n\n  #missingCanvas = false;\n\n  #resizeTimeoutId = null;\n\n  #isSvg = false;\n\n  #hasBeenAddedInUndoStack = false;\n\n  static _type = \"stamp\";\n\n  static _editorType = AnnotationEditorType.STAMP;\n\n  constructor(params) {\n    super({ ...params, name: \"stampEditor\" });\n    this.#bitmapUrl = params.bitmapUrl;\n    this.#bitmapFile = params.bitmapFile;\n    this.defaultL10nId = \"pdfjs-editor-stamp-editor\";\n  }\n\n  /** @inheritdoc */\n  static initialize(l10n, uiManager) {\n    AnnotationEditor.initialize(l10n, uiManager);\n  }\n\n  /** @inheritdoc */\n  static isHandlingMimeForPasting(mime) {\n    return SupportedImageMimeTypes.includes(mime);\n  }\n\n  /** @inheritdoc */\n  static paste(item, parent) {\n    parent.pasteEditor(\n      { mode: AnnotationEditorType.STAMP },\n      { bitmapFile: item.getAsFile() }\n    );\n  }\n\n  /** @inheritdoc */\n  altTextFinish() {\n    if (this._uiManager.useNewAltTextFlow) {\n      this.div.hidden = false;\n    }\n    super.altTextFinish();\n  }\n\n  /** @inheritdoc */\n  get telemetryFinalData() {\n    return {\n      type: \"stamp\",\n      hasAltText: !!this.altTextData?.altText,\n    };\n  }\n\n  static computeTelemetryFinalData(data) {\n    const hasAltTextStats = data.get(\"hasAltText\");\n    return {\n      hasAltText: hasAltTextStats.get(true) ?? 0,\n      hasNoAltText: hasAltTextStats.get(false) ?? 0,\n    };\n  }\n\n  #getBitmapFetched(data, fromId = false) {\n    if (!data) {\n      this.remove();\n      return;\n    }\n    this.#bitmap = data.bitmap;\n    if (!fromId) {\n      this.#bitmapId = data.id;\n      this.#isSvg = data.isSvg;\n    }\n    if (data.file) {\n      this.#bitmapFileName = data.file.name;\n    }\n    this.#createCanvas();\n  }\n\n  #getBitmapDone() {\n    this.#bitmapPromise = null;\n    this._uiManager.enableWaiting(false);\n    if (!this.#canvas) {\n      return;\n    }\n    if (\n      this._uiManager.useNewAltTextWhenAddingImage &&\n      this._uiManager.useNewAltTextFlow &&\n      this.#bitmap\n    ) {\n      this.addEditToolbar().then(() => {\n        this._editToolbar.hide();\n        this._uiManager.editAltText(this, /* firstTime = */ true);\n      });\n      return;\n    }\n\n    if (\n      !this._uiManager.useNewAltTextWhenAddingImage &&\n      this._uiManager.useNewAltTextFlow &&\n      this.#bitmap\n    ) {\n      this._reportTelemetry({\n        action: \"pdfjs.image.image_added\",\n        data: { alt_text_modal: false, alt_text_type: \"empty\" },\n      });\n      try {\n        // The alt-text dialog isn't opened but we still want to guess the alt\n        // text.\n        this.mlGuessAltText();\n      } catch {}\n    }\n\n    this.div.focus();\n  }\n\n  async mlGuessAltText(imageData = null, updateAltTextData = true) {\n    if (this.hasAltTextData()) {\n      return null;\n    }\n\n    const { mlManager } = this._uiManager;\n    if (!mlManager) {\n      throw new Error(\"No ML.\");\n    }\n    if (!(await mlManager.isEnabledFor(\"altText\"))) {\n      throw new Error(\"ML isn't enabled for alt text.\");\n    }\n    const { data, width, height } =\n      imageData ||\n      this.copyCanvas(null, null, /* createImageData = */ true).imageData;\n    const response = await mlManager.guess({\n      name: \"altText\",\n      request: {\n        data,\n        width,\n        height,\n        channels: data.length / (width * height),\n      },\n    });\n    if (!response) {\n      throw new Error(\"No response from the AI service.\");\n    }\n    if (response.error) {\n      throw new Error(\"Error from the AI service.\");\n    }\n    if (response.cancel) {\n      return null;\n    }\n    if (!response.output) {\n      throw new Error(\"No valid response from the AI service.\");\n    }\n    const altText = response.output;\n    await this.setGuessedAltText(altText);\n    if (updateAltTextData && !this.hasAltTextData()) {\n      this.altTextData = { alt: altText, decorative: false };\n    }\n    return altText;\n  }\n\n  #getBitmap() {\n    if (this.#bitmapId) {\n      this._uiManager.enableWaiting(true);\n      this._uiManager.imageManager\n        .getFromId(this.#bitmapId)\n        .then(data => this.#getBitmapFetched(data, /* fromId = */ true))\n        .finally(() => this.#getBitmapDone());\n      return;\n    }\n\n    if (this.#bitmapUrl) {\n      const url = this.#bitmapUrl;\n      this.#bitmapUrl = null;\n      this._uiManager.enableWaiting(true);\n      this.#bitmapPromise = this._uiManager.imageManager\n        .getFromUrl(url)\n        .then(data => this.#getBitmapFetched(data))\n        .finally(() => this.#getBitmapDone());\n      return;\n    }\n\n    if (this.#bitmapFile) {\n      const file = this.#bitmapFile;\n      this.#bitmapFile = null;\n      this._uiManager.enableWaiting(true);\n      this.#bitmapPromise = this._uiManager.imageManager\n        .getFromFile(file)\n        .then(data => this.#getBitmapFetched(data))\n        .finally(() => this.#getBitmapDone());\n      return;\n    }\n\n    const input = document.createElement(\"input\");\n    if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n      input.hidden = true;\n      input.id = \"stampEditorFileInput\";\n      document.body.append(input);\n    }\n    input.type = \"file\";\n    input.accept = SupportedImageMimeTypes.join(\",\");\n    const signal = this._uiManager._signal;\n    this.#bitmapPromise = new Promise(resolve => {\n      input.addEventListener(\n        \"change\",\n        async () => {\n          if (!input.files || input.files.length === 0) {\n            this.remove();\n          } else {\n            this._uiManager.enableWaiting(true);\n            const data = await this._uiManager.imageManager.getFromFile(\n              input.files[0]\n            );\n            this._reportTelemetry({\n              action: \"pdfjs.image.image_selected\",\n              data: { alt_text_modal: this._uiManager.useNewAltTextFlow },\n            });\n            this.#getBitmapFetched(data);\n          }\n          if (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING\")) {\n            input.remove();\n          }\n          resolve();\n        },\n        { signal }\n      );\n      input.addEventListener(\n        \"cancel\",\n        () => {\n          this.remove();\n          resolve();\n        },\n        { signal }\n      );\n    }).finally(() => this.#getBitmapDone());\n    if (typeof PDFJSDev === \"undefined\" || !PDFJSDev.test(\"TESTING\")) {\n      input.click();\n    }\n  }\n\n  /** @inheritdoc */\n  remove() {\n    if (this.#bitmapId) {\n      this.#bitmap = null;\n      this._uiManager.imageManager.deleteId(this.#bitmapId);\n      this.#canvas?.remove();\n      this.#canvas = null;\n      if (this.#resizeTimeoutId) {\n        clearTimeout(this.#resizeTimeoutId);\n        this.#resizeTimeoutId = null;\n      }\n    }\n    super.remove();\n  }\n\n  /** @inheritdoc */\n  rebuild() {\n    if (!this.parent) {\n      // It's possible to have to rebuild an editor which is not on a visible\n      // page.\n      if (this.#bitmapId) {\n        this.#getBitmap();\n      }\n      return;\n    }\n    super.rebuild();\n    if (this.div === null) {\n      return;\n    }\n\n    if (this.#bitmapId && this.#canvas === null) {\n      this.#getBitmap();\n    }\n\n    if (!this.isAttachedToDOM) {\n      // At some point this editor was removed and we're rebuilting it,\n      // hence we must add it to its parent.\n      this.parent.add(this);\n    }\n  }\n\n  /** @inheritdoc */\n  onceAdded(focus) {\n    this._isDraggable = true;\n    if (focus) {\n      this.div.focus();\n    }\n  }\n\n  /** @inheritdoc */\n  isEmpty() {\n    return !(\n      this.#bitmapPromise ||\n      this.#bitmap ||\n      this.#bitmapUrl ||\n      this.#bitmapFile ||\n      this.#bitmapId ||\n      this.#missingCanvas\n    );\n  }\n\n  /** @inheritdoc */\n  get toolbarButtons() {\n    return [[\"altText\", this.createAltText()]];\n  }\n\n  /** @inheritdoc */\n  get isResizable() {\n    return true;\n  }\n\n  /** @inheritdoc */\n  render() {\n    if (this.div) {\n      return this.div;\n    }\n\n    let baseX, baseY;\n    if (this._isCopy) {\n      baseX = this.x;\n      baseY = this.y;\n    }\n\n    super.render();\n    this.div.hidden = true;\n\n    this.createAltText();\n\n    if (!this.#missingCanvas) {\n      if (this.#bitmap) {\n        this.#createCanvas();\n      } else {\n        this.#getBitmap();\n      }\n    }\n\n    if (this._isCopy) {\n      this._moveAfterPaste(baseX, baseY);\n    }\n\n    this._uiManager.addShouldRescale(this);\n\n    return this.div;\n  }\n\n  setCanvas(annotationElementId, canvas) {\n    const { id: bitmapId, bitmap } = this._uiManager.imageManager.getFromCanvas(\n      annotationElementId,\n      canvas\n    );\n    canvas.remove();\n    if (bitmapId && this._uiManager.imageManager.isValidId(bitmapId)) {\n      this.#bitmapId = bitmapId;\n      if (bitmap) {\n        this.#bitmap = bitmap;\n      }\n      this.#missingCanvas = false;\n      this.#createCanvas();\n    }\n  }\n\n  /** @inheritdoc */\n  _onResized() {\n    // We used a CSS-zoom during the resizing, but now it's resized we can\n    // rescale correctly the bitmap to fit the new dimensions.\n    this.onScaleChanging();\n  }\n\n  onScaleChanging() {\n    if (!this.parent) {\n      return;\n    }\n    if (this.#resizeTimeoutId !== null) {\n      clearTimeout(this.#resizeTimeoutId);\n    }\n    // The user's zooming the page, there is no need to redraw the bitmap at\n    // each step, hence we wait a bit before redrawing it.\n    const TIME_TO_WAIT = 200;\n    this.#resizeTimeoutId = setTimeout(() => {\n      this.#resizeTimeoutId = null;\n      this.#drawBitmap();\n    }, TIME_TO_WAIT);\n  }\n\n  #createCanvas() {\n    const { div } = this;\n    let { width, height } = this.#bitmap;\n    const [pageWidth, pageHeight] = this.pageDimensions;\n    const MAX_RATIO = 0.75;\n    if (this.width) {\n      width = this.width * pageWidth;\n      height = this.height * pageHeight;\n    } else if (\n      width > MAX_RATIO * pageWidth ||\n      height > MAX_RATIO * pageHeight\n    ) {\n      // If the image is too big compared to the page dimensions\n      // (more than MAX_RATIO) then we scale it down.\n      const factor = Math.min(\n        (MAX_RATIO * pageWidth) / width,\n        (MAX_RATIO * pageHeight) / height\n      );\n      width *= factor;\n      height *= factor;\n    }\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    this.setDims(\n      (width * parentWidth) / pageWidth,\n      (height * parentHeight) / pageHeight\n    );\n\n    this._uiManager.enableWaiting(false);\n    const canvas = (this.#canvas = document.createElement(\"canvas\"));\n    canvas.setAttribute(\"role\", \"img\");\n    this.addContainer(canvas);\n\n    this.width = width / pageWidth;\n    this.height = height / pageHeight;\n    if (this._initialOptions?.isCentered) {\n      this.center();\n    } else {\n      this.fixAndSetPosition();\n    }\n    this._initialOptions = null;\n\n    if (\n      !this._uiManager.useNewAltTextWhenAddingImage ||\n      !this._uiManager.useNewAltTextFlow ||\n      this.annotationElementId\n    ) {\n      div.hidden = false;\n    }\n    this.#drawBitmap();\n    if (!this.#hasBeenAddedInUndoStack) {\n      this.parent.addUndoableEditor(this);\n      this.#hasBeenAddedInUndoStack = true;\n    }\n\n    // There are multiple ways to add an image to the page, so here we just\n    // count the number of times an image is added to the page whatever the way\n    // is.\n    this._reportTelemetry({\n      action: \"inserted_image\",\n    });\n    if (this.#bitmapFileName) {\n      this.div.setAttribute(\"aria-description\", this.#bitmapFileName);\n    }\n    if (!this.annotationElementId) {\n      this._uiManager.a11yAlert(\"pdfjs-editor-stamp-added-alert\");\n    }\n  }\n\n  copyCanvas(maxDataDimension, maxPreviewDimension, createImageData = false) {\n    if (!maxDataDimension) {\n      // TODO: get this value from Firefox\n      //   (https://bugzilla.mozilla.org/show_bug.cgi?id=1908184)\n      // It's the maximum dimension that the AI can handle.\n      maxDataDimension = 224;\n    }\n\n    const { width: bitmapWidth, height: bitmapHeight } = this.#bitmap;\n    const outputScale = new OutputScale();\n\n    let bitmap = this.#bitmap;\n    let width = bitmapWidth,\n      height = bitmapHeight;\n    let canvas = null;\n\n    if (maxPreviewDimension) {\n      if (\n        bitmapWidth > maxPreviewDimension ||\n        bitmapHeight > maxPreviewDimension\n      ) {\n        const ratio = Math.min(\n          maxPreviewDimension / bitmapWidth,\n          maxPreviewDimension / bitmapHeight\n        );\n        width = Math.floor(bitmapWidth * ratio);\n        height = Math.floor(bitmapHeight * ratio);\n      }\n\n      canvas = document.createElement(\"canvas\");\n      const scaledWidth = (canvas.width = Math.ceil(width * outputScale.sx));\n      const scaledHeight = (canvas.height = Math.ceil(height * outputScale.sy));\n\n      if (!this.#isSvg) {\n        bitmap = this.#scaleBitmap(scaledWidth, scaledHeight);\n      }\n\n      const ctx = canvas.getContext(\"2d\");\n      ctx.filter = this._uiManager.hcmFilter;\n\n      // Add a checkerboard pattern as a background in case the image has some\n      // transparency.\n      let white = \"white\",\n        black = \"#cfcfd8\";\n      if (this._uiManager.hcmFilter !== \"none\") {\n        black = \"black\";\n      } else if (window.matchMedia?.(\"(prefers-color-scheme: dark)\").matches) {\n        white = \"#8f8f9d\";\n        black = \"#42414d\";\n      }\n      const boxDim = 15;\n      const boxDimWidth = boxDim * outputScale.sx;\n      const boxDimHeight = boxDim * outputScale.sy;\n      const pattern = new OffscreenCanvas(boxDimWidth * 2, boxDimHeight * 2);\n      const patternCtx = pattern.getContext(\"2d\");\n      patternCtx.fillStyle = white;\n      patternCtx.fillRect(0, 0, boxDimWidth * 2, boxDimHeight * 2);\n      patternCtx.fillStyle = black;\n      patternCtx.fillRect(0, 0, boxDimWidth, boxDimHeight);\n      patternCtx.fillRect(boxDimWidth, boxDimHeight, boxDimWidth, boxDimHeight);\n      ctx.fillStyle = ctx.createPattern(pattern, \"repeat\");\n      ctx.fillRect(0, 0, scaledWidth, scaledHeight);\n      ctx.drawImage(\n        bitmap,\n        0,\n        0,\n        bitmap.width,\n        bitmap.height,\n        0,\n        0,\n        scaledWidth,\n        scaledHeight\n      );\n    }\n\n    let imageData = null;\n    if (createImageData) {\n      let dataWidth, dataHeight;\n      if (\n        outputScale.symmetric &&\n        bitmap.width < maxDataDimension &&\n        bitmap.height < maxDataDimension\n      ) {\n        dataWidth = bitmap.width;\n        dataHeight = bitmap.height;\n      } else {\n        bitmap = this.#bitmap;\n        if (bitmapWidth > maxDataDimension || bitmapHeight > maxDataDimension) {\n          const ratio = Math.min(\n            maxDataDimension / bitmapWidth,\n            maxDataDimension / bitmapHeight\n          );\n          dataWidth = Math.floor(bitmapWidth * ratio);\n          dataHeight = Math.floor(bitmapHeight * ratio);\n\n          if (!this.#isSvg) {\n            bitmap = this.#scaleBitmap(dataWidth, dataHeight);\n          }\n        }\n      }\n\n      const offscreen = new OffscreenCanvas(dataWidth, dataHeight);\n      const offscreenCtx = offscreen.getContext(\"2d\", {\n        willReadFrequently: true,\n      });\n      offscreenCtx.drawImage(\n        bitmap,\n        0,\n        0,\n        bitmap.width,\n        bitmap.height,\n        0,\n        0,\n        dataWidth,\n        dataHeight\n      );\n      imageData = {\n        width: dataWidth,\n        height: dataHeight,\n        data: offscreenCtx.getImageData(0, 0, dataWidth, dataHeight).data,\n      };\n    }\n\n    return { canvas, width, height, imageData };\n  }\n\n  #scaleBitmap(width, height) {\n    const { width: bitmapWidth, height: bitmapHeight } = this.#bitmap;\n\n    let newWidth = bitmapWidth;\n    let newHeight = bitmapHeight;\n    let bitmap = this.#bitmap;\n    while (newWidth > 2 * width || newHeight > 2 * height) {\n      const prevWidth = newWidth;\n      const prevHeight = newHeight;\n\n      if (newWidth > 2 * width) {\n        // See bug 1820511 (Windows specific bug).\n        // TODO: once the above bug is fixed we could revert to:\n        // newWidth = Math.ceil(newWidth / 2);\n        newWidth =\n          newWidth >= 16384\n            ? Math.floor(newWidth / 2) - 1\n            : Math.ceil(newWidth / 2);\n      }\n      if (newHeight > 2 * height) {\n        newHeight =\n          newHeight >= 16384\n            ? Math.floor(newHeight / 2) - 1\n            : Math.ceil(newHeight / 2);\n      }\n\n      const offscreen = new OffscreenCanvas(newWidth, newHeight);\n      const ctx = offscreen.getContext(\"2d\");\n      ctx.drawImage(\n        bitmap,\n        0,\n        0,\n        prevWidth,\n        prevHeight,\n        0,\n        0,\n        newWidth,\n        newHeight\n      );\n      bitmap = offscreen.transferToImageBitmap();\n    }\n\n    return bitmap;\n  }\n\n  #drawBitmap() {\n    const [parentWidth, parentHeight] = this.parentDimensions;\n    const { width, height } = this;\n    const outputScale = new OutputScale();\n    const scaledWidth = Math.ceil(width * parentWidth * outputScale.sx);\n    const scaledHeight = Math.ceil(height * parentHeight * outputScale.sy);\n    const canvas = this.#canvas;\n\n    if (\n      !canvas ||\n      (canvas.width === scaledWidth && canvas.height === scaledHeight)\n    ) {\n      return;\n    }\n\n    canvas.width = scaledWidth;\n    canvas.height = scaledHeight;\n\n    const bitmap = this.#isSvg\n      ? this.#bitmap\n      : this.#scaleBitmap(scaledWidth, scaledHeight);\n\n    const ctx = canvas.getContext(\"2d\");\n    ctx.filter = this._uiManager.hcmFilter;\n    ctx.drawImage(\n      bitmap,\n      0,\n      0,\n      bitmap.width,\n      bitmap.height,\n      0,\n      0,\n      scaledWidth,\n      scaledHeight\n    );\n  }\n\n  #serializeBitmap(toUrl) {\n    if (toUrl) {\n      if (this.#isSvg) {\n        const url = this._uiManager.imageManager.getSvgUrl(this.#bitmapId);\n        if (url) {\n          return url;\n        }\n      }\n      // We convert to a data url because it's sync and the url can live in the\n      // clipboard.\n      const canvas = document.createElement(\"canvas\");\n      ({ width: canvas.width, height: canvas.height } = this.#bitmap);\n      const ctx = canvas.getContext(\"2d\");\n      ctx.drawImage(this.#bitmap, 0, 0);\n\n      return canvas.toDataURL();\n    }\n\n    if (this.#isSvg) {\n      const [pageWidth, pageHeight] = this.pageDimensions;\n      // Multiply by PixelsPerInch.PDF_TO_CSS_UNITS in order to increase the\n      // image resolution when rasterizing it.\n      const width = Math.round(\n        this.width * pageWidth * PixelsPerInch.PDF_TO_CSS_UNITS\n      );\n      const height = Math.round(\n        this.height * pageHeight * PixelsPerInch.PDF_TO_CSS_UNITS\n      );\n      const offscreen = new OffscreenCanvas(width, height);\n      const ctx = offscreen.getContext(\"2d\");\n      ctx.drawImage(\n        this.#bitmap,\n        0,\n        0,\n        this.#bitmap.width,\n        this.#bitmap.height,\n        0,\n        0,\n        width,\n        height\n      );\n      return offscreen.transferToImageBitmap();\n    }\n\n    return structuredClone(this.#bitmap);\n  }\n\n  /** @inheritdoc */\n  static async deserialize(data, parent, uiManager) {\n    let initialData = null;\n    let missingCanvas = false;\n    if (data instanceof StampAnnotationElement) {\n      const {\n        data: { rect, rotation, id, structParent, popupRef },\n        container,\n        parent: {\n          page: { pageNumber },\n        },\n        canvas,\n      } = data;\n      let bitmapId, bitmap;\n      if (canvas) {\n        delete data.canvas;\n        ({ id: bitmapId, bitmap } = uiManager.imageManager.getFromCanvas(\n          container.id,\n          canvas\n        ));\n        canvas.remove();\n      } else {\n        missingCanvas = true;\n        data._hasNoCanvas = true;\n      }\n\n      // When switching to edit mode, we wait for the structure tree to be\n      // ready (see pdf_viewer.js), so it's fine to use getAriaAttributesSync.\n      const altText =\n        (\n          await parent._structTree.getAriaAttributes(`${AnnotationPrefix}${id}`)\n        )?.get(\"aria-label\") || \"\";\n\n      initialData = data = {\n        annotationType: AnnotationEditorType.STAMP,\n        bitmapId,\n        bitmap,\n        pageIndex: pageNumber - 1,\n        rect: rect.slice(0),\n        rotation,\n        annotationElementId: id,\n        id,\n        deleted: false,\n        accessibilityData: {\n          decorative: false,\n          altText,\n        },\n        isSvg: false,\n        structParent,\n        popupRef,\n      };\n    }\n    const editor = await super.deserialize(data, parent, uiManager);\n    const { rect, bitmap, bitmapUrl, bitmapId, isSvg, accessibilityData } =\n      data;\n    if (missingCanvas) {\n      uiManager.addMissingCanvas(data.id, editor);\n      editor.#missingCanvas = true;\n    } else if (bitmapId && uiManager.imageManager.isValidId(bitmapId)) {\n      editor.#bitmapId = bitmapId;\n      if (bitmap) {\n        editor.#bitmap = bitmap;\n      }\n    } else {\n      editor.#bitmapUrl = bitmapUrl;\n    }\n    editor.#isSvg = isSvg;\n\n    const [parentWidth, parentHeight] = editor.pageDimensions;\n    editor.width = (rect[2] - rect[0]) / parentWidth;\n    editor.height = (rect[3] - rect[1]) / parentHeight;\n\n    if (accessibilityData) {\n      editor.altTextData = accessibilityData;\n    }\n    editor._initialData = initialData;\n    // No need to be add in the undo stack if the editor is created from an\n    // existing one.\n    editor.#hasBeenAddedInUndoStack = !!initialData;\n\n    return editor;\n  }\n\n  /** @inheritdoc */\n  serialize(isForCopying = false, context = null) {\n    if (this.isEmpty()) {\n      return null;\n    }\n\n    if (this.deleted) {\n      return this.serializeDeleted();\n    }\n\n    const serialized = {\n      annotationType: AnnotationEditorType.STAMP,\n      bitmapId: this.#bitmapId,\n      pageIndex: this.pageIndex,\n      rect: this.getRect(0, 0),\n      rotation: this.rotation,\n      isSvg: this.#isSvg,\n      structTreeParentId: this._structTreeParentId,\n    };\n\n    if (isForCopying) {\n      // We don't know what's the final destination (this pdf or another one)\n      // of this annotation and the clipboard doesn't support ImageBitmaps,\n      // hence we serialize the bitmap to a data url.\n      serialized.bitmapUrl = this.#serializeBitmap(/* toUrl = */ true);\n      serialized.accessibilityData = this.serializeAltText(true);\n      serialized.isCopy = true;\n      return serialized;\n    }\n\n    const { decorative, altText } = this.serializeAltText(false);\n    if (!decorative && altText) {\n      serialized.accessibilityData = { type: \"Figure\", alt: altText };\n    }\n    if (this.annotationElementId) {\n      const changes = this.#hasElementChanged(serialized);\n      if (changes.isSame) {\n        // Nothing has been changed.\n        return null;\n      }\n      if (changes.isSameAltText) {\n        delete serialized.accessibilityData;\n      } else {\n        serialized.accessibilityData.structParent =\n          this._initialData.structParent ?? -1;\n      }\n    }\n    serialized.id = this.annotationElementId;\n\n    if (context === null) {\n      return serialized;\n    }\n\n    context.stamps ||= new Map();\n    const area = this.#isSvg\n      ? (serialized.rect[2] - serialized.rect[0]) *\n        (serialized.rect[3] - serialized.rect[1])\n      : null;\n    if (!context.stamps.has(this.#bitmapId)) {\n      // We don't want to have multiple copies of the same bitmap in the\n      // annotationMap, hence we only add the bitmap the first time we meet it.\n      context.stamps.set(this.#bitmapId, { area, serialized });\n      serialized.bitmap = this.#serializeBitmap(/* toUrl = */ false);\n    } else if (this.#isSvg) {\n      // If we have multiple copies of the same svg but with different sizes,\n      // then we want to keep the biggest one.\n      const prevData = context.stamps.get(this.#bitmapId);\n      if (area > prevData.area) {\n        prevData.area = area;\n        prevData.serialized.bitmap.close();\n        prevData.serialized.bitmap = this.#serializeBitmap(/* toUrl = */ false);\n      }\n    }\n    return serialized;\n  }\n\n  #hasElementChanged(serialized) {\n    const {\n      pageIndex,\n      accessibilityData: { altText },\n    } = this._initialData;\n\n    const isSamePageIndex = serialized.pageIndex === pageIndex;\n    const isSameAltText = (serialized.accessibilityData?.alt || \"\") === altText;\n\n    return {\n      isSame:\n        !this._hasBeenMoved &&\n        !this._hasBeenResized &&\n        isSamePageIndex &&\n        isSameAltText,\n      isSameAltText,\n    };\n  }\n\n  /** @inheritdoc */\n  renderAnnotationElement(annotation) {\n    annotation.updateEdited({\n      rect: this.getRect(0, 0),\n    });\n\n    return null;\n  }\n}\n\nexport { StampEditor };\n","/* Copyright 2022 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./tools.js\").AnnotationEditorUIManager} AnnotationEditorUIManager */\n/** @typedef {import(\"../display_utils.js\").PageViewport} PageViewport */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../../../web/text_accessibility.js\").TextAccessibilityManager} TextAccessibilityManager */\n/** @typedef {import(\"../../../web/interfaces\").IL10n} IL10n */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../annotation_layer.js\").AnnotationLayer} AnnotationLayer */\n/** @typedef {import(\"../draw_layer.js\").DrawLayer} DrawLayer */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"../src/display/struct_tree_layer_builder.js\").StructTreeLayerBuilder} StructTreeLayerBuilder */\n\nimport {\n  AnnotationEditorPrefix,\n  AnnotationEditorType,\n  FeatureTest,\n} from \"../../shared/util.js\";\nimport { AnnotationEditor } from \"./editor.js\";\nimport { FreeTextEditor } from \"./freetext.js\";\nimport { HighlightEditor } from \"./highlight.js\";\nimport { InkEditor } from \"./ink.js\";\nimport { setLayerDimensions } from \"../display_utils.js\";\nimport { SignatureEditor } from \"./signature.js\";\nimport { StampEditor } from \"./stamp.js\";\n\n/**\n * @typedef {Object} AnnotationEditorLayerOptions\n * @property {Object} mode\n * @property {HTMLDivElement} div\n * @property {StructTreeLayerBuilder} structTreeLayer\n * @property {AnnotationEditorUIManager} uiManager\n * @property {boolean} enabled\n * @property {TextAccessibilityManager} [accessibilityManager]\n * @property {number} pageIndex\n * @property {IL10n} l10n\n * @property {AnnotationLayer} [annotationLayer]\n * @property {HTMLDivElement} [textLayer]\n * @property {DrawLayer} drawLayer\n * @property {PageViewport} viewport\n */\n\n/**\n * @typedef {Object} RenderEditorLayerOptions\n * @property {PageViewport} viewport\n */\n\n/**\n * Manage all the different editors on a page.\n */\nclass AnnotationEditorLayer {\n  #accessibilityManager;\n\n  #allowClick = false;\n\n  #annotationLayer = null;\n\n  #clickAC = null;\n\n  #editorFocusTimeoutId = null;\n\n  #editors = new Map();\n\n  #hadPointerDown = false;\n\n  #isDisabling = false;\n\n  #isEnabling = false;\n\n  #drawingAC = null;\n\n  #focusedElement = null;\n\n  #textLayer = null;\n\n  #textSelectionAC = null;\n\n  #textLayerDblClickAC = null;\n\n  #lastPointerDownTimestamp = -1;\n\n  #uiManager;\n\n  static _initialized = false;\n\n  static #editorTypes = new Map(\n    [\n      FreeTextEditor,\n      InkEditor,\n      StampEditor,\n      HighlightEditor,\n      SignatureEditor,\n    ].map(type => [type._editorType, type])\n  );\n\n  /**\n   * @param {AnnotationEditorLayerOptions} options\n   */\n  constructor({\n    uiManager,\n    pageIndex,\n    div,\n    structTreeLayer,\n    accessibilityManager,\n    annotationLayer,\n    drawLayer,\n    textLayer,\n    viewport,\n    l10n,\n  }) {\n    const editorTypes = [...AnnotationEditorLayer.#editorTypes.values()];\n    if (!AnnotationEditorLayer._initialized) {\n      AnnotationEditorLayer._initialized = true;\n      for (const editorType of editorTypes) {\n        editorType.initialize(l10n, uiManager);\n      }\n    }\n    uiManager.registerEditorTypes(editorTypes);\n\n    this.#uiManager = uiManager;\n    this.pageIndex = pageIndex;\n    this.div = div;\n    this.#accessibilityManager = accessibilityManager;\n    this.#annotationLayer = annotationLayer;\n    this.viewport = viewport;\n    this.#textLayer = textLayer;\n    this.drawLayer = drawLayer;\n    this._structTree = structTreeLayer;\n\n    this.#uiManager.addLayer(this);\n  }\n\n  get isEmpty() {\n    return this.#editors.size === 0;\n  }\n\n  get isInvisible() {\n    return (\n      this.isEmpty && this.#uiManager.getMode() === AnnotationEditorType.NONE\n    );\n  }\n\n  /**\n   * Update the toolbar if it's required to reflect the tool currently used.\n   * @param {Object} options\n   */\n  updateToolbar(options) {\n    this.#uiManager.updateToolbar(options);\n  }\n\n  /**\n   * The mode has changed: it must be updated.\n   * @param {number} mode\n   */\n  updateMode(mode = this.#uiManager.getMode()) {\n    this.#cleanup();\n    switch (mode) {\n      case AnnotationEditorType.NONE:\n        this.disableTextSelection();\n        this.togglePointerEvents(false);\n        this.toggleAnnotationLayerPointerEvents(true);\n        this.disableClick();\n        return;\n      case AnnotationEditorType.INK:\n        this.disableTextSelection();\n        this.togglePointerEvents(true);\n        this.enableClick();\n        break;\n      case AnnotationEditorType.HIGHLIGHT:\n        this.enableTextSelection();\n        this.togglePointerEvents(false);\n        this.disableClick();\n        break;\n      default:\n        this.disableTextSelection();\n        this.togglePointerEvents(true);\n        this.enableClick();\n    }\n\n    this.toggleAnnotationLayerPointerEvents(false);\n    const { classList } = this.div;\n    for (const editorType of AnnotationEditorLayer.#editorTypes.values()) {\n      classList.toggle(\n        `${editorType._type}Editing`,\n        mode === editorType._editorType\n      );\n    }\n    this.div.hidden = false;\n  }\n\n  hasTextLayer(textLayer) {\n    return textLayer === this.#textLayer?.div;\n  }\n\n  /**\n   * Set the editing state.\n   * @param {boolean} isEditing\n   */\n  setEditingState(isEditing) {\n    this.#uiManager.setEditingState(isEditing);\n  }\n\n  /**\n   * Add some commands into the CommandManager (undo/redo stuff).\n   * @param {Object} params\n   */\n  addCommands(params) {\n    this.#uiManager.addCommands(params);\n  }\n\n  cleanUndoStack(type) {\n    this.#uiManager.cleanUndoStack(type);\n  }\n\n  toggleDrawing(enabled = false) {\n    this.div.classList.toggle(\"drawing\", !enabled);\n  }\n\n  togglePointerEvents(enabled = false) {\n    this.div.classList.toggle(\"disabled\", !enabled);\n  }\n\n  toggleAnnotationLayerPointerEvents(enabled = false) {\n    this.#annotationLayer?.div.classList.toggle(\"disabled\", !enabled);\n  }\n\n  /**\n   * Enable pointer events on the main div in order to enable\n   * editor creation.\n   */\n  async enable() {\n    this.#isEnabling = true;\n    this.div.tabIndex = 0;\n    this.togglePointerEvents(true);\n    this.#textLayerDblClickAC?.abort();\n    this.#textLayerDblClickAC = null;\n    const annotationElementIds = new Set();\n    for (const editor of this.#editors.values()) {\n      editor.enableEditing();\n      editor.show(true);\n      if (editor.annotationElementId) {\n        this.#uiManager.removeChangedExistingAnnotation(editor);\n        annotationElementIds.add(editor.annotationElementId);\n      }\n    }\n\n    if (!this.#annotationLayer) {\n      this.#isEnabling = false;\n      return;\n    }\n\n    const editables = this.#annotationLayer.getEditableAnnotations();\n    for (const editable of editables) {\n      // The element must be hidden whatever its state is.\n      editable.hide();\n      if (this.#uiManager.isDeletedAnnotationElement(editable.data.id)) {\n        continue;\n      }\n      if (annotationElementIds.has(editable.data.id)) {\n        continue;\n      }\n      const editor = await this.deserialize(editable);\n      if (!editor) {\n        continue;\n      }\n      this.addOrRebuild(editor);\n      editor.enableEditing();\n    }\n    this.#isEnabling = false;\n  }\n\n  /**\n   * Disable editor creation.\n   */\n  disable() {\n    this.#isDisabling = true;\n    this.div.tabIndex = -1;\n    this.togglePointerEvents(false);\n    if (this.#textLayer && !this.#textLayerDblClickAC) {\n      this.#textLayerDblClickAC = new AbortController();\n      const signal = this.#uiManager.combinedSignal(this.#textLayerDblClickAC);\n      this.#textLayer.div.addEventListener(\n        \"pointerdown\",\n        e => {\n          // It's the default value in Fenix:\n          // https://searchfox.org/mozilla-central/rev/beba5cde846f944c4d709e75cbe499d17af880a4/modules/libpref/init/StaticPrefList.yaml#19064\n          // and in Chrome and Windows:\n          // https://source.chromium.org/chromium/chromium/src/+/main:ui/events/event_constants.h;drc=f0f5f3ceebb00da9363ccc7a1e2c0f17b6b383ba;l=115\n          const DBL_CLICK_THRESHOLD = 500;\n          const { clientX, clientY, timeStamp } = e;\n          const lastPointerDownTimestamp = this.#lastPointerDownTimestamp;\n          if (timeStamp - lastPointerDownTimestamp > DBL_CLICK_THRESHOLD) {\n            this.#lastPointerDownTimestamp = timeStamp;\n            return;\n          }\n          this.#lastPointerDownTimestamp = -1;\n          const { classList } = this.div;\n          classList.toggle(\"getElements\", true);\n          const elements = document.elementsFromPoint(clientX, clientY);\n          classList.toggle(\"getElements\", false);\n          if (!this.div.contains(elements[0])) {\n            return;\n          }\n          let id;\n          const regex = new RegExp(`^${AnnotationEditorPrefix}[0-9]+$`);\n          for (const element of elements) {\n            if (regex.test(element.id)) {\n              id = element.id;\n              break;\n            }\n          }\n          if (!id) {\n            return;\n          }\n          const editor = this.#editors.get(id);\n          if (editor?.annotationElementId === null) {\n            e.stopPropagation();\n            e.preventDefault();\n            editor.dblclick();\n          }\n        },\n        { signal, capture: true }\n      );\n    }\n    const changedAnnotations = new Map();\n    const resetAnnotations = new Map();\n    for (const editor of this.#editors.values()) {\n      editor.disableEditing();\n      if (!editor.annotationElementId) {\n        continue;\n      }\n      if (editor.serialize() !== null) {\n        changedAnnotations.set(editor.annotationElementId, editor);\n        continue;\n      } else {\n        resetAnnotations.set(editor.annotationElementId, editor);\n      }\n      this.getEditableAnnotation(editor.annotationElementId)?.show();\n      editor.remove();\n    }\n\n    if (this.#annotationLayer) {\n      // Show the annotations that were hidden in enable().\n      const editables = this.#annotationLayer.getEditableAnnotations();\n      for (const editable of editables) {\n        const { id } = editable.data;\n        if (this.#uiManager.isDeletedAnnotationElement(id)) {\n          continue;\n        }\n        let editor = resetAnnotations.get(id);\n        if (editor) {\n          editor.resetAnnotationElement(editable);\n          editor.show(false);\n          editable.show();\n          continue;\n        }\n\n        editor = changedAnnotations.get(id);\n        if (editor) {\n          this.#uiManager.addChangedExistingAnnotation(editor);\n          if (editor.renderAnnotationElement(editable)) {\n            // Content has changed, so we need to hide the editor.\n            editor.show(false);\n          }\n        }\n        editable.show();\n      }\n    }\n\n    this.#cleanup();\n    if (this.isEmpty) {\n      this.div.hidden = true;\n    }\n    const { classList } = this.div;\n    for (const editorType of AnnotationEditorLayer.#editorTypes.values()) {\n      classList.remove(`${editorType._type}Editing`);\n    }\n    this.disableTextSelection();\n    this.toggleAnnotationLayerPointerEvents(true);\n\n    this.#isDisabling = false;\n  }\n\n  getEditableAnnotation(id) {\n    return this.#annotationLayer?.getEditableAnnotation(id) || null;\n  }\n\n  /**\n   * Set the current editor.\n   * @param {AnnotationEditor} editor\n   */\n  setActiveEditor(editor) {\n    const currentActive = this.#uiManager.getActive();\n    if (currentActive === editor) {\n      return;\n    }\n\n    this.#uiManager.setActiveEditor(editor);\n  }\n\n  enableTextSelection() {\n    this.div.tabIndex = -1;\n    if (this.#textLayer?.div && !this.#textSelectionAC) {\n      this.#textSelectionAC = new AbortController();\n      const signal = this.#uiManager.combinedSignal(this.#textSelectionAC);\n\n      this.#textLayer.div.addEventListener(\n        \"pointerdown\",\n        this.#textLayerPointerDown.bind(this),\n        { signal }\n      );\n      this.#textLayer.div.classList.add(\"highlighting\");\n    }\n  }\n\n  disableTextSelection() {\n    this.div.tabIndex = 0;\n    if (this.#textLayer?.div && this.#textSelectionAC) {\n      this.#textSelectionAC.abort();\n      this.#textSelectionAC = null;\n\n      this.#textLayer.div.classList.remove(\"highlighting\");\n    }\n  }\n\n  #textLayerPointerDown(event) {\n    // Unselect all the editors in order to let the user select some text\n    // without being annoyed by an editor toolbar.\n    this.#uiManager.unselectAll();\n    const { target } = event;\n    if (\n      target === this.#textLayer.div ||\n      ((target.getAttribute(\"role\") === \"img\" ||\n        target.classList.contains(\"endOfContent\")) &&\n        this.#textLayer.div.contains(target))\n    ) {\n      const { isMac } = FeatureTest.platform;\n      if (event.button !== 0 || (event.ctrlKey && isMac)) {\n        // Do nothing on right click.\n        return;\n      }\n      this.#uiManager.showAllEditors(\n        \"highlight\",\n        true,\n        /* updateButton = */ true\n      );\n      this.#textLayer.div.classList.add(\"free\");\n      this.toggleDrawing();\n      HighlightEditor.startHighlighting(\n        this,\n        this.#uiManager.direction === \"ltr\",\n        { target: this.#textLayer.div, x: event.x, y: event.y }\n      );\n      this.#textLayer.div.addEventListener(\n        \"pointerup\",\n        () => {\n          this.#textLayer.div.classList.remove(\"free\");\n          this.toggleDrawing(true);\n        },\n        { once: true, signal: this.#uiManager._signal }\n      );\n      event.preventDefault();\n    }\n  }\n\n  enableClick() {\n    if (this.#clickAC) {\n      return;\n    }\n    this.#clickAC = new AbortController();\n    const signal = this.#uiManager.combinedSignal(this.#clickAC);\n\n    this.div.addEventListener(\"pointerdown\", this.pointerdown.bind(this), {\n      signal,\n    });\n    const pointerup = this.pointerup.bind(this);\n    this.div.addEventListener(\"pointerup\", pointerup, { signal });\n    this.div.addEventListener(\"pointercancel\", pointerup, { signal });\n  }\n\n  disableClick() {\n    this.#clickAC?.abort();\n    this.#clickAC = null;\n  }\n\n  attach(editor) {\n    this.#editors.set(editor.id, editor);\n    const { annotationElementId } = editor;\n    if (\n      annotationElementId &&\n      this.#uiManager.isDeletedAnnotationElement(annotationElementId)\n    ) {\n      this.#uiManager.removeDeletedAnnotationElement(editor);\n    }\n  }\n\n  detach(editor) {\n    this.#editors.delete(editor.id);\n    this.#accessibilityManager?.removePointerInTextLayer(editor.contentDiv);\n\n    if (!this.#isDisabling && editor.annotationElementId) {\n      this.#uiManager.addDeletedAnnotationElement(editor);\n    }\n  }\n\n  /**\n   * Remove an editor.\n   * @param {AnnotationEditor} editor\n   */\n  remove(editor) {\n    this.detach(editor);\n    this.#uiManager.removeEditor(editor);\n    editor.div.remove();\n    editor.isAttachedToDOM = false;\n  }\n\n  /**\n   * An editor can have a different parent, for example after having\n   * being dragged and droped from a page to another.\n   * @param {AnnotationEditor} editor\n   */\n  changeParent(editor) {\n    if (editor.parent === this) {\n      return;\n    }\n\n    if (editor.parent && editor.annotationElementId) {\n      this.#uiManager.addDeletedAnnotationElement(editor.annotationElementId);\n      AnnotationEditor.deleteAnnotationElement(editor);\n      editor.annotationElementId = null;\n    }\n\n    this.attach(editor);\n    editor.parent?.detach(editor);\n    editor.setParent(this);\n    if (editor.div && editor.isAttachedToDOM) {\n      editor.div.remove();\n      this.div.append(editor.div);\n    }\n  }\n\n  /**\n   * Add a new editor in the current view.\n   * @param {AnnotationEditor} editor\n   */\n  add(editor) {\n    if (editor.parent === this && editor.isAttachedToDOM) {\n      return;\n    }\n    this.changeParent(editor);\n    this.#uiManager.addEditor(editor);\n    this.attach(editor);\n\n    if (!editor.isAttachedToDOM) {\n      const div = editor.render();\n      this.div.append(div);\n      editor.isAttachedToDOM = true;\n    }\n\n    // The editor will be correctly moved into the DOM (see fixAndSetPosition).\n    editor.fixAndSetPosition();\n    editor.onceAdded(/* focus = */ !this.#isEnabling);\n    this.#uiManager.addToAnnotationStorage(editor);\n    editor._reportTelemetry(editor.telemetryInitialData);\n  }\n\n  moveEditorInDOM(editor) {\n    if (!editor.isAttachedToDOM) {\n      return;\n    }\n\n    const { activeElement } = document;\n    if (editor.div.contains(activeElement) && !this.#editorFocusTimeoutId) {\n      // When the div is moved in the DOM the focus can move somewhere else,\n      // so we want to be sure that the focus will stay on the editor but we\n      // don't want to call any focus callbacks, hence we disable them and only\n      // re-enable them when the editor has the focus.\n      editor._focusEventsAllowed = false;\n      this.#editorFocusTimeoutId = setTimeout(() => {\n        this.#editorFocusTimeoutId = null;\n        if (!editor.div.contains(document.activeElement)) {\n          editor.div.addEventListener(\n            \"focusin\",\n            () => {\n              editor._focusEventsAllowed = true;\n            },\n            { once: true, signal: this.#uiManager._signal }\n          );\n          activeElement.focus();\n        } else {\n          editor._focusEventsAllowed = true;\n        }\n      }, 0);\n    }\n\n    editor._structTreeParentId = this.#accessibilityManager?.moveElementInDOM(\n      this.div,\n      editor.div,\n      editor.contentDiv,\n      /* isRemovable = */ true\n    );\n  }\n\n  /**\n   * Add or rebuild depending if it has been removed or not.\n   * @param {AnnotationEditor} editor\n   */\n  addOrRebuild(editor) {\n    if (editor.needsToBeRebuilt()) {\n      editor.parent ||= this;\n      editor.rebuild();\n      editor.show();\n    } else {\n      this.add(editor);\n    }\n  }\n\n  /**\n   * Add a new editor and make this addition undoable.\n   * @param {AnnotationEditor} editor\n   */\n  addUndoableEditor(editor) {\n    const cmd = () => editor._uiManager.rebuild(editor);\n    const undo = () => {\n      editor.remove();\n    };\n\n    this.addCommands({ cmd, undo, mustExec: false });\n  }\n\n  /**\n   * Get an id for an editor.\n   * @returns {string}\n   */\n  getNextId() {\n    return this.#uiManager.getId();\n  }\n\n  get #currentEditorType() {\n    return AnnotationEditorLayer.#editorTypes.get(this.#uiManager.getMode());\n  }\n\n  combinedSignal(ac) {\n    return this.#uiManager.combinedSignal(ac);\n  }\n\n  /**\n   * Create a new editor\n   * @param {Object} params\n   * @returns {AnnotationEditor}\n   */\n  #createNewEditor(params) {\n    const editorType = this.#currentEditorType;\n    return editorType ? new editorType.prototype.constructor(params) : null;\n  }\n\n  canCreateNewEmptyEditor() {\n    return this.#currentEditorType?.canCreateNewEmptyEditor();\n  }\n\n  /**\n   * Paste some content into a new editor.\n   * @param {Object} options\n   * @param {Object} params\n   */\n  async pasteEditor(options, params) {\n    this.updateToolbar(options);\n    await this.#uiManager.updateMode(options.mode);\n\n    const { offsetX, offsetY } = this.#getCenterPoint();\n    const id = this.getNextId();\n    const editor = this.#createNewEditor({\n      parent: this,\n      id,\n      x: offsetX,\n      y: offsetY,\n      uiManager: this.#uiManager,\n      isCentered: true,\n      ...params,\n    });\n    if (editor) {\n      this.add(editor);\n    }\n  }\n\n  /**\n   * Create a new editor\n   * @param {Object} data\n   * @returns {AnnotationEditor | null}\n   */\n  async deserialize(data) {\n    return (\n      (await AnnotationEditorLayer.#editorTypes\n        .get(data.annotationType ?? data.annotationEditorType)\n        ?.deserialize(data, this, this.#uiManager)) || null\n    );\n  }\n\n  /**\n   * Create and add a new editor.\n   * @param {PointerEvent} event\n   * @param {boolean} isCentered\n   * @param [Object] data\n   * @returns {AnnotationEditor}\n   */\n  createAndAddNewEditor(event, isCentered, data = {}) {\n    const id = this.getNextId();\n    const editor = this.#createNewEditor({\n      parent: this,\n      id,\n      x: event.offsetX,\n      y: event.offsetY,\n      uiManager: this.#uiManager,\n      isCentered,\n      ...data,\n    });\n    if (editor) {\n      this.add(editor);\n    }\n\n    return editor;\n  }\n\n  #getCenterPoint() {\n    const { x, y, width, height } = this.div.getBoundingClientRect();\n    const tlX = Math.max(0, x);\n    const tlY = Math.max(0, y);\n    const brX = Math.min(window.innerWidth, x + width);\n    const brY = Math.min(window.innerHeight, y + height);\n    const centerX = (tlX + brX) / 2 - x;\n    const centerY = (tlY + brY) / 2 - y;\n    const [offsetX, offsetY] =\n      this.viewport.rotation % 180 === 0\n        ? [centerX, centerY]\n        : [centerY, centerX];\n\n    return { offsetX, offsetY };\n  }\n\n  /**\n   * Create and add a new editor.\n   */\n  addNewEditor(data = {}) {\n    this.createAndAddNewEditor(\n      this.#getCenterPoint(),\n      /* isCentered = */ true,\n      data\n    );\n  }\n\n  /**\n   * Set the last selected editor.\n   * @param {AnnotationEditor} editor\n   */\n  setSelected(editor) {\n    this.#uiManager.setSelected(editor);\n  }\n\n  /**\n   * Add or remove an editor the current selection.\n   * @param {AnnotationEditor} editor\n   */\n  toggleSelected(editor) {\n    this.#uiManager.toggleSelected(editor);\n  }\n\n  /**\n   * Unselect an editor.\n   * @param {AnnotationEditor} editor\n   */\n  unselect(editor) {\n    this.#uiManager.unselect(editor);\n  }\n\n  /**\n   * Pointerup callback.\n   * @param {PointerEvent} event\n   */\n  pointerup(event) {\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      // Don't create an editor on right click.\n      return;\n    }\n\n    if (event.target !== this.div) {\n      return;\n    }\n\n    if (!this.#hadPointerDown) {\n      // It can happen when the user starts a drag inside a text editor\n      // and then releases the mouse button outside of it. In such a case\n      // we don't want to create a new editor, hence we check that a pointerdown\n      // occurred on this div previously.\n      return;\n    }\n    this.#hadPointerDown = false;\n\n    if (\n      this.#currentEditorType?.isDrawer &&\n      this.#currentEditorType.supportMultipleDrawings\n    ) {\n      return;\n    }\n\n    if (!this.#allowClick) {\n      this.#allowClick = true;\n      return;\n    }\n\n    const currentMode = this.#uiManager.getMode();\n    if (\n      currentMode === AnnotationEditorType.STAMP ||\n      currentMode === AnnotationEditorType.SIGNATURE\n    ) {\n      this.#uiManager.unselectAll();\n      return;\n    }\n\n    this.createAndAddNewEditor(event, /* isCentered = */ false);\n  }\n\n  /**\n   * Pointerdown callback.\n   * @param {PointerEvent} event\n   */\n  pointerdown(event) {\n    if (this.#uiManager.getMode() === AnnotationEditorType.HIGHLIGHT) {\n      this.enableTextSelection();\n    }\n    if (this.#hadPointerDown) {\n      // It's possible to have a second pointerdown event before a pointerup one\n      // when the user puts a finger on a touchscreen and then add a second one\n      // to start a pinch-to-zoom gesture.\n      // That said, in case it's possible to have two pointerdown events with\n      // a mouse, we don't want to create a new editor in such a case either.\n      this.#hadPointerDown = false;\n      return;\n    }\n    const { isMac } = FeatureTest.platform;\n    if (event.button !== 0 || (event.ctrlKey && isMac)) {\n      // Do nothing on right click.\n      return;\n    }\n\n    if (event.target !== this.div) {\n      return;\n    }\n\n    this.#hadPointerDown = true;\n\n    if (this.#currentEditorType?.isDrawer) {\n      this.startDrawingSession(event);\n      return;\n    }\n\n    const editor = this.#uiManager.getActive();\n    this.#allowClick = !editor || editor.isEmpty();\n  }\n\n  startDrawingSession(event) {\n    this.div.focus({\n      preventScroll: true,\n    });\n    if (this.#drawingAC) {\n      this.#currentEditorType.startDrawing(this, this.#uiManager, false, event);\n      return;\n    }\n\n    this.#uiManager.setCurrentDrawingSession(this);\n    this.#drawingAC = new AbortController();\n    const signal = this.#uiManager.combinedSignal(this.#drawingAC);\n    this.div.addEventListener(\n      \"blur\",\n      ({ relatedTarget }) => {\n        if (relatedTarget && !this.div.contains(relatedTarget)) {\n          this.#focusedElement = null;\n          this.commitOrRemove();\n        }\n      },\n      { signal }\n    );\n    this.#currentEditorType.startDrawing(this, this.#uiManager, false, event);\n  }\n\n  pause(on) {\n    if (on) {\n      const { activeElement } = document;\n      if (this.div.contains(activeElement)) {\n        this.#focusedElement = activeElement;\n      }\n      return;\n    }\n    if (this.#focusedElement) {\n      setTimeout(() => {\n        this.#focusedElement?.focus();\n        this.#focusedElement = null;\n      }, 0);\n    }\n  }\n\n  endDrawingSession(isAborted = false) {\n    if (!this.#drawingAC) {\n      return null;\n    }\n    this.#uiManager.setCurrentDrawingSession(null);\n    this.#drawingAC.abort();\n    this.#drawingAC = null;\n    this.#focusedElement = null;\n    return this.#currentEditorType.endDrawing(isAborted);\n  }\n\n  /**\n   *\n   * @param {AnnotationEditor} editor\n   * @param {number} x\n   * @param {number} y\n   * @returns\n   */\n  findNewParent(editor, x, y) {\n    const layer = this.#uiManager.findParent(x, y);\n    if (layer === null || layer === this) {\n      return false;\n    }\n    layer.changeParent(editor);\n    return true;\n  }\n\n  commitOrRemove() {\n    if (this.#drawingAC) {\n      this.endDrawingSession();\n      return true;\n    }\n    return false;\n  }\n\n  onScaleChanging() {\n    if (!this.#drawingAC) {\n      return;\n    }\n    this.#currentEditorType.onScaleChangingWhenDrawing(this);\n  }\n\n  /**\n   * Destroy the main editor.\n   */\n  destroy() {\n    this.commitOrRemove();\n    if (this.#uiManager.getActive()?.parent === this) {\n      // We need to commit the current editor before destroying the layer.\n      this.#uiManager.commitOrRemove();\n      this.#uiManager.setActiveEditor(null);\n    }\n\n    if (this.#editorFocusTimeoutId) {\n      clearTimeout(this.#editorFocusTimeoutId);\n      this.#editorFocusTimeoutId = null;\n    }\n\n    for (const editor of this.#editors.values()) {\n      this.#accessibilityManager?.removePointerInTextLayer(editor.contentDiv);\n      editor.setParent(null);\n      editor.isAttachedToDOM = false;\n      editor.div.remove();\n    }\n    this.div = null;\n    this.#editors.clear();\n    this.#uiManager.removeLayer(this);\n  }\n\n  #cleanup() {\n    // When we're cleaning up, some editors are removed but we don't want\n    // to add a new one which will induce an addition in this.#editors, hence\n    // an infinite loop.\n    for (const editor of this.#editors.values()) {\n      if (editor.isEmpty()) {\n        editor.remove();\n      }\n    }\n  }\n\n  /**\n   * Render the main editor.\n   * @param {RenderEditorLayerOptions} parameters\n   */\n  render({ viewport }) {\n    this.viewport = viewport;\n    setLayerDimensions(this.div, viewport);\n    for (const editor of this.#uiManager.getEditors(this.pageIndex)) {\n      this.add(editor);\n      editor.rebuild();\n    }\n    // We're maybe rendering a layer which was invisible when we started to edit\n    // so we must set the different callbacks for it.\n    this.updateMode();\n  }\n\n  /**\n   * Update the main editor.\n   * @param {RenderEditorLayerOptions} parameters\n   */\n  update({ viewport }) {\n    // Editors have their dimensions/positions in percent so to avoid any\n    // issues (see #15582), we must commit the current one before changing\n    // the viewport.\n    this.#uiManager.commitOrRemove();\n    this.#cleanup();\n\n    const oldRotation = this.viewport.rotation;\n    const rotation = viewport.rotation;\n\n    this.viewport = viewport;\n    setLayerDimensions(this.div, { rotation });\n    if (oldRotation !== rotation) {\n      for (const editor of this.#editors.values()) {\n        editor.rotate(rotation);\n      }\n    }\n  }\n\n  /**\n   * Get page dimensions.\n   * @returns {Object} dimensions.\n   */\n  get pageDimensions() {\n    const { pageWidth, pageHeight } = this.viewport.rawDims;\n    return [pageWidth, pageHeight];\n  }\n\n  get scale() {\n    return this.#uiManager.viewParameters.realScale;\n  }\n}\n\nexport { AnnotationEditorLayer };\n","/* Copyright 2023 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DOMSVGFactory } from \"./svg_factory.js\";\nimport { shadow } from \"../shared/util.js\";\n\n/**\n * Manage the SVGs drawn on top of the page canvas.\n * It's important to have them directly on top of the canvas because we want to\n * be able to use mix-blend-mode for some of them.\n */\nclass DrawLayer {\n  #parent = null;\n\n  #mapping = new Map();\n\n  #toUpdate = new Map();\n\n  static #id = 0;\n\n  constructor({ pageIndex }) {\n    this.pageIndex = pageIndex;\n  }\n\n  setParent(parent) {\n    if (!this.#parent) {\n      this.#parent = parent;\n      return;\n    }\n\n    if (this.#parent !== parent) {\n      if (this.#mapping.size > 0) {\n        for (const root of this.#mapping.values()) {\n          root.remove();\n          parent.append(root);\n        }\n      }\n      this.#parent = parent;\n    }\n  }\n\n  static get _svgFactory() {\n    return shadow(this, \"_svgFactory\", new DOMSVGFactory());\n  }\n\n  static #setBox(element, [x, y, width, height]) {\n    const { style } = element;\n    style.top = `${100 * y}%`;\n    style.left = `${100 * x}%`;\n    style.width = `${100 * width}%`;\n    style.height = `${100 * height}%`;\n  }\n\n  #createSVG() {\n    const svg = DrawLayer._svgFactory.create(1, 1, /* skipDimensions = */ true);\n    this.#parent.append(svg);\n    svg.setAttribute(\"aria-hidden\", true);\n\n    return svg;\n  }\n\n  #createClipPath(defs, pathId) {\n    const clipPath = DrawLayer._svgFactory.createElement(\"clipPath\");\n    defs.append(clipPath);\n    const clipPathId = `clip_${pathId}`;\n    clipPath.setAttribute(\"id\", clipPathId);\n    clipPath.setAttribute(\"clipPathUnits\", \"objectBoundingBox\");\n    const clipPathUse = DrawLayer._svgFactory.createElement(\"use\");\n    clipPath.append(clipPathUse);\n    clipPathUse.setAttribute(\"href\", `#${pathId}`);\n    clipPathUse.classList.add(\"clip\");\n\n    return clipPathId;\n  }\n\n  #updateProperties(element, properties) {\n    for (const [key, value] of Object.entries(properties)) {\n      if (value === null) {\n        element.removeAttribute(key);\n      } else {\n        element.setAttribute(key, value);\n      }\n    }\n  }\n\n  draw(properties, isPathUpdatable = false, hasClip = false) {\n    const id = DrawLayer.#id++;\n    const root = this.#createSVG();\n\n    const defs = DrawLayer._svgFactory.createElement(\"defs\");\n    root.append(defs);\n    const path = DrawLayer._svgFactory.createElement(\"path\");\n    defs.append(path);\n    const pathId = `path_p${this.pageIndex}_${id}`;\n    path.setAttribute(\"id\", pathId);\n    path.setAttribute(\"vector-effect\", \"non-scaling-stroke\");\n\n    if (isPathUpdatable) {\n      this.#toUpdate.set(id, path);\n    }\n\n    // Create the clipping path for the editor div.\n    const clipPathId = hasClip ? this.#createClipPath(defs, pathId) : null;\n\n    const use = DrawLayer._svgFactory.createElement(\"use\");\n    root.append(use);\n    use.setAttribute(\"href\", `#${pathId}`);\n    this.updateProperties(root, properties);\n\n    this.#mapping.set(id, root);\n\n    return { id, clipPathId: `url(#${clipPathId})` };\n  }\n\n  drawOutline(properties, mustRemoveSelfIntersections) {\n    // We cannot draw the outline directly in the SVG for highlights because\n    // it composes with its parent with mix-blend-mode: multiply.\n    // But the outline has a different mix-blend-mode, so we need to draw it in\n    // its own SVG.\n    const id = DrawLayer.#id++;\n    const root = this.#createSVG();\n    const defs = DrawLayer._svgFactory.createElement(\"defs\");\n    root.append(defs);\n    const path = DrawLayer._svgFactory.createElement(\"path\");\n    defs.append(path);\n    const pathId = `path_p${this.pageIndex}_${id}`;\n    path.setAttribute(\"id\", pathId);\n    path.setAttribute(\"vector-effect\", \"non-scaling-stroke\");\n\n    let maskId;\n    if (mustRemoveSelfIntersections) {\n      const mask = DrawLayer._svgFactory.createElement(\"mask\");\n      defs.append(mask);\n      maskId = `mask_p${this.pageIndex}_${id}`;\n      mask.setAttribute(\"id\", maskId);\n      mask.setAttribute(\"maskUnits\", \"objectBoundingBox\");\n      const rect = DrawLayer._svgFactory.createElement(\"rect\");\n      mask.append(rect);\n      rect.setAttribute(\"width\", \"1\");\n      rect.setAttribute(\"height\", \"1\");\n      rect.setAttribute(\"fill\", \"white\");\n      const use = DrawLayer._svgFactory.createElement(\"use\");\n      mask.append(use);\n      use.setAttribute(\"href\", `#${pathId}`);\n      use.setAttribute(\"stroke\", \"none\");\n      use.setAttribute(\"fill\", \"black\");\n      use.setAttribute(\"fill-rule\", \"nonzero\");\n      use.classList.add(\"mask\");\n    }\n\n    const use1 = DrawLayer._svgFactory.createElement(\"use\");\n    root.append(use1);\n    use1.setAttribute(\"href\", `#${pathId}`);\n    if (maskId) {\n      use1.setAttribute(\"mask\", `url(#${maskId})`);\n    }\n    const use2 = use1.cloneNode();\n    root.append(use2);\n    use1.classList.add(\"mainOutline\");\n    use2.classList.add(\"secondaryOutline\");\n\n    this.updateProperties(root, properties);\n\n    this.#mapping.set(id, root);\n\n    return id;\n  }\n\n  finalizeDraw(id, properties) {\n    this.#toUpdate.delete(id);\n    this.updateProperties(id, properties);\n  }\n\n  updateProperties(elementOrId, properties) {\n    if (!properties) {\n      return;\n    }\n    const { root, bbox, rootClass, path } = properties;\n    const element =\n      typeof elementOrId === \"number\"\n        ? this.#mapping.get(elementOrId)\n        : elementOrId;\n    if (!element) {\n      return;\n    }\n    if (root) {\n      this.#updateProperties(element, root);\n    }\n    if (bbox) {\n      DrawLayer.#setBox(element, bbox);\n    }\n    if (rootClass) {\n      const { classList } = element;\n      for (const [className, value] of Object.entries(rootClass)) {\n        classList.toggle(className, value);\n      }\n    }\n    if (path) {\n      const defs = element.firstChild;\n      const pathElement = defs.firstChild;\n      this.#updateProperties(pathElement, path);\n    }\n  }\n\n  updateParent(id, layer) {\n    if (layer === this) {\n      return;\n    }\n    const root = this.#mapping.get(id);\n    if (!root) {\n      return;\n    }\n    layer.#parent.append(root);\n    this.#mapping.delete(id);\n    layer.#mapping.set(id, root);\n  }\n\n  remove(id) {\n    this.#toUpdate.delete(id);\n    if (this.#parent === null) {\n      return;\n    }\n    this.#mapping.get(id).remove();\n    this.#mapping.delete(id);\n  }\n\n  destroy() {\n    this.#parent = null;\n    for (const root of this.#mapping.values()) {\n      root.remove();\n    }\n    this.#mapping.clear();\n    this.#toUpdate.clear();\n  }\n}\n\nexport { DrawLayer };\n","/* Copyright 2012 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./display/api\").OnProgressParameters} OnProgressParameters */\n// eslint-disable-next-line max-len\n/** @typedef {import(\"./display/api\").PDFDocumentLoadingTask} PDFDocumentLoadingTask */\n/** @typedef {import(\"./display/api\").PDFDocumentProxy} PDFDocumentProxy */\n/** @typedef {import(\"./display/api\").PDFPageProxy} PDFPageProxy */\n/** @typedef {import(\"./display/api\").RenderTask} RenderTask */\n/** @typedef {import(\"./display/display_utils\").PageViewport} PageViewport */\n\nimport {\n  AbortException,\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  AnnotationMode,\n  AnnotationType,\n  createValidAbsoluteUrl,\n  FeatureTest,\n  getUuid,\n  ImageKind,\n  InvalidPDFException,\n  MathClamp,\n  normalizeUnicode,\n  OPS,\n  PasswordResponses,\n  PermissionFlag,\n  ResponseException,\n  shadow,\n  updateUrlHash,\n  Util,\n  VerbosityLevel,\n} from \"./shared/util.js\";\nimport {\n  build,\n  getDocument,\n  PDFDataRangeTransport,\n  PDFWorker,\n  version,\n} from \"./display/api.js\";\nimport {\n  fetchData,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getXfaPageViewport,\n  isDataScheme,\n  isPdfFile,\n  noContextMenu,\n  OutputScale,\n  PDFDateString,\n  PixelsPerInch,\n  RenderingCancelledException,\n  setLayerDimensions,\n  stopEvent,\n  SupportedImageMimeTypes,\n} from \"./display/display_utils.js\";\nimport { AnnotationEditorLayer } from \"./display/editor/annotation_editor_layer.js\";\nimport { AnnotationEditorUIManager } from \"./display/editor/tools.js\";\nimport { AnnotationLayer } from \"./display/annotation_layer.js\";\nimport { ColorPicker } from \"./display/editor/color_picker.js\";\nimport { DOMSVGFactory } from \"./display/svg_factory.js\";\nimport { DrawLayer } from \"./display/draw_layer.js\";\nimport { GlobalWorkerOptions } from \"./display/worker_options.js\";\nimport { HighlightOutliner } from \"./display/editor/drawers/highlight.js\";\nimport { isValidExplicitDest } from \"./display/api_utils.js\";\nimport { SignatureExtractor } from \"./display/editor/drawers/signaturedraw.js\";\nimport { TextLayer } from \"./display/text_layer.js\";\nimport { TouchManager } from \"./display/touch_manager.js\";\nimport { XfaLayer } from \"./display/xfa_layer.js\";\n\nif (typeof PDFJSDev !== \"undefined\" && PDFJSDev.test(\"TESTING || GENERIC\")) {\n  globalThis._pdfjsTestingUtils = {\n    HighlightOutliner,\n  };\n}\n\nglobalThis.pdfjsLib = {\n  AbortException,\n  AnnotationEditorLayer,\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  AnnotationEditorUIManager,\n  AnnotationLayer,\n  AnnotationMode,\n  AnnotationType,\n  build,\n  ColorPicker,\n  createValidAbsoluteUrl,\n  DOMSVGFactory,\n  DrawLayer,\n  FeatureTest,\n  fetchData,\n  getDocument,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getUuid,\n  getXfaPageViewport,\n  GlobalWorkerOptions,\n  ImageKind,\n  InvalidPDFException,\n  isDataScheme,\n  isPdfFile,\n  isValidExplicitDest,\n  MathClamp,\n  noContextMenu,\n  normalizeUnicode,\n  OPS,\n  OutputScale,\n  PasswordResponses,\n  PDFDataRangeTransport,\n  PDFDateString,\n  PDFWorker,\n  PermissionFlag,\n  PixelsPerInch,\n  RenderingCancelledException,\n  ResponseException,\n  setLayerDimensions,\n  shadow,\n  SignatureExtractor,\n  stopEvent,\n  SupportedImageMimeTypes,\n  TextLayer,\n  TouchManager,\n  updateUrlHash,\n  Util,\n  VerbosityLevel,\n  version,\n  XfaLayer,\n};\n\nexport {\n  AbortException,\n  AnnotationEditorLayer,\n  AnnotationEditorParamsType,\n  AnnotationEditorType,\n  AnnotationEditorUIManager,\n  AnnotationLayer,\n  AnnotationMode,\n  AnnotationType,\n  build,\n  ColorPicker,\n  createValidAbsoluteUrl,\n  DOMSVGFactory,\n  DrawLayer,\n  FeatureTest,\n  fetchData,\n  getDocument,\n  getFilenameFromUrl,\n  getPdfFilenameFromUrl,\n  getUuid,\n  getXfaPageViewport,\n  GlobalWorkerOptions,\n  ImageKind,\n  InvalidPDFException,\n  isDataScheme,\n  isPdfFile,\n  isValidExplicitDest,\n  MathClamp,\n  noContextMenu,\n  normalizeUnicode,\n  OPS,\n  OutputScale,\n  PasswordResponses,\n  PDFDataRangeTransport,\n  PDFDateString,\n  PDFWorker,\n  PermissionFlag,\n  PixelsPerInch,\n  RenderingCancelledException,\n  ResponseException,\n  setLayerDimensions,\n  shadow,\n  SignatureExtractor,\n  stopEvent,\n  SupportedImageMimeTypes,\n  TextLayer,\n  TouchManager,\n  updateUrlHash,\n  Util,\n  VerbosityLevel,\n  version,\n  XfaLayer,\n};\n","var isProduction = process.env.NODE_ENV === 'production';\nvar prefix = 'Invariant failed';\nfunction invariant(condition, message) {\n    if (condition) {\n        return;\n    }\n    if (isProduction) {\n        throw new Error(prefix);\n    }\n    var provided = typeof message === 'function' ? message() : message;\n    var value = provided ? \"\".concat(prefix, \": \").concat(provided) : prefix;\n    throw new Error(value);\n}\n\nexport { invariant as default };\n","var has = Object.prototype.hasOwnProperty;\n\nfunction find(iter, tar, key) {\n\tfor (key of iter.keys()) {\n\t\tif (dequal(key, tar)) return key;\n\t}\n}\n\nexport function dequal(foo, bar) {\n\tvar ctor, len, tmp;\n\tif (foo === bar) return true;\n\n\tif (foo && bar && (ctor=foo.constructor) === bar.constructor) {\n\t\tif (ctor === Date) return foo.getTime() === bar.getTime();\n\t\tif (ctor === RegExp) return foo.toString() === bar.toString();\n\n\t\tif (ctor === Array) {\n\t\t\tif ((len=foo.length) === bar.length) {\n\t\t\t\twhile (len-- && dequal(foo[len], bar[len]));\n\t\t\t}\n\t\t\treturn len === -1;\n\t\t}\n\n\t\tif (ctor === Set) {\n\t\t\tif (foo.size !== bar.size) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tfor (len of foo) {\n\t\t\t\ttmp = len;\n\t\t\t\tif (tmp && typeof tmp === 'object') {\n\t\t\t\t\ttmp = find(bar, tmp);\n\t\t\t\t\tif (!tmp) return false;\n\t\t\t\t}\n\t\t\t\tif (!bar.has(tmp)) return false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tif (ctor === Map) {\n\t\t\tif (foo.size !== bar.size) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tfor (len of foo) {\n\t\t\t\ttmp = len[0];\n\t\t\t\tif (tmp && typeof tmp === 'object') {\n\t\t\t\t\ttmp = find(bar, tmp);\n\t\t\t\t\tif (!tmp) return false;\n\t\t\t\t}\n\t\t\t\tif (!dequal(len[1], bar.get(tmp))) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tif (ctor === ArrayBuffer) {\n\t\t\tfoo = new Uint8Array(foo);\n\t\t\tbar = new Uint8Array(bar);\n\t\t} else if (ctor === DataView) {\n\t\t\tif ((len=foo.byteLength) === bar.byteLength) {\n\t\t\t\twhile (len-- && foo.getInt8(len) === bar.getInt8(len));\n\t\t\t}\n\t\t\treturn len === -1;\n\t\t}\n\n\t\tif (ArrayBuffer.isView(foo)) {\n\t\t\tif ((len=foo.byteLength) === bar.byteLength) {\n\t\t\t\twhile (len-- && foo[len] === bar[len]);\n\t\t\t}\n\t\t\treturn len === -1;\n\t\t}\n\n\t\tif (!ctor || typeof foo === 'object') {\n\t\t\tlen = 0;\n\t\t\tfor (ctor in foo) {\n\t\t\t\tif (has.call(foo, ctor) && ++len && !has.call(bar, ctor)) return false;\n\t\t\t\tif (!(ctor in bar) || !dequal(foo[ctor], bar[ctor])) return false;\n\t\t\t}\n\t\t\treturn Object.keys(bar).length === len;\n\t\t}\n\t}\n\n\treturn foo !== foo && bar !== bar;\n}\n","/* Copyright 2015 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport invariant from 'tiny-invariant';\nconst DEFAULT_LINK_REL = 'noopener noreferrer nofollow';\nexport default class LinkService {\n    constructor() {\n        this.externalLinkEnabled = true;\n        this.externalLinkRel = undefined;\n        this.externalLinkTarget = undefined;\n        this.isInPresentationMode = false;\n        this.pdfDocument = undefined;\n        this.pdfViewer = undefined;\n    }\n    setDocument(pdfDocument) {\n        this.pdfDocument = pdfDocument;\n    }\n    setViewer(pdfViewer) {\n        this.pdfViewer = pdfViewer;\n    }\n    setExternalLinkRel(externalLinkRel) {\n        this.externalLinkRel = externalLinkRel;\n    }\n    setExternalLinkTarget(externalLinkTarget) {\n        this.externalLinkTarget = externalLinkTarget;\n    }\n    setHistory() {\n        // Intentionally empty\n    }\n    get pagesCount() {\n        return this.pdfDocument ? this.pdfDocument.numPages : 0;\n    }\n    get page() {\n        invariant(this.pdfViewer, 'PDF viewer is not initialized.');\n        return this.pdfViewer.currentPageNumber || 0;\n    }\n    set page(value) {\n        invariant(this.pdfViewer, 'PDF viewer is not initialized.');\n        this.pdfViewer.currentPageNumber = value;\n    }\n    get rotation() {\n        return 0;\n    }\n    set rotation(_value) {\n        // Intentionally empty\n    }\n    goToDestination(dest) {\n        return new Promise((resolve) => {\n            invariant(this.pdfDocument, 'PDF document not loaded.');\n            invariant(dest, 'Destination is not specified.');\n            if (typeof dest === 'string') {\n                this.pdfDocument.getDestination(dest).then(resolve);\n            }\n            else if (Array.isArray(dest)) {\n                resolve(dest);\n            }\n            else {\n                dest.then(resolve);\n            }\n        }).then((explicitDest) => {\n            invariant(Array.isArray(explicitDest), `\"${explicitDest}\" is not a valid destination array.`);\n            const destRef = explicitDest[0];\n            new Promise((resolve) => {\n                invariant(this.pdfDocument, 'PDF document not loaded.');\n                if (destRef instanceof Object) {\n                    this.pdfDocument\n                        .getPageIndex(destRef)\n                        .then((pageIndex) => {\n                        resolve(pageIndex);\n                    })\n                        .catch(() => {\n                        invariant(false, `\"${destRef}\" is not a valid page reference.`);\n                    });\n                }\n                else if (typeof destRef === 'number') {\n                    resolve(destRef);\n                }\n                else {\n                    invariant(false, `\"${destRef}\" is not a valid destination reference.`);\n                }\n            }).then((pageIndex) => {\n                const pageNumber = pageIndex + 1;\n                invariant(this.pdfViewer, 'PDF viewer is not initialized.');\n                invariant(pageNumber >= 1 && pageNumber <= this.pagesCount, `\"${pageNumber}\" is not a valid page number.`);\n                this.pdfViewer.scrollPageIntoView({\n                    dest: explicitDest,\n                    pageIndex,\n                    pageNumber,\n                });\n            });\n        });\n    }\n    navigateTo(dest) {\n        this.goToDestination(dest);\n    }\n    goToPage(pageNumber) {\n        const pageIndex = pageNumber - 1;\n        invariant(this.pdfViewer, 'PDF viewer is not initialized.');\n        invariant(pageNumber >= 1 && pageNumber <= this.pagesCount, `\"${pageNumber}\" is not a valid page number.`);\n        this.pdfViewer.scrollPageIntoView({\n            pageIndex,\n            pageNumber,\n        });\n    }\n    addLinkAttributes(link, url, newWindow) {\n        link.href = url;\n        link.rel = this.externalLinkRel || DEFAULT_LINK_REL;\n        link.target = newWindow ? '_blank' : this.externalLinkTarget || '';\n    }\n    getDestinationHash() {\n        return '#';\n    }\n    getAnchorUrl() {\n        return '#';\n    }\n    setHash() {\n        // Intentionally empty\n    }\n    executeNamedAction() {\n        // Intentionally empty\n    }\n    cachePageRef() {\n        // Intentionally empty\n    }\n    isPageVisible() {\n        return true;\n    }\n    isPageCached() {\n        return true;\n    }\n    executeSetOCGState() {\n        // Intentionally empty\n    }\n}\n","// As defined in https://github.com/mozilla/pdf.js/blob/d9fac3459609a807be6506fb3441b5da4b154d14/src/shared/util.js#L371-L374\nconst PasswordResponses = {\n    NEED_PASSWORD: 1,\n    INCORRECT_PASSWORD: 2,\n};\nexport default PasswordResponses;\n","'use client';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { forwardRef, useCallback, useEffect, useImperativeHandle, useMemo, useRef } from 'react';\nimport clsx from 'clsx';\nimport { dequal } from 'dequal';\nimport makeCancellable from 'make-cancellable-promise';\nimport makeEventProps from 'make-event-props';\nimport * as pdfjs from 'pdfjs-dist';\nimport invariant from 'tiny-invariant';\nimport warning from 'warning';\nimport DocumentContext from './DocumentContext.js';\nimport LinkService from './LinkService.js';\nimport Message from './Message.js';\nimport PasswordResponses from './PasswordResponses.js';\nimport useResolver from './shared/hooks/useResolver.js';\nimport { cancelRunningTask, dataURItoByteString, displayCORSWarning, isArrayBuffer, isBlob, isBrowser, isDataURI, loadFromFile, } from './shared/utils.js';\nconst { PDFDataRangeTransport } = pdfjs;\nconst defaultOnPassword = (callback, reason) => {\n    switch (reason) {\n        case PasswordResponses.NEED_PASSWORD: {\n            const password = prompt('Enter the password to open this PDF file.');\n            callback(password);\n            break;\n        }\n        case PasswordResponses.INCORRECT_PASSWORD: {\n            const password = prompt('Invalid password. Please try again.');\n            callback(password);\n            break;\n        }\n        default:\n    }\n};\nfunction isParameterObject(file) {\n    return (typeof file === 'object' &&\n        file !== null &&\n        ('data' in file || 'range' in file || 'url' in file));\n}\n/**\n * Loads a document passed using `file` prop.\n */\nconst Document = forwardRef(function Document({ children, className, error = 'Failed to load PDF file.', externalLinkRel, externalLinkTarget, file, inputRef, imageResourcesPath, loading = 'Loading PDF', noData = 'No PDF file specified.', onItemClick, onLoadError: onLoadErrorProps, onLoadProgress, onLoadSuccess: onLoadSuccessProps, onPassword = defaultOnPassword, onSourceError: onSourceErrorProps, onSourceSuccess: onSourceSuccessProps, options, renderMode, rotate, scale, ...otherProps }, ref) {\n    const [sourceState, sourceDispatch] = useResolver();\n    const { value: source, error: sourceError } = sourceState;\n    const [pdfState, pdfDispatch] = useResolver();\n    const { value: pdf, error: pdfError } = pdfState;\n    const linkService = useRef(new LinkService());\n    const pages = useRef([]);\n    const prevFile = useRef(undefined);\n    const prevOptions = useRef(undefined);\n    if (file && file !== prevFile.current && isParameterObject(file)) {\n        warning(!dequal(file, prevFile.current), `File prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to \"file\" prop.`);\n        prevFile.current = file;\n    }\n    // Detect non-memoized changes in options prop\n    if (options && options !== prevOptions.current) {\n        warning(!dequal(options, prevOptions.current), `Options prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to \"options\" prop.`);\n        prevOptions.current = options;\n    }\n    const viewer = useRef({\n        // Handling jumping to internal links target\n        scrollPageIntoView: (args) => {\n            const { dest, pageNumber, pageIndex = pageNumber - 1 } = args;\n            // First, check if custom handling of onItemClick was provided\n            if (onItemClick) {\n                onItemClick({ dest, pageIndex, pageNumber });\n                return;\n            }\n            // If not, try to look for target page within the <Document>.\n            const page = pages.current[pageIndex];\n            if (page) {\n                // Scroll to the page automatically\n                page.scrollIntoView();\n                return;\n            }\n            warning(false, `An internal link leading to page ${pageNumber} was clicked, but neither <Document> was provided with onItemClick nor it was able to find the page within itself. Either provide onItemClick to <Document> and handle navigating by yourself or ensure that all pages are rendered within <Document>.`);\n        },\n    });\n    useImperativeHandle(ref, () => ({\n        linkService,\n        pages,\n        viewer,\n    }), []);\n    /**\n     * Called when a document source is resolved correctly\n     */\n    function onSourceSuccess() {\n        if (onSourceSuccessProps) {\n            onSourceSuccessProps();\n        }\n    }\n    /**\n     * Called when a document source failed to be resolved correctly\n     */\n    function onSourceError() {\n        if (!sourceError) {\n            // Impossible, but TypeScript doesn't know that\n            return;\n        }\n        warning(false, sourceError.toString());\n        if (onSourceErrorProps) {\n            onSourceErrorProps(sourceError);\n        }\n    }\n    function resetSource() {\n        sourceDispatch({ type: 'RESET' });\n    }\n    // biome-ignore lint/correctness/useExhaustiveDependencies: See https://github.com/biomejs/biome/issues/3080\n    useEffect(resetSource, [file, sourceDispatch]);\n    const findDocumentSource = useCallback(async () => {\n        if (!file) {\n            return null;\n        }\n        // File is a string\n        if (typeof file === 'string') {\n            if (isDataURI(file)) {\n                const fileByteString = dataURItoByteString(file);\n                return { data: fileByteString };\n            }\n            displayCORSWarning();\n            return { url: file };\n        }\n        // File is PDFDataRangeTransport\n        if (file instanceof PDFDataRangeTransport) {\n            return { range: file };\n        }\n        // File is an ArrayBuffer\n        if (isArrayBuffer(file)) {\n            return { data: file };\n        }\n        /**\n         * The cases below are browser-only.\n         * If you're running on a non-browser environment, these cases will be of no use.\n         */\n        if (isBrowser) {\n            // File is a Blob\n            if (isBlob(file)) {\n                const data = await loadFromFile(file);\n                return { data };\n            }\n        }\n        // At this point, file must be an object\n        invariant(typeof file === 'object', 'Invalid parameter in file, need either Uint8Array, string or a parameter object');\n        invariant(isParameterObject(file), 'Invalid parameter object: need either .data, .range or .url');\n        // File .url is a string\n        if ('url' in file && typeof file.url === 'string') {\n            if (isDataURI(file.url)) {\n                const { url, ...otherParams } = file;\n                const fileByteString = dataURItoByteString(url);\n                return { data: fileByteString, ...otherParams };\n            }\n            displayCORSWarning();\n        }\n        return file;\n    }, [file]);\n    useEffect(() => {\n        const cancellable = makeCancellable(findDocumentSource());\n        cancellable.promise\n            .then((nextSource) => {\n            sourceDispatch({ type: 'RESOLVE', value: nextSource });\n        })\n            .catch((error) => {\n            sourceDispatch({ type: 'REJECT', error });\n        });\n        return () => {\n            cancelRunningTask(cancellable);\n        };\n    }, [findDocumentSource, sourceDispatch]);\n    // biome-ignore lint/correctness/useExhaustiveDependencies: Omitted callbacks so they are not called every time they change\n    useEffect(() => {\n        if (typeof source === 'undefined') {\n            return;\n        }\n        if (source === false) {\n            onSourceError();\n            return;\n        }\n        onSourceSuccess();\n    }, [source]);\n    /**\n     * Called when a document is read successfully\n     */\n    function onLoadSuccess() {\n        if (!pdf) {\n            // Impossible, but TypeScript doesn't know that\n            return;\n        }\n        if (onLoadSuccessProps) {\n            onLoadSuccessProps(pdf);\n        }\n        pages.current = new Array(pdf.numPages);\n        linkService.current.setDocument(pdf);\n    }\n    /**\n     * Called when a document failed to read successfully\n     */\n    function onLoadError() {\n        if (!pdfError) {\n            // Impossible, but TypeScript doesn't know that\n            return;\n        }\n        warning(false, pdfError.toString());\n        if (onLoadErrorProps) {\n            onLoadErrorProps(pdfError);\n        }\n    }\n    // biome-ignore lint/correctness/useExhaustiveDependencies: useEffect intentionally triggered on source change\n    useEffect(function resetDocument() {\n        pdfDispatch({ type: 'RESET' });\n    }, [pdfDispatch, source]);\n    // biome-ignore lint/correctness/useExhaustiveDependencies: Omitted callbacks so they are not called every time they change\n    useEffect(function loadDocument() {\n        if (!source) {\n            return;\n        }\n        const documentInitParams = options\n            ? { ...source, ...options }\n            : source;\n        const destroyable = pdfjs.getDocument(documentInitParams);\n        if (onLoadProgress) {\n            destroyable.onProgress = onLoadProgress;\n        }\n        if (onPassword) {\n            destroyable.onPassword = onPassword;\n        }\n        const loadingTask = destroyable;\n        const loadingPromise = loadingTask.promise\n            .then((nextPdf) => {\n            pdfDispatch({ type: 'RESOLVE', value: nextPdf });\n        })\n            .catch((error) => {\n            if (loadingTask.destroyed) {\n                return;\n            }\n            pdfDispatch({ type: 'REJECT', error });\n        });\n        return () => {\n            loadingPromise.finally(() => loadingTask.destroy());\n        };\n    }, [options, pdfDispatch, source]);\n    // biome-ignore lint/correctness/useExhaustiveDependencies: Omitted callbacks so they are not called every time they change\n    useEffect(() => {\n        if (typeof pdf === 'undefined') {\n            return;\n        }\n        if (pdf === false) {\n            onLoadError();\n            return;\n        }\n        onLoadSuccess();\n    }, [pdf]);\n    useEffect(function setupLinkService() {\n        linkService.current.setViewer(viewer.current);\n        linkService.current.setExternalLinkRel(externalLinkRel);\n        linkService.current.setExternalLinkTarget(externalLinkTarget);\n    }, [externalLinkRel, externalLinkTarget]);\n    const registerPage = useCallback((pageIndex, ref) => {\n        pages.current[pageIndex] = ref;\n    }, []);\n    const unregisterPage = useCallback((pageIndex) => {\n        delete pages.current[pageIndex];\n    }, []);\n    const childContext = useMemo(() => ({\n        imageResourcesPath,\n        linkService: linkService.current,\n        onItemClick,\n        pdf,\n        registerPage,\n        renderMode,\n        rotate,\n        scale,\n        unregisterPage,\n    }), [imageResourcesPath, onItemClick, pdf, registerPage, renderMode, rotate, scale, unregisterPage]);\n    const eventProps = useMemo(() => makeEventProps(otherProps, () => pdf), \n    // biome-ignore lint/correctness/useExhaustiveDependencies: FIXME\n    [otherProps, pdf]);\n    function renderChildren() {\n        function isFulfilledContext(context) {\n            return Boolean(context === null || context === void 0 ? void 0 : context.pdf);\n        }\n        if (!isFulfilledContext(childContext)) {\n            // Impossible, but TypeScript doesn't know that\n            throw new Error('pdf is undefined');\n        }\n        const resolvedChildren = typeof children === 'function' ? children(childContext) : children;\n        return (_jsx(DocumentContext.Provider, { value: childContext, children: resolvedChildren }));\n    }\n    function renderContent() {\n        if (!file) {\n            return _jsx(Message, { type: \"no-data\", children: typeof noData === 'function' ? noData() : noData });\n        }\n        if (pdf === undefined || pdf === null) {\n            return (_jsx(Message, { type: \"loading\", children: typeof loading === 'function' ? loading() : loading }));\n        }\n        if (pdf === false) {\n            return _jsx(Message, { type: \"error\", children: typeof error === 'function' ? error() : error });\n        }\n        return renderChildren();\n    }\n    return (_jsx(\"div\", { className: clsx('react-pdf__Document', className), \n        // Assertion is needed for React 18 compatibility\n        ref: inputRef, ...eventProps, children: renderContent() }));\n});\nexport default Document;\n","export default function makeCancellablePromise(promise) {\n    let isCancelled = false;\n    const wrappedPromise = new Promise((resolve, reject) => {\n        promise\n            .then((value) => !isCancelled && resolve(value))\n            .catch((error) => !isCancelled && reject(error));\n    });\n    return {\n        promise: wrappedPromise,\n        cancel() {\n            isCancelled = true;\n        },\n    };\n}\n","/**\n * A function that merges React refs into one.\n * Supports both functions and ref objects created using createRef() and useRef().\n *\n * Usage:\n * ```tsx\n * <div ref={mergeRefs(ref1, ref2, ref3)} />\n * ```\n *\n * @param {(React.Ref<T> | undefined)[]} inputRefs Array of refs\n * @returns {React.Ref<T> | React.RefCallback<T>} Merged refs\n */\nexport default function mergeRefs() {\n    var inputRefs = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        inputRefs[_i] = arguments[_i];\n    }\n    var filteredInputRefs = inputRefs.filter(Boolean);\n    if (filteredInputRefs.length <= 1) {\n        var firstRef = filteredInputRefs[0];\n        return firstRef || null;\n    }\n    return function mergedRefs(ref) {\n        for (var _i = 0, filteredInputRefs_1 = filteredInputRefs; _i < filteredInputRefs_1.length; _i++) {\n            var inputRef = filteredInputRefs_1[_i];\n            if (typeof inputRef === 'function') {\n                inputRef(ref);\n            }\n            else if (inputRef) {\n                inputRef.current = ref;\n            }\n        }\n    };\n}\n","import { useContext } from 'react';\nimport DocumentContext from '../../DocumentContext.js';\nexport default function useDocumentContext() {\n    return useContext(DocumentContext);\n}\n","'use client';\nimport { createContext } from 'react';\nconst pageContext = createContext(null);\nexport default pageContext;\n","import { useContext } from 'react';\nimport PageContext from '../../PageContext.js';\nexport default function usePageContext() {\n    return useContext(PageContext);\n}\n","'use client';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useEffect, useMemo, useRef } from 'react';\nimport clsx from 'clsx';\nimport makeCancellable from 'make-cancellable-promise';\nimport * as pdfjs from 'pdfjs-dist';\nimport invariant from 'tiny-invariant';\nimport warning from 'warning';\nimport useDocumentContext from '../shared/hooks/useDocumentContext.js';\nimport usePageContext from '../shared/hooks/usePageContext.js';\nimport useResolver from '../shared/hooks/useResolver.js';\nimport { cancelRunningTask } from '../shared/utils.js';\nexport default function AnnotationLayer() {\n    const documentContext = useDocumentContext();\n    const pageContext = usePageContext();\n    invariant(pageContext, 'Unable to find Page context.');\n    const mergedProps = { ...documentContext, ...pageContext };\n    const { imageResourcesPath, linkService, onGetAnnotationsError: onGetAnnotationsErrorProps, onGetAnnotationsSuccess: onGetAnnotationsSuccessProps, onRenderAnnotationLayerError: onRenderAnnotationLayerErrorProps, onRenderAnnotationLayerSuccess: onRenderAnnotationLayerSuccessProps, page, pdf, renderForms, rotate, scale = 1, } = mergedProps;\n    invariant(pdf, 'Attempted to load page annotations, but no document was specified. Wrap <Page /> in a <Document /> or pass explicit `pdf` prop.');\n    invariant(page, 'Attempted to load page annotations, but no page was specified.');\n    invariant(linkService, 'Attempted to load page annotations, but no linkService was specified.');\n    const [annotationsState, annotationsDispatch] = useResolver();\n    const { value: annotations, error: annotationsError } = annotationsState;\n    const layerElement = useRef(null);\n    warning(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue('--react-pdf-annotation-layer'), 10) === 1, 'AnnotationLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-annotations');\n    function onLoadSuccess() {\n        if (!annotations) {\n            // Impossible, but TypeScript doesn't know that\n            return;\n        }\n        if (onGetAnnotationsSuccessProps) {\n            onGetAnnotationsSuccessProps(annotations);\n        }\n    }\n    function onLoadError() {\n        if (!annotationsError) {\n            // Impossible, but TypeScript doesn't know that\n            return;\n        }\n        warning(false, annotationsError.toString());\n        if (onGetAnnotationsErrorProps) {\n            onGetAnnotationsErrorProps(annotationsError);\n        }\n    }\n    // biome-ignore lint/correctness/useExhaustiveDependencies: useEffect intentionally triggered on page change\n    useEffect(function resetAnnotations() {\n        annotationsDispatch({ type: 'RESET' });\n    }, [annotationsDispatch, page]);\n    useEffect(function loadAnnotations() {\n        if (!page) {\n            return;\n        }\n        const cancellable = makeCancellable(page.getAnnotations());\n        const runningTask = cancellable;\n        cancellable.promise\n            .then((nextAnnotations) => {\n            annotationsDispatch({ type: 'RESOLVE', value: nextAnnotations });\n        })\n            .catch((error) => {\n            annotationsDispatch({ type: 'REJECT', error });\n        });\n        return () => {\n            cancelRunningTask(runningTask);\n        };\n    }, [annotationsDispatch, page]);\n    // biome-ignore lint/correctness/useExhaustiveDependencies: Omitted callbacks so they are not called every time they change\n    useEffect(() => {\n        if (annotations === undefined) {\n            return;\n        }\n        if (annotations === false) {\n            onLoadError();\n            return;\n        }\n        onLoadSuccess();\n    }, [annotations]);\n    function onRenderSuccess() {\n        if (onRenderAnnotationLayerSuccessProps) {\n            onRenderAnnotationLayerSuccessProps();\n        }\n    }\n    function onRenderError(error) {\n        warning(false, `${error}`);\n        if (onRenderAnnotationLayerErrorProps) {\n            onRenderAnnotationLayerErrorProps(error);\n        }\n    }\n    const viewport = useMemo(() => page.getViewport({ scale, rotation: rotate }), [page, rotate, scale]);\n    // biome-ignore lint/correctness/useExhaustiveDependencies: Omitted callbacks so they are not called every time they change\n    useEffect(function renderAnnotationLayer() {\n        if (!pdf || !page || !linkService || !annotations) {\n            return;\n        }\n        const { current: layer } = layerElement;\n        if (!layer) {\n            return;\n        }\n        const clonedViewport = viewport.clone({ dontFlip: true });\n        const annotationLayerParameters = {\n            accessibilityManager: null, // TODO: Implement this\n            annotationCanvasMap: null, // TODO: Implement this\n            annotationEditorUIManager: null, // TODO: Implement this\n            div: layer,\n            l10n: null, // TODO: Implement this\n            page,\n            structTreeLayer: null, // TODO: Implement this\n            viewport: clonedViewport,\n        };\n        const renderParameters = {\n            annotations,\n            annotationStorage: pdf.annotationStorage,\n            div: layer,\n            imageResourcesPath,\n            linkService,\n            page,\n            renderForms,\n            viewport: clonedViewport,\n        };\n        layer.innerHTML = '';\n        try {\n            new pdfjs.AnnotationLayer(annotationLayerParameters).render(renderParameters);\n            // Intentional immediate callback\n            onRenderSuccess();\n        }\n        catch (error) {\n            onRenderError(error);\n        }\n        return () => {\n            // TODO: Cancel running task?\n        };\n    }, [annotations, imageResourcesPath, linkService, page, pdf, renderForms, viewport]);\n    return (_jsx(\"div\", { className: clsx('react-pdf__Page__annotations', 'annotationLayer'), ref: layerElement }));\n}\n","// From pdfjs-dist/lib/web/struct_tree_layer_builder.js\nexport const PDF_ROLE_TO_HTML_ROLE = {\n    // Document level structure types\n    Document: null, // There's a \"document\" role, but it doesn't make sense here.\n    DocumentFragment: null,\n    // Grouping level structure types\n    Part: 'group',\n    Sect: 'group', // XXX: There's a \"section\" role, but it's abstract.\n    Div: 'group',\n    Aside: 'note',\n    NonStruct: 'none',\n    // Block level structure types\n    P: null,\n    // H<n>,\n    H: 'heading',\n    Title: null,\n    FENote: 'note',\n    // Sub-block level structure type\n    Sub: 'group',\n    // General inline level structure types\n    Lbl: null,\n    Span: null,\n    Em: null,\n    Strong: null,\n    Link: 'link',\n    Annot: 'note',\n    Form: 'form',\n    // Ruby and Warichu structure types\n    Ruby: null,\n    RB: null,\n    RT: null,\n    RP: null,\n    Warichu: null,\n    WT: null,\n    WP: null,\n    // List standard structure types\n    L: 'list',\n    LI: 'listitem',\n    LBody: null,\n    // Table standard structure types\n    Table: 'table',\n    TR: 'row',\n    TH: 'columnheader',\n    TD: 'cell',\n    THead: 'columnheader',\n    TBody: null,\n    TFoot: null,\n    // Standard structure type Caption\n    Caption: null,\n    // Standard structure type Figure\n    Figure: 'figure',\n    // Standard structure type Formula\n    Formula: null,\n    // standard structure type Artifact\n    Artifact: null,\n};\nexport const HEADING_PATTERN = /^H(\\d+)$/;\n","import { HEADING_PATTERN, PDF_ROLE_TO_HTML_ROLE } from './constants.js';\nexport function isPdfRole(role) {\n    return role in PDF_ROLE_TO_HTML_ROLE;\n}\nexport function isStructTreeNode(node) {\n    return 'children' in node;\n}\nexport function isStructTreeNodeWithOnlyContentChild(node) {\n    if (!isStructTreeNode(node)) {\n        return false;\n    }\n    return node.children.length === 1 && 0 in node.children && 'id' in node.children[0];\n}\nexport function getRoleAttributes(node) {\n    const attributes = {};\n    if (isStructTreeNode(node)) {\n        const { role } = node;\n        const matches = role.match(HEADING_PATTERN);\n        if (matches) {\n            attributes.role = 'heading';\n            attributes['aria-level'] = Number(matches[1]);\n        }\n        else if (isPdfRole(role)) {\n            const htmlRole = PDF_ROLE_TO_HTML_ROLE[role];\n            if (htmlRole) {\n                attributes.role = htmlRole;\n            }\n        }\n    }\n    return attributes;\n}\nexport function getBaseAttributes(node) {\n    const attributes = {};\n    if (isStructTreeNode(node)) {\n        if (node.alt !== undefined) {\n            attributes['aria-label'] = node.alt;\n        }\n        if (node.lang !== undefined) {\n            attributes.lang = node.lang;\n        }\n        if (isStructTreeNodeWithOnlyContentChild(node)) {\n            const [child] = node.children;\n            if (child) {\n                const childAttributes = getBaseAttributes(child);\n                return {\n                    ...attributes,\n                    ...childAttributes,\n                };\n            }\n        }\n    }\n    else {\n        if ('id' in node) {\n            attributes['aria-owns'] = node.id;\n        }\n    }\n    return attributes;\n}\nexport function getAttributes(node) {\n    if (!node) {\n        return null;\n    }\n    return {\n        ...getRoleAttributes(node),\n        ...getBaseAttributes(node),\n    };\n}\n","import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useMemo } from 'react';\nimport { getAttributes, isStructTreeNode, isStructTreeNodeWithOnlyContentChild, } from './shared/structTreeUtils.js';\nexport default function StructTreeItem({ className, node, }) {\n    const attributes = useMemo(() => getAttributes(node), [node]);\n    const children = useMemo(() => {\n        if (!isStructTreeNode(node)) {\n            return null;\n        }\n        if (isStructTreeNodeWithOnlyContentChild(node)) {\n            return null;\n        }\n        return node.children.map((child, index) => {\n            return (\n            // biome-ignore lint/suspicious/noArrayIndexKey: index is stable here\n            _jsx(StructTreeItem, { node: child }, index));\n        });\n    }, [node]);\n    return (_jsx(\"span\", { className: className, ...attributes, children: children }));\n}\n","import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useEffect } from 'react';\nimport makeCancellable from 'make-cancellable-promise';\nimport invariant from 'tiny-invariant';\nimport warning from 'warning';\nimport StructTreeItem from './StructTreeItem.js';\nimport usePageContext from './shared/hooks/usePageContext.js';\nimport useResolver from './shared/hooks/useResolver.js';\nimport { cancelRunningTask } from './shared/utils.js';\nexport default function StructTree() {\n    const pageContext = usePageContext();\n    invariant(pageContext, 'Unable to find Page context.');\n    const { onGetStructTreeError: onGetStructTreeErrorProps, onGetStructTreeSuccess: onGetStructTreeSuccessProps, } = pageContext;\n    const [structTreeState, structTreeDispatch] = useResolver();\n    const { value: structTree, error: structTreeError } = structTreeState;\n    const { customTextRenderer, page } = pageContext;\n    function onLoadSuccess() {\n        if (!structTree) {\n            // Impossible, but TypeScript doesn't know that\n            return;\n        }\n        if (onGetStructTreeSuccessProps) {\n            onGetStructTreeSuccessProps(structTree);\n        }\n    }\n    function onLoadError() {\n        if (!structTreeError) {\n            // Impossible, but TypeScript doesn't know that\n            return;\n        }\n        warning(false, structTreeError.toString());\n        if (onGetStructTreeErrorProps) {\n            onGetStructTreeErrorProps(structTreeError);\n        }\n    }\n    // biome-ignore lint/correctness/useExhaustiveDependencies: useEffect intentionally triggered on page change\n    useEffect(function resetStructTree() {\n        structTreeDispatch({ type: 'RESET' });\n    }, [structTreeDispatch, page]);\n    useEffect(function loadStructTree() {\n        if (customTextRenderer) {\n            // TODO: Document why this is necessary\n            return;\n        }\n        if (!page) {\n            return;\n        }\n        const cancellable = makeCancellable(page.getStructTree());\n        const runningTask = cancellable;\n        cancellable.promise\n            .then((nextStructTree) => {\n            structTreeDispatch({ type: 'RESOLVE', value: nextStructTree });\n        })\n            .catch((error) => {\n            structTreeDispatch({ type: 'REJECT', error });\n        });\n        return () => cancelRunningTask(runningTask);\n    }, [customTextRenderer, page, structTreeDispatch]);\n    // biome-ignore lint/correctness/useExhaustiveDependencies: Omitted callbacks so they are not called every time they change\n    useEffect(() => {\n        if (structTree === undefined) {\n            return;\n        }\n        if (structTree === false) {\n            onLoadError();\n            return;\n        }\n        onLoadSuccess();\n    }, [structTree]);\n    if (!structTree) {\n        return null;\n    }\n    return _jsx(StructTreeItem, { className: \"react-pdf__Page__structTree structTree\", node: structTree });\n}\n","'use client';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useCallback, useEffect, useMemo, useRef } from 'react';\nimport mergeRefs from 'merge-refs';\nimport * as pdfjs from 'pdfjs-dist';\nimport invariant from 'tiny-invariant';\nimport warning from 'warning';\nimport StructTree from '../StructTree.js';\nimport usePageContext from '../shared/hooks/usePageContext.js';\nimport { cancelRunningTask, getDevicePixelRatio, isCancelException, makePageCallback, } from '../shared/utils.js';\nconst ANNOTATION_MODE = pdfjs.AnnotationMode;\nexport default function Canvas(props) {\n    const pageContext = usePageContext();\n    invariant(pageContext, 'Unable to find Page context.');\n    const mergedProps = { ...pageContext, ...props };\n    const { _className, canvasBackground, devicePixelRatio = getDevicePixelRatio(), onRenderError: onRenderErrorProps, onRenderSuccess: onRenderSuccessProps, page, renderForms, renderTextLayer, rotate, scale, } = mergedProps;\n    const { canvasRef } = props;\n    invariant(page, 'Attempted to render page canvas, but no page was specified.');\n    const canvasElement = useRef(null);\n    /**\n     * Called when a page is rendered successfully.\n     */\n    function onRenderSuccess() {\n        if (!page) {\n            // Impossible, but TypeScript doesn't know that\n            return;\n        }\n        if (onRenderSuccessProps) {\n            onRenderSuccessProps(makePageCallback(page, scale));\n        }\n    }\n    /**\n     * Called when a page fails to render.\n     */\n    function onRenderError(error) {\n        if (isCancelException(error)) {\n            return;\n        }\n        warning(false, error.toString());\n        if (onRenderErrorProps) {\n            onRenderErrorProps(error);\n        }\n    }\n    const renderViewport = useMemo(() => page.getViewport({ scale: scale * devicePixelRatio, rotation: rotate }), [devicePixelRatio, page, rotate, scale]);\n    const viewport = useMemo(() => page.getViewport({ scale, rotation: rotate }), [page, rotate, scale]);\n    // biome-ignore lint/correctness/useExhaustiveDependencies: Omitted callbacks so they are not called every time they change\n    useEffect(function drawPageOnCanvas() {\n        if (!page) {\n            return;\n        }\n        // Ensures the canvas will be re-rendered from scratch. Otherwise all form data will stay.\n        page.cleanup();\n        const { current: canvas } = canvasElement;\n        if (!canvas) {\n            return;\n        }\n        canvas.width = renderViewport.width;\n        canvas.height = renderViewport.height;\n        canvas.style.width = `${Math.floor(viewport.width)}px`;\n        canvas.style.height = `${Math.floor(viewport.height)}px`;\n        canvas.style.visibility = 'hidden';\n        const renderContext = {\n            annotationMode: renderForms ? ANNOTATION_MODE.ENABLE_FORMS : ANNOTATION_MODE.ENABLE,\n            canvasContext: canvas.getContext('2d', { alpha: false }),\n            viewport: renderViewport,\n        };\n        if (canvasBackground) {\n            renderContext.background = canvasBackground;\n        }\n        const cancellable = page.render(renderContext);\n        const runningTask = cancellable;\n        cancellable.promise\n            .then(() => {\n            canvas.style.visibility = '';\n            onRenderSuccess();\n        })\n            .catch(onRenderError);\n        return () => cancelRunningTask(runningTask);\n    }, [canvasBackground, page, renderForms, renderViewport, viewport]);\n    const cleanup = useCallback(() => {\n        const { current: canvas } = canvasElement;\n        /**\n         * Zeroing the width and height cause most browsers to release graphics\n         * resources immediately, which can greatly reduce memory consumption.\n         */\n        if (canvas) {\n            canvas.width = 0;\n            canvas.height = 0;\n        }\n    }, []);\n    useEffect(() => cleanup, [cleanup]);\n    return (_jsx(\"canvas\", { className: `${_className}__canvas`, dir: \"ltr\", ref: mergeRefs(canvasRef, canvasElement), style: {\n            display: 'block',\n            userSelect: 'none',\n        }, children: renderTextLayer ? _jsx(StructTree, {}) : null }));\n}\n","'use client';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useCallback, useEffect, useLayoutEffect, useMemo, useRef } from 'react';\nimport clsx from 'clsx';\nimport makeCancellable from 'make-cancellable-promise';\nimport * as pdfjs from 'pdfjs-dist';\nimport invariant from 'tiny-invariant';\nimport warning from 'warning';\nimport usePageContext from '../shared/hooks/usePageContext.js';\nimport useResolver from '../shared/hooks/useResolver.js';\nimport { cancelRunningTask } from '../shared/utils.js';\nfunction isTextItem(item) {\n    return 'str' in item;\n}\nexport default function TextLayer() {\n    const pageContext = usePageContext();\n    invariant(pageContext, 'Unable to find Page context.');\n    const { customTextRenderer, onGetTextError, onGetTextSuccess, onRenderTextLayerError, onRenderTextLayerSuccess, page, pageIndex, pageNumber, rotate, scale, } = pageContext;\n    invariant(page, 'Attempted to load page text content, but no page was specified.');\n    const [textContentState, textContentDispatch] = useResolver();\n    const { value: textContent, error: textContentError } = textContentState;\n    const layerElement = useRef(null);\n    warning(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue('--react-pdf-text-layer'), 10) === 1, 'TextLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-text-layer');\n    /**\n     * Called when a page text content is read successfully\n     */\n    function onLoadSuccess() {\n        if (!textContent) {\n            // Impossible, but TypeScript doesn't know that\n            return;\n        }\n        if (onGetTextSuccess) {\n            onGetTextSuccess(textContent);\n        }\n    }\n    /**\n     * Called when a page text content failed to read successfully\n     */\n    function onLoadError() {\n        if (!textContentError) {\n            // Impossible, but TypeScript doesn't know that\n            return;\n        }\n        warning(false, textContentError.toString());\n        if (onGetTextError) {\n            onGetTextError(textContentError);\n        }\n    }\n    // biome-ignore lint/correctness/useExhaustiveDependencies: useEffect intentionally triggered on page change\n    useEffect(function resetTextContent() {\n        textContentDispatch({ type: 'RESET' });\n    }, [page, textContentDispatch]);\n    useEffect(function loadTextContent() {\n        if (!page) {\n            return;\n        }\n        const cancellable = makeCancellable(page.getTextContent());\n        const runningTask = cancellable;\n        cancellable.promise\n            .then((nextTextContent) => {\n            textContentDispatch({ type: 'RESOLVE', value: nextTextContent });\n        })\n            .catch((error) => {\n            textContentDispatch({ type: 'REJECT', error });\n        });\n        return () => cancelRunningTask(runningTask);\n    }, [page, textContentDispatch]);\n    // biome-ignore lint/correctness/useExhaustiveDependencies: Omitted callbacks so they are not called every time they change\n    useEffect(() => {\n        if (textContent === undefined) {\n            return;\n        }\n        if (textContent === false) {\n            onLoadError();\n            return;\n        }\n        onLoadSuccess();\n    }, [textContent]);\n    /**\n     * Called when a text layer is rendered successfully\n     */\n    const onRenderSuccess = useCallback(() => {\n        if (onRenderTextLayerSuccess) {\n            onRenderTextLayerSuccess();\n        }\n    }, [onRenderTextLayerSuccess]);\n    /**\n     * Called when a text layer failed to render successfully\n     */\n    const onRenderError = useCallback((error) => {\n        warning(false, error.toString());\n        if (onRenderTextLayerError) {\n            onRenderTextLayerError(error);\n        }\n    }, [onRenderTextLayerError]);\n    function onMouseDown() {\n        const layer = layerElement.current;\n        if (!layer) {\n            return;\n        }\n        layer.classList.add('selecting');\n    }\n    function onMouseUp() {\n        const layer = layerElement.current;\n        if (!layer) {\n            return;\n        }\n        layer.classList.remove('selecting');\n    }\n    const viewport = useMemo(() => page.getViewport({ scale, rotation: rotate }), [page, rotate, scale]);\n    useLayoutEffect(function renderTextLayer() {\n        if (!page || !textContent) {\n            return;\n        }\n        const { current: layer } = layerElement;\n        if (!layer) {\n            return;\n        }\n        layer.innerHTML = '';\n        const textContentSource = page.streamTextContent({ includeMarkedContent: true });\n        const parameters = {\n            container: layer,\n            textContentSource,\n            viewport,\n        };\n        const cancellable = new pdfjs.TextLayer(parameters);\n        const runningTask = cancellable;\n        cancellable\n            .render()\n            .then(() => {\n            const end = document.createElement('div');\n            end.className = 'endOfContent';\n            layer.append(end);\n            const layerChildren = layer.querySelectorAll('[role=\"presentation\"]');\n            if (customTextRenderer) {\n                let index = 0;\n                textContent.items.forEach((item, itemIndex) => {\n                    if (!isTextItem(item)) {\n                        return;\n                    }\n                    const child = layerChildren[index];\n                    if (!child) {\n                        return;\n                    }\n                    const content = customTextRenderer({\n                        pageIndex,\n                        pageNumber,\n                        itemIndex,\n                        ...item,\n                    });\n                    child.innerHTML = content;\n                    index += item.str && item.hasEOL ? 2 : 1;\n                });\n            }\n            // Intentional immediate callback\n            onRenderSuccess();\n        })\n            .catch(onRenderError);\n        return () => cancelRunningTask(runningTask);\n    }, [\n        customTextRenderer,\n        onRenderError,\n        onRenderSuccess,\n        page,\n        pageIndex,\n        pageNumber,\n        textContent,\n        viewport,\n    ]);\n    return (\n    // biome-ignore lint/a11y/noStaticElementInteractions: False positive caused by non interactive wrapper listening for bubbling events\n    _jsx(\"div\", { className: clsx('react-pdf__Page__textContent', 'textLayer'), onMouseUp: onMouseUp, onMouseDown: onMouseDown, ref: layerElement }));\n}\n","'use client';\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { useEffect, useMemo, useRef } from 'react';\nimport clsx from 'clsx';\nimport makeCancellable from 'make-cancellable-promise';\nimport makeEventProps from 'make-event-props';\nimport mergeRefs from 'merge-refs';\nimport invariant from 'tiny-invariant';\nimport warning from 'warning';\nimport Message from './Message.js';\nimport AnnotationLayer from './Page/AnnotationLayer.js';\nimport Canvas from './Page/Canvas.js';\nimport TextLayer from './Page/TextLayer.js';\nimport PageContext from './PageContext.js';\nimport useDocumentContext from './shared/hooks/useDocumentContext.js';\nimport useResolver from './shared/hooks/useResolver.js';\nimport { cancelRunningTask, isProvided, makePageCallback } from './shared/utils.js';\nconst defaultScale = 1;\n/**\n * Displays a page.\n *\n * Should be placed inside `<Document />`. Alternatively, it can have `pdf` prop passed, which can be obtained from `<Document />`'s `onLoadSuccess` callback function, however some advanced functions like linking between pages inside a document may not be working correctly.\n */\nexport default function Page(props) {\n    const documentContext = useDocumentContext();\n    const mergedProps = { ...documentContext, ...props };\n    const { _className = 'react-pdf__Page', _enableRegisterUnregisterPage = true, canvasBackground, canvasRef, children, className, customRenderer: CustomRenderer, customTextRenderer, devicePixelRatio, error = 'Failed to load the page.', height, inputRef, loading = 'Loading page', noData = 'No page specified.', onGetAnnotationsError: onGetAnnotationsErrorProps, onGetAnnotationsSuccess: onGetAnnotationsSuccessProps, onGetStructTreeError: onGetStructTreeErrorProps, onGetStructTreeSuccess: onGetStructTreeSuccessProps, onGetTextError: onGetTextErrorProps, onGetTextSuccess: onGetTextSuccessProps, onLoadError: onLoadErrorProps, onLoadSuccess: onLoadSuccessProps, onRenderAnnotationLayerError: onRenderAnnotationLayerErrorProps, onRenderAnnotationLayerSuccess: onRenderAnnotationLayerSuccessProps, onRenderError: onRenderErrorProps, onRenderSuccess: onRenderSuccessProps, onRenderTextLayerError: onRenderTextLayerErrorProps, onRenderTextLayerSuccess: onRenderTextLayerSuccessProps, pageIndex: pageIndexProps, pageNumber: pageNumberProps, pdf, registerPage, renderAnnotationLayer: renderAnnotationLayerProps = true, renderForms = false, renderMode = 'canvas', renderTextLayer: renderTextLayerProps = true, rotate: rotateProps, scale: scaleProps = defaultScale, unregisterPage, width, ...otherProps } = mergedProps;\n    const [pageState, pageDispatch] = useResolver();\n    const { value: page, error: pageError } = pageState;\n    const pageElement = useRef(null);\n    invariant(pdf, 'Attempted to load a page, but no document was specified. Wrap <Page /> in a <Document /> or pass explicit `pdf` prop.');\n    const pageIndex = isProvided(pageNumberProps) ? pageNumberProps - 1 : (pageIndexProps !== null && pageIndexProps !== void 0 ? pageIndexProps : null);\n    const pageNumber = pageNumberProps !== null && pageNumberProps !== void 0 ? pageNumberProps : (isProvided(pageIndexProps) ? pageIndexProps + 1 : null);\n    const rotate = rotateProps !== null && rotateProps !== void 0 ? rotateProps : (page ? page.rotate : null);\n    const scale = useMemo(() => {\n        if (!page) {\n            return null;\n        }\n        // Be default, we'll render page at 100% * scale width.\n        let pageScale = 1;\n        // Passing scale explicitly null would cause the page not to render\n        const scaleWithDefault = scaleProps !== null && scaleProps !== void 0 ? scaleProps : defaultScale;\n        // If width/height is defined, calculate the scale of the page so it could be of desired width.\n        if (width || height) {\n            const viewport = page.getViewport({ scale: 1, rotation: rotate });\n            if (width) {\n                pageScale = width / viewport.width;\n            }\n            else if (height) {\n                pageScale = height / viewport.height;\n            }\n        }\n        return scaleWithDefault * pageScale;\n    }, [height, page, rotate, scaleProps, width]);\n    // biome-ignore lint/correctness/useExhaustiveDependencies: useEffect intentionally triggered on pdf change\n    useEffect(function hook() {\n        return () => {\n            if (!isProvided(pageIndex)) {\n                // Impossible, but TypeScript doesn't know that\n                return;\n            }\n            if (_enableRegisterUnregisterPage && unregisterPage) {\n                unregisterPage(pageIndex);\n            }\n        };\n    }, [_enableRegisterUnregisterPage, pdf, pageIndex, unregisterPage]);\n    /**\n     * Called when a page is loaded successfully\n     */\n    function onLoadSuccess() {\n        if (onLoadSuccessProps) {\n            if (!page || !scale) {\n                // Impossible, but TypeScript doesn't know that\n                return;\n            }\n            onLoadSuccessProps(makePageCallback(page, scale));\n        }\n        if (_enableRegisterUnregisterPage && registerPage) {\n            if (!isProvided(pageIndex) || !pageElement.current) {\n                // Impossible, but TypeScript doesn't know that\n                return;\n            }\n            registerPage(pageIndex, pageElement.current);\n        }\n    }\n    /**\n     * Called when a page failed to load\n     */\n    function onLoadError() {\n        if (!pageError) {\n            // Impossible, but TypeScript doesn't know that\n            return;\n        }\n        warning(false, pageError.toString());\n        if (onLoadErrorProps) {\n            onLoadErrorProps(pageError);\n        }\n    }\n    // biome-ignore lint/correctness/useExhaustiveDependencies: useEffect intentionally triggered on pdf and pageIndex change\n    useEffect(function resetPage() {\n        pageDispatch({ type: 'RESET' });\n    }, [pageDispatch, pdf, pageIndex]);\n    useEffect(function loadPage() {\n        if (!pdf || !pageNumber) {\n            return;\n        }\n        const cancellable = makeCancellable(pdf.getPage(pageNumber));\n        const runningTask = cancellable;\n        cancellable.promise\n            .then((nextPage) => {\n            pageDispatch({ type: 'RESOLVE', value: nextPage });\n        })\n            .catch((error) => {\n            pageDispatch({ type: 'REJECT', error });\n        });\n        return () => cancelRunningTask(runningTask);\n    }, [pageDispatch, pdf, pageNumber]);\n    // biome-ignore lint/correctness/useExhaustiveDependencies: Omitted callbacks so they are not called every time they change\n    useEffect(() => {\n        if (page === undefined) {\n            return;\n        }\n        if (page === false) {\n            onLoadError();\n            return;\n        }\n        onLoadSuccess();\n    }, [page, scale]);\n    const childContext = useMemo(() => \n    // Technically there cannot be page without pageIndex, pageNumber, rotate and scale, but TypeScript doesn't know that\n    isProvided(pageIndex) && pageNumber && isProvided(rotate) && isProvided(scale)\n        ? {\n            _className,\n            canvasBackground,\n            customTextRenderer,\n            devicePixelRatio,\n            onGetAnnotationsError: onGetAnnotationsErrorProps,\n            onGetAnnotationsSuccess: onGetAnnotationsSuccessProps,\n            onGetStructTreeError: onGetStructTreeErrorProps,\n            onGetStructTreeSuccess: onGetStructTreeSuccessProps,\n            onGetTextError: onGetTextErrorProps,\n            onGetTextSuccess: onGetTextSuccessProps,\n            onRenderAnnotationLayerError: onRenderAnnotationLayerErrorProps,\n            onRenderAnnotationLayerSuccess: onRenderAnnotationLayerSuccessProps,\n            onRenderError: onRenderErrorProps,\n            onRenderSuccess: onRenderSuccessProps,\n            onRenderTextLayerError: onRenderTextLayerErrorProps,\n            onRenderTextLayerSuccess: onRenderTextLayerSuccessProps,\n            page,\n            pageIndex,\n            pageNumber,\n            renderForms,\n            renderTextLayer: renderTextLayerProps,\n            rotate,\n            scale,\n        }\n        : null, [\n        _className,\n        canvasBackground,\n        customTextRenderer,\n        devicePixelRatio,\n        onGetAnnotationsErrorProps,\n        onGetAnnotationsSuccessProps,\n        onGetStructTreeErrorProps,\n        onGetStructTreeSuccessProps,\n        onGetTextErrorProps,\n        onGetTextSuccessProps,\n        onRenderAnnotationLayerErrorProps,\n        onRenderAnnotationLayerSuccessProps,\n        onRenderErrorProps,\n        onRenderSuccessProps,\n        onRenderTextLayerErrorProps,\n        onRenderTextLayerSuccessProps,\n        page,\n        pageIndex,\n        pageNumber,\n        renderForms,\n        renderTextLayerProps,\n        rotate,\n        scale,\n    ]);\n    const eventProps = useMemo(() => makeEventProps(otherProps, () => page ? (scale ? makePageCallback(page, scale) : undefined) : page), \n    // biome-ignore lint/correctness/useExhaustiveDependencies: FIXME\n    [otherProps, page, scale]);\n    const pageKey = `${pageIndex}@${scale}/${rotate}`;\n    function renderMainLayer() {\n        switch (renderMode) {\n            case 'custom': {\n                invariant(CustomRenderer, `renderMode was set to \"custom\", but no customRenderer was passed.`);\n                return _jsx(CustomRenderer, {}, `${pageKey}_custom`);\n            }\n            case 'none':\n                return null;\n            case 'canvas':\n            default:\n                return _jsx(Canvas, { canvasRef: canvasRef }, `${pageKey}_canvas`);\n        }\n    }\n    function renderTextLayer() {\n        if (!renderTextLayerProps) {\n            return null;\n        }\n        return _jsx(TextLayer, {}, `${pageKey}_text`);\n    }\n    function renderAnnotationLayer() {\n        if (!renderAnnotationLayerProps) {\n            return null;\n        }\n        return _jsx(AnnotationLayer, {}, `${pageKey}_annotations`);\n    }\n    function renderChildren() {\n        function isFulfilledContext(context) {\n            return Boolean(context === null || context === void 0 ? void 0 : context.page);\n        }\n        if (!isFulfilledContext(childContext)) {\n            // Impossible, but TypeScript doesn't know that\n            throw new Error('page is undefined');\n        }\n        const resolvedChildren = typeof children === 'function' ? children(childContext) : children;\n        return (_jsxs(PageContext.Provider, { value: childContext, children: [renderMainLayer(), renderTextLayer(), renderAnnotationLayer(), resolvedChildren] }));\n    }\n    function renderContent() {\n        if (!pageNumber) {\n            return _jsx(Message, { type: \"no-data\", children: typeof noData === 'function' ? noData() : noData });\n        }\n        if (pdf === null || page === undefined || page === null) {\n            return (_jsx(Message, { type: \"loading\", children: typeof loading === 'function' ? loading() : loading }));\n        }\n        if (pdf === false || page === false) {\n            return _jsx(Message, { type: \"error\", children: typeof error === 'function' ? error() : error });\n        }\n        return renderChildren();\n    }\n    return (_jsx(\"div\", { className: clsx(_className, className), \"data-page-number\": pageNumber, \n        // Assertion is needed for React 18 compatibility\n        ref: mergeRefs(inputRef, pageElement), style: {\n            '--scale-round-x': '1px',\n            '--scale-round-y': '1px',\n            '--scale-factor': '1',\n            '--user-unit': `${scale}`,\n            '--total-scale-factor': 'calc(var(--scale-factor) * var(--user-unit))',\n            backgroundColor: canvasBackground || 'white',\n            position: 'relative',\n            minWidth: 'min-content',\n            minHeight: 'min-content',\n        }, ...eventProps, children: renderContent() }));\n}\n","import { useReducer } from 'react';\nfunction reducer(state, action) {\n    switch (action.type) {\n        case 'RESOLVE':\n            return { value: action.value, error: undefined };\n        case 'REJECT':\n            return { value: false, error: action.error };\n        case 'RESET':\n            return { value: undefined, error: undefined };\n        default:\n            return state;\n    }\n}\nexport default function useResolver() {\n    return useReducer((reducer), { value: undefined, error: undefined });\n}\n","// As defined on the list of supported events: https://reactjs.org/docs/events.html\nexport const clipboardEvents = ['onCopy', 'onCut', 'onPaste'];\nexport const compositionEvents = [\n    'onCompositionEnd',\n    'onCompositionStart',\n    'onCompositionUpdate',\n];\nexport const focusEvents = ['onFocus', 'onBlur'];\nexport const formEvents = ['onInput', 'onInvalid', 'onReset', 'onSubmit'];\nexport const imageEvents = ['onLoad', 'onError'];\nexport const keyboardEvents = ['onKeyDown', 'onKeyPress', 'onKeyUp'];\nexport const mediaEvents = [\n    'onAbort',\n    'onCanPlay',\n    'onCanPlayThrough',\n    'onDurationChange',\n    'onEmptied',\n    'onEncrypted',\n    'onEnded',\n    'onError',\n    'onLoadedData',\n    'onLoadedMetadata',\n    'onLoadStart',\n    'onPause',\n    'onPlay',\n    'onPlaying',\n    'onProgress',\n    'onRateChange',\n    'onSeeked',\n    'onSeeking',\n    'onStalled',\n    'onSuspend',\n    'onTimeUpdate',\n    'onVolumeChange',\n    'onWaiting',\n];\nexport const mouseEvents = [\n    'onClick',\n    'onContextMenu',\n    'onDoubleClick',\n    'onMouseDown',\n    'onMouseEnter',\n    'onMouseLeave',\n    'onMouseMove',\n    'onMouseOut',\n    'onMouseOver',\n    'onMouseUp',\n];\nexport const dragEvents = [\n    'onDrag',\n    'onDragEnd',\n    'onDragEnter',\n    'onDragExit',\n    'onDragLeave',\n    'onDragOver',\n    'onDragStart',\n    'onDrop',\n];\nexport const selectionEvents = ['onSelect'];\nexport const touchEvents = ['onTouchCancel', 'onTouchEnd', 'onTouchMove', 'onTouchStart'];\nexport const pointerEvents = [\n    'onPointerDown',\n    'onPointerMove',\n    'onPointerUp',\n    'onPointerCancel',\n    'onGotPointerCapture',\n    'onLostPointerCapture',\n    'onPointerEnter',\n    'onPointerLeave',\n    'onPointerOver',\n    'onPointerOut',\n];\nexport const uiEvents = ['onScroll'];\nexport const wheelEvents = ['onWheel'];\nexport const animationEvents = [\n    'onAnimationStart',\n    'onAnimationEnd',\n    'onAnimationIteration',\n];\nexport const transitionEvents = ['onTransitionEnd'];\nexport const otherEvents = ['onToggle'];\nexport const changeEvents = ['onChange'];\nexport const allEvents = [\n    ...clipboardEvents,\n    ...compositionEvents,\n    ...focusEvents,\n    ...formEvents,\n    ...imageEvents,\n    ...keyboardEvents,\n    ...mediaEvents,\n    ...mouseEvents,\n    ...dragEvents,\n    ...selectionEvents,\n    ...touchEvents,\n    ...pointerEvents,\n    ...uiEvents,\n    ...wheelEvents,\n    ...animationEvents,\n    ...transitionEvents,\n    ...changeEvents,\n    ...otherEvents,\n];\n/**\n * Returns an object with on-event callback props curried with provided args.\n *\n * @template ArgsType Type of arguments to curry on-event callbacks with.\n * @param {PropsType} props Props passed to a component.\n * @param {GetArgs<ArgsType>} [getArgs] A function that returns argument(s) on-event callbacks\n *   shall be curried with.\n */\nexport default function makeEventProps(props, getArgs) {\n    const eventProps = {};\n    for (const eventName of allEvents) {\n        const eventHandler = props[eventName];\n        if (!eventHandler) {\n            continue;\n        }\n        if (getArgs) {\n            eventProps[eventName] = ((event) => eventHandler(event, getArgs(eventName)));\n        }\n        else {\n            eventProps[eventName] = eventHandler;\n        }\n    }\n    return eventProps;\n}\n","'use client';\nimport { createContext } from 'react';\nconst documentContext = createContext(null);\nexport default documentContext;\n","function r(e){var t,f,n=\"\";if(\"string\"==typeof e||\"number\"==typeof e)n+=e;else if(\"object\"==typeof e)if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(f=r(e[t]))&&(n&&(n+=\" \"),n+=f)}else for(f in e)e[f]&&(n&&(n+=\" \"),n+=f);return n}export function clsx(){for(var e,t,f=0,n=\"\",o=arguments.length;f<o;f++)(e=arguments[f])&&(t=r(e))&&(n&&(n+=\" \"),n+=t);return n}export default clsx;","import invariant from 'tiny-invariant';\nimport warning from 'warning';\n/**\n * Checks if we're running in a browser environment.\n */\nexport const isBrowser = typeof window !== 'undefined';\n/**\n * Checks whether we're running from a local file system.\n */\nexport const isLocalFileSystem = isBrowser && window.location.protocol === 'file:';\n/**\n * Checks whether a variable is defined.\n *\n * @param {*} variable Variable to check\n */\nexport function isDefined(variable) {\n    return typeof variable !== 'undefined';\n}\n/**\n * Checks whether a variable is defined and not null.\n *\n * @param {*} variable Variable to check\n */\nexport function isProvided(variable) {\n    return isDefined(variable) && variable !== null;\n}\n/**\n * Checks whether a variable provided is a string.\n *\n * @param {*} variable Variable to check\n */\nexport function isString(variable) {\n    return typeof variable === 'string';\n}\n/**\n * Checks whether a variable provided is an ArrayBuffer.\n *\n * @param {*} variable Variable to check\n */\nexport function isArrayBuffer(variable) {\n    return variable instanceof ArrayBuffer;\n}\n/**\n * Checks whether a variable provided is a Blob.\n *\n * @param {*} variable Variable to check\n */\nexport function isBlob(variable) {\n    invariant(isBrowser, 'isBlob can only be used in a browser environment');\n    return variable instanceof Blob;\n}\n/**\n * Checks whether a variable provided is a data URI.\n *\n * @param {*} variable String to check\n */\nexport function isDataURI(variable) {\n    return isString(variable) && /^data:/.test(variable);\n}\nexport function dataURItoByteString(dataURI) {\n    invariant(isDataURI(dataURI), 'Invalid data URI.');\n    const [headersString = '', dataString = ''] = dataURI.split(',');\n    const headers = headersString.split(';');\n    if (headers.indexOf('base64') !== -1) {\n        return atob(dataString);\n    }\n    return unescape(dataString);\n}\nexport function getDevicePixelRatio() {\n    return (isBrowser && window.devicePixelRatio) || 1;\n}\nconst allowFileAccessFromFilesTip = 'On Chromium based browsers, you can use --allow-file-access-from-files flag for debugging purposes.';\nexport function displayCORSWarning() {\n    warning(!isLocalFileSystem, `Loading PDF as base64 strings/URLs may not work on protocols other than HTTP/HTTPS. ${allowFileAccessFromFilesTip}`);\n}\nexport function displayWorkerWarning() {\n    warning(!isLocalFileSystem, `Loading PDF.js worker may not work on protocols other than HTTP/HTTPS. ${allowFileAccessFromFilesTip}`);\n}\nexport function cancelRunningTask(runningTask) {\n    if (runningTask === null || runningTask === void 0 ? void 0 : runningTask.cancel)\n        runningTask.cancel();\n}\nexport function makePageCallback(page, scale) {\n    Object.defineProperty(page, 'width', {\n        get() {\n            return this.view[2] * scale;\n        },\n        configurable: true,\n    });\n    Object.defineProperty(page, 'height', {\n        get() {\n            return this.view[3] * scale;\n        },\n        configurable: true,\n    });\n    Object.defineProperty(page, 'originalWidth', {\n        get() {\n            return this.view[2];\n        },\n        configurable: true,\n    });\n    Object.defineProperty(page, 'originalHeight', {\n        get() {\n            return this.view[3];\n        },\n        configurable: true,\n    });\n    return page;\n}\nexport function isCancelException(error) {\n    return error.name === 'RenderingCancelledException';\n}\nexport function loadFromFile(file) {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = () => {\n            if (!reader.result) {\n                return reject(new Error('Error while reading a file.'));\n            }\n            resolve(reader.result);\n        };\n        reader.onerror = (event) => {\n            if (!event.target) {\n                return reject(new Error('Error while reading a file.'));\n            }\n            const { error } = event.target;\n            if (!error) {\n                return reject(new Error('Error while reading a file.'));\n            }\n            switch (error.code) {\n                case error.NOT_FOUND_ERR:\n                    return reject(new Error('Error while reading a file: File not found.'));\n                case error.SECURITY_ERR:\n                    return reject(new Error('Error while reading a file: Security error.'));\n                case error.ABORT_ERR:\n                    return reject(new Error('Error while reading a file: Aborted.'));\n                default:\n                    return reject(new Error('Error while reading a file.'));\n            }\n        };\n        reader.readAsArrayBuffer(file);\n    });\n}\n","import { jsx as _jsx } from \"react/jsx-runtime\";\nexport default function Message({ children, type }) {\n    return _jsx(\"div\", { className: `react-pdf__message react-pdf__message--${type}`, children: children });\n}\n","/**\n * Copyright (c) 2014-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\n/**\n * Similar to invariant but only logs a warning if the condition is not met.\n * This can be used to log issues in development environments in critical\n * paths. Removing the logging code for production environments will keep the\n * same logic and follow the same code paths.\n */\n\nvar __DEV__ = process.env.NODE_ENV !== 'production';\n\nvar warning = function() {};\n\nif (__DEV__) {\n  var printWarning = function printWarning(format, args) {\n    var len = arguments.length;\n    args = new Array(len > 1 ? len - 1 : 0);\n    for (var key = 1; key < len; key++) {\n      args[key - 1] = arguments[key];\n    }\n    var argIndex = 0;\n    var message = 'Warning: ' +\n      format.replace(/%s/g, function() {\n        return args[argIndex++];\n      });\n    if (typeof console !== 'undefined') {\n      console.error(message);\n    }\n    try {\n      // --- Welcome to debugging React ---\n      // This error was thrown as a convenience so that you can use this stack\n      // to find the callsite that caused this warning to fire.\n      throw new Error(message);\n    } catch (x) {}\n  }\n\n  warning = function(condition, format, args) {\n    var len = arguments.length;\n    args = new Array(len > 2 ? len - 2 : 0);\n    for (var key = 2; key < len; key++) {\n      args[key - 2] = arguments[key];\n    }\n    if (format === undefined) {\n      throw new Error(\n          '`warning(condition, format, ...args)` requires a warning ' +\n          'message argument'\n      );\n    }\n    if (!condition) {\n      printWarning.apply(null, [format].concat(args));\n    }\n  };\n}\n\nmodule.exports = warning;\n"],"names":["_toSetter","t","e","n","r","length","Object","defineProperty","set","o","apply","_checkPrivateRedeclaration","has","TypeError","_classPrivateMethodInitSpec","a","add","_classPrivateFieldInitSpec","_assertClassBrand","arguments","_classPrivateGetter","s","get","_classPrivateFieldSet2","AsyncFromSyncIterator","AsyncFromSyncIteratorContinuation","Promise","reject","done","resolve","value","then","this","next","prototype","isNodeJS","process","versions","nw","electron","type","FONT_IDENTITY_MATRIX","LINE_FACTOR","RenderingIntentFlag","AnnotationMode","DISABLE","ENABLE","ENABLE_FORMS","ENABLE_STORAGE","AnnotationEditorPrefix","AnnotationEditorType","NONE","FREETEXT","HIGHLIGHT","STAMP","INK","SIGNATURE","AnnotationEditorParamsType","RESIZE","CREATE","FREETEXT_SIZE","FREETEXT_COLOR","FREETEXT_OPACITY","INK_COLOR","INK_THICKNESS","INK_OPACITY","HIGHLIGHT_COLOR","HIGHLIGHT_DEFAULT_COLOR","HIGHLIGHT_THICKNESS","HIGHLIGHT_FREE","HIGHLIGHT_SHOW_ALL","DRAW_STEP","TextRenderingMode","util_ImageKind","GRAYSCALE_1BPP","RGB_24BPP","RGBA_32BPP","AnnotationType","TEXT","LINK","LINE","SQUARE","CIRCLE","POLYGON","POLYLINE","UNDERLINE","SQUIGGLY","STRIKEOUT","CARET","POPUP","FILEATTACHMENT","SOUND","MOVIE","WIDGET","SCREEN","PRINTERMARK","TRAPNET","WATERMARK","THREED","REDACT","AnnotationBorderStyleType","VerbosityLevel","ERRORS","WARNINGS","INFOS","OPS","dependency","setLineWidth","setLineCap","setLineJoin","setMiterLimit","setDash","setRenderingIntent","setFlatness","setGState","save","restore","transform","moveTo","lineTo","curveTo","curveTo2","curveTo3","closePath","rectangle","stroke","closeStroke","fill","eoFill","fillStroke","eoFillStroke","closeFillStroke","closeEOFillStroke","endPath","clip","eoClip","beginText","endText","setCharSpacing","setWordSpacing","setHScale","setLeading","setFont","setTextRenderingMode","setTextRise","moveText","setLeadingMoveText","setTextMatrix","nextLine","showText","showSpacedText","nextLineShowText","nextLineSetSpacingShowText","setCharWidth","setCharWidthAndBounds","setStrokeColorSpace","setFillColorSpace","setStrokeColor","setStrokeColorN","setFillColor","setFillColorN","setStrokeGray","setFillGray","setStrokeRGBColor","setFillRGBColor","setStrokeCMYKColor","setFillCMYKColor","shadingFill","beginInlineImage","beginImageData","endInlineImage","paintXObject","markPoint","markPointProps","beginMarkedContent","beginMarkedContentProps","endMarkedContent","beginCompat","endCompat","paintFormXObjectBegin","paintFormXObjectEnd","beginGroup","endGroup","beginAnnotation","endAnnotation","paintImageMaskXObject","paintImageMaskXObjectGroup","paintImageXObject","paintInlineImageXObject","paintInlineImageXObjectGroup","paintImageXObjectRepeat","paintImageMaskXObjectRepeat","paintSolidColorImageMask","constructPath","setStrokeTransparent","setFillTransparent","rawFillPath","DrawOPS","verbosity","setVerbosityLevel","level","Number","isInteger","getVerbosityLevel","info","msg","console","log","concat","warn","unreachable","Error","assert","cond","createValidAbsoluteUrl","url","baseUrl","undefined","options","addDefaultProtocol","startsWith","dots","match","tryConvertEncoding","decodeURIComponent","escape","_unused","absoluteUrl","URL","parse","protocol","_isValidProtocol","updateUrlHash","hash","allowRel","res","href","split","shadow","obj","prop","nonSerializable","enumerable","configurable","writable","BaseException","message","name","constructor","PasswordException","code","super","UnknownErrorException","details","InvalidPDFException","ResponseException","status","missing","FormatError","AbortException","bytesToString","bytes","MAX_ARGUMENT_COUNT","String","fromCharCode","strBuf","i","chunkEnd","Math","min","chunk","subarray","push","join","stringToBytes","str","Uint8Array","charCodeAt","util_FeatureTest","isLittleEndian","buffer8","Uint32Array","buffer","isEvalSupported","Function","_unused2","isOffscreenCanvasSupported","OffscreenCanvas","isImageDecoderSupported","ImageDecoder","platform","userAgent","navigator","isAndroid","includes","isLinux","isMac","isWindows","isFirefox","isCSSRoundSupported","_globalThis$CSS","_globalThis$CSS$suppo","globalThis","CSS","supports","call","hexNumbers","Array","from","keys","toString","padStart","Util","makeHexColor","g","b","scaleMinMax","minMax","temp","m1","m2","applyTransform","p","m","pos","p0","p1","applyTransformToBezier","m0","m3","m4","m5","pI","pI1","applyInverseTransform","d","axialAlignedBoundingBox","rect","output","r0","r1","r2","r3","a0","a2","a1","a3","b0","b2","b1","b3","m1r0","m1r2","m2r1","m2r3","max","inverseTransform","singularValueDecompose2dScale","matrix","c","first","second","sqrt","normalizeRect","slice","intersect","rect1","rect2","xLow","xHigh","yLow","yHigh","pointBoundingBox","x","y","rectBoundingBox","x0","y0","x1","y1","bezierBoundingBox","x2","y2","x3","y3","_getExtremum","_getExtremumOnCurve","mt","tt","ttt","abs","delta","sqrtDelta","_Util","NormalizeRegex","NormalizationMap","getUuid","crypto","randomUUID","buf","getRandomValues","AnnotationPrefix","MathClamp","v","toBase64Util","arr","toBase64","btoa","try","fn","_len","args","_key","sumPrecise","numbers","reduce","SVG_NS","PixelsPerInch","async","fetchData","isValidFetchUrl","document","baseURI","response","fetch","ok","statusText","arrayBuffer","blob","json","text","request","XMLHttpRequest","open","responseType","onreadystatechange","readyState","DONE","responseText","send","_PixelsPerInch","_defineProperty","PDF","PageViewport","_ref","viewBox","userUnit","scale","rotation","offsetX","offsetY","dontFlip","centerX","centerY","rotateA","rotateB","rotateC","rotateD","offsetCanvasX","offsetCanvasY","width","height","rawDims","dims","pageWidth","pageHeight","pageX","pageY","clone","convertToViewportPoint","convertToViewportRectangle","topLeft","bottomRight","convertToPdfPoint","RenderingCancelledException","extraDelay","isDataScheme","ii","trim","substring","toLowerCase","isPdfFile","filename","test","StatTimer","create","time","started","Date","now","timeEnd","times","start","end","outBuf","longest","padEnd","noContextMenu","preventDefault","stopEvent","stopPropagation","PDFDateString","toDateObject","input","_regex","_","RegExp","matches","exec","year","parseInt","month","day","hour","minute","universalTimeRelation","offsetHour","offsetMinute","UTC","getRGB","color","colorRGB","map","getCurrentTransform","ctx","f","getTransform","getCurrentTransformInverse","invertSelf","setLayerDimensions","div","viewport","mustFlip","mustRotate","style","useRound","w","h","widthStr","heightStr","setAttribute","OutputScale","pixelRatio","sx","sy","scaled","symmetric","limitCanvas","maxPixels","maxDim","capAreaFactor","maxAreaScale","Infinity","maxWidthScale","maxHeightScale","capPixels","maxScale","devicePixelRatio","winPixels","ceil","window","screen","availWidth","availHeight","SupportedImageMimeTypes","EditorToolbar","editor","_EditorToolbar_brand","_toolbar","_colorPicker","_editor","_buttons","_altText","_signatureDescriptionButton","_classPrivateFieldSet","_l10nRemove","freeze","freetext","highlight","ink","stamp","signature","render","editToolbar","createElement","classList","signal","_classPrivateFieldGet","_uiManager","_signal","addEventListener","_pointerDown","buttons","className","append","position","toolbarPosition","direction","insetInlineEnd","top","hide","_classPrivateFieldGet2","hideDropdown","show","_classPrivateFieldGet3","remove","shown","addDeleteButton","editorType","button","tabIndex","_addListenersToElement","delete","addAltText","altText","_get_divider","addColorPicker","colorPicker","renderButton","addEditSignatureButton","signatureManager","renderEditButton","addButton","tool","updateEditSignatureButton","description","title","_classPrivateFieldGet4","destroy","_focusIn","_focusEventsAllowed","_focusOut","element","bind","capture","_this","divider","_buttons2","WeakMap","_toolbar2","_uiManager2","_HighlightToolbar_brand","WeakSet","HighlightToolbar","uiManager","parent","boxes","isLTR","_getLastPoint","_render","_addHighlightButton","lastY","lastX","box","span","highlightSelection","bindEvents","names","_id","IdManager","id","_this$id","_this$id2","_baseId","_id2","_cache","_ImageManager_brand","ImageManager","_isSVGFittingCanvas","getContext","willReadFrequently","image","Image","src","decode","drawImage","getImageData","data","getFromFile","file","lastModified","size","_get","getFromUrl","getFromBlob","blobPromise","getFromId","Map","bitmap","refCounter","getFromCanvas","canvas","_this$id5","_this$id6","_data2","offscreen","transferToImageBitmap","isSvg","getSvgUrl","svgUrl","deleteId","_bitmap$close","transferFromImageBitmap","convertToBlob","close","isValidId","key","rawData","_data4","_this$id3","_this$id4","File","Blob","mustRemoveAspectRatioPromise","fileReader","FileReader","imageElement","imagePromise","onload","result","onerror","readAsDataURL","createImageBitmap","_ImageManager","_commands","_locked","_maxSize","_position","CommandManager","maxSize","_ref3","cmd","undo","post","mustExec","NaN","overwriteIfSameType","keepUndo","splice","redo","hasSomethingToUndo","hasSomethingToRedo","cleanType","_KeyboardManager_brand","KeyboardManager","callbacks","allKeys","Set","callback","isMacKey","at","self","event","_serialize","bubbles","checker","altKey","ctrlKey","metaKey","shiftKey","ColorManager","_colors","colors","visibility","colorScheme","body","computedColor","getComputedStyle","getColorValues","convert","rgb","matchMedia","RGB","every","_colorsMapping","getHexCode","_abortController","_activeEditor","_allEditors","_allLayers","_altTextManager","_annotationStorage","_changedExistingAnnotations","_commandManager","_copyPasteAC","_currentDrawingSession","_currentPageIndex","_deletedAnnotationsElementIds","_draggingEditors","_editorTypes","_editorsToRescale","_enableHighlightFloatingButton","_enableUpdatedAddImage","_enableNewAltTextWhenAddingImage","_filterFactory","_focusMainContainerTimeoutId","_focusManagerAC","_highlightColors","_highlightWhenShiftUp","_highlightToolbar","_idManager","_isEnabled","_isWaiting","_keyboardManagerAC","_lastActiveElement","_mainHighlightColorPicker","_missingCanvases","_mlManager","_mode","_selectedEditors","_selectedTextNode","_signatureManager","_pageColors","_showAllStates","_previousStates","_translation","_translationTimeoutId","_container","_viewer","_viewerAlert","_updateModeCapability","_AnnotationEditorUIManager_brand","AnnotationEditorUIManager","_keyboardManager","proto","arrowChecker","contains","activeElement","tagName","hasSomethingToControl","textInputChecker","_self","_ref4","target","el","HTMLInputElement","small","TRANSLATE_SMALL","big","TRANSLATE_BIG","selectAll","addNewEditorFromKeyboard","_ref5","HTMLButtonElement","isEnterHandled","_ref6","unselectAll","translateSelectedEditors","container","viewer","viewerAlert","altTextManager","eventBus","pdfDocument","pageColors","highlightColors","enableHighlightFloatingButton","enableUpdatedAddImage","enableNewAltTextWhenAddingImage","mlManager","editorUndoBar","supportsPinchToZoom","AbortController","isEditing","isEmpty","hasSelectedEditor","hasSelectedText","_eventBus","_on","onEditingAction","onPageChanging","onScaleChanging","onRotationChanging","onSetPreference","evt","updateParams","_addSelectionListener","_addDragAndDropListeners","_addKeyboardManager","annotationStorage","filterFactory","viewParameters","realScale","PDF_TO_CSS_UNITS","isShiftKeyDown","_editorUndoBar","_supportsPinchToZoom","_classPrivateFieldGet5","_classPrivateFieldGet6","_classPrivateFieldGet7","_classPrivateFieldGet8","_classPrivateFieldGet9","_classPrivateFieldGet0","_classPrivateFieldGet1","_this$_editorUndoBar","abort","layer","values","clear","clearTimeout","combinedSignal","ac","AbortSignal","any","useNewAltTextFlow","useNewAltTextWhenAddingImage","hcmFilter","addHCMFilter","foreground","background","pair","toUpperCase","highlightColorNames","reverse","setCurrentDrawingSession","disableUserSelect","setMainHighlightColorPicker","editAltText","_classPrivateFieldGet10","firstTime","getSignature","_classPrivateFieldGet11","switchToMode","mode","on","once","dispatch","source","setPreference","_ref7","_ref8","pageNumber","focusMainContainer","focus","findParent","layerX","layerY","getBoundingClientRect","toggle","addShouldRescale","removeShouldRescale","_ref9","_classPrivateFieldGet12","commitOrRemove","_ref0","pagesRotation","methodOfCreation","selection","getSelection","isCollapsed","anchorNode","anchorOffset","focusNode","focusOffset","textLayer","_getAnchorElementForSelection","closest","getSelectionBoxes","empty","_getLayerForTextLayer","isNoneMode","createAndAddNewEditor","showAllEditors","addToAnnotationStorage","setValue","a11yAlert","messageId","JSON","stringify","removeAttribute","blur","_onSelectEnd","hasSelection","lastEditor","lastActiveElement","addEditListeners","_addCopyPasteListeners","removeEditListeners","_removeKeyboardManager","_removeCopyPasteListeners","dragOver","dataTransfer","items","isHandlingMimeForPasting","dropEffect","drop","item","paste","currentLayer","copy","_classPrivateFieldGet13","editors","serialized","serialize","clipboardData","setData","cut","getData","ex","isArray","newEditors","deserializedEditor","deserialize","_addEditorToLayer","_selectEditors","addCommands","keydown","isEditorHandlingKeyboard","keyup","_ref1","setEditingState","_addFocusManager","_dispatchUpdateStates","_isEmpty","_removeFocusManager","registerEditorTypes","types","_dispatchUpdateUI","defaultPropertiesToUpdate","getId","getLayer","pageIndex","currentPageIndex","addLayer","enable","disable","removeLayer","updateMode","_classPrivateFieldGet14","editId","isFromKeyboard","mustEnterInEditMode","promise","_this$_editorUndoBar2","_classPrivateFieldGet15","withResolvers","_disableAll","loadSignatures","_enableAll","annotationElementId","setSelected","enterInEditMode","unselect","canCreateNewEmptyEditor","addNewEditor","updateToolbar","_objectSpread","_classPrivateFieldGet16","updateColor","action","updateDefaultParams","visible","_classPrivateFieldGet17","_classPrivateFieldGet18","enableWaiting","mustWait","disableClick","enableClick","getEditors","getEditor","addEditor","removeEditor","_classPrivateFieldGet19","_classPrivateFieldGet20","setTimeout","addDeletedAnnotationElement","addChangedExistingAnnotation","deleted","isDeletedAnnotationElement","removeDeletedAnnotationElement","removeChangedExistingAnnotation","setActiveEditor","propertiesToUpdate","updateUI","_get_lastSelectedEditor","updateUIForDefaultProperties","toggleSelected","select","_classPrivateFieldGet21","ed","isSelected","firstSelectedEditor","_this$_editorUndoBar3","params","cleanUndoStack","_this$currentLayer","drawingEditor","endDrawingSession","_this$_editorUndoBar4","_classPrivateFieldGet22","commit","_classPrivateFieldGet23","totalX","totalY","translateInPage","translationDone","setUpDragSession","savedX","savedY","savedPageIndex","newX","newY","newPageIndex","endDragSession","mustBeAddedInUndoStack","move","_setParentAndPosition","dragSelectedEditors","tx","ty","drag","rebuild","changeParent","addOrRebuild","_this$getActive","getActive","shouldGetKeyboardEvents","isActive","getMode","imageManager","rangeCount","getRangeAt","commonAncestorContainer","parentWidth","parentHeight","rotator","getAttribute","range","collapsed","getClientRects","_ref10","_ref11","_classPrivateFieldGet24","renderAnnotationElement","annotation","_classPrivateFieldGet25","editorId","getRawValue","hasBeenModified","setMissingCanvas","annotationId","_classPrivateFieldGet26","setCanvas","addMissingCanvas","_ref90","nodeType","Node","TEXT_NODE","parentElement","hasTextLayer","_displayHighlightToolbar","_selectionChange","_classPrivateFieldGet91","_classPrivateFieldGet89","_classPrivateFieldGet90","activeLayer","toggleDrawing","pointerup","_classPrivateFieldGet92","_classPrivateFieldGet93","_classPrivateFieldGet94","entries","some","_ref91","assign","promises","all","_this2","AltText","_AltText_brand","_altText2","_altTextDecorative","_altTextButton","_altTextButtonLabel","_altTextTooltip","_altTextTooltipTimeout","_altTextWasFromKeyBoard","_badge","_editor2","_guessedText","_textWithDisclaimer","_useNewAltTextFlow","_l10nNewButton","added","review","initialize","l10n","_AltText$_l10n","_l10n","label","onClick","_reportTelemetry","_get_label","_setState","finish","focusVisible","hasData","guessedText","setGuessedText","generatedAltText","toggleAltTextBadge","_classPrivateFieldGet27","badge","isForCopying","decorative","textWithDisclaimer","_ref12","cancel","enabled","disabled","_classPrivateFieldGet28","_classPrivateFieldGet29","_this3","_classPrivateFieldGet95","_classPrivateFieldGet96","_classPrivateFieldGet97","tooltip","DELAY_TO_SHOW_TOOLTIP","_classPrivateFieldGet98","textContent","parentNode","getElementForAltText","TouchManager","_ref13","isPinchingDisabled","isPinchingStopped","onPinchStart","onPinching","onPinchEnd","_TouchManager_brand","_container2","_isPinching","_isPinchingStopped","_isPinchingDisabled","_onPinchStart","_onPinching","_onPinchEnd","_pointerDownAC","_signal2","_touchInfo","_touchManagerAC","_touchMoveAC","_onTouchStart","passive","MIN_TOUCH_DISTANCE_TO_PINCH","_classPrivateFieldGet30","_classPrivateFieldGet31","_classPrivateFieldGet99","_classPrivateFieldGet102","touches","pointerDownAC","opts","cancelPointerDown","_classPrivateFieldGet100","pointerType","_classPrivateFieldGet101","opt","_onTouchMove","onTouchEnd","_onTouchEnd","touch0","touch1","identifier","touch0X","screenX","touch0Y","screenY","touch1X","touch1Y","_classPrivateFieldGet103","screen0X","screen0Y","screen1X","screen1Y","touchInfo","pTouch0X","pTouch0Y","pTouch1X","pTouch1Y","prevGapX","prevGapY","currGapX","currGapY","distance","hypot","pDistance","origin","_classPrivateFieldGet104","_TouchManager","AnnotationEditor","_resizerKeyboardManager","resize","_resizeWithKeyboard","_stopResizingWithKeyboard","parameters","_AnnotationEditor_brand","_accessibilityData","_allResizerDivs","_altText3","_disabled","_dragPointerId","_dragPointerType","_keepAspectRatio","_resizersDiv","_lastPointerCoords","_savedDimensions","_focusAC","_focusedResizerName","_hasBeenClicked","_initialRect","_isEditing","_isInEditMode","_isResizerEnabledForKeyboard","_moveInDOMTimeout","_prevDragX","_prevDragY","_telemetryTimeouts","_touchManager","_isDraggable","_zIndex","_willKeepAspectRatio","_initialOptions","isCentered","_structTreeParentId","pageRotation","pageDimensions","pageTranslation","parentDimensions","isAttachedToDOM","getPrototypeOf","_type","_editorType","isDrawer","_defaultLineColor","_colorManager","deleteAnnotationElement","fakeEditor","FakeEditor","getNextId","_AnnotationEditor$_l","_l10nResizer","topMiddle","topRight","middleRight","bottomMiddle","bottomLeft","middleLeft","_borderLineWidth","documentElement","parseFloat","getPropertyValue","_value","mime","_this$div","center","parentRotation","fixAndSetPosition","setInBackground","zIndex","setInForeground","setParent","_stopResizing","focusin","focusout","_this$parent","relatedTarget","isMultipleSelection","isInEditMode","setAt","screenToPageTranslation","_moveAfterPaste","baseX","baseY","_onTranslated","translate","_translate","scrollIntoView","block","findNewParent","floor","bx","by","getBaseTranslation","left","toFixed","_onTranslating","_hasBeenMoved","_hasBeenResized","_mustFixPosition","moveInDOM","_rotatePoint","pageTranslationToScreen","parentScale","setDims","fixDims","widthPercent","endsWith","heightPercent","getInitialTranslation","_onResized","_round","round","_onResizing","altTextFinish","_classPrivateFieldGet32","toolbarButtons","addEditToolbar","_editToolbar","removeEditToolbar","_classPrivateFieldGet33","addContainer","_this$_editToolbar","editToolbarDiv","before","getClientDimensions","createAltText","altTextData","_classPrivateFieldGet34","guessedAltText","_classPrivateFieldGet35","setGuessedAltText","_classPrivateFieldGet36","serializeAltText","_classPrivateFieldGet37","hasAltText","hasAltTextData","_classPrivateFieldGet38","_classPrivateFieldGet39","_this$_uiManager$_edi","defaultL10nId","_isVisible","_addFocusListeners","maxWidth","maxHeight","isResizable","_touchPinchStartCallback","_touchPinchCallback","_touchPinchEndCallback","pointerdown","_setUpDragSession","_selectOnPointerEvent","_onStartDragging","_onStopDragging","_this$parent2","moveEditorInDOM","getRect","shiftX","shiftY","getRectInCurrentCoords","onceAdded","enableEditMode","disableEditMode","needsToBeRebuilt","isOnScreen","bottom","right","innerHeight","innerWidth","rotate","_angle","serializeDeleted","_this$_initialData","popupRef","_initialData","accessibilityData","_isCopy","isCopy","_classPrivateFieldGet40","_classPrivateFieldGet41","timeout","makeResizable","_createResizers","savedWidth","savedHeight","children","boundResizerKeydown","_resizerKeydown","boundResizerBlur","_resizerBlur","_resizerFocus","firstPosition","nextFirstPosition","firstChild","lastChild","child","_setResizerTabIndex","stopImmediatePropagation","_resizerPointermove","deltaX","deltaY","fromKeyboard","_this$div2","_this$_editToolbar3","_classPrivateFieldGet42","_this$div3","_this$_editToolbar2","_classPrivateFieldGet43","_this$div4","_this$div5","_this$_editToolbar4","_classPrivateFieldGet44","preventScroll","disableEditing","enableEditing","canChangeContent","dblclick","contentDiv","setAspectRatio","aspectRatio","MIN_SIZE","telemetryInitialData","telemetryFinalData","_telemetryTimeout","content","querySelector","nodeName","prepend","resetAnnotationElement","_ref92","angle","_getRotationMatrix","classes","_resizerPointerdown","_classPrivateFieldGet105","savedDraggable","togglePointerEvents","savedParentCursor","cursor","savedCursor","pointerUpCallback","_classPrivateFieldGet106","_addResizeToUndoStack","_resize","newWidth","newHeight","minWidth","minHeight","rotationMatrix","transf","invRotationMatrix","getPoint","getOpposite","isDiagonal","isHorizontal","point","oppositePoint","transfOppositePoint","oppositeX","oppositeY","ratioX","ratioY","lastScreenX","lastScreenY","invTransf","oldDiag","_classPrivateFieldGet107","_origin","prevDistance","factor","transfCenterPoint","newTransfCenterPoint","_classPrivateFieldGet108","hasDraggingStarted","cancelDrag","clientX","clientY","pointerId","isPrimary","_event$relatedTarget","_AnnotationEditor","SEED","MASK_HIGH","MASK_LOW","MurmurHash3_64","seed","h1","h2","update","ArrayBuffer","isView","byteLength","blockCounts","tailLength","dataUint32","k1","k2","C1","C2","C1_LOW","C2_LOW","hexdigest","SerializableEmpty","transfer","_modified","_modifiedIds","_storage","_AnnotationStorage_brand","AnnotationStorage","onSetModified","onResetModified","onAnnotationEditor","getValue","defaultValue","resetModified","modified","entry","val","_setModified","print","PrintAnnotationStorage","serializable","context","hasBitmap","editorStats","stats","typeToEditor","_stats","_counters$get","counters","count","computeTelemetryFinalData","resetModifiedIds","modifiedIds","ids","Symbol","iterator","_serializable","structuredClone","FontLoader","_ref14","ownerDocument","styleElement","_systemFonts","_document","nativeFontFaces","loadingRequests","loadTestFontId","addNativeFontFace","nativeFontFace","fonts","removeNativeFontFace","insertRule","rule","getElementsByTagName","styleSheet","sheet","cssRules","loadSystemFont","_ref15","systemFontInfo","disableFontFace","_inspectFont","loadedName","isFontLoadingAPISupported","fontFace","FontFace","load","_unused8","baseFontName","font","attached","missingFile","createNativeFontFace","loaded","family","createFontFaceRule","isSyncFontLoadingSupported","_queueLoadingCallback","_prepareFontLoadEvent","_this$_document","complete","otherRequest","shift","_loadTestFont","atob","int32","offset","spliceString","insert","called","XXXX_VALUE","checksum","fontFamily","isFontReady","fillText","FontFaceObject","translatedData","inspectFont","compiledGlyphs","_this$_inspectFont","cssFontInfo","css","weight","fontWeight","italicAngle","_this$_inspectFont2","mimetype","getPathGenerator","objs","character","objId","cmds","path","Path2D","fontExtraProperties","getFactoryUrlProp","isRefProxy","num","gen","isValidExplicitDest","validRef","validName","dest","page","zoom","argsLen","allowNull","arg","_listeners","_deferred","LoopbackPort","postMessage","listener","rmAbort","aborted","onAbort","removeEventListener","terminate","CallbackKind","StreamKind","onFn","wrapReason","_messageAC","_MessageHandler_brand","MessageHandler","sourceName","targetName","comObj","callbackId","streamId","streamSinks","streamControllers","callbackCapabilities","actionHandler","_onMessage","actionName","handler","ah","transfers","sendWithPromise","capability","sendWithStream","queueingStrategy","ReadableStream","controller","startCapability","startCall","pullCall","cancelCall","isClosed","desiredSize","pull","pullCapability","stream","reason","cancelCapability","_classPrivateFieldGet45","_ref93","_processStreamMessage","_createStreamSink","streamSink","enqueue","isCancelled","lastDesiredSize","sinkCapability","ready","error","onPull","onCancel","success","streamController","_deleteStreamController","dataReason","_streamController$sta","_streamController$pul","_streamController$can","allSettled","BaseCanvasFactory","_ref16","enableHWA","_enableHWA","_createCanvas","reset","canvasAndContext","DOMCanvasFactory","_ref17","BaseCMapReaderFactory","_ref18","isCompressed","_ref19","_fetch","cMapData","catch","DOMCMapReaderFactory","BaseFilterFactory","addFilter","maps","fgColor","bgColor","addAlphaFilter","addLuminosityFilter","addHighlightHCMFilter","filterName","newFgColor","newBgColor","_baseUrl","_cache2","_defs","_docId","_hcmCache","_id3","_DOMFilterFactory_brand","DOMFilterFactory","_ref20","docId","_this$id7","_this$id8","_get_cache","tableR","tableG","tableB","_createTables","_createUrl","filter","_createFilter","_addTransferMapConversion","_info","_get_hcmCache","_info$filter","fgRGB","_getRGB","bgRGB","_get_defs","table","_addGrayConversion","getSteps","_this$id9","_this$id0","tableA","_addTransferMapAlphaConversion","_this$id1","_this$id10","_addLuminosityConversion","_info2","_info$filter2","fgGray","bgGray","newFgRGB","newBgRGB","fg","bg","step","newStart","newStep","prev","k","j","_classPrivateFieldGet46","_classPrivateFieldGet47","_classPrivateFieldGet48","_classPrivateFieldGet49","_this4","_this5","_this6","contain","svg","createElementNS","mapR","mapG","mapB","bufferR","bufferG","bufferB","feColorMatrix","_appendFeFunc","feComponentTransfer","func","feFunc","rTable","gTable","bTable","aTable","BaseStandardFontDataFactory","_ref21","_ref22","DOMStandardFontDataFactory","BaseWasmFactory","_ref23","_ref24","DOMWasmFactory","node_utils_fetchData","fs","getBuiltinModule","readFile","NodeFilterFactory","NodeCanvasFactory","createRequire","import","require","createCanvas","NodeCMapReaderFactory","NodeStandardFontDataFactory","NodeWasmFactory","PathType","applyBoundingBox","bbox","region","BaseShadingPattern","isModifyingCurrentTransform","getPattern","RadialAxialShadingPattern","IR","_bbox","_colorStops","_p0","_p1","_r0","_r1","_createGradient","grad","createLinearGradient","createRadialGradient","colorStop","addColorStop","owner","inverse","pathType","pattern","ownerBBox","current","getClippedPathBoundingBox","tmpCanvas","cachedCanvases","getCanvas","tmpCtx","clearRect","beginPath","baseTransform","fillStyle","createPattern","domMatrix","DOMMatrix","setTransform","drawTriangle","p2","p3","c1","c2","c3","coords","rowSize","tmp","scaleX","scaleY","c1r","c1g","c1b","c2r","c2g","c2b","c3r","c3g","c3b","minY","maxY","xa","car","cag","cab","xb","cbr","cbg","cbb","x1_","x2_","drawFigure","figure","ps","cs","verticesPerRow","rows","cols","q","MeshShadingPattern","_coords","_figures","_bounds","_background","_createMeshCanvas","combinedScale","backgroundColor","boundsWidth","boundsHeight","paddedWidth","BORDER_SIZE","paddedHeight","createImageData","putImageData","Float32Array","matrixScaleX","matrixScaleY","temporaryPatternCanvas","DummyShadingPattern","PaintType","TilingPattern","canvasGraphicsFactory","operatorList","xstep","ystep","paintType","tilingType","createPatternCanvas","combinedScaleX","combinedScaleY","canvasWidth","canvasHeight","redrawHorizontally","redrawVertically","xScaledStep","yScaledStep","dimx","getSizeAndScale","dimy","graphics","createCanvasGraphics","groupLevel","setFillAndStrokeStyleToContext","clipBbox","executeOperatorList","endDrawing","dimx2","dimy2","xSize","ySize","tmpCanvas2","tmpCtx2","jj","realOutputSize","MAX_PATTERN_SIZE","bboxWidth","bboxHeight","strokeStyle","fillColor","strokeColor","convertBlackAndWhiteToRGBA","_ref25","srcPos","nonBlackColor","inverseDecode","black","zeroMapping","oneMapping","widthInSource","widthRemainder","srcLength","destPos","elem","FULL_CHUNK_HEIGHT","SCALE_MATRIX","XY","MIN_MAX_INIT","CachedCanvases","canvasFactory","cache","canvasEntry","drawImageAtIntegerCoords","srcImg","srcX","srcY","srcW","srcH","destX","destY","destW","destH","tlX","rTlX","tlY","rTlY","brX","rWidth","brY","rHeight","sign","CanvasExtraState","clipBox","getPathBoundingBox","xStrokePad","lineWidth","yStrokePad","updateClipFromPath","startNewPathAndClipBox","isEmptyClip","putBinaryImageData","imgData","ImageData","partialChunkHeight","fullChunks","totalChunks","chunkImgData","thisChunkHeight","elemsInThisChunk","kind","dest32","dest32DataLength","fullSrcDiff","white","srcDiff","kEnd","kEndUnrolled","mask","srcByte","putBinaryImageMask","copyCtxState","sourceCtx","destCtx","properties","property","setLineDash","getLineDash","lineDashOffset","resetCtxToDefault","fillRule","globalAlpha","lineCap","lineJoin","miterLimit","globalCompositeOperation","getImageSmoothingEnabled","interpolate","actualScale","fround","LINE_CAP_STYLES","LINE_JOIN_STYLES","NORMAL_CLIP","EO_CLIP","_CanvasGraphics_brand","CanvasGraphics","canvasCtx","commonObjs","_ref27","annotationCanvasMap","optionalContentConfig","markedContentStack","stateStack","pendingClip","pendingEOFill","xobjs","groupStack","baseTransformStack","smaskStack","smaskCounter","tempSMask","suspendedCtx","contentVisible","cachedPatterns","viewportScale","outputScaleX","outputScaleY","_cachedScaleForStroking","_cachedGetSinglePixelWidth","_cachedBitmapsMap","getObject","fallback","beginDrawing","_ref28","transparency","savedFillStyle","fillRect","transparentCanvas","compositeCtx","executionStartIdx","continueCallback","stepper","argsArray","fnArray","argsArrayLen","chunkOperations","endTime","steps","fnId","nextBreakPoint","breakIt","depObjId","objsPool","_restoreInitialState","HTMLCanvasElement","_drawFilter","_scaleImage","img","_img$width","_img$height","displayWidth","displayHeight","widthScale","heightScale","paintWidth","paintHeight","tmpCanvasId","_createMaskCanvas","isPatternFill","patternFill","currentTransform","cacheKey","maskCanvas","mainKey","cachedImage","maskToCanvas","minX","maxX","drawnWidth","drawnHeight","fillCanvas","fillCtx","imageSmoothingEnabled","limit","dashArray","dashPhase","intent","flatness","states","strokeAlpha","fillAlpha","activeSMask","checkSMaskState","transferMaps","inSMaskMode","beginSMaskMode","endSMaskMode","cacheId","scratchCanvas","_removeMirroring","__originalSave","__originalRestore","__originalRotate","__originalScale","__originalTranslate","__originalTransform","__originalSetTransform","__originalResetTransform","resetTransform","__originalClip","__originalMoveTo","__originalLineTo","__originalBezierCurveTo","bezierCurveTo","__originalRect","__originalClosePath","__originalBeginPath","cp1x","cp1y","cp2x","cp2y","mirrorContextOperations","compose","dirtyBox","smask","composeSMask","layerCtx","layerBox","layerOffsetX","layerOffsetY","layerWidth","layerHeight","genericComposeSMask","subtype","backdrop","transferMap","maskCtx","maskOffsetX","maskOffsetY","maskX","maskY","old","pop","op","path2d","consumePath","newPath","addPath","multiplySelf","rescaleAndStroke","needRestore","textMatrix","textMatrixScale","lineX","lineY","paths","pendingTextPaths","fontSize","preMultiplySelf","spacing","charSpacing","wordSpacing","textHScale","leading","fontRefName","_fontObj$systemFontIn","fontObj","fontMatrix","fontDirection","isType3Font","typeface","fallbackName","bold","italic","browserFontSize","fontSizeScale","textRenderingMode","rise","textRise","paintChar","patternFillTransform","patternStrokeTransform","fillStrokeMode","isAddToPathSet","patternStroke","_getScaledPath","invPatternTransform","strokeText","isFontSubpixelAAEnabled","glyphs","showType3Text","glyphsLength","vertical","spacingDir","defaultVMetrics","widthAdvanceScale","simpleFillText","getSinglePixelWidth","isInvalidPDFjsFont","chars","glyph","unicode","restoreNeeded","isSpace","fontChar","accent","scaledX","scaledY","vmetric","vx","vy","remeasure","measuredWidth","measureText","characterScaleX","isInFont","scaledAccentX","scaledAccentY","spacingLength","charProcOperatorList","operatorListId","xWidth","yWidth","llx","lly","urx","ury","getColorN_Pattern","_getPattern","getShadingPattern","inv","group","currentCtx","isolated","knockout","bounds","canvasBounds","groupCtx","startTransformInverse","currentMtx","hasOwnCanvas","annotationCanvas","savedCtx","skewX","skewY","positions","trans","images","applyTransferMapsToCanvas","applyTransferMapsToBitmap","imgToPaint","HTMLElement","tag","isVisible","isContentVisible","absDet","normX","normY","getScaleForStroking","scaledLineWidth","scaledXLineWidth","scaledYLineWidth","baseArea","saveRestore","dashes","hcmFilterId","savedFilter","GlobalWorkerOptions","workerPort","_port","Worker","workerSrc","_src","Metadata","_ref29","parsedData","_map","_data3","getRaw","_classPrivateFieldGet50","INTERNAL","_isDisplay","_isPrint","_userSet","_visible","OptionalContentGroup","renderingIntent","_ref30","usage","rbGroups","view","viewState","printState","_setVisible","internal","userSet","_cachedGetHash","_groups","_initialHash","_order","_OptionalContentConfig_brand","OptionalContentConfig","creator","order","groups","baseState","off","getHash","expression","_evaluateVisibilityExpression","policy","setVisibility","preserveRB","rbGroup","otherId","_classPrivateFieldGet51","setOCGState","_ref31","operator","state","hasInitialVisibility","getOrder","getGroup","array","PDFDataTransportStream","pdfDataRangeTransport","_ref32","disableRange","disableStream","initialData","progressiveDone","contentDispositionFilename","_queuedChunks","_progressiveDone","_contentDispositionFilename","_pdfDataRangeTransport","_isStreamingSupported","_isRangeSupported","_contentLength","_fullRequestReader","_rangeReaders","addRangeListener","begin","_onReceiveData","addProgressListener","total","_onProgress","addProgressiveReadListener","addProgressiveDoneListener","_onProgressiveDone","transportReady","_ref33","_enqueue","rangeReader","_begin","_progressiveDataLength","_this$_fullRequestRea","_this$_fullRequestRea2","_loaded","_this$_rangeReaders$","_this$_rangeReaders$$","_this$_fullRequestRea3","_this$_fullRequestRea4","onProgress","_this$_fullRequestRea5","_removeRangeReader","reader","indexOf","getFullReader","queuedChunks","PDFDataTransportStreamReader","getRangeReader","PDFDataTransportStreamRangeReader","requestDataRange","cancelAllRequests","_this$_fullRequestRea6","_stream","_done","_filename","_requests","_headersReady","headersReady","isRangeSupported","isStreamingSupported","contentLength","read","requestCapability","_end","_queuedChunk","createHeaders","isHttp","httpHeaders","headers","Headers","getResponseOrigin","_URL$parse$origin","_URL$parse","validateRangeRequestCapabilities","_ref34","responseHeaders","rangeChunkSize","returnValues","allowRangeRequests","suggestedLength","extractFilenameFromHeader","contentDisposition","needsEncodingFixup","toParamRegExp","rfc2616unquote","unescape","rfc5987decode","rfc2047decode","fixupEncoding","contentDispositionStr","iter","quot","part","parts","rfc2231getparam","attributePattern","flags","textdecode","encoding","decoder","TextDecoder","fatal","_unused9","quotindex","replaceAll","extvalue","encodingend","replace","charset","hex","_unused0","getFilenameFromContentDispositionHeader","_unused1","createResponseError","validateResponseStatus","createFetchOptions","withCredentials","abortController","method","credentials","redirect","getArrayBuffer","PDFFetchStream","_rangeRequestReaders","_this$_fullRequestRea7","_this$_fullRequestRea8","PDFFetchStreamReader","PDFFetchStreamRangeReader","_this$_fullRequestRea9","_reader","_withCredentials","_headersCapability","_disableRange","_rangeChunkSize","_responseOrigin","getReader","_this$onProgress","_this$_reader","_readCapability","responseOrigin","_this$onProgress2","_this$_reader2","NetworkManager","_ref35","currXhrId","pendingRequests","xhr","xhrId","pendingRequest","setRequestHeader","expectedStatus","onError","onStateChange","onprogress","onHeadersReceived","onDone","_pendingRequest$onPro","xhrStatus","network_getArrayBuffer","rangeHeader","getResponseHeader","getRequestXhr","isPendingRequest","abortRequest","PDFNetworkStream","_source","_manager","_onRangeRequestReaderClosed","PDFNetworkStreamFullRequestReader","PDFNetworkStreamRangeRequestReader","onClosed","_this$_fullRequestRea0","manager","_url","_fullRequestId","_onHeadersReceived","_onDone","_onError","_cachedChunks","_storedError","fullRequestXhrId","fullRequestXhr","responseURL","rawResponseHeaders","getAllResponseHeaders","trimStart","_this$onProgress3","lengthComputable","_requestId","_this$_manager$getReq","_close","_this$onClosed","_this$_storedError","_this$onProgress4","urlRegex","PDFNodeStream","sourceUrl","pathToFileURL","parseUrlOrPath","_this$_fullRequestRea1","_this$_fullRequestRea10","PDFNodeStreamFsFullReader","PDFNodeStreamFsRangeReader","_this$_fullRequestRea11","_readableStream","lstat","stat","_setReadableStream","createReadStream","_this$onProgress5","_error","readableStream","_this$onProgress6","INITIAL_DATA","_objs","_PDFObjects_brand","PDFObjects","_ensureObj","_data$bitmap","_classPrivateFieldGet109","_capability","_container4","_disableProcessItems","_fontInspectorEnabled","_lang","_layoutTextParams","_pageHeight3","_pageWidth3","_rootContainer","_rotation3","_scale","_styleCache","_textContentItemsStr","_textContentSource","_textDivs","_textDivProperties","_transform","_TextLayer_brand","TextLayer","_ref36","_globalThis$FontInspe","textContentSource","FontInspector","_ensureMinFontSizeComputed","finally","_pendingTextLayers","fontFamilyMap","pump","_ref37","_classPrivateFieldGet52","lang","styles","_processItems","_ref38","onBefore","_getCtx","_layout","_classPrivateFieldGet53","abortEx","textDivs","textContentItemsStr","cleanup","_ascentCache","_canvasContexts","_classPrivateFieldGet110","_classPrivateFieldGet111","_appendText","geom","textDiv","textDivProperties","hasText","hasEOL","atan2","fontName","PI","fontSubstitution","fontHeight","fontAscent","_getAscent","sin","cos","scaleFactorStr","divStyle","_minFontSize","dir","dataset","fontSubstitutionLoadedName","shouldScaleText","absScaleX","absScaleY","br","_ensureCtxFont","alpha","_canvasCtxFonts","cached","opacity","lineHeight","cachedAscent","metrics","ascent","fontBoundingBoxAscent","descent","fontBoundingBoxDescent","ratio","_TextLayer","XfaText","xfa","walk","node","_node$attributes","shouldBuildText","attributes","getDocument","_src$password","_src$length","task","PDFDocumentLoadingTask","location","getUrlProp","Buffer","isNaN","getDataProp","password","rangeTransport","PDFDataRangeTransport","worker","PDFWorker","docBaseUrl","cMapUrl","cMapPacked","CMapReaderFactory","iccUrl","standardFontDataUrl","StandardFontDataFactory","wasmUrl","WasmFactory","ignoreErrors","stopAtErrors","maxImageSize","chrome","canvasMaxAreaInBytes","enableXfa","disableAutoFetch","pdfBug","CanvasFactory","FilterFactory","useWasm","useSystemFonts","useWorkerFetch","transportFactory","cMapReaderFactory","standardFontDataFactory","wasmFactory","port","_worker","docParams","apiVersion","evaluatorOptions","transportParams","loadingParams","destroyed","workerIdPromise","messageHandler","networkStream","NetworkStream","workerId","transport","WorkerTransport","_transport","_docId2","_PDFDocumentLoadingTa","_PDFDocumentLoadingTa2","_this$_worker3","_this$_worker","_this$_transport","_pendingDestroy","_this$_worker2","_capability2","_progressiveDoneListeners","_progressiveReadListeners","_progressListeners","_rangeListeners","onDataRange","onDataProgress","onDataProgressiveRead","onDataProgressiveDone","PDFDocumentProxy","pdfInfo","_pdfInfo","numPages","fingerprints","isPureXfa","_htmlForXfa","allXfaHtml","getPage","getPageIndex","ref","getDestinations","getDestination","getPageLabels","getPageLayout","getPageMode","getViewerPreferences","getOpenAction","getAttachments","getJSActions","getDocJSActions","getOutline","getOptionalContentConfig","getRenderingIntent","getPermissions","getMetadata","getMarkInfo","saveDocument","getDownloadInfo","downloadInfoCapability","keepLoadedFonts","startCleanup","loadingTask","cachedPageNumber","getFieldObjects","hasJSActions","getCalculationOrderIds","_pendingCleanup","_PDFPageProxy_brand","PDFPageProxy","pageInfo","_pageIndex","_pageInfo","_pdfBug","_intentStates","getViewport","getAnnotations","getPageJSActions","getXfa","_this$_transport$_htm","_ref39","_this$_stats","_intentState","canvasContext","annotationMode","optionalContentConfigPromise","printAnnotationStorage","intentArgs","intentState","streamReaderCancelTimeout","intentPrint","_this$_stats2","displayReadyCapability","lastChunk","separateAnnots","_pumpOperatorList","_globalThis$Stats","renderTasks","internalRenderTask","_tryCleanup","_abortOperatorList","Stats","InternalRenderTask","useRequestAnimationFrame","renderTask","_ref40","_this$_stats3","initializeGraphics","operatorListChanged","getOperatorList","opListTask","_intentState2","_this$_stats4","opListReadCapability","streamTextContent","includeMarkedContent","disableNormalization","highWaterMark","getTextContent","_ref41","_textContent$lang","getStructTree","_destroy","waitOn","force","completed","resetStats","_startRenderPage","_this$_stats5","_intentState$displayR","_renderPageChunk","operatorListChunk","_ref42","annotationStorageSerializable","streamReader","_ref43","_ref44","delay","curCacheKey","curIntentState","_capability3","_messageHandler","_port2","_webWorker","_PDFWorker_brand","_workerPorts","_initializeFromPort","_initialize","_classPrivateFieldGet54","_classPrivateFieldGet55","cachedPort","_setupFakeWorkerGlobal","_get_mainThreadWorkerMessageHandler","WorkerMessageHandler","loader","_resolve","_isWorkerDisabled","_setupFakeWorker","_isSameOrigin","_createCDNWrapper","terminateEarly","sendTest","_unused10","testObj","_unused11","_PDFWorker$fakeWorker","_PDFWorker$fakeWorker2","_fakeWorkerId","workerHandler","setup","_this7","_globalThis$pdfjsWork","pdfjsWorker","_unused12","_PDFWorker","otherUrl","base","other","wrapper","createObjectURL","fromPort","_methodPromises","_pageCache","_pagePromises","_pageRefCache","_passwordCapability","_WorkerTransport_brand","factory","fontLoader","_params","destroyCapability","_networkStream","_fullReader","_lastProgress","setupMessageHandler","isOpList","modifiedIdsHash","_classPrivateFieldGet56","hasOwnProperty","terminated","_this$_networkStream","_this$messageHandler","sink","_ref45","readyReason","_loadingTask$onProgre","_loadingTask$onProgre2","_ref46","_ref47","_numPages","htmlForXfa","onPassword","updatePassword","err","_loadingTask$onProgre3","_ref48","_globalThis$FontInspe2","exportedData","exportedError","fontAdded","imageRef","pageProxy","dataLen","_ref49","imageData","_imageData$bitmap","_loadingTask$onProgre4","_this$_fullReader$fil","_this$_fullReader","cachedPromise","refStr","_cacheSimpleMethod","results","_this$_fullReader$fil2","_this$_fullReader2","_this$_fullReader$con","_this$_fullReader3","metadata","_classPrivateFieldGet57","_internalRenderTask","RenderTask","form","_rAF","_ref50","operatorListIdx","running","graphicsReadyCallback","graphicsReady","_useRequestAnimationFrame","cancelled","_cancelBound","_continueBound","_continue","_scheduleNextBound","_scheduleNext","_nextBound","_next","_canvas","_ref51","_globalThis$StepperMa","_this$graphicsReadyCa","_canvasInUse","StepperManager","init","getNextBreakPoint","gfx","_this$gfx","_this$task$onError","_this$task","cancelAnimationFrame","_this$stepper","updateOperatorList","onContinue","requestAnimationFrame","version","makeColorComp","scaleAndClamp","ColorConverters","CMYK_G","_ref52","G_CMYK","_ref53","G_RGB","_ref54","G_rgb","_ref55","G_HTML","_ref56","G","RGB_G","_ref57","RGB_rgb","RGB_HTML","T_HTML","T_rgb","CMYK_RGB","_ref58","CMYK_rgb","_ref59","CMYK_HTML","components","RGB_CMYK","_ref60","BaseSVGFactory","skipDimensions","_createSVG","DOMSVGFactory","XfaLayer","setupStorage","html","storage","storedData","xfaOn","xfaOff","checked","option","selected","selectedIndex","setAttributes","_ref61","linkService","isHTMLAnchorElement","HTMLAnchorElement","addLinkAttributes","newWindow","dataId","root","xfaHtml","rootHtml","isNotForRichText","rootDiv","createTextNode","stack","_child$attributes","_child$children","childHtml","xmlns","querySelectorAll","hidden","GetElementsByNameSet","AnnotationElementFactory","annotationType","LinkAnnotationElement","TextAnnotationElement","fieldType","TextWidgetAnnotationElement","radioButton","RadioButtonWidgetAnnotationElement","checkBox","CheckboxWidgetAnnotationElement","PushButtonWidgetAnnotationElement","ChoiceWidgetAnnotationElement","SignatureWidgetAnnotationElement","WidgetAnnotationElement","PopupAnnotationElement","FreeTextAnnotationElement","LineAnnotationElement","SquareAnnotationElement","CircleAnnotationElement","PolylineAnnotationElement","CaretAnnotationElement","InkAnnotationElement","PolygonAnnotationElement","HighlightAnnotationElement","UnderlineAnnotationElement","SquigglyAnnotationElement","StrikeOutAnnotationElement","StampAnnotationElement","FileAttachmentAnnotationElement","AnnotationElement","_updates","_hasBorder","_popupElement","_AnnotationElement_brand","isRenderable","ignoreBorder","createQuadrilaterals","downloadManager","imageResourcesPath","renderForms","svgFactory","enableScripting","_fieldObjects","fieldObjects","_createContainer","_createQuadrilaterals","_hasPopupData","_ref62","contentsObj","richText","_isEditable","isEditable","hasPopupData","updateEdited","_classPrivateFieldGet58","_setRectEdited","popup","resetEdited","_classPrivateFieldGet59","alternativeText","noRotate","setRotation","borderStyle","borderWidth","horizontalRadius","horizontalCornerRadius","verticalRadius","verticalCornerRadius","radius","borderRadius","borderBottomStyle","borderColor","_commonActions","setColor","jsName","styleName","detail","colorType","colorArray","display","noView","noPrint","userName","readonly","required","_setRequired","textColor","_dispatchEventFromSandbox","actions","jsEvent","commonActions","_setDefaultPropertiesFromJS","quadPoints","rectBlX","rectBlY","rectTrX","rectTrY","trX","trY","blX","blY","svgBuffer","role","defs","clipPath","_svgBuffer","rectWidth","rectHeight","backgroundImage","_createPopup","titleObj","modificationDate","parentRect","elements","_getElementsByName","skipId","fields","fieldObj","exportValues","exportValue","domElement","getElementsByName","_this$popup","maybeShow","_this$popup2","forceHide","getElementsToTriggerPopup","addHighlightArea","triggers","_editOnDoubleClick","annotationEditorType","_this$linkService$eve","currentRect","_LinkAnnotationElement_brand","isTooltipOnly","link","isBound","_bindNamedAction","attachment","_bindAttachment","attachmentDest","_bindSetOCGState","_bindLink","Action","_bindJSAction","resetForm","_bindResetFormAction","destination","getDestinationHash","onclick","goToDestination","_setInternalLink","getAnchorUrl","executeNamedAction","_this$linkService$eve2","otherClickAction","resetFormFields","refs","resetFormRefs","include","allFields","fieldIds","fieldName","field","allIds","dispatchEvent","Event","_this$linkService$eve3","_this$downloadManager","openOrDownloadData","executeSetOCGState","showElementAndHideCanvas","_element$previousSibl","previousSibling","_getKeyModifier","_setEventListener","elementData","baseName","eventName","valueGetter","_this$linkService$eve4","modifier","_this$linkService$eve5","focused","_setEventListeners","getter","_this$data$actions","_this$data$actions2","_this$data$actions3","Blur","Focus","_setBackgroundColor","_setTextStyle","TEXT_ALIGNMENT","fontColor","defaultAppearanceData","computedFontSize","roundToOneDecimal","multiLine","textAlignment","textAlign","isRequired","hasAppearance","fieldValue","setPropertyOnSiblings","keyInStorage","_this$data$textConten","maxLen","charLimit","fieldFormattedValues","formattedValue","comb","userValue","lastCommittedValue","commitKey","doNotScroll","overflowY","overflowX","readOnly","format","dateFormat","timeFormat","maxLength","_this$data$defaultFie","defaultFieldValue","blurListener","scrollLeft","_this$data$actions6","_this$data$actions4","_event$detail$value","selRange","setSelectionRange","_this$linkService$eve6","willCommit","selStart","selectionStart","selEnd","selectionEnd","_this$linkService$eve7","_blurListener","_this$data$actions5","_this$linkService$eve8","Keystroke","_this$linkService$eve9","inputType","change","combWidth","letterSpacing","verticalAlign","checkbox","curChecked","buttonValue","radio","pdfButtonValue","linkElement","selectElement","addAnEmptyEntry","combo","multiSelect","multiple","optionElement","displayValue","removeEmptyEntry","noneOptionElement","isExport","selectedValues","getItems","_removeEmptyEntry","multipleSelection","index","findIndex","selectChild","indices","editable","_this$linkService$eve0","changeEx","keyDown","PopupElement","elementIds","ariaHasPopup","_boundKeyDown","_boundHide","_boundShow","_boundToggle","_color","_container5","_contentsObj","_dateObj","_elements","_parent","_parentRect","_pinned","_popup","_position2","_rect","_richText","_titleObj","_updates2","_wasVisible","_PopupElement_brand","_ref63","_keyDown","_hide","_show","_toggle","trigger","flatMap","_element$container","baseColor","outlineColor","header","dateObj","valueOf","dateTime","toISOString","_get_html","contents","_formatContents","_ref64","lines","line","_ref65","_classPrivateFieldGet60","popupContent","_makePopupContent","_classPrivateFieldGet61","_this8","_get_fontSize","_this9","_classPrivateGetter5","_get_fontColor","_this0","_classPrivateGetter6","popupLines","lineAttributes","_setPosition","useParentRect","normalizedRect","popupLeft","popupTop","textPosition","lineSpan","_line","lineCoordinates","_square","square","_circle","circle","_polyline","containerClassName","svgElementName","vertices","points","polyline","_polylinesGroupElement","_polylines","_InkAnnotationElement_brand","it","inkLists","_getTransform","thickness","overlaidText","mark","underline","strikeout","_trigger","_FileAttachmentAnnotationElement_brand","_this$linkService$eve1","_download","_this$downloadManager2","_accessibilityManager","_annotationCanvasMap","_editableAnnotations","_structTreeLayer","_AnnotationLayer_brand","AnnotationLayer","_ref66","accessibilityManager","annotationEditorUIManager","structTreeLayer","_annotationEditorUIManager","hasEditableAnnotations","annotations","popupToElements","elementParams","noHTML","isPopupAnnotation","rendered","_this$_annotationEdit","_appendElement","_setAnnotationCanvasMap","addLinkAnnotations","_defaultBorderStyle","_ref67","getEditableAnnotations","getEditableAnnotation","rawWidth","popupElements","_classPrivateFieldGet112","contentElement","ariaAttributes","getAriaAttributes","_classPrivateFieldGet113","after","moveElementInDOM","replaceWith","editableAnnotation","_this$_annotationEdit2","_hasNoCanvas","EOL_PATTERN","_color2","_content","_editorDivId","_editModeAC","_fontSize","_FreeTextEditor_brand","FreeTextEditor","_translateEmpty","_defaultColor","_defaultFontSize","_internalPadding","_updateFontSize","_updateColor","overlayDiv","editorDiv","contentEditable","editorDivKeydown","editorDivFocus","editorDivBlur","editorDivInput","editorDivPaste","_classPrivateFieldGet62","_this$_initialOptions","innerText","savedText","newText","_extractText","trimEnd","setText","_setContent","_setEditorDimensions","posX","posY","_deserializeContent","normalize","deleteFromDocument","insertNode","collapseToStart","startContainer","startOffset","bufferBefore","bufferAfter","nodeValue","childNodes","_getNodeContent","newRange","Range","beforeLength","setStart","setEnd","removeAllRanges","addRange","padding","_serializeContent","structTreeParentId","_hasElementChanged","replaceChildren","setFontsize","savedFontsize","col","savedColor","prevChild","_prevChild","savedDisplay","savedVisibility","_FreeTextEditor","Outline","toSVGPath","_rotation","_rescale","_rescaleAndSwap","svgRound","_normalizePoint","_normalizePagePoint","createBezierPoints","FreeDrawOutliner","_ref68","scaleFactor","innerMargin","_FreeDrawOutliner_brand","_box","_bottom","_innerMargin","_isLTR2","_top","_last","_lastX","_lastY","_min","_min_dist","_scaleFactor","_thickness","_points","_MIN_DIST","_MIN","_ref69","_classPrivateFieldGet63","diffX","diffY","diffD","K","nY","thX","thY","_toSVGPathTwoPoints","_toSVGPathEnd","_toSVGPathStart","newFreeDrawOutline","outline","FreeDrawOutline","getOutlines","_classPrivateFieldGet64","_classPrivateFieldGet65","last","_getOutlineTwoPoints","N","_getOutlineEnd","_getOutlineStart","_getLastCoords","lastTop","lastBottom","lastTopX","lastTopY","lastBottomX","lastBottomY","_box2","_bbox2","_innerMargin2","_isLTR3","_points2","_scaleFactor2","_outline","_FreeDrawOutline_brand","lastPoint","_computeMinMax","_ref70","newOutliner","getNewOutline","outliner","lastPointX","lastPointY","ltrCallback","HighlightOutliner","_HighlightOutliner_brand","_box3","_lastPoint","_verticalEdges","_intervals","EPSILON","shiftedMinX","shiftedMinY","lastEdge","edge","sort","outlineVerticalEdges","_breakEdge","_insert","_remove","_getOutlines","edges","allEdges","edge1","edge2","outlines","HighlightOutline","_binarySearch","middle","_ref94","_ref95","y4","_box4","_outlines","polygon","prevX","prevY","_ref71","classNamesForOutlining","FreeHighlightOutliner","FreeHighlightOutline","ColorPicker","_hideDropdownFromKeyboard","_colorSelectFromKeyboard","_moveToNext","_moveToPrevious","_moveToBeginning","_moveToEnd","_ref72","_editor$color","_classPrivateFieldGet66","_ColorPicker_brand","_button","_buttonSwatch","_dropdown","_dropdownWasFromKeyboard","_isMainColorPicker","_editor3","_openDropdownAC","_uiManager3","_type2","_l10nColor","blue","green","pink","red","yellow","ariaControls","_openDropdown","_keyDown2","swatch","ariaHidden","renderMainDropdown","dropdown","_getDropdownRoot","ariaOrientation","ariaLabelledBy","_colorSelect","_event$target$nextSib","_classPrivateFieldGet67","_get_isDropdownVisible","nextSibling","_classPrivateFieldGet68","_event$target$previou","_classPrivateFieldGet69","_classPrivateFieldGet70","_classPrivateFieldGet71","_classPrivateFieldGet72","ariaExpanded","_classPrivateFieldGet73","ariaSelected","_classPrivateFieldGet74","_classPrivateFieldGet75","ariaMultiSelectable","_pointerDown3","_classPrivateFieldGet114","_this1","_ColorPicker","HighlightEditor","_moveCaret","_HighlightEditor_brand","_anchorNode","_anchorOffset","_boxes","_clipPathId","_colorPicker2","_focusOutlines","_focusNode","_focusOffset","_highlightDiv","_highlightOutlines","_id4","_isFreeHighlight","_lastPoint2","_opacity","_outlineId","_text","_thickness2","_methodOfCreation","_defaultThickness","_defaultOpacity","highlightId","_createFreeOutlines","_addToDrawLayer","_createOutlines","numberOfColors","_uiManager$highlightC","_updateColor2","_updateThickness","_getRotation","addUndoableEditor","_cleanDrawLayer","mustBeSelected","_this$div6","drawLayer","_rotateBbox","updateProperties","_keydown","highlightDiv","pointerover","_this$parent3","rootClass","hovered","pointerleave","_this$parent4","_setCaret","_this$parent5","_this$parent6","startHighlighting","_ref73","_endHighlight","_highlightMove","_freeHighlight","_freeHighlightId","clipPathId","_freeHighlightClipId","draw","free","highlightOutlines","_serializeBoxes","_serializeOutlines","_hasElementChanged2","outlinerForOutline","_ref96","finalizeDraw","drawOutline","highlightOutline","setColorAndOpacity","opa","_this$parent12","_classPrivateFieldGet115","savedOpacity","savedThickness","setThickness","th","_changeThickness","_ref97","setPosition","_HighlightEditor","DrawingOptions","_svgProperties","updateProperty","updateSVGProperty","toSVGProperties","updateAll","_drawOutlines","_mustBeCommitted","_DrawingEditor_brand","DrawingEditor","mustBeCommitted","_addOutlines","drawOutlines","_createDrawOutlines","_addToDrawLayer2","_mergeSVGProperties","p1Keys","getDefaultDrawingOptions","_options","typesMap","supportMultipleDrawings","propertyName","_defaultDrawingOptions","_currentParent","_currentDraw","_currentDrawId","_updateProperty","_drawingOptions","savedValue","setter","_this$parent7","_updateBbox","_drawId","_this$parent8","getPathResizingSVGProperties","_convertToDrawSpace","_rotateBox","_this$parent9","getPathResizedSVGProperties","_x","_y","_this$parent0","_this$parent1","getPathTranslatedSVGProperties","_this$parent10","moving","_this$parent11","_cleanDrawLayer2","_this$div7","updateRotation","updateParentDimensions","onScaleChangingWhenDrawing","drawDiv","createDrawerInstance","_parentWidth","_parentHeight","startDrawing","_isLTR","_currentPointerType$_","_uiManager$_editorUnd","_currentPointerType","_currentDrawingAC","_currentPointerId","_currentPointerIds$_","_endDraw","_currentPointerIds","_currentPointerIds$_2","isCancellable","removeLastElement","_drawMove","timeStamp","_currentMoveTimestamp","startNew","_currentDrawingOptions","defaultSVGProperties","_currentPointerIds$_3","_cleanup","drawId","lastElement","getLastElement","setLastElement","isAborted","_INNER_MARGIN","drawingOptions","createDrawingOptions","_data","deserializeDraw","_pageX","_pageY","_pageWidth","_pageHeight","_innerWidth","serializeDraw","_ref98","defaultProperties","_createDrawing","updateParent","_convertToParentSpace","_ref99","pW","pH","_DrawingEditor","InkDrawOutliner","_InkDrawOutliner_brand","_last2","Float64Array","_line2","_lines","_rotation4","_thickness3","_points3","_lastSVGPath","_lastIndex","_outlines2","InkDrawOutline","_parentWidth2","_parentHeight2","firstX","firstY","lastIndexOf","secondX","secondY","c1x","c1y","c2x","c2y","build","_bbox3","_currentRotation","_innerMargin3","_lines2","_parentWidth3","_parentHeight3","_parentScale","_rotation5","_thickness4","_InkDrawOutline_brand","_computeBbox","_ref74","serializedLines","serializedPoints","_getBBoxWithNoMargin","rescaleFn","_ref75","newLines","len","_updateThickness2","_ref76","oldMarginX","oldMarginY","_getMarginComponents","newMarginX","newMarginY","diffMarginX","diffMarginY","rotationTransform","_ref77","marginX","marginY","PRECISION","s1x","s1y","s2x","s2y","_ref78","_ref79","newParentWidth","newParentHeight","margin","InkDrawingOptions","viewerParameters","_viewParameters","_InkEditor_brand","InkEditor","_ref80","_hasElementChanged3","ContourDrawOutline","SignatureExtractor","extractContoursFromText","_ref81","fontStyle","actualBoundingBoxLeft","actualBoundingBoxRight","actualBoundingBoxAscent","actualBoundingBoxDescent","SCALE","uint8Buf","_toUint","histogram","_getHistogram","threshold","_guessThreshold","contourList","_findContours","processDrawnLines","curves","mustSmooth","areContours","_getGrayPixels","_bilateralFilter","_PARAMETERS","sigmaSFactor","sigmaR","kernelSize","_ref82","_lines$thickness","linesAndPoints","xScale","yScale","newCurves","reducedPoints","_douglasPeucker","newPoints","compressSignature","_ref83","bufferType","minDiff","maxDiff","outlinesLength","dx","Int8Array","Int16Array","Int32Array","headerLength","BYTES_PER_ELEMENT","CompressionStream","writer","getWriter","write","BufferCtor","diffs","Response","readable","decompressSignature","signatureData","fromBase64","DecompressionStream","_iteratorError","_iteratorAbruptCompletion","_didIteratorError","_step","_iterator","asyncIterator","_asyncIterator","return","numberOfDrawings","diffsOffset","POINTS_PROPERTIES_NUMBER","_neighborIndexToId","i0","j0","_clockwiseNonZero","kk","_neighborIdToIndex","_counterClockwiseNonZero","lnbd","nbd","contours","ij","pix","i2","j2","isHole","contour","contour0","shiftI","shiftJ","i1","j1","i3","j3","i4","j4","ij3","_douglasPeuckerHelper","ax","ay","abx","aby","dist","nabx","naby","aa","invS","phi","atan","cosPhi","sinPhi","tmax","poly","partialPhi","dmax","sigmaS","kernel","sigmaS2","halfSize","exp","rangeValues","sigmaR2","out","sum","norm","l","neighbour","Uint8ClampedArray","M","L","spos","originalBitmap","prevWidth","prevHeight","log2","isteps","grayImage","_SignatureExtractor","SignatureOptions","DrawnSignatureOptions","_isExtracted","_description","_signatureData","_signatureUUID","SignatureEditor","_defaultDrawnSignatureOptions","hasDescription","_hasDescriptionStats$","_hasDescriptionStats$2","hasDescriptionStats","hasNoAltText","uuid","heightInPage","addSignature","setUuid","toolbar","getSignaturePreview","hasBeenSaved","getFromImage","getFromText","fontInfo","getDrawnSignature","_ref84","isSignature","alt","_data$accessibilityDa","StampEditor","_StampEditor_brand","_bitmap","_bitmapId","_bitmapPromise","_bitmapUrl","_bitmapFile","_bitmapFileName","_missingCanvas","_resizeTimeoutId","_isSvg","_hasBeenAddedInUndoStack","bitmapUrl","bitmapFile","pasteEditor","getAsFile","_this$altTextData","_hasAltTextStats$get","_hasAltTextStats$get2","hasAltTextStats","mlGuessAltText","updateAltTextData","isEnabledFor","copyCanvas","guess","channels","_classPrivateFieldGet76","_getBitmap","bitmapId","_drawBitmap","maxDataDimension","maxPreviewDimension","bitmapWidth","bitmapHeight","outputScale","_window$matchMedia","_window","scaledWidth","scaledHeight","_scaleBitmap","boxDim","boxDimWidth","boxDimHeight","patternCtx","dataWidth","dataHeight","offscreenCtx","missingCanvas","_await$parent$_struct","structParent","_structTree","_serializeBitmap","changes","_hasElementChanged4","isSame","_this$_initialData$st","isSameAltText","stamps","area","prevData","_getBitmapFetched","fromId","_getBitmapDone","alt_text_modal","alt_text_type","_unused13","accept","files","click","_this$_initialOptions2","MAX_RATIO","toUrl","toDataURL","_serialized$accessibi","isSamePageIndex","AnnotationEditorLayer","_ref85","annotationLayer","_AnnotationEditorLayer_brand","_accessibilityManager2","_allowClick","_annotationLayer","_clickAC","_editorFocusTimeoutId","_editors","_hadPointerDown","_isDisabling","_isEnabling","_drawingAC","_focusedElement","_textLayer","_textSelectionAC","_textLayerDblClickAC","_lastPointerDownTimestamp","_uiManager4","editorTypes","_editorTypes2","_initialized","isInvisible","disableTextSelection","toggleAnnotationLayerPointerEvents","enableTextSelection","_classPrivateFieldGet77","_classPrivateFieldGet78","_classPrivateFieldGet79","annotationElementIds","editables","elementsFromPoint","regex","changedAnnotations","resetAnnotations","_this$getEditableAnno","_classPrivateFieldGet80","_classPrivateFieldGet81","_textLayerPointerDown","_classPrivateFieldGet82","_classPrivateFieldGet83","attach","detach","_classPrivateFieldGet84","removePointerInTextLayer","_editor$parent","_classPrivateFieldGet85","_classPrivateGetter2","_get_currentEditorType","_getCenterPoint","_createNewEditor","_editorTypes2$_$get","_data$annotationType","_classPrivateGetter3","currentMode","_classPrivateGetter4","startDrawingSession","_ref86","pause","_classPrivateFieldGet86","_classPrivateFieldGet87","_classPrivateFieldGet88","_ref87","_ref88","oldRotation","_this10","DrawLayer","_ref89","_DrawLayer_brand","_parent2","_mapping","_toUpdate","_svgFactory","_DrawLayer$id","_DrawLayer$id2","isPathUpdatable","hasClip","_id5","pathId","_createClipPath","use","mustRemoveSelfIntersections","_DrawLayer$id3","_DrawLayer$id4","maskId","use1","use2","cloneNode","elementOrId","_updateProperties","_setBox","pathElement","_ref100","clipPathUse","_DrawLayer","_pdfjsTestingUtils","pdfjsLib","FeatureTest","getFilenameFromUrl","getPdfFilenameFromUrl","defaultFilename","newURL","urlString","_unused3","_unused4","_unused5","_unused6","getURL","decoded","_unused7","pdfRegex","pathname","searchParams","hashFilename","getXfaPageViewport","xfaPage","_ref2","ImageKind","normalizeUnicode","PasswordResponses","NEED_PASSWORD","INCORRECT_PASSWORD","PermissionFlag","PRINT","MODIFY_CONTENTS","COPY","MODIFY_ANNOTATIONS","FILL_INTERACTIVE_FORMS","COPY_FOR_ACCESSIBILITY","ASSEMBLE","PRINT_HIGH_QUALITY","isProduction","prefix","invariant","condition","provided","find","tar","dequal","foo","bar","ctor","getTime","DataView","getInt8","LinkService","externalLinkEnabled","externalLinkRel","externalLinkTarget","isInPresentationMode","pdfViewer","setDocument","setViewer","setExternalLinkRel","setExternalLinkTarget","setHistory","pagesCount","currentPageNumber","explicitDest","destRef","scrollPageIntoView","navigateTo","goToPage","rel","setHash","cachePageRef","isPageVisible","isPageCached","_excluded","_excluded2","pdfjs","defaultOnPassword","prompt","isParameterObject","forwardRef","inputRef","loading","noData","onItemClick","onLoadError","onLoadErrorProps","onLoadProgress","onLoadSuccess","onLoadSuccessProps","onSourceError","onSourceErrorProps","onSourceSuccess","onSourceSuccessProps","renderMode","otherProps","_objectWithoutProperties","sourceState","sourceDispatch","useResolver","sourceError","pdfState","pdfDispatch","pdf","pdfError","useRef","pages","prevFile","prevOptions","warning","useImperativeHandle","useEffect","findDocumentSource","useCallback","isDataURI","dataURItoByteString","displayCORSWarning","isArrayBuffer","isBrowser","isBlob","loadFromFile","otherParams","fileByteString","cancellable","makeCancellable","nextSource","cancelRunningTask","documentInitParams","destroyable","loadingPromise","nextPdf","registerPage","unregisterPage","childContext","useMemo","eventProps","makeEventProps","_jsx","clsx","Message","Boolean","resolvedChildren","DocumentContext","Provider","renderChildren","makeCancellablePromise","mergeRefs","inputRefs","_i","filteredInputRefs","filteredInputRefs_1","useDocumentContext","useContext","createContext","usePageContext","PageContext","documentContext","pageContext","mergedProps","onGetAnnotationsError","onGetAnnotationsErrorProps","onGetAnnotationsSuccess","onGetAnnotationsSuccessProps","onRenderAnnotationLayerError","onRenderAnnotationLayerErrorProps","onRenderAnnotationLayerSuccess","onRenderAnnotationLayerSuccessProps","annotationsState","annotationsDispatch","annotationsError","layerElement","runningTask","nextAnnotations","clonedViewport","annotationLayerParameters","renderParameters","innerHTML","onRenderError","PDF_ROLE_TO_HTML_ROLE","Document","DocumentFragment","Part","Sect","Div","Aside","NonStruct","P","H","Title","FENote","Sub","Lbl","Span","Em","Strong","Link","Annot","Form","Ruby","RB","RT","RP","Warichu","WT","WP","LI","LBody","Table","TR","TH","TD","THead","TBody","TFoot","Caption","Figure","Formula","Artifact","HEADING_PATTERN","isStructTreeNode","isStructTreeNodeWithOnlyContentChild","getRoleAttributes","isPdfRole","htmlRole","getBaseAttributes","childAttributes","getAttributes","StructTreeItem","StructTree","onGetStructTreeError","onGetStructTreeErrorProps","onGetStructTreeSuccess","onGetStructTreeSuccessProps","structTreeState","structTreeDispatch","structTree","structTreeError","customTextRenderer","nextStructTree","ANNOTATION_MODE","Canvas","props","_className","canvasBackground","getDevicePixelRatio","onRenderErrorProps","onRenderSuccess","onRenderSuccessProps","renderTextLayer","canvasRef","canvasElement","isCancelException","renderViewport","renderContext","makePageCallback","userSelect","onGetTextError","onGetTextSuccess","onRenderTextLayerError","onRenderTextLayerSuccess","textContentState","textContentDispatch","textContentError","nextTextContent","useLayoutEffect","layerChildren","forEach","itemIndex","isTextItem","onMouseUp","onMouseDown","defaultScale","Page","_enableRegisterUnregisterPage","customRenderer","CustomRenderer","onGetTextErrorProps","onGetTextSuccessProps","onRenderTextLayerErrorProps","onRenderTextLayerSuccessProps","pageIndexProps","pageNumberProps","renderAnnotationLayer","renderAnnotationLayerProps","renderTextLayerProps","rotateProps","scaleProps","pageState","pageDispatch","pageError","pageElement","isProvided","pageScale","scaleWithDefault","nextPage","pageKey","renderMainLayer","_jsxs","reducer","useReducer","allEvents","getArgs","eventHandler","isLocalFileSystem","variable","isDefined","isString","dataURI","headersString","dataString","allowFileAccessFromFilesTip","NOT_FOUND_ERR","SECURITY_ERR","ABORT_ERR","readAsArrayBuffer","module","exports"],"sourceRoot":""}