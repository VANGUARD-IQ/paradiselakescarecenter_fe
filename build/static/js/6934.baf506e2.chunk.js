"use strict";(self.webpackChunkbusiness_builder_master_frontend=self.webpackChunkbusiness_builder_master_frontend||[]).push([[6934],{96934:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ut});var r,o,i,s,l=n(89379),a=n(80045),c=n(57528),d=n(65043),u=n(30502),p=n(44093),h=n(22107),x=n(98939),g=n(96148),m=n(76659),j=n(39081),b=n(88787),y=n(85871),C=n(98662),S=n(10202),v=n(35699),D=n(28846),E=n(61724),f=n(87139),A=n(43533),I=n(25527),w=n(83169),T=n(24330),P=n(94217),N=n(53332),z=n(45973),M=n(80006),O=n(44860),k=n(78149),R=n(55182),U=n(94085),$=n(3109),L=n(31411),_=n(14566),G=n(51794),J=n(10227),W=n(26201),F=n(19077),H=n(57371),q=n(42703),B=n(73225),K=n(76668),V=n(73216),Z=n(70459),Y=n(10585),Q=n(31881),X=n(1009),ee=n(52003),te=n(63295),ne=n(95214),re=n(78460),oe=n(11054),ie=n(25722),se=n(15071),le=n(35929),ae=n(67516),ce=n(34946),de=n(56529),ue=n(80454),pe=n(39985),he=n(70579);const xe=(0,Z.J1)(r||(r=(0,c.A)(["\n  query GetOpportunityTasks($opportunityId: String!) {\n    opportunityTasks(opportunityId: $opportunityId) {\n      id\n      title\n      description\n      type\n      priority\n      status\n      dueDate\n      assignedTo\n      assignedToName\n      notes\n      isBlocking\n      createdAt\n      updatedAt\n    }\n  }\n"]))),ge=(0,Z.J1)(o||(o=(0,c.A)(["\n  mutation CreateOpportunityTask($input: OpportunityTaskInput!) {\n    createOpportunityTask(input: $input) {\n      id\n      title\n      status\n    }\n  }\n"]))),me=(0,Z.J1)(i||(i=(0,c.A)(["\n  mutation UpdateOpportunityTask($id: String!, $input: OpportunityTaskUpdateInput!) {\n    updateOpportunityTask(id: $id, input: $input) {\n      id\n      title\n      status\n    }\n  }\n"]))),je=(0,Z.J1)(s||(s=(0,c.A)(["\n  mutation DeleteOpportunityTask($id: String!) {\n    deleteOpportunityTask(id: $id)\n  }\n"]))),be=e=>{let{opportunityId:t}=e;const[n,r]=(0,d.useState)(!1),[o,i]=(0,d.useState)(null),[s,a]=(0,d.useState)({title:"",description:"",type:"OTHER",priority:"MEDIUM",dueDate:"",assignedTo:"",notes:"",isBlocking:!1}),c=(0,u.d)(),p=(0,pe.oU)("blue.500"),x="rgba(255, 255, 255, 0.1)",b="white",y="gray.400",{loading:D,data:A,refetch:I}=(0,Y.IT)(xe,{variables:{opportunityId:t}}),[w]=(0,Q.n)(ge,{onCompleted:()=>{c({title:"Task created",status:"success",duration:3e3,isClosable:!0}),I(),z()},onError:e=>{c({title:"Error creating task",description:e.message,status:"error",duration:5e3,isClosable:!0})}}),[T]=(0,Q.n)(me,{onCompleted:()=>{c({title:"Task updated",status:"success",duration:3e3,isClosable:!0}),I(),z()},onError:e=>{c({title:"Error updating task",description:e.message,status:"error",duration:5e3,isClosable:!0})}}),[P]=(0,Q.n)(je,{onCompleted:()=>{c({title:"Task deleted",status:"success",duration:3e3,isClosable:!0}),I()},onError:e=>{c({title:"Error deleting task",description:e.message,status:"error",duration:5e3,isClosable:!0})}}),N=e=>{e?(i(e),a({title:e.title,description:e.description||"",type:e.type,priority:e.priority,dueDate:e.dueDate?new Date(e.dueDate).toISOString().split("T")[0]:"",assignedTo:e.assignedTo||"",notes:e.notes||"",isBlocking:e.isBlocking||!1})):(i(null),a({title:"",description:"",type:"OTHER",priority:"MEDIUM",dueDate:"",assignedTo:"",notes:"",isBlocking:!1})),r(!0)},z=()=>{r(!1),i(null)},M=e=>{switch(e){case"URGENT":return"red";case"HIGH":return"orange";case"MEDIUM":return"yellow";case"LOW":return"green";default:return"gray"}},O=e=>{switch(e){case"COMPLETED":return"green";case"IN_PROGRESS":return"blue";case"PENDING":default:return"gray";case"CANCELLED":return"red";case"DEFERRED":return"purple"}};if(D)return(0,he.jsx)(h.a,{display:"flex",justifyContent:"center",py:8,children:(0,he.jsx)(m.y,{size:"xl",color:p})});const k=(null===A||void 0===A?void 0:A.opportunityTasks)||[];return(0,he.jsxs)(h.a,{children:[(0,he.jsxs)(g.z,{justify:"space-between",mb:4,children:[(0,he.jsxs)(j.E,{fontSize:"lg",fontWeight:"bold",color:b,children:["Tasks (",k.length,")"]}),(0,he.jsx)(C.$,{leftIcon:(0,he.jsx)(X.GGD,{}),onClick:()=>N(),size:"sm",bg:p,color:"white",_hover:{opacity:.8},children:"Add Task"})]}),(0,he.jsx)(S.T,{spacing:3,align:"stretch",children:0===k.length?(0,he.jsx)(j.E,{color:y,textAlign:"center",py:4,children:"No tasks yet. Create your first task to track activities for this opportunity."}):k.map(e=>(0,he.jsxs)(h.a,{p:4,bg:"linear-gradient(135deg, rgba(31, 37, 89, 0.8) 0%, rgba(17, 21, 51, 0.8) 100%)",borderRadius:"md",border:"1px",borderColor:x,children:[(0,he.jsxs)(g.z,{justify:"space-between",mb:2,children:[(0,he.jsxs)(g.z,{spacing:3,children:[(0,he.jsx)(q.K,{"aria-label":"Complete task",icon:(0,he.jsx)(X.YrT,{}),size:"sm",variant:"COMPLETED"===e.status?"solid":"outline",colorScheme:"COMPLETED"===e.status?"green":"gray",onClick:()=>(async(e,t)=>{await T({variables:{id:e,input:{status:t}}})})(e.id,"COMPLETED"===e.status?"PENDING":"COMPLETED")}),(0,he.jsxs)(S.T,{align:"start",spacing:0,children:[(0,he.jsx)(j.E,{fontWeight:"bold",color:b,children:e.title}),e.description&&(0,he.jsx)(j.E,{fontSize:"sm",color:y,children:e.description})]})]}),(0,he.jsxs)(g.z,{children:[(0,he.jsx)(q.K,{"aria-label":"Edit task",icon:(0,he.jsx)(X.SG1,{}),size:"sm",variant:"ghost",color:y,onClick:()=>N(e)}),(0,he.jsx)(q.K,{"aria-label":"Delete task",icon:(0,he.jsx)(X.IXo,{}),size:"sm",variant:"ghost",color:"red.400",onClick:()=>(async e=>{window.confirm("Are you sure you want to delete this task?")&&await P({variables:{id:e}})})(e.id)})]})]}),(0,he.jsxs)(g.z,{spacing:2,flexWrap:"wrap",children:[(0,he.jsx)(f.E,{colorScheme:M(e.priority),size:"sm",children:e.priority}),(0,he.jsx)(f.E,{colorScheme:O(e.status),size:"sm",children:e.status}),(0,he.jsx)(f.E,{colorScheme:"purple",size:"sm",children:e.type}),e.isBlocking&&(0,he.jsxs)(f.E,{colorScheme:"red",size:"sm",children:[(0,he.jsx)(X.y3G,{style:{marginRight:"4px"}}),"BLOCKING"]}),e.dueDate&&(0,he.jsxs)(f.E,{colorScheme:"blue",size:"sm",children:[(0,he.jsx)(X.wIk,{style:{marginRight:"4px"}}),(0,ue.GP)(new Date(e.dueDate),"MMM d, yyyy")]}),e.assignedToName&&(0,he.jsxs)(f.E,{colorScheme:"cyan",size:"sm",children:["Assigned to: ",e.assignedToName]})]})]},e.id))}),(0,he.jsxs)(re.aF,{isOpen:n,onClose:z,size:"lg",children:[(0,he.jsx)(oe.m,{}),(0,he.jsxs)(ie.$,{bg:"gray.800",borderColor:x,children:[(0,he.jsx)(se.r,{color:b,children:o?"Edit Task":"New Task"}),(0,he.jsx)(le.s,{color:y}),(0,he.jsx)(ae.c,{children:(0,he.jsxs)(S.T,{spacing:4,children:[(0,he.jsxs)(B.MJ,{isRequired:!0,children:[(0,he.jsx)(K.l,{color:y,children:"Title"}),(0,he.jsx)(v.p,{value:s.title,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{title:e.target.value})),placeholder:"Task title",bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:y,children:"Description"}),(0,he.jsx)(F.T,{value:s.description,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{description:e.target.value})),placeholder:"Task description",bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b})]}),(0,he.jsxs)(g.z,{spacing:4,width:"100%",children:[(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:y,children:"Type"}),(0,he.jsxs)(E.l,{value:s.type,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{type:e.target.value})),bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b,children:[(0,he.jsx)("option",{value:"CALL",children:"Call"}),(0,he.jsx)("option",{value:"EMAIL",children:"Email"}),(0,he.jsx)("option",{value:"MEETING",children:"Meeting"}),(0,he.jsx)("option",{value:"DEMO",children:"Demo"}),(0,he.jsx)("option",{value:"PROPOSAL",children:"Proposal"}),(0,he.jsx)("option",{value:"FOLLOW_UP",children:"Follow Up"}),(0,he.jsx)("option",{value:"RESEARCH",children:"Research"}),(0,he.jsx)("option",{value:"DOCUMENT",children:"Document"}),(0,he.jsx)("option",{value:"INTERNAL",children:"Internal"}),(0,he.jsx)("option",{value:"OTHER",children:"Other"})]})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:y,children:"Priority"}),(0,he.jsxs)(E.l,{value:s.priority,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{priority:e.target.value})),bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b,children:[(0,he.jsx)("option",{value:"LOW",children:"Low"}),(0,he.jsx)("option",{value:"MEDIUM",children:"Medium"}),(0,he.jsx)("option",{value:"HIGH",children:"High"}),(0,he.jsx)("option",{value:"URGENT",children:"Urgent"})]})]})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:y,children:"Due Date"}),(0,he.jsx)(v.p,{type:"date",value:s.dueDate,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{dueDate:e.target.value})),bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:y,children:"Notes"}),(0,he.jsx)(F.T,{value:s.notes,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{notes:e.target.value})),placeholder:"Additional notes",bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b})]}),(0,he.jsx)(B.MJ,{children:(0,he.jsx)(ce.S,{isChecked:s.isBlocking,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{isBlocking:e.target.checked})),colorScheme:"blue",color:y,children:"This task blocks opportunity progression"})})]})}),(0,he.jsxs)(de.j,{children:[(0,he.jsx)(C.$,{variant:"ghost",mr:3,onClick:z,color:y,children:"Cancel"}),(0,he.jsxs)(C.$,{colorScheme:"blue",onClick:async()=>{const e=(0,l.A)((0,l.A)({},s),{},{opportunityId:t});s.dueDate&&(e.dueDate=new Date(s.dueDate)),o?await T({variables:{id:o.id,input:(0,l.A)((0,l.A)({},s),{},{dueDate:s.dueDate?new Date(s.dueDate):null})}}):await w({variables:{input:e}})},bg:p,children:[o?"Update":"Create"," Task"]})]})]})]})]})};var ye,Ce,Se,ve,De=n(7189),Ee=n(82459);const fe=(0,Z.J1)(ye||(ye=(0,c.A)(["\n  query GetOpportunityMeetings($opportunityId: String!) {\n    opportunityMeetings(opportunityId: $opportunityId) {\n      id\n      title\n      description\n      type\n      status\n      format\n      scheduledDate\n      duration\n      location\n      address\n      meetingUrl\n      attendees {\n        name\n        email\n        role\n        company\n        isInternal\n        attended\n      }\n      objectives\n      notes\n      outcome\n      nextSteps\n      followUpDate\n      createdAt\n      organizerName\n    }\n  }\n"]))),Ae=(0,Z.J1)(Ce||(Ce=(0,c.A)(["\n  mutation CreateOpportunityMeeting($input: OpportunityMeetingInput!) {\n    createOpportunityMeeting(input: $input) {\n      id\n      title\n      status\n    }\n  }\n"]))),Ie=(0,Z.J1)(Se||(Se=(0,c.A)(["\n  mutation UpdateOpportunityMeeting($id: String!, $input: OpportunityMeetingUpdateInput!) {\n    updateOpportunityMeeting(id: $id, input: $input) {\n      id\n      title\n      status\n    }\n  }\n"]))),we=(0,Z.J1)(ve||(ve=(0,c.A)(["\n  mutation DeleteOpportunityMeeting($id: String!) {\n    deleteOpportunityMeeting(id: $id)\n  }\n"]))),Te=e=>{let{opportunityId:t}=e;const[n,r]=(0,d.useState)(!1),[o,i]=(0,d.useState)(null),[s,a]=(0,d.useState)({title:"",description:"",type:"OTHER",format:"VIDEO_CALL",scheduledDate:"",duration:60,location:"",address:"",meetingUrl:"",objectives:"",preparationNotes:"",notes:"",outcome:"",nextSteps:""}),c=(0,u.d)(),p=(0,pe.oU)("blue.500"),x="rgba(255, 255, 255, 0.1)",b="white",y="gray.400",{loading:D,data:A,refetch:I}=(0,Y.IT)(fe,{variables:{opportunityId:t}}),[w]=(0,Q.n)(Ae,{onCompleted:()=>{c({title:"Meeting scheduled",status:"success",duration:3e3,isClosable:!0}),I(),z()},onError:e=>{c({title:"Error creating meeting",description:e.message,status:"error",duration:5e3,isClosable:!0})}}),[T]=(0,Q.n)(Ie,{onCompleted:()=>{c({title:"Meeting updated",status:"success",duration:3e3,isClosable:!0}),I(),z()},onError:e=>{c({title:"Error updating meeting",description:e.message,status:"error",duration:5e3,isClosable:!0})}}),[P]=(0,Q.n)(we,{onCompleted:()=>{c({title:"Meeting deleted",status:"success",duration:3e3,isClosable:!0}),I()},onError:e=>{c({title:"Error deleting meeting",description:e.message,status:"error",duration:5e3,isClosable:!0})}}),N=e=>{if(e){i(e);const t=new Date(e.scheduledDate).toISOString().slice(0,16);a({title:e.title,description:e.description||"",type:e.type,format:e.format,scheduledDate:t,duration:e.duration,location:e.location||"",address:e.address||"",meetingUrl:e.meetingUrl||"",objectives:e.objectives||"",preparationNotes:e.preparationNotes||"",notes:e.notes||"",outcome:e.outcome||"",nextSteps:e.nextSteps||""})}else i(null),a({title:"",description:"",type:"OTHER",format:"VIDEO_CALL",scheduledDate:"",duration:60,location:"",address:"",meetingUrl:"",objectives:"",preparationNotes:"",notes:"",outcome:"",nextSteps:""});r(!0)},z=()=>{r(!1),i(null)},M=e=>{switch(e){case"SCHEDULED":return"blue";case"IN_PROGRESS":return"yellow";case"COMPLETED":return"green";case"CANCELLED":return"red";case"NO_SHOW":return"orange";case"RESCHEDULED":return"purple";default:return"gray"}},O=e=>{switch(e){case"VIDEO_CALL":return(0,he.jsx)(X.pVQ,{});case"PHONE_CALL":return(0,he.jsx)(X.QFc,{});case"IN_PERSON":return(0,he.jsx)(X.HzC,{});default:return(0,he.jsx)(X.cfS,{})}};if(D)return(0,he.jsx)(h.a,{display:"flex",justifyContent:"center",py:8,children:(0,he.jsx)(m.y,{size:"xl",color:p})});const k=(null===A||void 0===A?void 0:A.opportunityMeetings)||[];return(0,he.jsxs)(h.a,{children:[(0,he.jsxs)(g.z,{justify:"space-between",mb:4,children:[(0,he.jsxs)(j.E,{fontSize:"lg",fontWeight:"bold",color:b,children:["Meetings (",k.length,")"]}),(0,he.jsx)(C.$,{leftIcon:(0,he.jsx)(X.GGD,{}),onClick:()=>N(),size:"sm",bg:p,color:"white",_hover:{opacity:.8},children:"Schedule Meeting"})]}),(0,he.jsx)(S.T,{spacing:3,align:"stretch",children:0===k.length?(0,he.jsx)(j.E,{color:y,textAlign:"center",py:4,children:"No meetings scheduled yet. Schedule your first meeting to track discussions with this opportunity."}):k.map(e=>(0,he.jsxs)(h.a,{p:4,bg:"linear-gradient(135deg, rgba(31, 37, 89, 0.8) 0%, rgba(17, 21, 51, 0.8) 100%)",borderRadius:"md",border:"1px",borderColor:x,children:[(0,he.jsxs)(g.z,{justify:"space-between",mb:3,children:[(0,he.jsxs)(S.T,{align:"start",spacing:1,children:[(0,he.jsxs)(g.z,{children:[(0,he.jsx)(h.a,{color:p,children:O(e.format)}),(0,he.jsx)(j.E,{fontWeight:"bold",color:b,fontSize:"lg",children:e.title})]}),e.description&&(0,he.jsx)(j.E,{fontSize:"sm",color:y,children:e.description})]}),(0,he.jsxs)(g.z,{children:[(0,he.jsx)(q.K,{"aria-label":"Edit meeting",icon:(0,he.jsx)(X.SG1,{}),size:"sm",variant:"ghost",color:y,onClick:()=>N(e)}),(0,he.jsx)(q.K,{"aria-label":"Delete meeting",icon:(0,he.jsx)(X.IXo,{}),size:"sm",variant:"ghost",color:"red.400",onClick:()=>(async e=>{window.confirm("Are you sure you want to delete this meeting?")&&await P({variables:{id:e}})})(e.id)})]})]}),(0,he.jsxs)(S.T,{align:"stretch",spacing:2,children:[(0,he.jsxs)(g.z,{spacing:3,flexWrap:"wrap",children:[(0,he.jsx)(f.E,{colorScheme:M(e.status),size:"sm",children:e.status}),(0,he.jsx)(f.E,{colorScheme:"purple",size:"sm",children:e.type}),(0,he.jsxs)(g.z,{spacing:1,children:[(0,he.jsx)(X.wIk,{size:"14",color:y}),(0,he.jsx)(j.E,{fontSize:"sm",color:y,children:(0,ue.GP)(new Date(e.scheduledDate),"MMM d, yyyy h:mm a")})]}),(0,he.jsxs)(g.z,{spacing:1,children:[(0,he.jsx)(X.Ohp,{size:"14",color:y}),(0,he.jsxs)(j.E,{fontSize:"sm",color:y,children:[e.duration," mins"]})]})]}),(e.location||e.meetingUrl)&&(0,he.jsxs)(g.z,{spacing:3,children:[e.location&&(0,he.jsxs)(j.E,{fontSize:"sm",color:y,children:[(0,he.jsx)(X.HzC,{style:{display:"inline",marginRight:"4px"}}),e.location]}),e.meetingUrl&&(0,he.jsxs)(De.N,{href:e.meetingUrl,isExternal:!0,color:p,fontSize:"sm",children:[(0,he.jsx)(X.ayE,{style:{display:"inline",marginRight:"4px"}}),"Join Meeting"]})]}),e.objectives&&(0,he.jsxs)(h.a,{children:[(0,he.jsx)(j.E,{fontSize:"xs",color:y,fontWeight:"bold",mb:1,children:"Objectives:"}),(0,he.jsx)(j.E,{fontSize:"sm",color:b,children:e.objectives})]}),e.outcome&&(0,he.jsxs)(h.a,{children:[(0,he.jsx)(j.E,{fontSize:"xs",color:y,fontWeight:"bold",mb:1,children:"Outcome:"}),(0,he.jsx)(j.E,{fontSize:"sm",color:b,children:e.outcome})]}),e.attendees&&e.attendees.length>0&&(0,he.jsxs)(h.a,{children:[(0,he.jsxs)(j.E,{fontSize:"xs",color:y,fontWeight:"bold",mb:1,children:["Attendees (",e.attendees.length,"):"]}),(0,he.jsx)(g.z,{spacing:2,flexWrap:"wrap",children:e.attendees.map((e,t)=>(0,he.jsxs)(f.E,{colorScheme:e.isInternal?"blue":"green",size:"sm",children:[e.name," ",e.role&&"(".concat(e.role,")")]},t))})]})]})]},e.id))}),(0,he.jsxs)(re.aF,{isOpen:n,onClose:z,size:"xl",children:[(0,he.jsx)(oe.m,{}),(0,he.jsxs)(ie.$,{bg:"gray.800",borderColor:x,children:[(0,he.jsx)(se.r,{color:b,children:o?"Edit Meeting":"Schedule Meeting"}),(0,he.jsx)(le.s,{color:y}),(0,he.jsx)(ae.c,{children:(0,he.jsxs)(S.T,{spacing:4,children:[(0,he.jsxs)(B.MJ,{isRequired:!0,children:[(0,he.jsx)(K.l,{color:y,children:"Meeting Title"}),(0,he.jsx)(v.p,{value:s.title,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{title:e.target.value})),placeholder:"e.g., Product Demo Call",bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:y,children:"Description"}),(0,he.jsx)(F.T,{value:s.description,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{description:e.target.value})),placeholder:"Meeting description",bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b})]}),(0,he.jsxs)(g.z,{spacing:4,width:"100%",children:[(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:y,children:"Meeting Type"}),(0,he.jsxs)(E.l,{value:s.type,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{type:e.target.value})),bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b,children:[(0,he.jsx)("option",{value:"INITIAL_CALL",children:"Initial Call"}),(0,he.jsx)("option",{value:"DISCOVERY",children:"Discovery"}),(0,he.jsx)("option",{value:"DEMO",children:"Demo"}),(0,he.jsx)("option",{value:"PROPOSAL_PRESENTATION",children:"Proposal Presentation"}),(0,he.jsx)("option",{value:"NEGOTIATION",children:"Negotiation"}),(0,he.jsx)("option",{value:"CLOSING",children:"Closing"}),(0,he.jsx)("option",{value:"CHECK_IN",children:"Check In"}),(0,he.jsx)("option",{value:"REVIEW",children:"Review"}),(0,he.jsx)("option",{value:"OTHER",children:"Other"})]})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:y,children:"Format"}),(0,he.jsxs)(E.l,{value:s.format,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{format:e.target.value})),bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b,children:[(0,he.jsx)("option",{value:"VIDEO_CALL",children:"Video Call"}),(0,he.jsx)("option",{value:"PHONE_CALL",children:"Phone Call"}),(0,he.jsx)("option",{value:"IN_PERSON",children:"In Person"}),(0,he.jsx)("option",{value:"HYBRID",children:"Hybrid"})]})]})]}),(0,he.jsxs)(g.z,{spacing:4,width:"100%",children:[(0,he.jsxs)(B.MJ,{isRequired:!0,children:[(0,he.jsx)(K.l,{color:y,children:"Date & Time"}),(0,he.jsx)(v.p,{type:"datetime-local",value:s.scheduledDate,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{scheduledDate:e.target.value})),bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:y,children:"Duration (minutes)"}),(0,he.jsx)(v.p,{type:"number",value:s.duration,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{duration:parseInt(e.target.value)||60})),bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b})]})]}),"IN_PERSON"===s.format||"HYBRID"===s.format?(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:y,children:"Location"}),(0,he.jsx)(v.p,{value:s.location,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{location:e.target.value})),placeholder:"Meeting location",bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b})]}):(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:y,children:"Meeting Link"}),(0,he.jsx)(v.p,{value:s.meetingUrl,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{meetingUrl:e.target.value})),placeholder:"https://zoom.us/j/...",bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:y,children:"Objectives"}),(0,he.jsx)(F.T,{value:s.objectives,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{objectives:e.target.value})),placeholder:"What do you want to achieve in this meeting?",bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b})]}),o&&(0,he.jsxs)(he.Fragment,{children:[(0,he.jsx)(Ee.c,{borderColor:x}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:y,children:"Meeting Notes"}),(0,he.jsx)(F.T,{value:s.notes,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{notes:e.target.value})),placeholder:"Notes from the meeting",bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b,minH:"100px"})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:y,children:"Outcome"}),(0,he.jsx)(F.T,{value:s.outcome,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{outcome:e.target.value})),placeholder:"What was the outcome of the meeting?",bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:y,children:"Next Steps"}),(0,he.jsx)(F.T,{value:s.nextSteps,onChange:e=>a((0,l.A)((0,l.A)({},s),{},{nextSteps:e.target.value})),placeholder:"What are the next steps?",bg:"rgba(255, 255, 255, 0.05)",borderColor:x,color:b})]})]})]})}),(0,he.jsxs)(de.j,{children:[(0,he.jsx)(C.$,{variant:"ghost",mr:3,onClick:z,color:y,children:"Cancel"}),(0,he.jsxs)(C.$,{colorScheme:"blue",onClick:async()=>{const e=(0,l.A)((0,l.A)({},s),{},{opportunityId:t,scheduledDate:new Date(s.scheduledDate),duration:Number(s.duration)});if(o){const e=(0,l.A)((0,l.A)({},s),{},{scheduledDate:new Date(s.scheduledDate),duration:Number(s.duration)});await T({variables:{id:o.id,input:e}})}else await w({variables:{input:e}})},bg:p,children:[o?"Update":"Schedule"," Meeting"]})]})]})]})]})};var Pe,Ne,ze,Me;const Oe=(0,Z.J1)(Pe||(Pe=(0,c.A)(["\n  query GetOpportunityNotes($opportunityId: String!) {\n    opportunityNotes(opportunityId: $opportunityId) {\n      id\n      title\n      content\n      type\n      priority\n      visibility\n      isPinned\n      isActionable\n      isDecisionFactor\n      isRisk\n      isOpportunity\n      sentiment\n      contactPerson\n      contactEmail\n      followUpRequired\n      followUpDate\n      followUpAction\n      followUpCompleted\n      tags\n      category\n      createdAt\n      createdByName\n      lastEditedAt\n      lastEditedByName\n    }\n  }\n"]))),ke=(0,Z.J1)(Ne||(Ne=(0,c.A)(["\n  mutation CreateOpportunityNote($input: OpportunityNoteInput!) {\n    createOpportunityNote(input: $input) {\n      id\n      title\n    }\n  }\n"]))),Re=(0,Z.J1)(ze||(ze=(0,c.A)(["\n  mutation UpdateOpportunityNote($id: String!, $input: OpportunityNoteUpdateInput!) {\n    updateOpportunityNote(id: $id, input: $input) {\n      id\n      title\n    }\n  }\n"]))),Ue=(0,Z.J1)(Me||(Me=(0,c.A)(["\n  mutation DeleteOpportunityNote($id: String!) {\n    deleteOpportunityNote(id: $id)\n  }\n"]))),$e=e=>{let{opportunityId:t}=e;const[n,r]=(0,d.useState)(!1),[o,i]=(0,d.useState)(null),[s,a]=(0,d.useState)(new Set),[c,p]=(0,d.useState)({title:"",content:"",type:"GENERAL",priority:"MEDIUM",visibility:"PUBLIC",contactPerson:"",contactEmail:"",isPinned:!1,isActionable:!1,isDecisionFactor:!1,isRisk:!1,isOpportunity:!1,sentiment:"",followUpRequired:!1,followUpDate:"",followUpAction:"",tags:[],category:""}),x=(0,u.d)(),b=(0,pe.oU)("blue.500"),y="rgba(255, 255, 255, 0.1)",D="white",A="gray.400",{loading:I,data:P,refetch:N}=(0,Y.IT)(Oe,{variables:{opportunityId:t}}),[z]=(0,Q.n)(ke,{onCompleted:()=>{x({title:"Note created",status:"success",duration:3e3,isClosable:!0}),N(),R()},onError:e=>{x({title:"Error creating note",description:e.message,status:"error",duration:5e3,isClosable:!0})}}),[M]=(0,Q.n)(Re,{onCompleted:()=>{x({title:"Note updated",status:"success",duration:3e3,isClosable:!0}),N(),R()},onError:e=>{x({title:"Error updating note",description:e.message,status:"error",duration:5e3,isClosable:!0})}}),[O]=(0,Q.n)(Ue,{onCompleted:()=>{x({title:"Note deleted",status:"success",duration:3e3,isClosable:!0}),N()},onError:e=>{x({title:"Error deleting note",description:e.message,status:"error",duration:5e3,isClosable:!0})}}),k=e=>{e?(i(e),p({title:e.title,content:e.content,type:e.type,priority:e.priority,visibility:e.visibility,contactPerson:e.contactPerson||"",contactEmail:e.contactEmail||"",isPinned:e.isPinned||!1,isActionable:e.isActionable||!1,isDecisionFactor:e.isDecisionFactor||!1,isRisk:e.isRisk||!1,isOpportunity:e.isOpportunity||!1,sentiment:e.sentiment||"",followUpRequired:e.followUpRequired||!1,followUpDate:e.followUpDate?new Date(e.followUpDate).toISOString().split("T")[0]:"",followUpAction:e.followUpAction||"",tags:e.tags||[],category:e.category||""})):(i(null),p({title:"",content:"",type:"GENERAL",priority:"MEDIUM",visibility:"PUBLIC",contactPerson:"",contactEmail:"",isPinned:!1,isActionable:!1,isDecisionFactor:!1,isRisk:!1,isOpportunity:!1,sentiment:"",followUpRequired:!1,followUpDate:"",followUpAction:"",tags:[],category:""})),r(!0)},R=()=>{r(!1),i(null)},U=e=>{switch(e){case"CRITICAL":return"red";case"HIGH":return"orange";case"MEDIUM":return"yellow";case"LOW":return"green";default:return"gray"}},$=e=>{switch(e){case"CALL_NOTES":return"blue";case"MEETING_NOTES":return"purple";case"EMAIL_SUMMARY":return"cyan";case"CUSTOMER_FEEDBACK":return"green";case"COMPETITOR_INTEL":case"RISK_ASSESSMENT":return"red";case"PRICING_DISCUSSION":return"orange";case"WIN_LOSS_ANALYSIS":return"yellow";default:return"gray"}};if(I)return(0,he.jsx)(h.a,{display:"flex",justifyContent:"center",py:8,children:(0,he.jsx)(m.y,{size:"xl",color:b})});const L=(null===P||void 0===P?void 0:P.opportunityNotes)||[],_=[...L.filter(e=>e.isPinned),...L.filter(e=>!e.isPinned)];return(0,he.jsxs)(h.a,{children:[(0,he.jsxs)(g.z,{justify:"space-between",mb:4,children:[(0,he.jsxs)(j.E,{fontSize:"lg",fontWeight:"bold",color:D,children:["Notes (",L.length,")"]}),(0,he.jsx)(C.$,{leftIcon:(0,he.jsx)(X.GGD,{}),onClick:()=>k(),size:"sm",bg:b,color:"white",_hover:{opacity:.8},children:"Add Note"})]}),(0,he.jsx)(S.T,{spacing:3,align:"stretch",children:0===_.length?(0,he.jsx)(j.E,{color:A,textAlign:"center",py:4,children:"No notes yet. Add notes to capture important information about this opportunity."}):_.map(e=>{const t=s.has(e.id),n=e.content.length>150&&!t?e.content.substring(0,150)+"...":e.content;return(0,he.jsx)(w.Z,{bg:"linear-gradient(135deg, rgba(31, 37, 89, 0.8) 0%, rgba(17, 21, 51, 0.8) 100%)",borderRadius:"md",border:"1px",borderColor:e.isPinned?b:y,position:"relative",children:(0,he.jsxs)(T.b,{children:[e.isPinned&&(0,he.jsxs)(f.E,{position:"absolute",top:2,right:2,colorScheme:"blue",variant:"solid",children:[(0,he.jsx)(X.Y19,{style:{marginRight:"4px"}}),"Pinned"]}),(0,he.jsxs)(S.T,{align:"stretch",spacing:3,children:[(0,he.jsxs)(g.z,{justify:"space-between",children:[(0,he.jsxs)(S.T,{align:"start",spacing:1,flex:"1",children:[(0,he.jsx)(j.E,{fontWeight:"bold",color:D,fontSize:"lg",children:e.title}),(0,he.jsxs)(g.z,{spacing:2,flexWrap:"wrap",children:[(0,he.jsx)(f.E,{colorScheme:U(e.priority),size:"sm",children:e.priority}),(0,he.jsx)(f.E,{colorScheme:$(e.type),size:"sm",children:e.type.replace(/_/g," ")}),e.isActionable&&(0,he.jsxs)(f.E,{colorScheme:"orange",size:"sm",children:[(0,he.jsx)(X.A3x,{style:{marginRight:"2px"}}),"Actionable"]}),e.isRisk&&(0,he.jsxs)(f.E,{colorScheme:"red",size:"sm",children:[(0,he.jsx)(X.y3G,{style:{marginRight:"2px"}}),"Risk"]}),e.isOpportunity&&(0,he.jsxs)(f.E,{colorScheme:"green",size:"sm",children:[(0,he.jsx)(X.ARf,{style:{marginRight:"2px"}}),"Opportunity"]}),e.isDecisionFactor&&(0,he.jsx)(f.E,{colorScheme:"purple",size:"sm",children:"Decision Factor"})]})]}),(0,he.jsxs)(g.z,{children:[(0,he.jsx)(q.K,{"aria-label":"Pin note",icon:(0,he.jsx)(X.Y19,{}),size:"sm",variant:"ghost",color:e.isPinned?b:A,onClick:()=>(async e=>{await M({variables:{id:e.id,input:{isPinned:!e.isPinned}}})})(e)}),(0,he.jsx)(q.K,{"aria-label":"Edit note",icon:(0,he.jsx)(X.SG1,{}),size:"sm",variant:"ghost",color:A,onClick:()=>k(e)}),(0,he.jsx)(q.K,{"aria-label":"Delete note",icon:(0,he.jsx)(X.IXo,{}),size:"sm",variant:"ghost",color:"red.400",onClick:()=>(async e=>{window.confirm("Are you sure you want to delete this note?")&&await O({variables:{id:e}})})(e.id)})]})]}),(0,he.jsx)(j.E,{color:D,whiteSpace:"pre-wrap",children:n}),e.content.length>150&&(0,he.jsx)(C.$,{size:"sm",variant:"link",color:b,onClick:()=>(e=>{const t=new Set(s);t.has(e)?t.delete(e):t.add(e),a(t)})(e.id),children:t?"Show less":"Read more"}),e.contactPerson&&(0,he.jsxs)(g.z,{children:[(0,he.jsx)(X.JXP,{color:A}),(0,he.jsxs)(j.E,{fontSize:"sm",color:A,children:["Contact: ",e.contactPerson,e.contactEmail&&" (".concat(e.contactEmail,")")]})]}),e.followUpRequired&&(0,he.jsxs)(h.a,{p:2,bg:"rgba(255, 255, 255, 0.05)",borderRadius:"md",children:[(0,he.jsx)(j.E,{fontSize:"sm",color:"orange.300",fontWeight:"bold",children:"Follow-up Required"}),e.followUpDate&&(0,he.jsxs)(j.E,{fontSize:"sm",color:A,children:["Due: ",(0,ue.GP)(new Date(e.followUpDate),"MMM d, yyyy")]}),e.followUpAction&&(0,he.jsxs)(j.E,{fontSize:"sm",color:A,children:["Action: ",e.followUpAction]})]}),(0,he.jsx)(Ee.c,{borderColor:y}),(0,he.jsxs)(g.z,{justify:"space-between",children:[(0,he.jsxs)(j.E,{fontSize:"xs",color:A,children:["Created by ",e.createdByName," on ",(0,ue.GP)(new Date(e.createdAt),"MMM d, yyyy h:mm a")]}),e.lastEditedAt&&(0,he.jsxs)(j.E,{fontSize:"xs",color:A,children:["Edited by ",e.lastEditedByName]})]})]})]})},e.id)})}),(0,he.jsxs)(re.aF,{isOpen:n,onClose:R,size:"xl",children:[(0,he.jsx)(oe.m,{}),(0,he.jsxs)(ie.$,{bg:"gray.800",borderColor:y,maxH:"90vh",overflowY:"auto",children:[(0,he.jsx)(se.r,{color:D,children:o?"Edit Note":"New Note"}),(0,he.jsx)(le.s,{color:A}),(0,he.jsx)(ae.c,{children:(0,he.jsxs)(S.T,{spacing:4,children:[(0,he.jsxs)(B.MJ,{isRequired:!0,children:[(0,he.jsx)(K.l,{color:A,children:"Title"}),(0,he.jsx)(v.p,{value:c.title,onChange:e=>p((0,l.A)((0,l.A)({},c),{},{title:e.target.value})),placeholder:"Note title",bg:"rgba(255, 255, 255, 0.05)",borderColor:y,color:D})]}),(0,he.jsxs)(B.MJ,{isRequired:!0,children:[(0,he.jsx)(K.l,{color:A,children:"Content"}),(0,he.jsx)(F.T,{value:c.content,onChange:e=>p((0,l.A)((0,l.A)({},c),{},{content:e.target.value})),placeholder:"Write your note here...",bg:"rgba(255, 255, 255, 0.05)",borderColor:y,color:D,minH:"150px"})]}),(0,he.jsxs)(g.z,{spacing:4,width:"100%",children:[(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:A,children:"Type"}),(0,he.jsxs)(E.l,{value:c.type,onChange:e=>p((0,l.A)((0,l.A)({},c),{},{type:e.target.value})),bg:"rgba(255, 255, 255, 0.05)",borderColor:y,color:D,children:[(0,he.jsx)("option",{value:"GENERAL",children:"General"}),(0,he.jsx)("option",{value:"CALL_NOTES",children:"Call Notes"}),(0,he.jsx)("option",{value:"MEETING_NOTES",children:"Meeting Notes"}),(0,he.jsx)("option",{value:"EMAIL_SUMMARY",children:"Email Summary"}),(0,he.jsx)("option",{value:"INTERNAL",children:"Internal"}),(0,he.jsx)("option",{value:"CUSTOMER_FEEDBACK",children:"Customer Feedback"}),(0,he.jsx)("option",{value:"COMPETITOR_INTEL",children:"Competitor Intel"}),(0,he.jsx)("option",{value:"TECHNICAL_REQUIREMENTS",children:"Technical Requirements"}),(0,he.jsx)("option",{value:"PRICING_DISCUSSION",children:"Pricing Discussion"}),(0,he.jsx)("option",{value:"DECISION_CRITERIA",children:"Decision Criteria"}),(0,he.jsx)("option",{value:"RISK_ASSESSMENT",children:"Risk Assessment"}),(0,he.jsx)("option",{value:"WIN_LOSS_ANALYSIS",children:"Win/Loss Analysis"}),(0,he.jsx)("option",{value:"OTHER",children:"Other"})]})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:A,children:"Priority"}),(0,he.jsxs)(E.l,{value:c.priority,onChange:e=>p((0,l.A)((0,l.A)({},c),{},{priority:e.target.value})),bg:"rgba(255, 255, 255, 0.05)",borderColor:y,color:D,children:[(0,he.jsx)("option",{value:"LOW",children:"Low"}),(0,he.jsx)("option",{value:"MEDIUM",children:"Medium"}),(0,he.jsx)("option",{value:"HIGH",children:"High"}),(0,he.jsx)("option",{value:"CRITICAL",children:"Critical"})]})]})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:A,children:"Contact Person"}),(0,he.jsx)(v.p,{value:c.contactPerson,onChange:e=>p((0,l.A)((0,l.A)({},c),{},{contactPerson:e.target.value})),placeholder:"Name of contact person",bg:"rgba(255, 255, 255, 0.05)",borderColor:y,color:D})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:A,children:"Contact Email"}),(0,he.jsx)(v.p,{type:"email",value:c.contactEmail,onChange:e=>p((0,l.A)((0,l.A)({},c),{},{contactEmail:e.target.value})),placeholder:"contact@example.com",bg:"rgba(255, 255, 255, 0.05)",borderColor:y,color:D})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:A,children:"Flags"}),(0,he.jsxs)(S.T,{align:"start",spacing:2,children:[(0,he.jsx)(ce.S,{isChecked:c.isPinned,onChange:e=>p((0,l.A)((0,l.A)({},c),{},{isPinned:e.target.checked})),colorScheme:"blue",color:A,children:"Pin to top"}),(0,he.jsx)(ce.S,{isChecked:c.isActionable,onChange:e=>p((0,l.A)((0,l.A)({},c),{},{isActionable:e.target.checked})),colorScheme:"orange",color:A,children:"Requires action"}),(0,he.jsx)(ce.S,{isChecked:c.isDecisionFactor,onChange:e=>p((0,l.A)((0,l.A)({},c),{},{isDecisionFactor:e.target.checked})),colorScheme:"purple",color:A,children:"Influences buying decision"}),(0,he.jsx)(ce.S,{isChecked:c.isRisk,onChange:e=>p((0,l.A)((0,l.A)({},c),{},{isRisk:e.target.checked})),colorScheme:"red",color:A,children:"Represents a risk"}),(0,he.jsx)(ce.S,{isChecked:c.isOpportunity,onChange:e=>p((0,l.A)((0,l.A)({},c),{},{isOpportunity:e.target.checked})),colorScheme:"green",color:A,children:"Upsell/expansion opportunity"})]})]}),(0,he.jsx)(B.MJ,{children:(0,he.jsx)(ce.S,{isChecked:c.followUpRequired,onChange:e=>p((0,l.A)((0,l.A)({},c),{},{followUpRequired:e.target.checked})),colorScheme:"orange",color:A,children:"Follow-up required"})}),c.followUpRequired&&(0,he.jsxs)(he.Fragment,{children:[(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:A,children:"Follow-up Date"}),(0,he.jsx)(v.p,{type:"date",value:c.followUpDate,onChange:e=>p((0,l.A)((0,l.A)({},c),{},{followUpDate:e.target.value})),bg:"rgba(255, 255, 255, 0.05)",borderColor:y,color:D})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:A,children:"Follow-up Action"}),(0,he.jsx)(v.p,{value:c.followUpAction,onChange:e=>p((0,l.A)((0,l.A)({},c),{},{followUpAction:e.target.value})),placeholder:"What action needs to be taken?",bg:"rgba(255, 255, 255, 0.05)",borderColor:y,color:D})]})]})]})}),(0,he.jsxs)(de.j,{children:[(0,he.jsx)(C.$,{variant:"ghost",mr:3,onClick:R,color:A,children:"Cancel"}),(0,he.jsxs)(C.$,{colorScheme:"blue",onClick:async()=>{const e=(0,l.A)((0,l.A)({},c),{},{opportunityId:t});c.followUpDate&&(e.followUpDate=new Date(c.followUpDate)),o?await M({variables:{id:o.id,input:(0,l.A)((0,l.A)({},c),{},{followUpDate:c.followUpDate?new Date(c.followUpDate):null})}}):await z({variables:{input:e}})},bg:b,children:[o?"Update":"Create"," Note"]})]})]})]})]})};var Le,_e,Ge,Je,We,Fe=n(96870),He=n(5371),qe=n(73669),Be=n(80511),Ke=n(3313),Ve=n(55395),Ze=n(83201),Ye=n(82595),Qe=n(67813),Xe=n(47726),et=n(12730),tt=n(99973),nt=n(58584),rt=n(66037);const ot=(0,Z.J1)(Le||(Le=(0,c.A)(["\n  query GetOpportunityMembers($opportunityId: String!) {\n    opportunityMembers(opportunityId: $opportunityId) {\n      id\n      clientId\n      clientName\n      clientEmail\n      role\n      notes\n      isActive\n      totalEarned\n      totalPending\n    }\n  }\n"]))),it=(0,Z.J1)(_e||(_e=(0,c.A)(["\n  query GetClients {\n    clients {\n      id\n      fName\n      lName\n      email\n    }\n  }\n"]))),st=(0,Z.J1)(Ge||(Ge=(0,c.A)(["\n  mutation AddOpportunityMember($opportunityId: String!, $input: OpportunityMemberInput!) {\n    addOpportunityMember(opportunityId: $opportunityId, input: $input) {\n      id\n      clientId\n      clientName\n    }\n  }\n"]))),lt=(0,Z.J1)(Je||(Je=(0,c.A)(["\n  mutation UpdateOpportunityMember($id: String!, $input: OpportunityMemberUpdateInput!) {\n    updateOpportunityMember(id: $id, input: $input) {\n      id\n      role\n    }\n  }\n"]))),at=(0,Z.J1)(We||(We=(0,c.A)(["\n  mutation RemoveOpportunityMember($id: String!) {\n    removeOpportunityMember(id: $id)\n  }\n"]))),ct=e=>{let{opportunityId:t,onMembersUpdate:n}=e;(0,rt.H)("Opportunity Members");const r=(0,u.d)(),{colorMode:o}=(0,p.G6)(),{isOpen:i,onOpen:s,onClose:a}=(0,Fe.j)(),[c,x]=(0,d.useState)(null),[m,b]=(0,d.useState)(!1),y=(0,pe.oU)("background.cardGradient",o),D=(0,pe.oU)("border.darkCard",o),A=(0,pe.oU)("light"===o?"text.primary":"text.primaryDark",o),I=(0,pe.oU)("light"===o?"text.secondary":"text.secondaryDark",o),w=(0,pe.oU)("light"===o?"text.muted":"text.mutedDark",o),[T,P]=(0,d.useState)({clientId:"",role:"",notes:""}),{data:N,refetch:z}=(0,Y.IT)(ot,{variables:{opportunityId:t},skip:!t}),{data:M}=(0,Y.IT)(it),[O]=(0,Q.n)(st),[k]=(0,Q.n)(lt),[R]=(0,Q.n)(at),U=(null===N||void 0===N?void 0:N.opportunityMembers)||[],$=((null===M||void 0===M?void 0:M.clients)||[]).filter(e=>!U.some(t=>t.clientId===e.id)),L=e=>{e?(x(e),P({clientId:e.clientId,role:e.role||"",notes:e.notes||""}),b(!0)):(x(null),P({clientId:"",role:"",notes:""}),b(!1)),s()};return(0,he.jsxs)(h.a,{bg:y,p:6,borderRadius:"lg",border:"1px",borderColor:D,children:[(0,he.jsxs)(He.s,{mb:4,align:"center",children:[(0,he.jsx)(j.E,{fontSize:"lg",fontWeight:"bold",children:"Team Members"}),(0,he.jsx)(qe.h,{}),(0,he.jsx)(C.$,{leftIcon:(0,he.jsx)(et.R,{}),colorScheme:"blue",size:"sm",onClick:()=>L(),children:"Add Member"})]}),0===U.length?(0,he.jsxs)(h.a,{p:8,textAlign:"center",children:[(0,he.jsx)(j.E,{color:I,children:"No team members added yet"}),(0,he.jsx)(j.E,{fontSize:"sm",mt:2,color:w,children:"Add members to configure commission splits per payment type"})]}):(0,he.jsxs)(Be.X,{variant:"simple",size:"sm",children:[(0,he.jsx)(Ke.d,{children:(0,he.jsxs)(Ve.Tr,{children:[(0,he.jsx)(Ze.Th,{children:"Member"}),(0,he.jsx)(Ze.Th,{children:"Role"}),(0,he.jsx)(Ze.Th,{isNumeric:!0,children:"Total Earned"}),(0,he.jsx)(Ze.Th,{isNumeric:!0,children:"Pending"}),(0,he.jsx)(Ze.Th,{children:"Actions"})]})}),(0,he.jsx)(Ye.N,{children:U.map(e=>(0,he.jsxs)(Ve.Tr,{children:[(0,he.jsx)(Qe.Td,{children:(0,he.jsxs)(S.T,{align:"start",spacing:0,children:[(0,he.jsx)(j.E,{fontWeight:"medium",color:A,children:e.clientName}),(0,he.jsx)(j.E,{fontSize:"xs",color:w,children:e.clientEmail})]})}),(0,he.jsx)(Qe.Td,{children:(0,he.jsx)(f.E,{colorScheme:"blue",children:e.role||"Team Member"})}),(0,he.jsxs)(Qe.Td,{isNumeric:!0,children:["$",(e.totalEarned||0).toLocaleString()]}),(0,he.jsxs)(Qe.Td,{isNumeric:!0,children:["$",(e.totalPending||0).toLocaleString()]}),(0,he.jsx)(Qe.Td,{children:(0,he.jsxs)(g.z,{spacing:1,children:[(0,he.jsx)(Xe.m,{label:"Edit member",children:(0,he.jsx)(q.K,{"aria-label":"Edit",icon:(0,he.jsx)(tt.q,{}),size:"sm",variant:"ghost",onClick:()=>L(e)})}),(0,he.jsx)(Xe.m,{label:"Remove member",children:(0,he.jsx)(q.K,{"aria-label":"Remove",icon:(0,he.jsx)(nt.d,{}),size:"sm",variant:"ghost",colorScheme:"red",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to remove this member?"))try{await R({variables:{id:e}}),r({title:"Member removed",status:"success",duration:3e3}),z(),null===n||void 0===n||n()}catch(t){r({title:"Error removing member",description:t.message,status:"error",duration:5e3})}})(e.id)})})]})})]},e.id))})]}),(0,he.jsxs)(re.aF,{isOpen:i,onClose:a,size:"lg",children:[(0,he.jsx)(oe.m,{}),(0,he.jsxs)(ie.$,{children:[(0,he.jsx)(se.r,{children:m?"Edit Member":"Add Team Member"}),(0,he.jsx)(le.s,{}),(0,he.jsx)(ae.c,{children:(0,he.jsxs)(S.T,{spacing:4,children:[!m&&(0,he.jsxs)(B.MJ,{isRequired:!0,children:[(0,he.jsx)(K.l,{children:"Select Client"}),(0,he.jsx)(E.l,{value:T.clientId,onChange:e=>P((0,l.A)((0,l.A)({},T),{},{clientId:e.target.value})),placeholder:"Choose a client",children:$.map(e=>(0,he.jsxs)("option",{value:e.id,children:[e.fName," ",e.lName," - ",e.email]},e.id))})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{children:"Role"}),(0,he.jsxs)(E.l,{value:T.role,onChange:e=>P((0,l.A)((0,l.A)({},T),{},{role:e.target.value})),placeholder:"Select role",children:[(0,he.jsx)("option",{value:"Sales",children:"Sales"}),(0,he.jsx)("option",{value:"Account Manager",children:"Account Manager"}),(0,he.jsx)("option",{value:"Technical Lead",children:"Technical Lead"}),(0,he.jsx)("option",{value:"Project Manager",children:"Project Manager"}),(0,he.jsx)("option",{value:"Consultant",children:"Consultant"}),(0,he.jsx)("option",{value:"Partner",children:"Partner"})]})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{children:"Notes"}),(0,he.jsx)(v.p,{value:T.notes,onChange:e=>P((0,l.A)((0,l.A)({},T),{},{notes:e.target.value})),placeholder:"Additional notes about this member"})]})]})}),(0,he.jsxs)(de.j,{children:[(0,he.jsx)(C.$,{variant:"ghost",mr:3,onClick:a,children:"Cancel"}),(0,he.jsx)(C.$,{colorScheme:"blue",onClick:async()=>{try{m&&c?(await k({variables:{id:c.id,input:{role:T.role,notes:T.notes}}}),r({title:"Member updated",status:"success",duration:3e3})):(await O({variables:{opportunityId:t,input:T}}),r({title:"Member added",status:"success",duration:3e3})),z(),null===n||void 0===n||n(),a()}catch(e){r({title:"Error",description:e.message,status:"error",duration:5e3})}},isDisabled:!m&&!T.clientId,children:m?"Update":"Add Member"})]})]})]})]})};var dt,ut,pt=n(59883),ht=n(86236),xt=n(91872),gt=n(53560),mt=n(5874),jt=n(72515);const bt=(0,Z.J1)(dt||(dt=(0,c.A)(["\n  mutation UpdatePaymentStatus($opportunityId: String!, $paymentType: String!, $status: String!, $receivedDate: DateTime) {\n    updatePaymentStatus(opportunityId: $opportunityId, paymentType: $paymentType, status: $status, receivedDate: $receivedDate) {\n      id\n      valuePaymentStatus\n      valueReceivedDate\n    }\n  }\n"]))),yt=(0,Z.J1)(ut||(ut=(0,c.A)(["\n  mutation UpdatePayoutStatus($opportunityId: String!, $paymentType: String!, $clientId: String!, $status: String!, $paidOutDate: DateTime, $transactionId: String) {\n    updatePayoutStatus(opportunityId: $opportunityId, paymentType: $paymentType, clientId: $clientId, status: $status, paidOutDate: $paidOutDate, transactionId: $transactionId) {\n      id\n    }\n  }\n"]))),Ct=e=>{let{opportunityId:t,paymentType:n,paymentAmount:r,paymentLabel:o,paymentStatus:i="PENDING",receivedDate:s,members:a,currentSplits:c=[],onSplitsUpdate:x,onPaymentStatusUpdate:m}=e;(0,rt.H)("Payment Splits");const D=(0,u.d)(),{colorMode:A}=(0,p.G6)(),[I,w]=(0,d.useState)([]),[T]=(0,Q.n)(bt),[P]=(0,Q.n)(yt),N=(0,pe.oU)("background.cardGradient",A),z=(0,pe.oU)("border.darkCard",A),M=(0,pe.oU)("light"===A?"text.primary":"text.primaryDark",A),k=((0,pe.oU)("light"===A?"text.secondary":"text.secondaryDark",A),(0,pe.oU)("light"===A?"text.muted":"text.mutedDark",A));(0,d.useEffect)(()=>{if(c&&c.length>0)w(c.map(e=>(0,l.A)((0,l.A)({},e),{},{amount:r*(e.percentage||0)/100})));else if(a.length>0){const e=[...a.map(e=>({clientId:e.clientId,clientName:e.clientName,percentage:0,payoutDelayDays:7,amount:0})),{clientId:"unallocated",clientName:"Unallocated (Company)",percentage:100,payoutDelayDays:0,amount:r}];w(e)}},[a,c,r,n]);const R=I.reduce((e,t)=>e+(t.percentage||0),0),U=Math.abs(R-100)<.01,$=(e,t)=>{const n=[...I];n[e].payoutDelayDays=t,n[e].payoutDate=void 0,w(n)},L=async e=>{try{const r="oneoff"===n?"oneoff":"recurring"===n?"recurring":"schedule-".concat(o);await T({variables:{opportunityId:t,paymentType:r,status:e,receivedDate:"RECEIVED"===e?new Date:null}}),D({title:"Payment status updated",status:"success",duration:3e3}),null===m||void 0===m||m()}catch(r){D({title:"Error updating payment status",description:r.message,status:"error",duration:5e3})}},_=async(e,r)=>{try{const i="oneoff"===n?"oneoff":"recurring"===n?"recurring":"schedule-".concat(o);await P({variables:{opportunityId:t,paymentType:i,clientId:e,status:r,paidOutDate:"PAID"===r?new Date:null}}),D({title:"Payout status updated",status:"success",duration:3e3}),null===m||void 0===m||m()}catch(i){D({title:"Error updating payout status",description:i.message,status:"error",duration:5e3})}},G=e=>{switch(e){case"PENDING":default:return"gray";case"SCHEDULED":return"yellow";case"PROCESSING":return"orange";case"PAID":return"green";case"FAILED":case"CANCELLED":return"red"}},J=()=>{switch(n){case"oneoff":return"One-off Payment";case"recurring":return"Recurring Payment";case"schedule":return o||"Scheduled Payment";default:return"Payment"}};return 0===a.length?(0,he.jsxs)(b.F,{status:"info",borderRadius:"md",children:[(0,he.jsx)(y._,{}),(0,he.jsx)(j.E,{children:"Add team members to configure payment splits"})]}):(0,he.jsx)(h.a,{bg:N,p:4,borderRadius:"md",border:"1px",borderColor:z,children:(0,he.jsxs)(S.T,{spacing:4,align:"stretch",children:[(0,he.jsxs)(He.s,{justify:"space-between",align:"center",wrap:"wrap",gap:2,children:[(0,he.jsxs)(g.z,{children:[(0,he.jsx)(f.E,{colorScheme:(()=>{switch(n){case"oneoff":return"blue";case"recurring":return"green";case"schedule":return"purple";default:return"gray"}})(),fontSize:"sm",children:J()}),(0,he.jsxs)(j.E,{fontWeight:"bold",fontSize:"lg",children:["$",r.toLocaleString()]}),(0,he.jsxs)(pt.W,{children:[(0,he.jsxs)(ht.I,{as:C.$,rightIcon:(0,he.jsx)(mt.D,{}),size:"sm",colorScheme:(e=>{switch(e){case"PENDING":default:return"gray";case"RECEIVED":return"green";case"DISTRIBUTED":return"blue";case"CANCELLED":return"red"}})(i),variant:"outline",children:["Payment: ",i]}),(0,he.jsxs)(xt.c,{children:[(0,he.jsx)(gt.D,{onClick:()=>L("PENDING"),children:"Mark as Pending"}),(0,he.jsx)(gt.D,{onClick:()=>L("RECEIVED"),children:"Mark as Received"}),(0,he.jsx)(gt.D,{onClick:()=>L("DISTRIBUTED"),children:"Mark as Distributed"}),(0,he.jsx)(gt.D,{onClick:()=>L("CANCELLED"),children:"Mark as Cancelled"})]})]}),s&&(0,he.jsxs)(j.E,{fontSize:"sm",color:k,children:["Received: ",(0,ue.GP)(new Date(s),"MMM d, yyyy")]})]}),(0,he.jsx)(C.$,{size:"sm",variant:"outline",onClick:()=>{if(0===I.length)return;const e=I.filter(e=>"unallocated"!==e.clientId);if(0===e.length)return;const t=100/e.length,n=I.map(e=>(0,l.A)((0,l.A)({},e),{},{percentage:"unallocated"===e.clientId?0:t,amount:"unallocated"===e.clientId?0:r*t/100}));w(n)},children:"Distribute Equally"})]}),(0,he.jsxs)(b.F,{status:U?"success":"warning",size:"sm",borderRadius:"md",children:[(0,he.jsx)(y._,{}),(0,he.jsxs)(j.E,{fontSize:"sm",children:["Total: ",R.toFixed(1),"%",!U&&" (".concat((100-R).toFixed(1),"% ").concat(R>100?"over":"remaining",")")]})]}),(0,he.jsxs)(Be.X,{variant:"simple",size:"sm",children:[(0,he.jsx)(Ke.d,{children:(0,he.jsxs)(Ve.Tr,{children:[(0,he.jsx)(Ze.Th,{children:"Member"}),(0,he.jsx)(Ze.Th,{isNumeric:!0,children:"Split %"}),(0,he.jsx)(Ze.Th,{isNumeric:!0,children:"Amount"}),(0,he.jsx)(Ze.Th,{children:"Payout Schedule"}),(0,he.jsx)(Ze.Th,{children:"Payout Status"}),(0,he.jsx)(Ze.Th,{children:"Notes"})]})}),(0,he.jsx)(Ye.N,{children:I.map((e,t)=>{const n=a.find(t=>t.clientId===e.clientId),o=e.clientName||(null===n||void 0===n?void 0:n.clientName)||"Unknown Member",s="unallocated"===e.clientId;return(0,he.jsxs)(Ve.Tr,{bg:s?(0,pe.oU)("background.overlay",A):void 0,children:[(0,he.jsx)(Qe.Td,{children:(0,he.jsx)(j.E,{fontWeight:"medium",color:s?k:M,children:o})}),(0,he.jsx)(Qe.Td,{isNumeric:!0,children:(0,he.jsxs)(O.Q7,{value:e.percentage,onChange:(e,n)=>((e,t)=>{const n=[...I];n[e].percentage=t,n[e].amount=r*t/100;const o=n.findIndex(e=>"unallocated"===e.clientId);if(-1!==o&&e!==o){const e=n.reduce((e,t,n)=>n!==o?e+(t.percentage||0):e,0),t=Math.max(0,100-e);n[o].percentage=t,n[o].amount=r*t/100}w(n)})(t,n),min:0,max:100,precision:2,size:"sm",width:"100px",children:[(0,he.jsx)(O.OO,{}),(0,he.jsxs)(O.lw,{children:[(0,he.jsx)(O.Q0,{}),(0,he.jsx)(O.Sh,{})]})]})}),(0,he.jsx)(Qe.Td,{isNumeric:!0,children:(0,he.jsxs)(j.E,{fontWeight:"bold",color:"green.600",children:["$",(e.amount||0).toLocaleString()]})}),(0,he.jsx)(Qe.Td,{children:(0,he.jsxs)(S.T,{spacing:1,align:"start",children:[(0,he.jsxs)(E.l,{size:"sm",value:e.payoutDate?"date":"delay",onChange:n=>{"delay"===n.target.value&&$(t,e.payoutDelayDays||7)},children:[(0,he.jsx)("option",{value:"delay",children:"Days after payment"}),(0,he.jsx)("option",{value:"date",children:"Specific date"})]}),e.payoutDate?(0,he.jsx)(v.p,{type:"date",size:"sm",value:e.payoutDate,onChange:e=>((e,t)=>{const n=[...I];n[e].payoutDate=t,n[e].payoutDelayDays=void 0,w(n)})(t,e.target.value)}):(0,he.jsxs)(g.z,{children:[(0,he.jsx)(O.Q7,{value:e.payoutDelayDays||7,onChange:(e,n)=>$(t,n),min:0,max:365,size:"sm",width:"80px",children:(0,he.jsx)(O.OO,{})}),(0,he.jsx)(j.E,{fontSize:"sm",color:k,children:"days"})]})]})}),(0,he.jsx)(Qe.Td,{children:!s&&(0,he.jsxs)(pt.W,{children:[(0,he.jsx)(ht.I,{as:C.$,size:"xs",colorScheme:G(e.payoutStatus||"PENDING"),variant:"outline",isDisabled:"RECEIVED"!==i,children:e.payoutStatus||"PENDING"}),(0,he.jsxs)(xt.c,{children:[(0,he.jsx)(gt.D,{onClick:()=>_(e.clientId,"PENDING"),children:"Pending"}),(0,he.jsx)(gt.D,{onClick:()=>_(e.clientId,"SCHEDULED"),children:"Scheduled"}),(0,he.jsx)(gt.D,{onClick:()=>_(e.clientId,"PROCESSING"),children:"Processing"}),(0,he.jsx)(gt.D,{onClick:()=>_(e.clientId,"PAID"),children:"Paid"}),(0,he.jsx)(gt.D,{onClick:()=>_(e.clientId,"FAILED"),children:"Failed"})]})]})}),(0,he.jsx)(Qe.Td,{children:(0,he.jsx)(v.p,{size:"sm",placeholder:"Notes",value:e.payoutNotes||"",onChange:e=>((e,t)=>{const n=[...I];n[e].payoutNotes=t,w(n)})(t,e.target.value)})})]},e.clientId)})})]}),(0,he.jsx)(g.z,{justify:"flex-end",children:(0,he.jsx)(C.$,{colorScheme:"blue",size:"sm",leftIcon:(0,he.jsx)(jt.S,{}),onClick:()=>{if(!U)return void D({title:"Invalid splits",description:"Total percentage must equal 100%",status:"error",duration:3e3});const e=I.map(e=>({clientId:e.clientId,percentage:e.percentage,payoutDelayDays:e.payoutDelayDays,payoutDate:e.payoutDate,payoutNotes:e.payoutNotes,payoutStatus:e.payoutStatus}));x(e),D({title:"".concat(J()," splits saved"),status:"success",duration:2e3})},isDisabled:!U,children:"Save Splits"})})]})})};var St=n(69129);const vt=["clientId"];var Dt,Et,ft,At,It,wt,Tt;const Pt=(0,Z.J1)(Dt||(Dt=(0,c.A)(["\n  query GetAllClients {\n    clients {\n      id\n      fName\n      lName\n      email\n      phoneNumber\n    }\n  }\n"]))),Nt=(0,Z.J1)(Et||(Et=(0,c.A)(["\n  query GetOpportunity($id: String!) {\n    opportunity(id: $id) {\n      id\n      title\n      description\n      clientId\n      clientName\n      clientEmail\n      clientPhone\n      value\n      valuePaymentStatus\n      valueReceivedDate\n      stage\n      status\n      priority\n      probability\n      expectedCloseDate\n      source\n      campaign\n      internalNotes\n      products\n      services\n      tags\n      assignedTo\n      assignedToName\n      expectedRevenue\n      createdAt\n      updatedAt\n      lastActivityDate\n      taskCount\n      meetingCount\n      emailCount\n      callCount\n      noteCount\n      paymentSchedule {\n        description\n        amount\n        dueDate\n        status\n        paymentStatus\n        receivedDate\n        paidDate\n        notes\n        memberSplits {\n          clientId\n          clientName\n          percentage\n          amount\n          payoutDelayDays\n          payoutDate\n          payoutNotes\n          payoutStatus\n          paidOutDate\n          transactionId\n        }\n      }\n      recurringPayment {\n        monthlyAmount\n        probability\n        description\n        startDate\n        endDate\n        paymentStatus\n        lastPaymentDate\n        nextPaymentDate\n        memberSplits {\n          clientId\n          clientName\n          percentage\n          amount\n          payoutDelayDays\n          payoutDate\n          payoutNotes\n          payoutStatus\n          paidOutDate\n          transactionId\n        }\n      }\n      valueMemberSplits {\n        clientId\n        clientName\n        percentage\n        amount\n        payoutDelayDays\n        payoutDate\n        payoutNotes\n        payoutStatus\n        paidOutDate\n        transactionId\n      }\n      memberCount\n      totalScheduledAmount\n      totalPaidAmount\n      projectedTotalValue\n    }\n  }\n"]))),zt=(0,Z.J1)(ft||(ft=(0,c.A)(["\n  mutation UpdateOpportunity($id: String!, $input: OpportunityUpdateInput!) {\n    updateOpportunity(id: $id, input: $input) {\n      id\n      title\n      description\n      value\n      stage\n      priority\n      probability\n      expectedCloseDate\n      source\n      campaign\n      internalNotes\n      paymentSchedule {\n        description\n        amount\n        dueDate\n        status\n        paidDate\n        notes\n      }\n      recurringPayment {\n        monthlyAmount\n        probability\n        description\n        startDate\n        endDate\n      }\n    }\n  }\n"]))),Mt=(0,Z.J1)(At||(At=(0,c.A)(["\n  mutation UpdateOpportunityPaymentStatus($opportunityId: String!, $paymentIndex: Int!, $status: PaymentScheduleStatus!) {\n    updateOpportunityPaymentStatus(opportunityId: $opportunityId, paymentIndex: $paymentIndex, status: $status) {\n      id\n      paymentSchedule {\n        description\n        amount\n        dueDate\n        status\n        paidDate\n        notes\n      }\n      totalPaidAmount\n      expectedRevenue\n    }\n  }\n"]))),Ot=(0,Z.J1)(It||(It=(0,c.A)(["\n  mutation DeleteOpportunity($id: String!) {\n    deleteOpportunity(id: $id)\n  }\n"]))),kt=(0,Z.J1)(wt||(wt=(0,c.A)(["\n  query GetOpportunityMembers($opportunityId: String!) {\n    opportunityMembers(opportunityId: $opportunityId) {\n      id\n      clientId\n      clientName\n      clientEmail\n      role\n      notes\n      isActive\n    }\n  }\n"]))),Rt=(0,Z.J1)(Tt||(Tt=(0,c.A)(["\n  query GetOpportunityStages {\n    opportunityStages {\n      id\n      name\n      code\n      order\n      color\n      defaultProbability\n    }\n  }\n"]))),Ut=()=>{var e,t,n,r,o,i,s,c,Z;const re=(0,V.Zp)(),oe=(0,u.d)(),{id:ie}=(0,V.g)(),[se,le]=(0,d.useState)(!1),[ae,ce]=(0,d.useState)(!1),[de,ue]=(0,d.useState)({}),[xe,ge]=(0,d.useState)({paymentSchedule:[],recurringPayment:{monthlyAmount:0,probability:100,description:"",startDate:"",endDate:""}}),{colorMode:me}=(0,p.G6)(),je=(0,pe.oU)("background.main",me),ye=(0,pe.oU)("background.cardGradient",me),Ce=(0,pe.oU)("background.cardHeader",me)||("light"===me?"gray.50":"gray.800"),Se=(0,pe.oU)("border.darkCard",me),ve=(0,pe.oU)("light"===me?"text.primary":"text.primaryDark",me),De=(0,pe.oU)("light"===me?"text.secondary":"text.secondaryDark",me),Ee=(0,pe.oU)("light"===me?"text.muted":"text.mutedDark",me),fe=(0,pe.oU)("primary",me),Ae=(0,pe.oU)("primaryHover",me),{data:Ie,loading:we,error:Pe,refetch:Ne}=(0,Y.IT)(Nt,{variables:{id:ie},skip:!ie}),{data:ze}=(0,Y.IT)(Rt),Me=(null===ze||void 0===ze?void 0:ze.opportunityStages)||[],{data:Oe,loading:ke}=(0,Y.IT)(Pt),Re=(null===Oe||void 0===Oe?void 0:Oe.clients)||[];(0,d.useEffect)(()=>{Oe&&console.log("Clients loaded:",Re.length,Re)},[Oe,Re]),(0,rt.H)(null!==Ie&&void 0!==Ie&&null!==(e=Ie.opportunity)&&void 0!==e&&e.title?"".concat(Ie.opportunity.title," - Opportunity Details"):"Opportunity Details");const{data:Ue,refetch:Le}=(0,Y.IT)(kt,{variables:{opportunityId:ie},skip:!ie}),[_e]=(0,Q.n)(zt),[Ge,{loading:Je}]=(0,Q.n)(Ot),[We]=(0,Q.n)(Mt),Fe=null===Ie||void 0===Ie?void 0:Ie.opportunity;(0,d.useEffect)(()=>{Fe&&(ue({title:Fe.title||"",description:Fe.description||"",clientId:Fe.clientId||"",value:Fe.value||0,stage:Fe.stage||"LEAD",priority:Fe.priority||"MEDIUM",probability:Fe.probability||0,expectedCloseDate:Fe.expectedCloseDate||"",source:Fe.source||"",campaign:Fe.campaign||"",internalNotes:Fe.internalNotes||""}),ge({paymentSchedule:Fe.paymentSchedule||[],recurringPayment:Fe.recurringPayment||{monthlyAmount:0,probability:100,description:"",startDate:"",endDate:""}}))},[Fe]);const He=(e,t)=>{ue(n=>(0,l.A)((0,l.A)({},n),{},{[e]:t}))},qe=(e,t,n)=>{ge(r=>(0,l.A)((0,l.A)({},r),{},{paymentSchedule:r.paymentSchedule.map((r,o)=>o===e?(0,l.A)((0,l.A)({},r),{},{[t]:n}):r)}))},Be=(e,t)=>{ge(n=>(0,l.A)((0,l.A)({},n),{},{recurringPayment:(0,l.A)((0,l.A)({},n.recurringPayment),{},{[e]:t})}))},Ke=e=>new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD"}).format(e),Ve=e=>e?new Date(e).toLocaleDateString("en-AU",{year:"numeric",month:"long",day:"numeric"}):"Not set";return we?(0,he.jsxs)(h.a,{bg:je,minH:"100vh",display:"flex",flexDirection:"column",children:[(0,he.jsx)(ee.m,{}),(0,he.jsx)(ne.y,{moduleConfig:St.default}),(0,he.jsx)(x.m,{maxW:"4xl",py:8,flex:"1",children:(0,he.jsxs)(g.z,{justify:"center",py:20,children:[(0,he.jsx)(m.y,{size:"xl",color:fe}),(0,he.jsx)(j.E,{color:ve,children:"Loading opportunity..."})]})}),(0,he.jsx)(h.a,{position:"sticky",bottom:0,zIndex:10,children:(0,he.jsx)(te.n,{})})]}):Pe||!Fe?(0,he.jsxs)(h.a,{bg:je,minH:"100vh",display:"flex",flexDirection:"column",children:[(0,he.jsx)(ee.m,{}),(0,he.jsx)(ne.y,{moduleConfig:St.default}),(0,he.jsxs)(x.m,{maxW:"4xl",py:8,flex:"1",children:[(0,he.jsxs)(b.F,{status:"error",borderRadius:"md",children:[(0,he.jsx)(y._,{}),Pe?Pe.message:"Opportunity not found"]}),(0,he.jsx)(C.$,{mt:4,bg:"rgba(255, 255, 255, 0.1)",color:ve,leftIcon:(0,he.jsx)(X.kRp,{}),onClick:()=>re("/opportunities"),_hover:{bg:"rgba(255, 255, 255, 0.2)"},children:"Back to Opportunities"})]}),(0,he.jsx)(h.a,{position:"sticky",bottom:0,zIndex:10,children:(0,he.jsx)(te.n,{})})]}):(0,he.jsxs)(h.a,{bg:je,minH:"100vh",display:"flex",flexDirection:"column",children:[(0,he.jsx)(ee.m,{}),(0,he.jsx)(ne.y,{moduleConfig:St.default}),(0,he.jsx)(x.m,{maxW:"6xl",py:8,flex:"1",children:(0,he.jsxs)(S.T,{spacing:6,align:"stretch",children:[(0,he.jsxs)(S.T,{spacing:4,align:"stretch",children:[(0,he.jsx)(g.z,{children:(0,he.jsx)(C.$,{bg:"rgba(255, 255, 255, 0.1)",color:ve,leftIcon:(0,he.jsx)(X.kRp,{}),onClick:()=>re("/opportunities"),_hover:{bg:"rgba(255, 255, 255, 0.2)"},transition:"all 0.2s",size:{base:"sm",md:"md"},children:"Back"})}),(0,he.jsxs)(S.T,{spacing:2,align:"stretch",children:[se?(0,he.jsx)(v.p,{value:de.title,onChange:e=>He("title",e.target.value),fontSize:{base:"lg",md:"2xl"},fontWeight:"bold",bg:"light"===me?"white":"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve,_hover:{borderColor:De},_focus:{borderColor:fe,boxShadow:"0 0 0 1px ".concat(fe)}}):(0,he.jsx)(D.D,{size:{base:"md",md:"lg"},color:ve,children:Fe.title}),(0,he.jsx)(g.z,{spacing:2,flexWrap:"wrap",children:se?(0,he.jsxs)(he.Fragment,{children:[(0,he.jsx)(E.l,{value:de.stage,onChange:e=>He("stage",e.target.value),bg:"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve,size:"sm",width:"auto",minW:"120px",_hover:{borderColor:De},_focus:{borderColor:fe,boxShadow:"0 0 0 1px ".concat(fe)},children:Me.map(e=>(0,he.jsx)("option",{value:e.code,children:e.name},e.code))}),(0,he.jsxs)(E.l,{value:de.priority,onChange:e=>He("priority",e.target.value),bg:"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve,size:"sm",width:"auto",minW:"120px",_hover:{borderColor:De},_focus:{borderColor:fe,boxShadow:"0 0 0 1px ".concat(fe)},children:[(0,he.jsx)("option",{value:"LOW",children:"Low"}),(0,he.jsx)("option",{value:"MEDIUM",children:"Medium"}),(0,he.jsx)("option",{value:"HIGH",children:"High"}),(0,he.jsx)("option",{value:"CRITICAL",children:"Critical"})]})]}):(0,he.jsxs)(he.Fragment,{children:[(0,he.jsx)(f.E,{colorScheme:(Ye=Fe.stage,{LEAD:"blue",QUALIFIED:"cyan",PROPOSAL:"orange",NEGOTIATION:"yellow",CLOSED_WON:"green",CLOSED_LOST:"red"}[Ye]||"gray"),children:Fe.stage}),(0,he.jsx)(f.E,{colorScheme:(Ze=Fe.priority,{LOW:"gray",MEDIUM:"blue",HIGH:"orange",CRITICAL:"red"}[Ze]||"gray"),children:Fe.priority})]})})]}),(0,he.jsxs)(g.z,{spacing:2,flexWrap:"wrap",children:[se?(0,he.jsxs)(he.Fragment,{children:[(0,he.jsx)(C.$,{onClick:()=>{Fe&&ue({title:Fe.title||"",description:Fe.description||"",clientId:Fe.clientId||"",value:Fe.value||0,stage:Fe.stage||"LEAD",priority:Fe.priority||"MEDIUM",probability:Fe.probability||0,expectedCloseDate:Fe.expectedCloseDate||"",source:Fe.source||"",campaign:Fe.campaign||"",internalNotes:Fe.internalNotes||""}),le(!1)},variant:"outline",borderColor:Se,color:ve,size:{base:"sm",md:"md"},_hover:{bg:"rgba(255, 255, 255, 0.1)"},children:"Cancel"}),(0,he.jsx)(C.$,{leftIcon:(0,he.jsx)(X.YrT,{}),onClick:async()=>{try{const e=e=>{if(!e)return;const t=new Date(e);return isNaN(t.getTime())?void 0:t.toISOString()},{clientId:t}=de,n=(0,a.A)(de,vt);await _e({variables:{id:ie,input:(0,l.A)((0,l.A)({},n),{},{value:parseFloat(de.value.toString()),expectedCloseDate:e(de.expectedCloseDate)})}}),oe({title:"Opportunity updated",description:"Changes have been saved successfully",status:"success",duration:3e3,isClosable:!0}),le(!1),Ne()}catch(Pe){oe({title:"Update failed",description:Pe.message||"Failed to update opportunity",status:"error",duration:5e3,isClosable:!0})}},bg:fe,color:"white",size:{base:"sm",md:"md"},_hover:{bg:Ae},children:"Save"})]}):(0,he.jsx)(C.$,{leftIcon:(0,he.jsx)(X.SG1,{}),onClick:()=>le(!0),bg:"rgba(255, 255, 255, 0.1)",color:ve,size:{base:"sm",md:"md"},_hover:{bg:"rgba(255, 255, 255, 0.2)"},children:"Edit"}),(0,he.jsx)(C.$,{leftIcon:(0,he.jsx)(X.IXo,{}),onClick:async()=>{if(window.confirm("Are you sure you want to delete this opportunity?"))try{await Ge({variables:{id:ie}}),oe({title:"Opportunity deleted",description:"The opportunity has been deleted successfully",status:"success",duration:3e3,isClosable:!0}),re("/opportunities")}catch(Pe){oe({title:"Failed to delete opportunity",description:Pe.message||"An error occurred",status:"error",duration:5e3,isClosable:!0})}},isLoading:Je,colorScheme:"red",variant:"outline",size:{base:"sm",md:"md"},children:"Delete"})]})]}),(0,he.jsxs)(A.x,{templateColumns:{base:"repeat(1, 1fr)",sm:"repeat(2, 1fr)",md:"repeat(4, 1fr)"},gap:4,children:[(0,he.jsx)(I.E,{children:(0,he.jsx)(w.Z,{bg:ye,backdropFilter:"blur(10px)",boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.37)",border:"1px",borderColor:Se,borderRadius:"lg",children:(0,he.jsx)(T.b,{children:(0,he.jsxs)(P.r,{children:[(0,he.jsx)(N.v,{color:Ee,children:"Value"}),se?(0,he.jsxs)(z.M,{size:"lg",children:[(0,he.jsx)(M.G6,{bg:"rgba(255, 255, 255, 0.1)",borderColor:Se,color:ve,children:"$"}),(0,he.jsx)(O.Q7,{value:de.value,onChange:(e,t)=>He("value",t||0),min:0,flex:"1",children:(0,he.jsx)(O.OO,{bg:"light"===me?"white":"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve,_hover:{borderColor:De},_focus:{borderColor:fe,boxShadow:"0 0 0 1px ".concat(fe)}})})]}):(0,he.jsx)(k.k,{color:ve,children:Ke(Fe.value)})]})})})}),(0,he.jsx)(I.E,{children:(0,he.jsx)(w.Z,{bg:ye,backdropFilter:"blur(10px)",boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.37)",border:"1px",borderColor:Se,borderRadius:"lg",children:(0,he.jsx)(T.b,{children:(0,he.jsxs)(P.r,{children:[(0,he.jsx)(N.v,{color:Ee,children:"Expected Revenue"}),se?(0,he.jsxs)(S.T,{align:"stretch",spacing:2,children:[(0,he.jsx)(g.z,{children:(0,he.jsxs)(j.E,{color:ve,fontWeight:"bold",fontSize:"2xl",children:[de.probability,"%"]})}),(0,he.jsxs)(R.Ap,{value:de.probability,onChange:e=>He("probability",e),min:0,max:100,step:5,children:[(0,he.jsx)(R.hB,{bg:"light"===me?"gray.200":"rgba(255, 255, 255, 0.1)",children:(0,he.jsx)(R.hJ,{bg:fe})}),(0,he.jsx)(R.OQ,{boxSize:6,children:(0,he.jsx)(h.a,{color:fe,as:X.z8N})})]}),(0,he.jsxs)(j.E,{fontSize:"sm",color:Ee,children:["Expected: ",Ke(de.value*de.probability/100)]})]}):(0,he.jsxs)(he.Fragment,{children:[(0,he.jsx)(k.k,{color:ve,children:Ke(Fe.expectedRevenue)}),(0,he.jsx)(U.h,{color:Ee,children:(0,he.jsxs)(S.T,{align:"start",spacing:0,children:[(0,he.jsxs)(j.E,{children:[Fe.probability,"% win probability"]}),(0,he.jsxs)(j.E,{fontSize:"xs",opacity:.8,children:[Ke(Fe.value)," \xd7 ",Fe.probability,"%",(null===(t=Fe.paymentSchedule)||void 0===t?void 0:t.length)>0&&" + scheduled",(null===(n=Fe.recurringPayment)||void 0===n?void 0:n.monthlyAmount)>0&&" + recurring"]})]})})]})]})})})}),(0,he.jsx)(I.E,{children:(0,he.jsx)(w.Z,{bg:ye,backdropFilter:"blur(10px)",boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.37)",border:"1px",borderColor:Se,borderRadius:"lg",children:(0,he.jsx)(T.b,{children:(0,he.jsxs)(P.r,{children:[(0,he.jsx)(N.v,{color:Ee,children:"Expected Close"}),se?(0,he.jsx)(v.p,{type:"date",value:de.expectedCloseDate?new Date(de.expectedCloseDate).toISOString().split("T")[0]:"",onChange:e=>He("expectedCloseDate",e.target.value),bg:"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve,_hover:{borderColor:De},_focus:{borderColor:fe,boxShadow:"0 0 0 1px ".concat(fe)}}):(0,he.jsx)(k.k,{fontSize:"lg",color:ve,children:Ve(Fe.expectedCloseDate)})]})})})}),(0,he.jsx)(I.E,{children:(0,he.jsx)(w.Z,{bg:ye,backdropFilter:"blur(10px)",boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.37)",border:"1px",borderColor:Se,borderRadius:"lg",children:(0,he.jsx)(T.b,{children:(0,he.jsxs)(P.r,{children:[(0,he.jsx)(N.v,{color:Ee,children:"Activities"}),(0,he.jsx)(k.k,{color:ve,children:Fe.taskCount+Fe.meetingCount+Fe.emailCount+Fe.callCount}),(0,he.jsx)(U.h,{color:Ee,children:(0,he.jsxs)(S.T,{align:"start",spacing:0,children:[(0,he.jsxs)(j.E,{fontSize:"xs",children:["Tasks: ",Fe.taskCount||0]}),(0,he.jsxs)(j.E,{fontSize:"xs",children:["Meetings: ",Fe.meetingCount||0]}),(0,he.jsxs)(j.E,{fontSize:"xs",children:["Emails: ",Fe.emailCount||0]}),(0,he.jsxs)(j.E,{fontSize:"xs",children:["Calls: ",Fe.callCount||0]})]})})]})})})})]}),(0,he.jsxs)($.t,{colorScheme:"blue",isLazy:!0,children:[(0,he.jsxs)(L.w,{borderBottomColor:Se,overflowX:"auto",overflowY:"hidden",children:[(0,he.jsx)(_.o,{color:De,fontSize:{base:"sm",md:"md"},_selected:{color:fe,borderColor:fe},children:"Overview"}),(0,he.jsx)(_.o,{color:De,fontSize:{base:"sm",md:"md"},_selected:{color:fe,borderColor:fe},children:"Payment"}),(0,he.jsx)(_.o,{color:De,fontSize:{base:"sm",md:"md"},_selected:{color:fe,borderColor:fe},children:"Team"}),(0,he.jsxs)(_.o,{color:De,fontSize:{base:"sm",md:"md"},_selected:{color:fe,borderColor:fe},children:["Activities (",Fe.taskCount+Fe.meetingCount+Fe.emailCount+Fe.callCount,")"]}),(0,he.jsxs)(_.o,{color:De,fontSize:{base:"sm",md:"md"},_selected:{color:fe,borderColor:fe},children:["Notes (",Fe.noteCount||0,")"]})]}),(0,he.jsxs)(G.T,{children:[(0,he.jsx)(J.K,{px:0,children:(0,he.jsxs)(A.x,{templateColumns:{base:"repeat(1, 1fr)",md:"repeat(2, 1fr)"},gap:6,children:[(0,he.jsx)(I.E,{children:(0,he.jsxs)(w.Z,{bg:ye,backdropFilter:"blur(10px)",boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.37)",border:"1px",borderColor:Se,borderRadius:"lg",children:[(0,he.jsx)(W.a,{children:(0,he.jsx)(j.E,{fontWeight:"bold",color:ve,children:"Client Information"})}),(0,he.jsx)(T.b,{children:(0,he.jsxs)(S.T,{align:"stretch",spacing:3,children:[(0,he.jsxs)(g.z,{children:[(0,he.jsx)(X.JXP,{color:De}),(0,he.jsx)(j.E,{color:ve,children:Fe.clientName})]}),Fe.clientEmail&&(0,he.jsxs)(g.z,{children:[(0,he.jsx)(X.pHD,{color:De}),(0,he.jsx)(j.E,{color:De,children:Fe.clientEmail})]}),Fe.clientPhone&&(0,he.jsxs)(g.z,{children:[(0,he.jsx)(X.QFc,{color:De}),(0,he.jsx)(j.E,{color:De,children:Fe.clientPhone})]}),se&&(0,he.jsx)(j.E,{color:Ee,fontSize:"xs",fontStyle:"italic",children:"Note: Client cannot be changed after opportunity creation"})]})})]})}),(0,he.jsx)(I.E,{children:(0,he.jsxs)(w.Z,{bg:ye,backdropFilter:"blur(10px)",boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.37)",border:"1px",borderColor:Se,borderRadius:"lg",children:[(0,he.jsx)(W.a,{children:(0,he.jsx)(j.E,{fontWeight:"bold",color:ve,children:"Details"})}),(0,he.jsx)(T.b,{children:(0,he.jsxs)(S.T,{align:"stretch",spacing:3,children:[(0,he.jsxs)(g.z,{justify:"space-between",children:[(0,he.jsx)(j.E,{color:Ee,children:"Source:"}),se?(0,he.jsxs)(E.l,{value:de.source,onChange:e=>He("source",e.target.value),size:"sm",bg:"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve,_hover:{borderColor:De},_focus:{borderColor:fe,boxShadow:"0 0 0 1px ".concat(fe)},children:[(0,he.jsx)("option",{value:"",children:"None"}),(0,he.jsx)("option",{value:"Website",children:"Website"}),(0,he.jsx)("option",{value:"Referral",children:"Referral"}),(0,he.jsx)("option",{value:"Cold Call",children:"Cold Call"}),(0,he.jsx)("option",{value:"Email",children:"Email Campaign"}),(0,he.jsx)("option",{value:"Social Media",children:"Social Media"}),(0,he.jsx)("option",{value:"Event",children:"Event"}),(0,he.jsx)("option",{value:"Partner",children:"Partner"}),(0,he.jsx)("option",{value:"Other",children:"Other"})]}):(0,he.jsx)(j.E,{color:ve,children:Fe.source||"Not set"})]}),(0,he.jsxs)(g.z,{justify:"space-between",children:[(0,he.jsx)(j.E,{color:Ee,children:"Campaign:"}),se?(0,he.jsx)(v.p,{value:de.campaign,onChange:e=>He("campaign",e.target.value),placeholder:"Campaign name",size:"sm",bg:"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve,_placeholder:{color:Ee},_hover:{borderColor:De},_focus:{borderColor:fe,boxShadow:"0 0 0 1px ".concat(fe)}}):(0,he.jsx)(j.E,{color:ve,children:Fe.campaign||"Not set"})]}),(0,he.jsxs)(g.z,{justify:"space-between",children:[(0,he.jsx)(j.E,{color:Ee,children:"Assigned to:"}),(0,he.jsx)(j.E,{color:ve,children:Fe.assignedToName||"Unassigned"})]}),(0,he.jsxs)(g.z,{justify:"space-between",children:[(0,he.jsx)(j.E,{color:Ee,children:"Last activity:"}),(0,he.jsx)(j.E,{color:ve,children:Ve(Fe.lastActivityDate)})]})]})})]})}),(0,he.jsx)(I.E,{colSpan:{base:1,md:2},children:(0,he.jsxs)(w.Z,{bg:ye,backdropFilter:"blur(10px)",boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.37)",border:"1px",borderColor:Se,borderRadius:"lg",children:[(0,he.jsx)(W.a,{children:(0,he.jsx)(j.E,{fontWeight:"bold",color:ve,children:"Description"})}),(0,he.jsx)(T.b,{children:se?(0,he.jsx)(F.T,{value:de.description,onChange:e=>He("description",e.target.value),placeholder:"Describe the opportunity...",rows:4,bg:"light"===me?"white":"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve,_placeholder:{color:Ee},_hover:{borderColor:De},_focus:{borderColor:fe,boxShadow:"0 0 0 1px ".concat(fe)}}):(0,he.jsx)(j.E,{color:De,children:Fe.description||"No description provided"})})]})}),(0,he.jsx)(I.E,{colSpan:{base:1,md:2},children:(0,he.jsxs)(w.Z,{bg:ye,backdropFilter:"blur(10px)",boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.37)",border:"1px",borderColor:Se,borderRadius:"lg",children:[(0,he.jsx)(W.a,{children:(0,he.jsx)(j.E,{fontWeight:"bold",color:ve,children:"Internal Notes"})}),(0,he.jsx)(T.b,{children:se?(0,he.jsx)(F.T,{value:de.internalNotes,onChange:e=>He("internalNotes",e.target.value),placeholder:"Notes for internal use only...",rows:3,bg:"light"===me?"white":"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve,_placeholder:{color:Ee},_hover:{borderColor:De},_focus:{borderColor:fe,boxShadow:"0 0 0 1px ".concat(fe)}}):(0,he.jsx)(j.E,{color:De,children:Fe.internalNotes||"No internal notes"})})]})}),(0,he.jsx)(I.E,{colSpan:{base:1,md:2},children:(0,he.jsxs)(w.Z,{bg:ye,backdropFilter:"blur(10px)",boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.37)",border:"1px",borderColor:Se,borderRadius:"lg",children:[(0,he.jsx)(W.a,{children:(0,he.jsx)(j.E,{fontWeight:"bold",color:ve,children:"Win Probability"})}),(0,he.jsx)(T.b,{children:(0,he.jsxs)(S.T,{align:"stretch",children:[(0,he.jsxs)(g.z,{justify:"space-between",children:[(0,he.jsx)(j.E,{color:De,children:"Chance of closing"}),(0,he.jsxs)(j.E,{fontWeight:"bold",color:ve,children:[Fe.probability,"%"]})]}),(0,he.jsx)(H.k,{value:Fe.probability,colorScheme:"blue",borderRadius:"full",bg:"light"===me?"gray.200":"rgba(255, 255, 255, 0.1)"})]})})]})})]})}),(0,he.jsx)(J.K,{px:0,children:(0,he.jsxs)(S.T,{spacing:6,align:"stretch",children:[(0,he.jsx)(g.z,{justify:"flex-end",spacing:2,children:ae?(0,he.jsxs)(he.Fragment,{children:[(0,he.jsx)(C.$,{size:"sm",variant:"outline",borderColor:Se,color:ve,onClick:()=>{Fe&&ge({paymentSchedule:Fe.paymentSchedule||[],recurringPayment:Fe.recurringPayment||{monthlyAmount:0,probability:100,description:"",startDate:"",endDate:""}}),ce(!1)},children:"Cancel"}),(0,he.jsx)(C.$,{size:"sm",leftIcon:(0,he.jsx)(X.YrT,{}),bg:fe,color:"white",_hover:{bg:Ae},onClick:async()=>{try{const e=e=>{if(!e)return;const t=new Date(e);return isNaN(t.getTime())?void 0:t.toISOString()};await _e({variables:{id:ie,input:{paymentSchedule:xe.paymentSchedule.filter(e=>e.description&&e.amount>0).map(t=>({description:t.description,amount:parseFloat(t.amount.toString()),dueDate:e(t.dueDate)||(new Date).toISOString(),status:t.status||"PENDING",paidDate:t.paidDate?e(t.paidDate):void 0,notes:t.notes})),recurringPayment:xe.recurringPayment.monthlyAmount>0?{monthlyAmount:parseFloat(xe.recurringPayment.monthlyAmount.toString()),probability:xe.recurringPayment.probability,description:xe.recurringPayment.description,startDate:e(xe.recurringPayment.startDate)||(new Date).toISOString(),endDate:e(xe.recurringPayment.endDate)}:void 0}}}),oe({title:"Payment details updated",description:"Changes have been saved successfully",status:"success",duration:3e3,isClosable:!0}),ce(!1),Ne()}catch(Pe){oe({title:"Update failed",description:Pe.message||"Failed to update payment details",status:"error",duration:5e3,isClosable:!0})}},children:"Save Changes"})]}):(0,he.jsx)(C.$,{size:"sm",leftIcon:(0,he.jsx)(X.SG1,{}),bg:"rgba(255, 255, 255, 0.1)",color:ve,_hover:{bg:"rgba(255, 255, 255, 0.2)"},onClick:()=>ce(!0),children:"Edit Payment Details"})}),(0,he.jsxs)(w.Z,{bg:ye,backdropFilter:"blur(10px)",boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.37)",border:"1px",borderColor:Se,borderRadius:"lg",children:[(0,he.jsx)(W.a,{children:(0,he.jsxs)(g.z,{justify:"space-between",children:[(0,he.jsx)(j.E,{fontWeight:"bold",color:ve,children:"Payment Schedule"}),!ae&&Fe.totalScheduledAmount>0&&(0,he.jsxs)(f.E,{colorScheme:"green",fontSize:"md",px:3,py:1,children:["Total: $",null===(r=Fe.totalScheduledAmount)||void 0===r?void 0:r.toLocaleString()]})]})}),(0,he.jsx)(T.b,{children:ae?(0,he.jsxs)(S.T,{spacing:4,align:"stretch",children:[xe.paymentSchedule.map((e,t)=>(0,he.jsx)(h.a,{p:4,bg:"rgba(255, 255, 255, 0.05)",borderRadius:"md",border:"1px",borderColor:Se,children:(0,he.jsxs)(S.T,{spacing:3,children:[(0,he.jsxs)(g.z,{width:"full",justify:"space-between",children:[(0,he.jsxs)(j.E,{color:ve,fontWeight:"semibold",children:["Payment #",t+1]}),(0,he.jsx)(q.K,{"aria-label":"Remove payment",icon:(0,he.jsx)(X.IXo,{}),size:"sm",colorScheme:"red",variant:"ghost",onClick:()=>(e=>{ge(t=>(0,l.A)((0,l.A)({},t),{},{paymentSchedule:t.paymentSchedule.filter((t,n)=>n!==e)}))})(t)})]}),(0,he.jsx)(v.p,{placeholder:"Description (e.g., Initial deposit)",value:e.description,onChange:e=>qe(t,"description",e.target.value),bg:"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve}),(0,he.jsxs)(g.z,{spacing:4,width:"full",children:[(0,he.jsxs)(z.M,{flex:"1",children:[(0,he.jsx)(M.G6,{bg:"rgba(255, 255, 255, 0.1)",borderColor:Se,color:ve,children:"$"}),(0,he.jsx)(O.Q7,{value:e.amount,onChange:(e,n)=>qe(t,"amount",n||0),min:0,width:"full",children:(0,he.jsx)(O.OO,{bg:"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve})})]}),(0,he.jsx)(v.p,{type:"date",value:e.dueDate?new Date(e.dueDate).toISOString().split("T")[0]:"",onChange:e=>qe(t,"dueDate",e.target.value),flex:"1",bg:"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve})]}),(0,he.jsx)(F.T,{placeholder:"Notes (optional)",value:e.notes||"",onChange:e=>qe(t,"notes",e.target.value),rows:2,bg:"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve})]})},t)),(0,he.jsx)(C.$,{onClick:()=>{ge(e=>(0,l.A)((0,l.A)({},e),{},{paymentSchedule:[...e.paymentSchedule,{description:"",amount:0,dueDate:"",status:"PENDING",notes:""}]}))},leftIcon:(0,he.jsx)(X.GGD,{}),variant:"outline",borderColor:fe,color:fe,_hover:{bg:"rgba(255, 255, 255, 0.1)"},children:"Add Payment"})]}):Fe.paymentSchedule&&Fe.paymentSchedule.length>0?(0,he.jsxs)(S.T,{spacing:4,align:"stretch",children:[Fe.paymentSchedule.map((e,t)=>(0,he.jsx)(h.a,{p:4,bg:"rgba(255, 255, 255, 0.05)",borderRadius:"md",border:"1px",borderColor:Se,children:(0,he.jsxs)(g.z,{justify:"space-between",mb:3,children:[(0,he.jsxs)(S.T,{align:"start",spacing:1,children:[(0,he.jsx)(j.E,{color:ve,fontWeight:"bold",children:e.description}),(0,he.jsxs)(g.z,{spacing:4,children:[(0,he.jsxs)(g.z,{children:[(0,he.jsx)(X.z8N,{color:De}),(0,he.jsxs)(j.E,{color:ve,fontSize:"lg",children:["$",e.amount.toLocaleString()]})]}),(0,he.jsxs)(g.z,{children:[(0,he.jsx)(X.wIk,{color:De}),(0,he.jsxs)(j.E,{color:De,children:["Due: ",new Date(e.dueDate).toLocaleDateString()]})]})]}),e.notes&&(0,he.jsx)(j.E,{color:Ee,fontSize:"sm",children:e.notes})]}),(0,he.jsxs)(S.T,{align:"end",children:[(0,he.jsx)(f.E,{colorScheme:"PAID"===e.status?"green":"OVERDUE"===e.status?"red":"CANCELLED"===e.status?"gray":"yellow",fontSize:"sm",px:2,py:1,children:e.status}),e.paidDate&&(0,he.jsxs)(j.E,{color:Ee,fontSize:"xs",children:["Paid: ",new Date(e.paidDate).toLocaleDateString()]}),"PAID"!==e.status&&"CANCELLED"!==e.status&&(0,he.jsx)(C.$,{size:"sm",leftIcon:(0,he.jsx)(X.A3x,{}),colorScheme:"green",variant:"outline",onClick:async()=>{try{await We({variables:{opportunityId:Fe.id,paymentIndex:t,status:"PAID"}}),oe({title:"Payment marked as paid",status:"success",duration:3e3,isClosable:!0}),Ne()}catch(Pe){oe({title:"Failed to update payment status",description:Pe.message||"An error occurred",status:"error",duration:5e3,isClosable:!0})}},children:"Mark as Paid"})]})]})},t)),Fe.totalPaidAmount>0&&(0,he.jsxs)(g.z,{justify:"space-between",pt:3,borderTop:"1px",borderColor:Se,children:[(0,he.jsx)(j.E,{color:ve,fontWeight:"bold",children:"Total Paid:"}),(0,he.jsxs)(j.E,{color:"green.400",fontSize:"lg",fontWeight:"bold",children:["$",null===(o=Fe.totalPaidAmount)||void 0===o?void 0:o.toLocaleString()]})]})]}):(0,he.jsx)(j.E,{color:Ee,textAlign:"center",children:"No payment schedule defined"})})]}),(0,he.jsxs)(w.Z,{bg:ye,backdropFilter:"blur(10px)",boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.37)",border:"1px",borderColor:Se,borderRadius:"lg",children:[(0,he.jsx)(W.a,{children:(0,he.jsxs)(g.z,{children:[(0,he.jsx)(X.wO2,{color:fe}),(0,he.jsx)(j.E,{fontWeight:"bold",color:ve,children:"Recurring Subscription"})]})}),(0,he.jsx)(T.b,{children:ae?(0,he.jsxs)(S.T,{spacing:4,align:"stretch",children:[(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:ve,children:"Monthly Amount (AUD)"}),(0,he.jsxs)(z.M,{children:[(0,he.jsx)(M.G6,{bg:"rgba(255, 255, 255, 0.1)",borderColor:Se,color:ve,children:"$"}),(0,he.jsx)(O.Q7,{value:xe.recurringPayment.monthlyAmount,onChange:(e,t)=>Be("monthlyAmount",t||0),min:0,width:"full",children:(0,he.jsx)(O.OO,{bg:"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve})})]})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsxs)(K.l,{color:ve,children:["Subscription Probability: ",xe.recurringPayment.probability,"%"]}),(0,he.jsxs)(R.Ap,{value:xe.recurringPayment.probability,onChange:e=>Be("probability",e),min:0,max:100,step:5,children:[(0,he.jsx)(R.hB,{children:(0,he.jsx)(R.hJ,{bg:fe})}),(0,he.jsx)(R.OQ,{boxSize:6,children:(0,he.jsx)(h.a,{color:fe,as:X.wO2})})]})]}),(0,he.jsxs)(B.MJ,{children:[(0,he.jsx)(K.l,{color:ve,children:"Description"}),(0,he.jsx)(v.p,{value:xe.recurringPayment.description,onChange:e=>Be("description",e.target.value),placeholder:"e.g., Monthly maintenance",bg:"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve})]}),(0,he.jsxs)(g.z,{spacing:4,children:[(0,he.jsxs)(B.MJ,{flex:"1",children:[(0,he.jsx)(K.l,{color:ve,children:"Start Date"}),(0,he.jsx)(v.p,{type:"date",value:xe.recurringPayment.startDate?new Date(xe.recurringPayment.startDate).toISOString().split("T")[0]:"",onChange:e=>Be("startDate",e.target.value),bg:"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve})]}),(0,he.jsxs)(B.MJ,{flex:"1",children:[(0,he.jsx)(K.l,{color:ve,children:"End Date (Optional)"}),(0,he.jsx)(v.p,{type:"date",value:xe.recurringPayment.endDate?new Date(xe.recurringPayment.endDate).toISOString().split("T")[0]:"",onChange:e=>Be("endDate",e.target.value),bg:"rgba(255, 255, 255, 0.05)",borderColor:Se,color:ve})]})]})]}):Fe.recurringPayment&&Fe.recurringPayment.monthlyAmount>0?(0,he.jsxs)(S.T,{align:"stretch",spacing:4,children:[(0,he.jsxs)(g.z,{justify:"space-between",children:[(0,he.jsx)(j.E,{color:Ee,children:"Monthly Amount:"}),(0,he.jsxs)(j.E,{color:ve,fontSize:"lg",fontWeight:"bold",children:["$",Fe.recurringPayment.monthlyAmount.toLocaleString(),"/month"]})]}),Fe.recurringPayment.description&&(0,he.jsxs)(g.z,{justify:"space-between",children:[(0,he.jsx)(j.E,{color:Ee,children:"Description:"}),(0,he.jsx)(j.E,{color:ve,children:Fe.recurringPayment.description})]}),(0,he.jsxs)(g.z,{justify:"space-between",children:[(0,he.jsx)(j.E,{color:Ee,children:"Probability:"}),(0,he.jsxs)(f.E,{colorScheme:"blue",fontSize:"sm",children:[Fe.recurringPayment.probability,"%"]})]}),Fe.recurringPayment.startDate&&(0,he.jsxs)(g.z,{justify:"space-between",children:[(0,he.jsx)(j.E,{color:Ee,children:"Start Date:"}),(0,he.jsx)(j.E,{color:ve,children:new Date(Fe.recurringPayment.startDate).toLocaleDateString()})]}),Fe.recurringPayment.endDate&&(0,he.jsxs)(g.z,{justify:"space-between",children:[(0,he.jsx)(j.E,{color:Ee,children:"End Date:"}),(0,he.jsx)(j.E,{color:ve,children:new Date(Fe.recurringPayment.endDate).toLocaleDateString()})]}),(0,he.jsx)(h.a,{pt:3,borderTop:"1px",borderColor:Se,children:(0,he.jsxs)(j.E,{color:Ee,fontSize:"sm",children:["Projected Annual Value: $",(12*Fe.recurringPayment.monthlyAmount*Fe.recurringPayment.probability/100).toLocaleString()]})})]}):(0,he.jsx)(j.E,{color:Ee,textAlign:"center",children:"No recurring subscription defined"})})]}),Fe.projectedTotalValue>0&&(0,he.jsx)(w.Z,{bg:fe,bgGradient:"linear(to-r, brand.500, brand.600)",boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.37)",borderRadius:"lg",children:(0,he.jsx)(T.b,{children:(0,he.jsxs)(S.T,{align:"start",spacing:3,children:[(0,he.jsx)(j.E,{color:"white",fontWeight:"bold",fontSize:"xl",children:"Total Projected Value"}),(0,he.jsxs)(j.E,{color:"white",fontSize:"3xl",fontWeight:"bold",children:["$",null===(i=Fe.projectedTotalValue)||void 0===i?void 0:i.toLocaleString()]}),(0,he.jsxs)(S.T,{align:"start",spacing:1,children:[(0,he.jsxs)(j.E,{color:"whiteAlpha.900",fontSize:"sm",children:["\u2022 One-off: $",(Fe.value*Fe.probability/100).toLocaleString()]}),Fe.totalScheduledAmount>0&&(0,he.jsxs)(j.E,{color:"whiteAlpha.900",fontSize:"sm",children:["\u2022 Scheduled: $",Fe.totalScheduledAmount.toLocaleString()]}),(null===(s=Fe.recurringPayment)||void 0===s?void 0:s.monthlyAmount)>0&&(0,he.jsxs)(j.E,{color:"whiteAlpha.900",fontSize:"sm",children:["\u2022 Recurring: $",(12*Fe.recurringPayment.monthlyAmount).toLocaleString(),"/year"]})]})]})})})]})}),(0,he.jsx)(J.K,{px:0,children:(0,he.jsxs)(S.T,{spacing:6,align:"stretch",children:[(0,he.jsx)(ct,{opportunityId:ie,onMembersUpdate:()=>{Ne(),Le()}}),Fe.value>0&&(0,he.jsxs)(w.Z,{bg:ye,borderColor:Se,borderWidth:"1px",boxShadow:"sm",overflow:"hidden",children:[(0,he.jsx)(W.a,{bg:Ce,borderBottom:"1px solid ".concat(Se),children:(0,he.jsxs)(g.z,{justify:"space-between",children:[(0,he.jsx)(D.D,{size:"md",color:ve,children:"One-off Payment Commission Split"}),(0,he.jsxs)(f.E,{colorScheme:"blue",fontSize:"md",children:["$",Fe.value.toLocaleString()]})]})}),(0,he.jsx)(T.b,{children:null!==Ue&&void 0!==Ue&&Ue.opportunityMembers&&Ue.opportunityMembers.length>0?(0,he.jsx)(Ct,{opportunityId:ie||"",paymentType:"oneoff",paymentAmount:Fe.value,paymentStatus:Fe.valuePaymentStatus,receivedDate:Fe.valueReceivedDate,members:Ue.opportunityMembers,currentSplits:Fe.valueMemberSplits,onSplitsUpdate:e=>{_e({variables:{id:ie,input:{valueMemberSplits:e}}}).then(()=>{Ne()})},onPaymentStatusUpdate:()=>{Ne()}}):(0,he.jsxs)(b.F,{status:"info",borderRadius:"md",children:[(0,he.jsx)(y._,{}),(0,he.jsx)(j.E,{children:"Add team members above to configure commission splits for this payment"})]})})]}),((null===(c=Fe.paymentSchedule)||void 0===c?void 0:c.length)>0||Fe.recurringPayment)&&(0,he.jsxs)(w.Z,{bg:ye,borderColor:Se,borderWidth:"1px",boxShadow:"sm",overflow:"hidden",children:[(0,he.jsx)(W.a,{bg:Ce,borderBottom:"1px solid ".concat(Se),children:(0,he.jsx)(D.D,{size:"md",color:ve,children:"Other Payment Types"})}),(0,he.jsx)(T.b,{children:(0,he.jsxs)(S.T,{spacing:4,align:"stretch",children:[null===(Z=Fe.paymentSchedule)||void 0===Z?void 0:Z.map((e,t)=>(0,he.jsx)(Ct,{opportunityId:ie||"",paymentType:"schedule",paymentAmount:e.amount,paymentLabel:"".concat(t),paymentStatus:e.paymentStatus,receivedDate:e.receivedDate,members:(null===Ue||void 0===Ue?void 0:Ue.opportunityMembers)||[],currentSplits:e.memberSplits,onSplitsUpdate:e=>{const n=Fe.paymentSchedule.map((n,r)=>r===t?{description:n.description,amount:n.amount,dueDate:n.dueDate,status:n.status,paidDate:n.paidDate,notes:n.notes,memberSplits:e}:{description:n.description,amount:n.amount,dueDate:n.dueDate,status:n.status,paidDate:n.paidDate,notes:n.notes,memberSplits:n.memberSplits});_e({variables:{id:ie,input:{paymentSchedule:n}}}).then(()=>{Ne()})},onPaymentStatusUpdate:()=>{Ne()}},t)),Fe.recurringPayment&&(0,he.jsx)(Ct,{opportunityId:ie||"",paymentType:"recurring",paymentAmount:Fe.recurringPayment.monthlyAmount,paymentStatus:Fe.recurringPayment.paymentStatus,receivedDate:Fe.recurringPayment.lastPaymentDate,members:(null===Ue||void 0===Ue?void 0:Ue.opportunityMembers)||[],currentSplits:Fe.recurringPayment.memberSplits,onSplitsUpdate:e=>{_e({variables:{id:ie,input:{recurringPayment:{monthlyAmount:Fe.recurringPayment.monthlyAmount,probability:Fe.recurringPayment.probability,description:Fe.recurringPayment.description,startDate:Fe.recurringPayment.startDate,endDate:Fe.recurringPayment.endDate,memberSplits:e}}}}).then(()=>{Ne()})},onPaymentStatusUpdate:()=>{Ne()}}),!Fe.value&&(!Fe.paymentSchedule||0===Fe.paymentSchedule.length)&&!Fe.recurringPayment&&(0,he.jsxs)(b.F,{status:"info",borderRadius:"md",children:[(0,he.jsx)(y._,{}),(0,he.jsx)(j.E,{children:"Configure payment details in the Payment Tracking tab to set up commission splits"})]})]})})]})]})}),(0,he.jsx)(J.K,{px:0,children:(0,he.jsxs)($.t,{variant:"soft-rounded",colorScheme:"blue",children:[(0,he.jsxs)(L.w,{mb:4,children:[(0,he.jsx)(_.o,{children:"Tasks"}),(0,he.jsx)(_.o,{children:"Meetings"})]}),(0,he.jsxs)(G.T,{children:[(0,he.jsx)(J.K,{px:0,children:(0,he.jsx)(be,{opportunityId:Fe.id})}),(0,he.jsx)(J.K,{px:0,children:(0,he.jsx)(Te,{opportunityId:Fe.id})})]})]})}),(0,he.jsx)(J.K,{px:0,children:(0,he.jsx)($e,{opportunityId:Fe.id})})]})]})]})}),(0,he.jsx)(te.n,{})]});var Ze,Ye}}}]);
//# sourceMappingURL=6934.baf506e2.chunk.js.map